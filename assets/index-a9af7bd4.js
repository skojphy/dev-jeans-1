(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))p(_);new MutationObserver(_=>{for(const C of _)if(C.type==="childList")for(const y of C.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&p(y)}).observe(document,{childList:!0,subtree:!0});function d(_){const C={};return _.integrity&&(C.integrity=_.integrity),_.referrerPolicy&&(C.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?C.credentials="include":_.crossOrigin==="anonymous"?C.credentials="omit":C.credentials="same-origin",C}function p(_){if(_.ep)return;_.ep=!0;const C=d(_);fetch(_.href,C)}})();function bt(){}function yr(c,t){for(const d in t)c[d]=t[d];return c}function Sn(c){return c()}function ki(){return Object.create(null)}function It(c){c.forEach(Sn)}function Ye(c){return typeof c=="function"}function Ot(c,t){return c!=c?t==t:c!==t||c&&typeof c=="object"||typeof c=="function"}let ke;function li(c,t){return ke||(ke=document.createElement("a")),ke.href=t,c===ke.href}function br(c){return Object.keys(c).length===0}function Tn(c,...t){if(c==null)return bt;const d=c.subscribe(...t);return d.unsubscribe?()=>d.unsubscribe():d}function jt(c,t,d){c.$$.on_destroy.push(Tn(t,d))}function we(c,t,d,p){if(c){const _=xn(c,t,d,p);return c[0](_)}}function xn(c,t,d,p){return c[1]&&p?yr(d.ctx.slice(),c[1](p(t))):d.ctx}function Se(c,t,d,p){if(c[2]&&p){const _=c[2](p(d));if(t.dirty===void 0)return _;if(typeof _=="object"){const C=[],y=Math.max(t.dirty.length,_.length);for(let h=0;h<y;h+=1)C[h]=t.dirty[h]|_[h];return C}return t.dirty|_}return t.dirty}function Te(c,t,d,p,_,C){if(_){const y=xn(t,d,p,C);c.p(y,_)}}function xe(c){if(c.ctx.length>32){const t=[],d=c.ctx.length/32;for(let p=0;p<d;p++)t[p]=-1;return t}return-1}function Fe(c){return c??""}function Re(c,t,d){return c.set(d),t}function it(c,t){c.appendChild(t)}function ht(c,t,d){c.insertBefore(t,d||null)}function lt(c){c.parentNode&&c.parentNode.removeChild(c)}function Le(c,t){for(let d=0;d<c.length;d+=1)c[d]&&c[d].d(t)}function nt(c){return document.createElement(c)}function Vt(c){return document.createTextNode(c)}function mt(){return Vt(" ")}function Gt(){return Vt("")}function ut(c,t,d,p){return c.addEventListener(t,d,p),()=>c.removeEventListener(t,d,p)}function Ut(c){return function(t){return t.preventDefault(),c.call(this,t)}}function re(c){return function(t){return t.stopPropagation(),c.call(this,t)}}function Cr(c){return function(t){t.target===this&&c.call(this,t)}}function L(c,t,d){d==null?c.removeAttribute(t):c.getAttribute(t)!==d&&c.setAttribute(t,d)}function wr(c){return Array.from(c.childNodes)}function ge(c,t){t=""+t,c.wholeText!==t&&(c.data=t)}function Nt(c,t,d,p){d===null?c.style.removeProperty(t):c.style.setProperty(t,d,p?"important":"")}function Rt(c,t,d){c.classList[d?"add":"remove"](t)}function Sr(c,t,{bubbles:d=!1,cancelable:p=!1}={}){const _=document.createEvent("CustomEvent");return _.initCustomEvent(c,d,p,t),_}function St(c,t){return new c(t)}let Oe;function ye(c){Oe=c}function On(){if(!Oe)throw new Error("Function called outside component initialization");return Oe}function An(c){On().$$.on_mount.push(c)}function Tr(){const c=On();return(t,d,{cancelable:p=!1}={})=>{const _=c.$$.callbacks[t];if(_){const C=Sr(t,d,{cancelable:p});return _.slice().forEach(y=>{y.call(c,C)}),!C.defaultPrevented}return!0}}function xr(c,t){const d=c.$$.callbacks[t.type];d&&d.slice().forEach(p=>p.call(this,t))}const fe=[],Ct=[];let de=[];const hi=[],Or=Promise.resolve();let ci=!1;function Ar(){ci||(ci=!0,Or.then(En))}function ui(c){de.push(c)}function Wt(c){hi.push(c)}const qe=new Set;let ce=0;function En(){if(ce!==0)return;const c=Oe;do{try{for(;ce<fe.length;){const t=fe[ce];ce++,ye(t),Er(t.$$)}}catch(t){throw fe.length=0,ce=0,t}for(ye(null),fe.length=0,ce=0;Ct.length;)Ct.pop()();for(let t=0;t<de.length;t+=1){const d=de[t];qe.has(d)||(qe.add(d),d())}de.length=0}while(fe.length);for(;hi.length;)hi.pop()();ci=!1,qe.clear(),ye(c)}function Er(c){if(c.fragment!==null){c.update(),It(c.before_update);const t=c.dirty;c.dirty=[-1],c.fragment&&c.fragment.p(c.ctx,t),c.after_update.forEach(ui)}}function kr(c){const t=[],d=[];de.forEach(p=>c.indexOf(p)===-1?t.push(p):d.push(p)),d.forEach(p=>p()),de=t}const Ie=new Set;let ie;function Dt(){ie={r:0,c:[],p:ie}}function Mt(){ie.r||It(ie.c),ie=ie.p}function at(c,t){c&&c.i&&(Ie.delete(c),c.i(t))}function ft(c,t,d,p){if(c&&c.o){if(Ie.has(c))return;Ie.add(c),ie.c.push(()=>{Ie.delete(c),p&&(d&&c.d(1),p())}),c.o(t)}else p&&p()}const bi=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Pt(c,t,d){const p=c.$$.props[t];p!==void 0&&(c.$$.bound[p]=d,d(c.$$.ctx[p]))}function yt(c){c&&c.c()}function pt(c,t,d,p){const{fragment:_,after_update:C}=c.$$;_&&_.m(t,d),p||ui(()=>{const y=c.$$.on_mount.map(Sn).filter(Ye);c.$$.on_destroy?c.$$.on_destroy.push(...y):It(y),c.$$.on_mount=[]}),C.forEach(ui)}function vt(c,t){const d=c.$$;d.fragment!==null&&(kr(d.after_update),It(d.on_destroy),d.fragment&&d.fragment.d(t),d.on_destroy=d.fragment=null,d.ctx=[])}function Pr(c,t){c.$$.dirty[0]===-1&&(fe.push(c),Ar(),c.$$.dirty.fill(0)),c.$$.dirty[t/31|0]|=1<<t%31}function At(c,t,d,p,_,C,y,h=[-1]){const e=Oe;ye(c);const o=c.$$={fragment:null,ctx:[],props:C,update:bt,not_equal:_,bound:ki(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(e?e.$$.context:[])),callbacks:ki(),dirty:h,skip_bound:!1,root:t.target||e.$$.root};y&&y(o.root);let l=!1;if(o.ctx=d?d(c,t.props||{},(n,r,...i)=>{const a=i.length?i[0]:r;return o.ctx&&_(o.ctx[n],o.ctx[n]=a)&&(!o.skip_bound&&o.bound[n]&&o.bound[n](a),l&&Pr(c,n)),r}):[],o.update(),l=!0,It(o.before_update),o.fragment=p?p(o.ctx):!1,t.target){if(t.hydrate){const n=wr(t.target);o.fragment&&o.fragment.l(n),n.forEach(lt)}else o.fragment&&o.fragment.c();t.intro&&at(c.$$.fragment),pt(c,t.target,t.anchor,t.customElement),En()}ye(e)}class Et{$destroy(){vt(this,1),this.$destroy=bt}$on(t,d){if(!Ye(d))return bt;const p=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return p.push(d),()=>{const _=p.indexOf(d);_!==-1&&p.splice(_,1)}}$set(t){this.$$set&&!br(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Dr="/assets/dev-jeans-a579548d.png";function Mr(c){if(c.__esModule)return c;var t=c.default;if(typeof t=="function"){var d=function p(){if(this instanceof p){var _=[null];_.push.apply(_,arguments);var C=Function.bind.apply(t,_);return new C}return t.apply(this,arguments)};d.prototype=t.prototype}else d={};return Object.defineProperty(d,"__esModule",{value:!0}),Object.keys(c).forEach(function(p){var _=Object.getOwnPropertyDescriptor(c,p);Object.defineProperty(d,p,_.get?_:{enumerable:!0,get:function(){return c[p]}})}),d}var me={};const Ir={},Fr=Object.freeze(Object.defineProperty({__proto__:null,default:Ir},Symbol.toStringTag,{value:"Module"})),Ke=Mr(Fr);(function(c){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var t=t||{version:"5.3.0"};if(c.fabric=t,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?t.document=document:t.document=document.implementation.createHTMLDocument(""),t.window=window;else{var d=Ke,p=new d.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;t.document=p.document,t.jsdomImplForWrapper=Ke.implForWrapper,t.nodeCanvas=Ke.Canvas,t.window=p,DOMParser=t.window.DOMParser}t.isTouchSupported="ontouchstart"in t.window||"ontouchstart"in t.document||t.window&&t.window.navigator&&t.window.navigator.maxTouchPoints>0,t.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",t.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],t.DPI=96,t.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",t.commaWsp="(?:\\s+,?\\s*|,\\s*)",t.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,t.reNonWord=/[ \n\.,;!\?\-]/,t.fontPaths={},t.iMatrix=[1,0,0,1,0,0],t.svgNS="http://www.w3.org/2000/svg",t.perfLimitSizeTotal=2097152,t.maxCacheSideLimit=4096,t.minCacheSideLimit=256,t.charWidthsCache={},t.textureSize=2048,t.disableStyleCopyPaste=!1,t.enableGLFiltering=!0,t.devicePixelRatio=t.window.devicePixelRatio||t.window.webkitDevicePixelRatio||t.window.mozDevicePixelRatio||1,t.browserShadowBlurConstant=1,t.arcToSegmentsCache={},t.boundsOfCurveCache={},t.cachesBoundsOfCurve=!0,t.forceGLPutImageData=!1,t.initFilterBackend=function(){if(t.enableGLFiltering&&t.isWebglSupported&&t.isWebglSupported(t.textureSize))return console.log("max texture size: "+t.maxTextureSize),new t.WebglFilterBackend({tileSize:t.textureSize});if(t.Canvas2dFilterBackend)return new t.Canvas2dFilterBackend},typeof document<"u"&&typeof window<"u"&&(window.fabric=t),function(){function h(i,a){if(this.__eventListeners[i]){var u=this.__eventListeners[i];a?u[u.indexOf(a)]=!1:t.util.array.fill(u,!1)}}function e(i,a){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var u in i)this.on(u,i[u]);else this.__eventListeners[i]||(this.__eventListeners[i]=[]),this.__eventListeners[i].push(a);return this}function o(i,a){var u=function(){a.apply(this,arguments),this.off(i,u)}.bind(this);this.on(i,u)}function l(i,a){if(arguments.length===1)for(var u in i)o.call(this,u,i[u]);else o.call(this,i,a);return this}function n(i,a){if(!this.__eventListeners)return this;if(arguments.length===0)for(i in this.__eventListeners)h.call(this,i);else if(arguments.length===1&&typeof arguments[0]=="object")for(var u in i)h.call(this,u,i[u]);else h.call(this,i,a);return this}function r(i,a){if(!this.__eventListeners)return this;var u=this.__eventListeners[i];if(!u)return this;for(var s=0,f=u.length;s<f;s++)u[s]&&u[s].call(this,a||{});return this.__eventListeners[i]=u.filter(function(g){return g!==!1}),this}t.Observable={fire:r,on:e,once:l,off:n}}(),t.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var h=0,e=arguments.length;h<e;h++)this._onObjectAdded(arguments[h]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(h,e,o){var l=this._objects;return o?l[e]=h:l.splice(e,0,h),this._onObjectAdded&&this._onObjectAdded(h),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var h=this._objects,e,o=!1,l=0,n=arguments.length;l<n;l++)e=h.indexOf(arguments[l]),e!==-1&&(o=!0,h.splice(e,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[l]));return this.renderOnAddRemove&&o&&this.requestRenderAll(),this},forEachObject:function(h,e){for(var o=this.getObjects(),l=0,n=o.length;l<n;l++)h.call(e,o[l],l,o);return this},getObjects:function(h){return typeof h>"u"?this._objects.concat():this._objects.filter(function(e){return e.type===h})},item:function(h){return this._objects[h]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(h,e){return this._objects.indexOf(h)>-1?!0:e?this._objects.some(function(o){return typeof o.contains=="function"&&o.contains(h,!0)}):!1},complexity:function(){return this._objects.reduce(function(h,e){return h+=e.complexity?e.complexity():0,h},0)}},t.CommonMethods={_setOptions:function(h){for(var e in h)this.set(e,h[e])},_initGradient:function(h,e){h&&h.colorStops&&!(h instanceof t.Gradient)&&this.set(e,new t.Gradient(h))},_initPattern:function(h,e,o){h&&h.source&&!(h instanceof t.Pattern)?this.set(e,new t.Pattern(h,o)):o&&o()},_setObject:function(h){for(var e in h)this._set(e,h[e])},set:function(h,e){return typeof h=="object"?this._setObject(h):this._set(h,e),this},_set:function(h,e){this[h]=e},toggle:function(h){var e=this.get(h);return typeof e=="boolean"&&this.set(h,!e),this},get:function(h){return this[h]}},function(h){var e=Math.sqrt,o=Math.atan2,l=Math.pow,n=Math.PI/180,r=Math.PI/2;t.util={cos:function(i){if(i===0)return 1;i<0&&(i=-i);var a=i/r;switch(a){case 1:case 3:return 0;case 2:return-1}return Math.cos(i)},sin:function(i){if(i===0)return 0;var a=i/r,u=1;switch(i<0&&(u=-1),a){case 1:return u;case 2:return 0;case 3:return-u}return Math.sin(i)},removeFromArray:function(i,a){var u=i.indexOf(a);return u!==-1&&i.splice(u,1),i},getRandomInt:function(i,a){return Math.floor(Math.random()*(a-i+1))+i},degreesToRadians:function(i){return i*n},radiansToDegrees:function(i){return i/n},rotatePoint:function(i,a,u){var s=new t.Point(i.x-a.x,i.y-a.y),f=t.util.rotateVector(s,u);return new t.Point(f.x,f.y).addEquals(a)},rotateVector:function(i,a){var u=t.util.sin(a),s=t.util.cos(a),f=i.x*s-i.y*u,g=i.x*u+i.y*s;return{x:f,y:g}},createVector:function(i,a){return new t.Point(a.x-i.x,a.y-i.y)},calcAngleBetweenVectors:function(i,a){return Math.acos((i.x*a.x+i.y*a.y)/(Math.hypot(i.x,i.y)*Math.hypot(a.x,a.y)))},getHatVector:function(i){return new t.Point(i.x,i.y).multiply(1/Math.hypot(i.x,i.y))},getBisector:function(i,a,u){var s=t.util.createVector(i,a),f=t.util.createVector(i,u),g=t.util.calcAngleBetweenVectors(s,f),m=t.util.calcAngleBetweenVectors(t.util.rotateVector(s,g),f),v=g*(m===0?1:-1)/2;return{vector:t.util.getHatVector(t.util.rotateVector(s,v)),angle:g}},projectStrokeOnPoints:function(i,a,u){var s=[],f=a.strokeWidth/2,g=a.strokeUniform?new t.Point(1/a.scaleX,1/a.scaleY):new t.Point(1,1),m=function(v){var b=f/Math.hypot(v.x,v.y);return new t.Point(v.x*b*g.x,v.y*b*g.y)};return i.length<=1||i.forEach(function(v,b){var w=new t.Point(v.x,v.y),S,A;b===0?(A=i[b+1],S=u?m(t.util.createVector(A,w)).addEquals(w):i[i.length-1]):b===i.length-1?(S=i[b-1],A=u?m(t.util.createVector(S,w)).addEquals(w):i[0]):(S=i[b-1],A=i[b+1]);var D=t.util.getBisector(w,S,A),X=D.vector,K=D.angle,$,H;if(a.strokeLineJoin==="miter"&&($=-f/Math.sin(K/2),H=new t.Point(X.x*$*g.x,X.y*$*g.y),Math.hypot(H.x,H.y)/f<=a.strokeMiterLimit)){s.push(w.add(H)),s.push(w.subtract(H));return}$=-f*Math.SQRT2,H=new t.Point(X.x*$*g.x,X.y*$*g.y),s.push(w.add(H)),s.push(w.subtract(H))}),s},transformPoint:function(i,a,u){return u?new t.Point(a[0]*i.x+a[2]*i.y,a[1]*i.x+a[3]*i.y):new t.Point(a[0]*i.x+a[2]*i.y+a[4],a[1]*i.x+a[3]*i.y+a[5])},makeBoundingBoxFromPoints:function(i,a){if(a)for(var u=0;u<i.length;u++)i[u]=t.util.transformPoint(i[u],a);var s=[i[0].x,i[1].x,i[2].x,i[3].x],f=t.util.array.min(s),g=t.util.array.max(s),m=g-f,v=[i[0].y,i[1].y,i[2].y,i[3].y],b=t.util.array.min(v),w=t.util.array.max(v),S=w-b;return{left:f,top:b,width:m,height:S}},invertTransform:function(i){var a=1/(i[0]*i[3]-i[1]*i[2]),u=[a*i[3],-a*i[1],-a*i[2],a*i[0]],s=t.util.transformPoint({x:i[4],y:i[5]},u,!0);return u[4]=-s.x,u[5]=-s.y,u},toFixed:function(i,a){return parseFloat(Number(i).toFixed(a))},parseUnit:function(i,a){var u=/\D{0,2}$/.exec(i),s=parseFloat(i);switch(a||(a=t.Text.DEFAULT_SVG_FONT_SIZE),u[0]){case"mm":return s*t.DPI/25.4;case"cm":return s*t.DPI/2.54;case"in":return s*t.DPI;case"pt":return s*t.DPI/72;case"pc":return s*t.DPI/72*12;case"em":return s*a;default:return s}},falseFunction:function(){return!1},getKlass:function(i,a){return i=t.util.string.camelize(i.charAt(0).toUpperCase()+i.slice(1)),t.util.resolveNamespace(a)[i]},getSvgAttributes:function(i){var a=["instantiated_by_use","style","id","class"];switch(i){case"linearGradient":a=a.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":a=a.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":a=a.concat(["offset","stop-color","stop-opacity"]);break}return a},resolveNamespace:function(i){if(!i)return t;var a=i.split("."),u=a.length,s,f=h||t.window;for(s=0;s<u;++s)f=f[a[s]];return f},loadImage:function(i,a,u,s){if(!i){a&&a.call(u,i);return}var f=t.util.createImage(),g=function(){a&&a.call(u,f,!1),f=f.onload=f.onerror=null};f.onload=g,f.onerror=function(){t.log("Error loading "+f.src),a&&a.call(u,null,!0),f=f.onload=f.onerror=null},i.indexOf("data")!==0&&s!==void 0&&s!==null&&(f.crossOrigin=s),i.substring(0,14)==="data:image/svg"&&(f.onload=null,t.util.loadImageInDom(f,g)),f.src=i},loadImageInDom:function(i,a){var u=t.document.createElement("div");u.style.width=u.style.height="1px",u.style.left=u.style.top="-100%",u.style.position="absolute",u.appendChild(i),t.document.querySelector("body").appendChild(u),i.onload=function(){a(),u.parentNode.removeChild(u),u=null}},enlivenObjects:function(i,a,u,s){i=i||[];var f=[],g=0,m=i.length;function v(){++g===m&&a&&a(f.filter(function(b){return b}))}if(!m){a&&a(f);return}i.forEach(function(b,w){if(!b||!b.type){v();return}var S=t.util.getKlass(b.type,u);S.fromObject(b,function(A,D){D||(f[w]=A),s&&s(b,A,D),v()})})},enlivenObjectEnlivables:function(i,a,u){var s=t.Object.ENLIVEN_PROPS.filter(function(f){return!!i[f]});t.util.enlivenObjects(s.map(function(f){return i[f]}),function(f){var g={};s.forEach(function(m,v){g[m]=f[v],a&&(a[m]=f[v])}),u&&u(g)})},enlivenPatterns:function(i,a){i=i||[];function u(){++f===g&&a&&a(s)}var s=[],f=0,g=i.length;if(!g){a&&a(s);return}i.forEach(function(m,v){m&&m.source?new t.Pattern(m,function(b){s[v]=b,u()}):(s[v]=m,u())})},groupSVGElements:function(i,a,u){var s;return i&&i.length===1?(typeof u<"u"&&(i[0].sourcePath=u),i[0]):(a&&(a.width&&a.height?a.centerPoint={x:a.width/2,y:a.height/2}:(delete a.width,delete a.height)),s=new t.Group(i,a),typeof u<"u"&&(s.sourcePath=u),s)},populateWithProperties:function(i,a,u){if(u&&Array.isArray(u))for(var s=0,f=u.length;s<f;s++)u[s]in i&&(a[u[s]]=i[u[s]])},createCanvasElement:function(){return t.document.createElement("canvas")},copyCanvasElement:function(i){var a=t.util.createCanvasElement();return a.width=i.width,a.height=i.height,a.getContext("2d").drawImage(i,0,0),a},toDataURL:function(i,a,u){return i.toDataURL("image/"+a,u)},createImage:function(){return t.document.createElement("img")},multiplyTransformMatrices:function(i,a,u){return[i[0]*a[0]+i[2]*a[1],i[1]*a[0]+i[3]*a[1],i[0]*a[2]+i[2]*a[3],i[1]*a[2]+i[3]*a[3],u?0:i[0]*a[4]+i[2]*a[5]+i[4],u?0:i[1]*a[4]+i[3]*a[5]+i[5]]},qrDecompose:function(i){var a=o(i[1],i[0]),u=l(i[0],2)+l(i[1],2),s=e(u),f=(i[0]*i[3]-i[2]*i[1])/s,g=o(i[0]*i[2]+i[1]*i[3],u);return{angle:a/n,scaleX:s,scaleY:f,skewX:g/n,skewY:0,translateX:i[4],translateY:i[5]}},calcRotateMatrix:function(i){if(!i.angle)return t.iMatrix.concat();var a=t.util.degreesToRadians(i.angle),u=t.util.cos(a),s=t.util.sin(a);return[u,s,-s,u,0,0]},calcDimensionsMatrix:function(i){var a=typeof i.scaleX>"u"?1:i.scaleX,u=typeof i.scaleY>"u"?1:i.scaleY,s=[i.flipX?-a:a,0,0,i.flipY?-u:u,0,0],f=t.util.multiplyTransformMatrices,g=t.util.degreesToRadians;return i.skewX&&(s=f(s,[1,0,Math.tan(g(i.skewX)),1],!0)),i.skewY&&(s=f(s,[1,Math.tan(g(i.skewY)),0,1],!0)),s},composeMatrix:function(i){var a=[1,0,0,1,i.translateX||0,i.translateY||0],u=t.util.multiplyTransformMatrices;return i.angle&&(a=u(a,t.util.calcRotateMatrix(i))),(i.scaleX!==1||i.scaleY!==1||i.skewX||i.skewY||i.flipX||i.flipY)&&(a=u(a,t.util.calcDimensionsMatrix(i))),a},resetObjectTransform:function(i){i.scaleX=1,i.scaleY=1,i.skewX=0,i.skewY=0,i.flipX=!1,i.flipY=!1,i.rotate(0)},saveObjectTransform:function(i){return{scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,angle:i.angle,left:i.left,flipX:i.flipX,flipY:i.flipY,top:i.top}},isTransparent:function(i,a,u,s){s>0&&(a>s?a-=s:a=0,u>s?u-=s:u=0);var f=!0,g,m,v=i.getImageData(a,u,s*2||1,s*2||1),b=v.data.length;for(g=3;g<b&&(m=v.data[g],f=m<=0,f!==!1);g+=4);return v=null,f},parsePreserveAspectRatioAttribute:function(i){var a="meet",u="Mid",s="Mid",f=i.split(" "),g;return f&&f.length&&(a=f.pop(),a!=="meet"&&a!=="slice"?(g=a,a="meet"):f.length&&(g=f.pop())),u=g!=="none"?g.slice(1,4):"none",s=g!=="none"?g.slice(5,8):"none",{meetOrSlice:a,alignX:u,alignY:s}},clearFabricFontCache:function(i){i=(i||"").toLowerCase(),i?t.charWidthsCache[i]&&delete t.charWidthsCache[i]:t.charWidthsCache={}},limitDimsByArea:function(i,a){var u=Math.sqrt(a*i),s=Math.floor(a/u);return{x:Math.floor(u),y:s}},capValue:function(i,a,u){return Math.max(i,Math.min(a,u))},findScaleToFit:function(i,a){return Math.min(a.width/i.width,a.height/i.height)},findScaleToCover:function(i,a){return Math.max(a.width/i.width,a.height/i.height)},matrixToSVG:function(i){return"matrix("+i.map(function(a){return t.util.toFixed(a,t.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(i,a){var u=t.util.invertTransform(a),s=t.util.multiplyTransformMatrices(u,i.calcOwnMatrix());t.util.applyTransformToObject(i,s)},addTransformToObject:function(i,a){t.util.applyTransformToObject(i,t.util.multiplyTransformMatrices(a,i.calcOwnMatrix()))},applyTransformToObject:function(i,a){var u=t.util.qrDecompose(a),s=new t.Point(u.translateX,u.translateY);i.flipX=!1,i.flipY=!1,i.set("scaleX",u.scaleX),i.set("scaleY",u.scaleY),i.skewX=u.skewX,i.skewY=u.skewY,i.angle=u.angle,i.setPositionByOrigin(s,"center","center")},sizeAfterTransform:function(i,a,u){var s=i/2,f=a/2,g=[{x:-s,y:-f},{x:s,y:-f},{x:-s,y:f},{x:s,y:f}],m=t.util.calcDimensionsMatrix(u),v=t.util.makeBoundingBoxFromPoints(g,m);return{x:v.width,y:v.height}},mergeClipPaths:function(i,a){var u=i,s=a;u.inverted&&!s.inverted&&(u=a,s=i),t.util.applyTransformToObject(s,t.util.multiplyTransformMatrices(t.util.invertTransform(u.calcTransformMatrix()),s.calcTransformMatrix()));var f=u.inverted&&s.inverted;return f&&(u.inverted=s.inverted=!1),new t.Group([u],{clipPath:s,inverted:f})},hasStyleChanged:function(i,a,u){return u=u||!1,i.fill!==a.fill||i.stroke!==a.stroke||i.strokeWidth!==a.strokeWidth||i.fontSize!==a.fontSize||i.fontFamily!==a.fontFamily||i.fontWeight!==a.fontWeight||i.fontStyle!==a.fontStyle||i.textBackgroundColor!==a.textBackgroundColor||i.deltaY!==a.deltaY||u&&(i.overline!==a.overline||i.underline!==a.underline||i.linethrough!==a.linethrough)},stylesToArray:function(u,a){for(var u=t.util.object.clone(u,!0),s=a.split(`
`),f=-1,g={},m=[],v=0;v<s.length;v++){if(!u[v]){f+=s[v].length;continue}for(var b=0;b<s[v].length;b++){f++;var w=u[v][b];if(w&&Object.keys(w).length>0){var S=t.util.hasStyleChanged(g,w,!0);S?m.push({start:f,end:f+1,style:w}):m[m.length-1].end++}g=w||{}}}return m},stylesFromArray:function(i,a){if(!Array.isArray(i))return i;for(var u=a.split(`
`),s=-1,f=0,g={},m=0;m<u.length;m++)for(var v=0;v<u[m].length;v++)s++,i[f]&&i[f].start<=s&&s<i[f].end&&(g[m]=g[m]||{},g[m][v]=Object.assign({},i[f].style),s===i[f].end-1&&f++);return g}}}(c),function(){var h=Array.prototype.join,e={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},o={m:"l",M:"L"};function l(T,k,P,E,B,O,x,M,R,Y,j){var G=t.util.cos(T),I=t.util.sin(T),tt=t.util.cos(k),W=t.util.sin(k),F=P*B*tt-E*O*W+x,U=E*B*tt+P*O*W+M,V=Y+R*(-P*B*I-E*O*G),N=j+R*(-E*B*I+P*O*G),q=F+R*(P*B*W+E*O*tt),et=U+R*(E*B*W-P*O*tt);return["C",V,N,q,et,F,U]}function n(T,k,P,E,B,O,x){var M=Math.PI,R=x*M/180,Y=t.util.sin(R),j=t.util.cos(R),G=0,I=0;P=Math.abs(P),E=Math.abs(E);var tt=-j*T*.5-Y*k*.5,W=-j*k*.5+Y*T*.5,F=P*P,U=E*E,V=W*W,N=tt*tt,q=F*U-F*V-U*N,et=0;if(q<0){var dt=Math.sqrt(1-q/(F*U));P*=dt,E*=dt}else et=(B===O?-1:1)*Math.sqrt(q/(F*V+U*N));var ot=et*P*W/E,z=-et*E*tt/P,ct=j*ot-Y*z+T*.5,gt=Y*ot+j*z+k*.5,_t=r(1,0,(tt-ot)/P,(W-z)/E),xt=r((tt-ot)/P,(W-z)/E,(-tt-ot)/P,(-W-z)/E);O===0&&xt>0?xt-=2*M:O===1&&xt<0&&(xt+=2*M);for(var wt=Math.ceil(Math.abs(xt/M*2)),Lt=[],kt=xt/wt,te=8/3*Math.sin(kt/4)*Math.sin(kt/4)/Math.sin(kt/2),ve=_t+kt,zt=0;zt<wt;zt++)Lt[zt]=l(_t,ve,j,Y,P,E,ct,gt,te,G,I),G=Lt[zt][5],I=Lt[zt][6],_t=ve,ve+=kt;return Lt}function r(T,k,P,E){var B=Math.atan2(k,T),O=Math.atan2(E,P);return O>=B?O-B:2*Math.PI-(B-O)}function i(T,k,P,E,B,O,x,M){var R;if(t.cachesBoundsOfCurve&&(R=h.call(arguments),t.boundsOfCurveCache[R]))return t.boundsOfCurveCache[R];var Y=Math.sqrt,j=Math.min,G=Math.max,I=Math.abs,tt=[],W=[[],[]],F,U,V,N,q,et,dt,ot;U=6*T-12*P+6*B,F=-3*T+9*P-9*B+3*x,V=3*P-3*T;for(var z=0;z<2;++z){if(z>0&&(U=6*k-12*E+6*O,F=-3*k+9*E-9*O+3*M,V=3*E-3*k),I(F)<1e-12){if(I(U)<1e-12)continue;N=-V/U,0<N&&N<1&&tt.push(N);continue}dt=U*U-4*V*F,!(dt<0)&&(ot=Y(dt),q=(-U+ot)/(2*F),0<q&&q<1&&tt.push(q),et=(-U-ot)/(2*F),0<et&&et<1&&tt.push(et))}for(var ct,gt,_t=tt.length,xt=_t,wt;_t--;)N=tt[_t],wt=1-N,ct=wt*wt*wt*T+3*wt*wt*N*P+3*wt*N*N*B+N*N*N*x,W[0][_t]=ct,gt=wt*wt*wt*k+3*wt*wt*N*E+3*wt*N*N*O+N*N*N*M,W[1][_t]=gt;W[0][xt]=T,W[1][xt]=k,W[0][xt+1]=x,W[1][xt+1]=M;var Lt=[{x:j.apply(null,W[0]),y:j.apply(null,W[1])},{x:G.apply(null,W[0]),y:G.apply(null,W[1])}];return t.cachesBoundsOfCurve&&(t.boundsOfCurveCache[R]=Lt),Lt}function a(T,k,P){for(var E=P[1],B=P[2],O=P[3],x=P[4],M=P[5],R=P[6],Y=P[7],j=n(R-T,Y-k,E,B,x,M,O),G=0,I=j.length;G<I;G++)j[G][1]+=T,j[G][2]+=k,j[G][3]+=T,j[G][4]+=k,j[G][5]+=T,j[G][6]+=k;return j}function u(T){var k=0,P=0,E=T.length,B=0,O=0,x,M,R,Y=[],j,G,I;for(M=0;M<E;++M){switch(R=!1,x=T[M].slice(0),x[0]){case"l":x[0]="L",x[1]+=k,x[2]+=P;case"L":k=x[1],P=x[2];break;case"h":x[1]+=k;case"H":x[0]="L",x[2]=P,k=x[1];break;case"v":x[1]+=P;case"V":x[0]="L",P=x[1],x[1]=k,x[2]=P;break;case"m":x[0]="M",x[1]+=k,x[2]+=P;case"M":k=x[1],P=x[2],B=x[1],O=x[2];break;case"c":x[0]="C",x[1]+=k,x[2]+=P,x[3]+=k,x[4]+=P,x[5]+=k,x[6]+=P;case"C":G=x[3],I=x[4],k=x[5],P=x[6];break;case"s":x[0]="S",x[1]+=k,x[2]+=P,x[3]+=k,x[4]+=P;case"S":j==="C"?(G=2*k-G,I=2*P-I):(G=k,I=P),k=x[3],P=x[4],x[0]="C",x[5]=x[3],x[6]=x[4],x[3]=x[1],x[4]=x[2],x[1]=G,x[2]=I,G=x[3],I=x[4];break;case"q":x[0]="Q",x[1]+=k,x[2]+=P,x[3]+=k,x[4]+=P;case"Q":G=x[1],I=x[2],k=x[3],P=x[4];break;case"t":x[0]="T",x[1]+=k,x[2]+=P;case"T":j==="Q"?(G=2*k-G,I=2*P-I):(G=k,I=P),x[0]="Q",k=x[1],P=x[2],x[1]=G,x[2]=I,x[3]=k,x[4]=P;break;case"a":x[0]="A",x[6]+=k,x[7]+=P;case"A":R=!0,Y=Y.concat(a(k,P,x)),k=x[6],P=x[7];break;case"z":case"Z":k=B,P=O;break}R||Y.push(x),j=x[0]}return Y}function s(T,k,P,E){return Math.sqrt((P-T)*(P-T)+(E-k)*(E-k))}function f(T){return T*T*T}function g(T){return 3*T*T*(1-T)}function m(T){return 3*T*(1-T)*(1-T)}function v(T){return(1-T)*(1-T)*(1-T)}function b(T,k,P,E,B,O,x,M){return function(R){var Y=f(R),j=g(R),G=m(R),I=v(R);return{x:x*Y+B*j+P*G+T*I,y:M*Y+O*j+E*G+k*I}}}function w(T,k,P,E,B,O,x,M){return function(R){var Y=1-R,j=3*Y*Y*(P-T)+6*Y*R*(B-P)+3*R*R*(x-B),G=3*Y*Y*(E-k)+6*Y*R*(O-E)+3*R*R*(M-O);return Math.atan2(G,j)}}function S(T){return T*T}function A(T){return 2*T*(1-T)}function D(T){return(1-T)*(1-T)}function X(T,k,P,E,B,O){return function(x){var M=S(x),R=A(x),Y=D(x);return{x:B*M+P*R+T*Y,y:O*M+E*R+k*Y}}}function K(T,k,P,E,B,O){return function(x){var M=1-x,R=2*M*(P-T)+2*x*(B-P),Y=2*M*(E-k)+2*x*(O-E);return Math.atan2(Y,R)}}function $(T,k,P){var E={x:k,y:P},B,O=0,x;for(x=1;x<=100;x+=1)B=T(x/100),O+=s(E.x,E.y,B.x,B.y),E=B;return O}function H(T,k){for(var P=0,E=0,B=T.iterator,O={x:T.x,y:T.y},x,M,R=.01,Y=T.angleFinder,j;E<k&&R>1e-4;)x=B(P),j=P,M=s(O.x,O.y,x.x,x.y),M+E>k?(P-=R,R/=2):(O=x,P+=R,E+=M);return x.angle=Y(j),x}function J(T){for(var k=0,P=T.length,E,B=0,O=0,x=0,M=0,R=[],Y,j,G,I=0;I<P;I++){switch(E=T[I],j={x:B,y:O,command:E[0]},E[0]){case"M":j.length=0,x=B=E[1],M=O=E[2];break;case"L":j.length=s(B,O,E[1],E[2]),B=E[1],O=E[2];break;case"C":Y=b(B,O,E[1],E[2],E[3],E[4],E[5],E[6]),G=w(B,O,E[1],E[2],E[3],E[4],E[5],E[6]),j.iterator=Y,j.angleFinder=G,j.length=$(Y,B,O),B=E[5],O=E[6];break;case"Q":Y=X(B,O,E[1],E[2],E[3],E[4]),G=K(B,O,E[1],E[2],E[3],E[4]),j.iterator=Y,j.angleFinder=G,j.length=$(Y,B,O),B=E[3],O=E[4];break;case"Z":case"z":j.destX=x,j.destY=M,j.length=s(B,O,x,M),B=x,O=M;break}k+=j.length,R.push(j)}return R.push({length:k,x:B,y:O}),R}function Z(T,k,P){P||(P=J(T));for(var E=0;k-P[E].length>0&&E<P.length-2;)k-=P[E].length,E++;var B=P[E],O=k/B.length,x=B.command,M=T[E],R;switch(x){case"M":return{x:B.x,y:B.y,angle:0};case"Z":case"z":return R=new t.Point(B.x,B.y).lerp(new t.Point(B.destX,B.destY),O),R.angle=Math.atan2(B.destY-B.y,B.destX-B.x),R;case"L":return R=new t.Point(B.x,B.y).lerp(new t.Point(M[1],M[2]),O),R.angle=Math.atan2(M[2]-B.y,M[1]-B.x),R;case"C":return H(B,k);case"Q":return H(B,k)}}function Q(T){var k=[],P=[],E,B,O=t.rePathCommand,x="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",M="("+x+")"+t.commaWsp,R="([01])"+t.commaWsp+"?",Y=M+"?"+M+"?"+M+R+R+M+"?("+x+")",j=new RegExp(Y,"g"),G,I,tt;if(!T||!T.match)return k;tt=T.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var W=0,F,U=tt.length;W<U;W++){E=tt[W],I=E.slice(1).trim(),P.length=0;var V=E.charAt(0);if(F=[V],V.toLowerCase()==="a")for(var N;N=j.exec(I);)for(var q=1;q<N.length;q++)P.push(N[q]);else for(;G=O.exec(I);)P.push(G[0]);for(var q=0,et=P.length;q<et;q++)B=parseFloat(P[q]),isNaN(B)||F.push(B);var dt=e[V.toLowerCase()],ot=o[V]||V;if(F.length-1>dt)for(var z=1,ct=F.length;z<ct;z+=dt)k.push([V].concat(F.slice(z,z+dt))),V=ot;else k.push(F)}return k}function rt(T,k){var P=[],E,B=new t.Point(T[0].x,T[0].y),O=new t.Point(T[1].x,T[1].y),x=T.length,M=1,R=0,Y=x>2;for(k=k||0,Y&&(M=T[2].x<O.x?-1:T[2].x===O.x?0:1,R=T[2].y<O.y?-1:T[2].y===O.y?0:1),P.push(["M",B.x-M*k,B.y-R*k]),E=1;E<x;E++){if(!B.eq(O)){var j=B.midPointFrom(O);P.push(["Q",B.x,B.y,j.x,j.y])}B=T[E],E+1<T.length&&(O=T[E+1])}return Y&&(M=B.x>T[E-2].x?1:B.x===T[E-2].x?0:-1,R=B.y>T[E-2].y?1:B.y===T[E-2].y?0:-1),P.push(["L",B.x+M*k,B.y+R*k]),P}function st(T,k,P){return P&&(k=t.util.multiplyTransformMatrices(k,[1,0,0,1,-P.x,-P.y])),T.map(function(E){for(var B=E.slice(0),O={},x=1;x<E.length-1;x+=2)O.x=E[x],O.y=E[x+1],O=t.util.transformPoint(O,k),B[x]=O.x,B[x+1]=O.y;return B})}t.util.joinPath=function(T){return T.map(function(k){return k.join(" ")}).join(" ")},t.util.parsePath=Q,t.util.makePathSimpler=u,t.util.getSmoothPathFromPoints=rt,t.util.getPathSegmentsInfo=J,t.util.getBoundsOfCurve=i,t.util.getPointOnPath=Z,t.util.transformPath=st}(),function(){var h=Array.prototype.slice;function e(i,a){for(var u=h.call(arguments,2),s=[],f=0,g=i.length;f<g;f++)s[f]=u.length?i[f][a].apply(i[f],u):i[f][a].call(i[f]);return s}function o(i,a){return r(i,a,function(u,s){return u>=s})}function l(i,a){return r(i,a,function(u,s){return u<s})}function n(i,a){for(var u=i.length;u--;)i[u]=a;return i}function r(i,a,u){if(!(!i||i.length===0)){var s=i.length-1,f=a?i[s][a]:i[s];if(a)for(;s--;)u(i[s][a],f)&&(f=i[s][a]);else for(;s--;)u(i[s],f)&&(f=i[s]);return f}}t.util.array={fill:n,invoke:e,min:l,max:o}}(),function(){function h(o,l,n){if(n)if(!t.isLikelyNode&&l instanceof Element)o=l;else if(l instanceof Array){o=[];for(var r=0,i=l.length;r<i;r++)o[r]=h({},l[r],n)}else if(l&&typeof l=="object")for(var a in l)a==="canvas"||a==="group"?o[a]=null:l.hasOwnProperty(a)&&(o[a]=h({},l[a],n));else o=l;else for(var a in l)o[a]=l[a];return o}function e(o,l){return h({},o,l)}t.util.object={extend:h,clone:e},t.util.object.extend(t.util,t.Observable)}(),function(){function h(r){return r.replace(/-+(.)?/g,function(i,a){return a?a.toUpperCase():""})}function e(r,i){return r.charAt(0).toUpperCase()+(i?r.slice(1):r.slice(1).toLowerCase())}function o(r){return r.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function l(r){var i=0,a,u=[];for(i=0,a;i<r.length;i++)(a=n(r,i))!==!1&&u.push(a);return u}function n(r,i){var a=r.charCodeAt(i);if(isNaN(a))return"";if(a<55296||a>57343)return r.charAt(i);if(55296<=a&&a<=56319){if(r.length<=i+1)throw"High surrogate without following low surrogate";var u=r.charCodeAt(i+1);if(56320>u||u>57343)throw"High surrogate without following low surrogate";return r.charAt(i)+r.charAt(i+1)}if(i===0)throw"Low surrogate without preceding high surrogate";var s=r.charCodeAt(i-1);if(55296>s||s>56319)throw"Low surrogate without preceding high surrogate";return!1}t.util.string={camelize:h,capitalize:e,escapeXml:o,graphemeSplit:l}}(),function(){var h=Array.prototype.slice,e=function(){},o=function(){for(var a in{toString:1})if(a==="toString")return!1;return!0}(),l=function(a,u,s){for(var f in u)f in a.prototype&&typeof a.prototype[f]=="function"&&(u[f]+"").indexOf("callSuper")>-1?a.prototype[f]=function(g){return function(){var m=this.constructor.superclass;this.constructor.superclass=s;var v=u[g].apply(this,arguments);if(this.constructor.superclass=m,g!=="initialize")return v}}(f):a.prototype[f]=u[f],o&&(u.toString!==Object.prototype.toString&&(a.prototype.toString=u.toString),u.valueOf!==Object.prototype.valueOf&&(a.prototype.valueOf=u.valueOf))};function n(){}function r(a){for(var u=null,s=this;s.constructor.superclass;){var f=s.constructor.superclass.prototype[a];if(s[a]!==f){u=f;break}s=s.constructor.superclass.prototype}return u?arguments.length>1?u.apply(this,h.call(arguments,1)):u.call(this):console.log("tried to callSuper "+a+", method not found in prototype chain",this)}function i(){var a=null,u=h.call(arguments,0);typeof u[0]=="function"&&(a=u.shift());function s(){this.initialize.apply(this,arguments)}s.superclass=a,s.subclasses=[],a&&(n.prototype=a.prototype,s.prototype=new n,a.subclasses.push(s));for(var f=0,g=u.length;f<g;f++)l(s,u[f],a);return s.prototype.initialize||(s.prototype.initialize=e),s.prototype.constructor=s,s.prototype.callSuper=r,s}t.util.createClass=i}(),function(){var h=!!t.document.createElement("div").attachEvent,e=["touchstart","touchmove","touchend"];t.util.addListener=function(l,n,r,i){l&&l.addEventListener(n,r,h?!1:i)},t.util.removeListener=function(l,n,r,i){l&&l.removeEventListener(n,r,h?!1:i)};function o(l){var n=l.changedTouches;return n&&n[0]?n[0]:l}t.util.getPointer=function(l){var n=l.target,r=t.util.getScrollLeftTop(n),i=o(l);return{x:i.clientX+r.left,y:i.clientY+r.top}},t.util.isTouchEvent=function(l){return e.indexOf(l.type)>-1||l.pointerType==="touch"}}(),function(){function h(i,a){var u=i.style;if(!u)return i;if(typeof a=="string")return i.style.cssText+=";"+a,a.indexOf("opacity")>-1?r(i,a.match(/opacity:\s*(\d?\.?\d*)/)[1]):i;for(var s in a)if(s==="opacity")r(i,a[s]);else{var f=s==="float"||s==="cssFloat"?typeof u.styleFloat>"u"?"cssFloat":"styleFloat":s;u.setProperty(f,a[s])}return i}var e=t.document.createElement("div"),o=typeof e.style.opacity=="string",l=typeof e.style.filter=="string",n=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,r=function(i){return i};o?r=function(i,a){return i.style.opacity=a,i}:l&&(r=function(i,a){var u=i.style;return i.currentStyle&&!i.currentStyle.hasLayout&&(u.zoom=1),n.test(u.filter)?(a=a>=.9999?"":"alpha(opacity="+a*100+")",u.filter=u.filter.replace(n,a)):u.filter+=" alpha(opacity="+a*100+")",i}),t.util.setStyle=h}(),function(){var h=Array.prototype.slice;function e(v){return typeof v=="string"?t.document.getElementById(v):v}var o,l=function(v){return h.call(v,0)};try{o=l(t.document.childNodes)instanceof Array}catch{}o||(l=function(v){for(var b=new Array(v.length),w=v.length;w--;)b[w]=v[w];return b});function n(v,b){var w=t.document.createElement(v);for(var S in b)S==="class"?w.className=b[S]:S==="for"?w.htmlFor=b[S]:w.setAttribute(S,b[S]);return w}function r(v,b){v&&(" "+v.className+" ").indexOf(" "+b+" ")===-1&&(v.className+=(v.className?" ":"")+b)}function i(v,b,w){return typeof b=="string"&&(b=n(b,w)),v.parentNode&&v.parentNode.replaceChild(b,v),b.appendChild(v),b}function a(v){for(var b=0,w=0,S=t.document.documentElement,A=t.document.body||{scrollLeft:0,scrollTop:0};v&&(v.parentNode||v.host)&&(v=v.parentNode||v.host,v===t.document?(b=A.scrollLeft||S.scrollLeft||0,w=A.scrollTop||S.scrollTop||0):(b+=v.scrollLeft||0,w+=v.scrollTop||0),!(v.nodeType===1&&v.style.position==="fixed")););return{left:b,top:w}}function u(v){var b,w=v&&v.ownerDocument,S={left:0,top:0},A={left:0,top:0},D,X={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!w)return A;for(var K in X)A[X[K]]+=parseInt(s(v,K),10)||0;return b=w.documentElement,typeof v.getBoundingClientRect<"u"&&(S=v.getBoundingClientRect()),D=a(v),{left:S.left+D.left-(b.clientLeft||0)+A.left,top:S.top+D.top-(b.clientTop||0)+A.top}}var s;t.document.defaultView&&t.document.defaultView.getComputedStyle?s=function(v,b){var w=t.document.defaultView.getComputedStyle(v,null);return w?w[b]:void 0}:s=function(v,b){var w=v.style[b];return!w&&v.currentStyle&&(w=v.currentStyle[b]),w},function(){var v=t.document.documentElement.style,b="userSelect"in v?"userSelect":"MozUserSelect"in v?"MozUserSelect":"WebkitUserSelect"in v?"WebkitUserSelect":"KhtmlUserSelect"in v?"KhtmlUserSelect":"";function w(A){return typeof A.onselectstart<"u"&&(A.onselectstart=t.util.falseFunction),b?A.style[b]="none":typeof A.unselectable=="string"&&(A.unselectable="on"),A}function S(A){return typeof A.onselectstart<"u"&&(A.onselectstart=null),b?A.style[b]="":typeof A.unselectable=="string"&&(A.unselectable=""),A}t.util.makeElementUnselectable=w,t.util.makeElementSelectable=S}();function f(v){var b=t.jsdomImplForWrapper(v);return b._canvas||b._image}function g(v){if(t.isLikelyNode){var b=t.jsdomImplForWrapper(v);b&&(b._image=null,b._canvas=null,b._currentSrc=null,b._attributes=null,b._classList=null)}}function m(v,b){v.imageSmoothingEnabled=v.imageSmoothingEnabled||v.webkitImageSmoothingEnabled||v.mozImageSmoothingEnabled||v.msImageSmoothingEnabled||v.oImageSmoothingEnabled,v.imageSmoothingEnabled=b}t.util.setImageSmoothing=m,t.util.getById=e,t.util.toArray=l,t.util.addClass=r,t.util.makeElement=n,t.util.wrapElement=i,t.util.getScrollLeftTop=a,t.util.getElementOffset=u,t.util.getNodeCanvas=f,t.util.cleanUpJsdomNode=g}(),function(){function h(l,n){return l+(/\?/.test(l)?"&":"?")+n}function e(){}function o(l,n){n||(n={});var r=n.method?n.method.toUpperCase():"GET",i=n.onComplete||function(){},a=new t.window.XMLHttpRequest,u=n.body||n.parameters;return a.onreadystatechange=function(){a.readyState===4&&(i(a),a.onreadystatechange=e)},r==="GET"&&(u=null,typeof n.parameters=="string"&&(l=h(l,n.parameters))),a.open(r,l,!0),(r==="POST"||r==="PUT")&&a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(u),a}t.util.request=o}(),t.log=console.log,t.warn=console.warn,function(){var h=t.util.object.extend,e=t.util.object.clone,o=[];t.util.object.extend(o,{cancelAll:function(){var f=this.splice(0);return f.forEach(function(g){g.cancel()}),f},cancelByCanvas:function(f){if(!f)return[];var g=this.filter(function(m){return typeof m.target=="object"&&m.target.canvas===f});return g.forEach(function(m){m.cancel()}),g},cancelByTarget:function(f){var g=this.findAnimationsByTarget(f);return g.forEach(function(m){m.cancel()}),g},findAnimationIndex:function(f){return this.indexOf(this.findAnimation(f))},findAnimation:function(f){return this.find(function(g){return g.cancel===f})},findAnimationsByTarget:function(f){return f?this.filter(function(g){return g.target===f}):[]}});function l(){return!1}function n(f,g,m,v){return-m*Math.cos(f/v*(Math.PI/2))+m+g}function r(f){f||(f={});var g=!1,m,v=function(){var b=t.runningAnimations.indexOf(m);return b>-1&&t.runningAnimations.splice(b,1)[0]};return m=h(e(f),{cancel:function(){return g=!0,v()},currentValue:"startValue"in f?f.startValue:0,completionRate:0,durationRate:0}),t.runningAnimations.push(m),u(function(b){var w=b||+new Date,S=f.duration||500,A=w+S,D,X=f.onChange||l,K=f.abort||l,$=f.onComplete||l,H=f.easing||n,J="startValue"in f?f.startValue.length>0:!1,Z="startValue"in f?f.startValue:0,Q="endValue"in f?f.endValue:100,rt=f.byValue||(J?Z.map(function(st,T){return Q[T]-Z[T]}):Q-Z);f.onStart&&f.onStart(),function st(T){D=T||+new Date;var k=D>A?S:D-w,P=k/S,E=J?Z.map(function(O,x){return H(k,Z[x],rt[x],S)}):H(k,Z,rt,S),B=Math.abs(J?(E[0]-Z[0])/rt[0]:(E-Z)/rt);if(m.currentValue=J?E.slice():E,m.completionRate=B,m.durationRate=P,!g){if(K(E,B,P)){v();return}if(D>A){m.currentValue=J?Q.slice():Q,m.completionRate=1,m.durationRate=1,X(J?Q.slice():Q,1,1),$(Q,1,1),v();return}else X(E,B,P),u(st)}}(w)}),m.cancel}var i=t.window.requestAnimationFrame||t.window.webkitRequestAnimationFrame||t.window.mozRequestAnimationFrame||t.window.oRequestAnimationFrame||t.window.msRequestAnimationFrame||function(f){return t.window.setTimeout(f,1e3/60)},a=t.window.cancelAnimationFrame||t.window.clearTimeout;function u(){return i.apply(t.window,arguments)}function s(){return a.apply(t.window,arguments)}t.util.animate=r,t.util.requestAnimFrame=u,t.util.cancelAnimFrame=s,t.runningAnimations=o}(),function(){function h(o,l,n){var r="rgba("+parseInt(o[0]+n*(l[0]-o[0]),10)+","+parseInt(o[1]+n*(l[1]-o[1]),10)+","+parseInt(o[2]+n*(l[2]-o[2]),10);return r+=","+(o&&l?parseFloat(o[3]+n*(l[3]-o[3])):1),r+=")",r}function e(o,l,n,r){var i=new t.Color(o).getSource(),a=new t.Color(l).getSource(),u=r.onComplete,s=r.onChange;return r=r||{},t.util.animate(t.util.object.extend(r,{duration:n||500,startValue:i,endValue:a,byValue:a,easing:function(f,g,m,v){var b=r.colorEasing?r.colorEasing(f,v):1-Math.cos(f/v*(Math.PI/2));return h(g,m,b)},onComplete:function(f,g,m){if(u)return u(h(a,a,0),g,m)},onChange:function(f,g,m){if(s){if(Array.isArray(f))return s(h(f,f,0),g,m);s(f,g,m)}}}))}t.util.animateColor=e}(),function(){function h(T,k,P,E){return T<Math.abs(k)?(T=k,E=P/4):k===0&&T===0?E=P/(2*Math.PI)*Math.asin(1):E=P/(2*Math.PI)*Math.asin(k/T),{a:T,c:k,p:P,s:E}}function e(T,k,P){return T.a*Math.pow(2,10*(k-=1))*Math.sin((k*P-T.s)*(2*Math.PI)/T.p)}function o(T,k,P,E){return P*((T=T/E-1)*T*T+1)+k}function l(T,k,P,E){return T/=E/2,T<1?P/2*T*T*T+k:P/2*((T-=2)*T*T+2)+k}function n(T,k,P,E){return P*(T/=E)*T*T*T+k}function r(T,k,P,E){return-P*((T=T/E-1)*T*T*T-1)+k}function i(T,k,P,E){return T/=E/2,T<1?P/2*T*T*T*T+k:-P/2*((T-=2)*T*T*T-2)+k}function a(T,k,P,E){return P*(T/=E)*T*T*T*T+k}function u(T,k,P,E){return P*((T=T/E-1)*T*T*T*T+1)+k}function s(T,k,P,E){return T/=E/2,T<1?P/2*T*T*T*T*T+k:P/2*((T-=2)*T*T*T*T+2)+k}function f(T,k,P,E){return-P*Math.cos(T/E*(Math.PI/2))+P+k}function g(T,k,P,E){return P*Math.sin(T/E*(Math.PI/2))+k}function m(T,k,P,E){return-P/2*(Math.cos(Math.PI*T/E)-1)+k}function v(T,k,P,E){return T===0?k:P*Math.pow(2,10*(T/E-1))+k}function b(T,k,P,E){return T===E?k+P:P*(-Math.pow(2,-10*T/E)+1)+k}function w(T,k,P,E){return T===0?k:T===E?k+P:(T/=E/2,T<1?P/2*Math.pow(2,10*(T-1))+k:P/2*(-Math.pow(2,-10*--T)+2)+k)}function S(T,k,P,E){return-P*(Math.sqrt(1-(T/=E)*T)-1)+k}function A(T,k,P,E){return P*Math.sqrt(1-(T=T/E-1)*T)+k}function D(T,k,P,E){return T/=E/2,T<1?-P/2*(Math.sqrt(1-T*T)-1)+k:P/2*(Math.sqrt(1-(T-=2)*T)+1)+k}function X(T,k,P,E){var B=1.70158,O=0,x=P;if(T===0)return k;if(T/=E,T===1)return k+P;O||(O=E*.3);var M=h(x,P,O,B);return-e(M,T,E)+k}function K(T,k,P,E){var B=1.70158,O=0,x=P;if(T===0)return k;if(T/=E,T===1)return k+P;O||(O=E*.3);var M=h(x,P,O,B);return M.a*Math.pow(2,-10*T)*Math.sin((T*E-M.s)*(2*Math.PI)/M.p)+M.c+k}function $(T,k,P,E){var B=1.70158,O=0,x=P;if(T===0)return k;if(T/=E/2,T===2)return k+P;O||(O=E*(.3*1.5));var M=h(x,P,O,B);return T<1?-.5*e(M,T,E)+k:M.a*Math.pow(2,-10*(T-=1))*Math.sin((T*E-M.s)*(2*Math.PI)/M.p)*.5+M.c+k}function H(T,k,P,E,B){return B===void 0&&(B=1.70158),P*(T/=E)*T*((B+1)*T-B)+k}function J(T,k,P,E,B){return B===void 0&&(B=1.70158),P*((T=T/E-1)*T*((B+1)*T+B)+1)+k}function Z(T,k,P,E,B){return B===void 0&&(B=1.70158),T/=E/2,T<1?P/2*(T*T*(((B*=1.525)+1)*T-B))+k:P/2*((T-=2)*T*(((B*=1.525)+1)*T+B)+2)+k}function Q(T,k,P,E){return P-rt(E-T,0,P,E)+k}function rt(T,k,P,E){return(T/=E)<1/2.75?P*(7.5625*T*T)+k:T<2/2.75?P*(7.5625*(T-=1.5/2.75)*T+.75)+k:T<2.5/2.75?P*(7.5625*(T-=2.25/2.75)*T+.9375)+k:P*(7.5625*(T-=2.625/2.75)*T+.984375)+k}function st(T,k,P,E){return T<E/2?Q(T*2,0,P,E)*.5+k:rt(T*2-E,0,P,E)*.5+P*.5+k}t.util.ease={easeInQuad:function(T,k,P,E){return P*(T/=E)*T+k},easeOutQuad:function(T,k,P,E){return-P*(T/=E)*(T-2)+k},easeInOutQuad:function(T,k,P,E){return T/=E/2,T<1?P/2*T*T+k:-P/2*(--T*(T-2)-1)+k},easeInCubic:function(T,k,P,E){return P*(T/=E)*T*T+k},easeOutCubic:o,easeInOutCubic:l,easeInQuart:n,easeOutQuart:r,easeInOutQuart:i,easeInQuint:a,easeOutQuint:u,easeInOutQuint:s,easeInSine:f,easeOutSine:g,easeInOutSine:m,easeInExpo:v,easeOutExpo:b,easeInOutExpo:w,easeInCirc:S,easeOutCirc:A,easeInOutCirc:D,easeInElastic:X,easeOutElastic:K,easeInOutElastic:$,easeInBack:H,easeOutBack:J,easeInOutBack:Z,easeInBounce:Q,easeOutBounce:rt,easeInOutBounce:st}}(),function(h){var e=h.fabric||(h.fabric={}),o=e.util.object.extend,l=e.util.object.clone,n=e.util.toFixed,r=e.util.parseUnit,i=e.util.multiplyTransformMatrices,a=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],u=["symbol","image","marker","pattern","view","svg"],s=["pattern","defs","symbol","metadata","clipPath","mask","desc"],f=["symbol","g","a","svg","clipPath","defs"],g={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},m={stroke:"strokeOpacity",fill:"fillOpacity"},v="font-size",b="clip-path";e.svgValidTagNamesRegEx=A(a),e.svgViewBoxElementsRegEx=A(u),e.svgInvalidAncestorsRegEx=A(s),e.svgValidParentsRegEx=A(f),e.cssRules={},e.gradientDefs={},e.clipPaths={};function w(O){return O in g?g[O]:O}function S(O,x,M,R){var Y=Array.isArray(x),j;if((O==="fill"||O==="stroke")&&x==="none")x="";else{if(O==="strokeUniform")return x==="non-scaling-stroke";if(O==="strokeDashArray")x==="none"?x=null:x=x.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(O==="transformMatrix")M&&M.transformMatrix?x=i(M.transformMatrix,e.parseTransformAttribute(x)):x=e.parseTransformAttribute(x);else if(O==="visible")x=x!=="none"&&x!=="hidden",M&&M.visible===!1&&(x=!1);else if(O==="opacity")x=parseFloat(x),M&&typeof M.opacity<"u"&&(x*=M.opacity);else if(O==="textAnchor")x=x==="start"?"left":x==="end"?"right":"center";else if(O==="charSpacing")j=r(x,R)/R*1e3;else if(O==="paintFirst"){var G=x.indexOf("fill"),I=x.indexOf("stroke"),x="fill";(G>-1&&I>-1&&I<G||G===-1&&I>-1)&&(x="stroke")}else{if(O==="href"||O==="xlink:href"||O==="font")return x;if(O==="imageSmoothing")return x==="optimizeQuality";j=Y?x.map(r):r(x,R)}}return!Y&&isNaN(j)?x:j}function A(O){return new RegExp("^("+O.join("|")+")\\b","i")}function D(O){for(var x in m)if(!(typeof O[m[x]]>"u"||O[x]==="")){if(typeof O[x]>"u"){if(!e.Object.prototype[x])continue;O[x]=e.Object.prototype[x]}if(O[x].indexOf("url(")!==0){var M=new e.Color(O[x]);O[x]=M.setAlpha(n(M.getAlpha()*O[m[x]],2)).toRgba()}}return O}function X(O,x){var M,R=[],Y,j,G;for(j=0,G=x.length;j<G;j++)M=x[j],Y=O.getElementsByTagName(M),R=R.concat(Array.prototype.slice.call(Y));return R}e.parseTransformAttribute=function(){function O(z,ct){var gt=e.util.cos(ct[0]),_t=e.util.sin(ct[0]),xt=0,wt=0;ct.length===3&&(xt=ct[1],wt=ct[2]),z[0]=gt,z[1]=_t,z[2]=-_t,z[3]=gt,z[4]=xt-(gt*xt-_t*wt),z[5]=wt-(_t*xt+gt*wt)}function x(z,ct){var gt=ct[0],_t=ct.length===2?ct[1]:ct[0];z[0]=gt,z[3]=_t}function M(z,ct,gt){z[gt]=Math.tan(e.util.degreesToRadians(ct[0]))}function R(z,ct){z[4]=ct[0],ct.length===2&&(z[5]=ct[1])}var Y=e.iMatrix,j=e.reNum,G=e.commaWsp,I="(?:(skewX)\\s*\\(\\s*("+j+")\\s*\\))",tt="(?:(skewY)\\s*\\(\\s*("+j+")\\s*\\))",W="(?:(rotate)\\s*\\(\\s*("+j+")(?:"+G+"("+j+")"+G+"("+j+"))?\\s*\\))",F="(?:(scale)\\s*\\(\\s*("+j+")(?:"+G+"("+j+"))?\\s*\\))",U="(?:(translate)\\s*\\(\\s*("+j+")(?:"+G+"("+j+"))?\\s*\\))",V="(?:(matrix)\\s*\\(\\s*("+j+")"+G+"("+j+")"+G+"("+j+")"+G+"("+j+")"+G+"("+j+")"+G+"("+j+")\\s*\\))",N="(?:"+V+"|"+U+"|"+F+"|"+W+"|"+I+"|"+tt+")",q="(?:"+N+"(?:"+G+"*"+N+")*)",et="^\\s*(?:"+q+"?)\\s*$",dt=new RegExp(et),ot=new RegExp(N,"g");return function(z){var ct=Y.concat(),gt=[];if(!z||z&&!dt.test(z))return ct;z.replace(ot,function(xt){var wt=new RegExp(N).exec(xt).filter(function(te){return!!te}),Lt=wt[1],kt=wt.slice(2).map(parseFloat);switch(Lt){case"translate":R(ct,kt);break;case"rotate":kt[0]=e.util.degreesToRadians(kt[0]),O(ct,kt);break;case"scale":x(ct,kt);break;case"skewX":M(ct,kt,2);break;case"skewY":M(ct,kt,1);break;case"matrix":ct=kt;break}gt.push(ct.concat()),ct=Y.concat()});for(var _t=gt[0];gt.length>1;)gt.shift(),_t=e.util.multiplyTransformMatrices(_t,gt[0]);return _t}}();function K(O,x){var M,R;O.replace(/;\s*$/,"").split(";").forEach(function(Y){var j=Y.split(":");M=j[0].trim().toLowerCase(),R=j[1].trim(),x[M]=R})}function $(O,x){var M,R;for(var Y in O)typeof O[Y]>"u"||(M=Y.toLowerCase(),R=O[Y],x[M]=R)}function H(O,x){var M={};for(var R in e.cssRules[x])if(J(O,R.split(" ")))for(var Y in e.cssRules[x][R])M[Y]=e.cssRules[x][R][Y];return M}function J(O,x){var M,R=!0;return M=Q(O,x.pop()),M&&x.length&&(R=Z(O,x)),M&&R&&x.length===0}function Z(O,x){for(var M,R=!0;O.parentNode&&O.parentNode.nodeType===1&&x.length;)R&&(M=x.pop()),O=O.parentNode,R=Q(O,M);return x.length===0}function Q(O,x){var M=O.nodeName,R=O.getAttribute("class"),Y=O.getAttribute("id"),j,G;if(j=new RegExp("^"+M,"i"),x=x.replace(j,""),Y&&x.length&&(j=new RegExp("#"+Y+"(?![a-zA-Z\\-]+)","i"),x=x.replace(j,"")),R&&x.length)for(R=R.split(" "),G=R.length;G--;)j=new RegExp("\\."+R[G]+"(?![a-zA-Z\\-]+)","i"),x=x.replace(j,"");return x.length===0}function rt(O,x){var M;if(O.getElementById&&(M=O.getElementById(x)),M)return M;var R,Y,j,G=O.getElementsByTagName("*");for(Y=0,j=G.length;Y<j;Y++)if(R=G[Y],x===R.getAttribute("id"))return R}function st(O){for(var x=X(O,["use","svg:use"]),M=0;x.length&&M<x.length;){var R=x[M],Y=R.getAttribute("xlink:href")||R.getAttribute("href");if(Y===null)return;var j=Y.slice(1),G=R.getAttribute("x")||0,I=R.getAttribute("y")||0,tt=rt(O,j).cloneNode(!0),W=(tt.getAttribute("transform")||"")+" translate("+G+", "+I+")",F,U=x.length,V,N,q,et,dt=e.svgNS;if(k(tt),/^svg$/i.test(tt.nodeName)){var ot=tt.ownerDocument.createElementNS(dt,"g");for(N=0,q=tt.attributes,et=q.length;N<et;N++)V=q.item(N),ot.setAttributeNS(dt,V.nodeName,V.nodeValue);for(;tt.firstChild;)ot.appendChild(tt.firstChild);tt=ot}for(N=0,q=R.attributes,et=q.length;N<et;N++)V=q.item(N),!(V.nodeName==="x"||V.nodeName==="y"||V.nodeName==="xlink:href"||V.nodeName==="href")&&(V.nodeName==="transform"?W=V.nodeValue+" "+W:tt.setAttribute(V.nodeName,V.nodeValue));tt.setAttribute("transform",W),tt.setAttribute("instantiated_by_use","1"),tt.removeAttribute("id"),F=R.parentNode,F.replaceChild(tt,R),x.length===U&&M++}}var T=new RegExp("^\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*$");function k(O){if(!e.svgViewBoxElementsRegEx.test(O.nodeName))return{};var x=O.getAttribute("viewBox"),M=1,R=1,Y=0,j=0,G,I,tt,W,F=O.getAttribute("width"),U=O.getAttribute("height"),V=O.getAttribute("x")||0,N=O.getAttribute("y")||0,q=O.getAttribute("preserveAspectRatio")||"",et=!x||!(x=x.match(T)),dt=!F||!U||F==="100%"||U==="100%",ot=et&&dt,z={},ct="",gt=0,_t=0;if(z.width=0,z.height=0,z.toBeParsed=ot,et&&(V||N)&&O.parentNode&&O.parentNode.nodeName!=="#document"&&(ct=" translate("+r(V)+" "+r(N)+") ",tt=(O.getAttribute("transform")||"")+ct,O.setAttribute("transform",tt),O.removeAttribute("x"),O.removeAttribute("y")),ot)return z;if(et)return z.width=r(F),z.height=r(U),z;if(Y=-parseFloat(x[1]),j=-parseFloat(x[2]),G=parseFloat(x[3]),I=parseFloat(x[4]),z.minX=Y,z.minY=j,z.viewBoxWidth=G,z.viewBoxHeight=I,dt?(z.width=G,z.height=I):(z.width=r(F),z.height=r(U),M=z.width/G,R=z.height/I),q=e.util.parsePreserveAspectRatioAttribute(q),q.alignX!=="none"&&(q.meetOrSlice==="meet"&&(R=M=M>R?R:M),q.meetOrSlice==="slice"&&(R=M=M>R?M:R),gt=z.width-G*M,_t=z.height-I*M,q.alignX==="Mid"&&(gt/=2),q.alignY==="Mid"&&(_t/=2),q.alignX==="Min"&&(gt=0),q.alignY==="Min"&&(_t=0)),M===1&&R===1&&Y===0&&j===0&&V===0&&N===0)return z;if((V||N)&&O.parentNode.nodeName!=="#document"&&(ct=" translate("+r(V)+" "+r(N)+") "),tt=ct+" matrix("+M+" 0 0 "+R+" "+(Y*M+gt)+" "+(j*R+_t)+") ",O.nodeName==="svg"){for(W=O.ownerDocument.createElementNS(e.svgNS,"g");O.firstChild;)W.appendChild(O.firstChild);O.appendChild(W)}else W=O,W.removeAttribute("x"),W.removeAttribute("y"),tt=W.getAttribute("transform")+tt;return W.setAttribute("transform",tt),z}function P(O,x){for(;O&&(O=O.parentNode);)if(O.nodeName&&x.test(O.nodeName.replace("svg:",""))&&!O.getAttribute("instantiated_by_use"))return!0;return!1}e.parseSVGDocument=function(O,x,M,R){if(O){st(O);var Y=e.Object.__uid++,j,G,I=k(O),tt=e.util.toArray(O.getElementsByTagName("*"));if(I.crossOrigin=R&&R.crossOrigin,I.svgUid=Y,tt.length===0&&e.isLikelyNode){tt=O.selectNodes('//*[name(.)!="svg"]');var W=[];for(j=0,G=tt.length;j<G;j++)W[j]=tt[j];tt=W}var F=tt.filter(function(V){return k(V),e.svgValidTagNamesRegEx.test(V.nodeName.replace("svg:",""))&&!P(V,e.svgInvalidAncestorsRegEx)});if(!F||F&&!F.length){x&&x([],{});return}var U={};tt.filter(function(V){return V.nodeName.replace("svg:","")==="clipPath"}).forEach(function(V){var N=V.getAttribute("id");U[N]=e.util.toArray(V.getElementsByTagName("*")).filter(function(q){return e.svgValidTagNamesRegEx.test(q.nodeName.replace("svg:",""))})}),e.gradientDefs[Y]=e.getGradientDefs(O),e.cssRules[Y]=e.getCSSRules(O),e.clipPaths[Y]=U,e.parseElements(F,function(V,N){x&&(x(V,I,N,tt),delete e.gradientDefs[Y],delete e.cssRules[Y],delete e.clipPaths[Y])},l(I),M,R)}};function E(O,x){var M=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],R="xlink:href",Y=x.getAttribute(R).slice(1),j=rt(O,Y);if(j&&j.getAttribute(R)&&E(O,j),M.forEach(function(I){j&&!x.hasAttribute(I)&&j.hasAttribute(I)&&x.setAttribute(I,j.getAttribute(I))}),!x.children.length)for(var G=j.cloneNode(!0);G.firstChild;)x.appendChild(G.firstChild);x.removeAttribute(R)}var B=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+e.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+e.reNum+"))?\\s+(.*)");o(e,{parseFontDeclaration:function(O,x){var M=O.match(B);if(M){var R=M[1],Y=M[3],j=M[4],G=M[5],I=M[6];R&&(x.fontStyle=R),Y&&(x.fontWeight=isNaN(parseFloat(Y))?Y:parseFloat(Y)),j&&(x.fontSize=r(j)),I&&(x.fontFamily=I),G&&(x.lineHeight=G==="normal"?1:G)}},getGradientDefs:function(O){var x=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],M=X(O,x),R,Y=0,j={};for(Y=M.length;Y--;)R=M[Y],R.getAttribute("xlink:href")&&E(O,R),j[R.getAttribute("id")]=R;return j},parseAttributes:function(O,x,M){if(O){var R,Y={},j,G;typeof M>"u"&&(M=O.getAttribute("svgUid")),O.parentNode&&e.svgValidParentsRegEx.test(O.parentNode.nodeName)&&(Y=e.parseAttributes(O.parentNode,x,M));var I=x.reduce(function(q,et){return R=O.getAttribute(et),R&&(q[et]=R),q},{}),tt=o(H(O,M),e.parseStyleAttribute(O));I=o(I,tt),tt[b]&&O.setAttribute(b,tt[b]),j=G=Y.fontSize||e.Text.DEFAULT_SVG_FONT_SIZE,I[v]&&(I[v]=j=r(I[v],G));var W,F,U={};for(var V in I)W=w(V),F=S(W,I[V],Y,j),U[W]=F;U&&U.font&&e.parseFontDeclaration(U.font,U);var N=o(Y,U);return e.svgValidParentsRegEx.test(O.nodeName)?N:D(N)}},parseElements:function(O,x,M,R,Y){new e.ElementsParser(O,x,M,R,Y).parse()},parseStyleAttribute:function(O){var x={},M=O.getAttribute("style");return M&&(typeof M=="string"?K(M,x):$(M,x)),x},parsePointsAttribute:function(O){if(!O)return null;O=O.replace(/,/g," ").trim(),O=O.split(/\s+/);var x=[],M,R;for(M=0,R=O.length;M<R;M+=2)x.push({x:parseFloat(O[M]),y:parseFloat(O[M+1])});return x},getCSSRules:function(O){var x=O.getElementsByTagName("style"),M,R,Y={},j;for(M=0,R=x.length;M<R;M++){var G=x[M].textContent;G=G.replace(/\/\*[\s\S]*?\*\//g,""),G.trim()!==""&&(j=G.split("}"),j=j.filter(function(I){return I.trim()}),j.forEach(function(I){var tt=I.split("{"),W={},F=tt[1].trim(),U=F.split(";").filter(function(et){return et.trim()});for(M=0,R=U.length;M<R;M++){var V=U[M].split(":"),N=V[0].trim(),q=V[1].trim();W[N]=q}I=tt[0].trim(),I.split(",").forEach(function(et){et=et.replace(/^svg/i,"").trim(),et!==""&&(Y[et]?e.util.object.extend(Y[et],W):Y[et]=e.util.object.clone(W))})}))}return Y},loadSVGFromURL:function(O,x,M,R){O=O.replace(/^\n\s*/,"").trim(),new e.util.request(O,{method:"get",onComplete:Y});function Y(j){var G=j.responseXML;if(!G||!G.documentElement)return x&&x(null),!1;e.parseSVGDocument(G.documentElement,function(I,tt,W,F){x&&x(I,tt,W,F)},M,R)}},loadSVGFromString:function(O,x,M,R){var Y=new e.window.DOMParser,j=Y.parseFromString(O.trim(),"text/xml");e.parseSVGDocument(j.documentElement,function(G,I,tt,W){x(G,I,tt,W)},M,R)}})}(c),t.ElementsParser=function(h,e,o,l,n,r){this.elements=h,this.callback=e,this.options=o,this.reviver=l,this.svgUid=o&&o.svgUid||0,this.parsingOptions=n,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=r},function(h){h.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},h.createObjects=function(){var e=this;this.elements.forEach(function(o,l){o.setAttribute("svgUid",e.svgUid),e.createObject(o,l)})},h.findTag=function(e){return t[t.util.string.capitalize(e.tagName.replace("svg:",""))]},h.createObject=function(e,o){var l=this.findTag(e);if(l&&l.fromElement)try{l.fromElement(e,this.createCallback(o,e),this.options)}catch(n){t.log(n)}else this.checkIfDone()},h.createCallback=function(e,o){var l=this;return function(n){var r;l.resolveGradient(n,o,"fill"),l.resolveGradient(n,o,"stroke"),n instanceof t.Image&&n._originalElement&&(r=n.parsePreserveAspectRatioAttribute(o)),n._removeTransformMatrix(r),l.resolveClipPath(n,o),l.reviver&&l.reviver(o,n),l.instances[e]=n,l.checkIfDone()}},h.extractPropertyDefinition=function(e,o,l){var n=e[o],r=this.regexUrl;if(r.test(n)){r.lastIndex=0;var i=r.exec(n)[1];return r.lastIndex=0,t[l][this.svgUid][i]}},h.resolveGradient=function(e,o,l){var n=this.extractPropertyDefinition(e,l,"gradientDefs");if(n){var r=o.getAttribute(l+"-opacity"),i=t.Gradient.fromElement(n,e,r,this.options);e.set(l,i)}},h.createClipPathCallback=function(e,o){return function(l){l._removeTransformMatrix(),l.fillRule=l.clipRule,o.push(l)}},h.resolveClipPath=function(e,o){var l=this.extractPropertyDefinition(e,"clipPath","clipPaths"),n,r,i,a,u,s;if(l){a=[],i=t.util.invertTransform(e.calcTransformMatrix());for(var f=l[0].parentNode,g=o;g.parentNode&&g.getAttribute("clip-path")!==e.clipPath;)g=g.parentNode;g.parentNode.appendChild(f);for(var m=0;m<l.length;m++)n=l[m],r=this.findTag(n),r.fromElement(n,this.createClipPathCallback(e,a),this.options);a.length===1?l=a[0]:l=new t.Group(a),u=t.util.multiplyTransformMatrices(i,l.calcTransformMatrix()),l.clipPath&&this.resolveClipPath(l,g);var s=t.util.qrDecompose(u);l.flipX=!1,l.flipY=!1,l.set("scaleX",s.scaleX),l.set("scaleY",s.scaleY),l.angle=s.angle,l.skewX=s.skewX,l.skewY=0,l.setPositionByOrigin({x:s.translateX,y:s.translateY},"center","center"),e.clipPath=l}else delete e.clipPath},h.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(e){return e!=null}),this.callback(this.instances,this.elements))}}(t.ElementsParser.prototype),function(h){var e=h.fabric||(h.fabric={});if(e.Point){e.warn("fabric.Point is already defined");return}e.Point=o;function o(l,n){this.x=l,this.y=n}o.prototype={type:"point",constructor:o,add:function(l){return new o(this.x+l.x,this.y+l.y)},addEquals:function(l){return this.x+=l.x,this.y+=l.y,this},scalarAdd:function(l){return new o(this.x+l,this.y+l)},scalarAddEquals:function(l){return this.x+=l,this.y+=l,this},subtract:function(l){return new o(this.x-l.x,this.y-l.y)},subtractEquals:function(l){return this.x-=l.x,this.y-=l.y,this},scalarSubtract:function(l){return new o(this.x-l,this.y-l)},scalarSubtractEquals:function(l){return this.x-=l,this.y-=l,this},multiply:function(l){return new o(this.x*l,this.y*l)},multiplyEquals:function(l){return this.x*=l,this.y*=l,this},divide:function(l){return new o(this.x/l,this.y/l)},divideEquals:function(l){return this.x/=l,this.y/=l,this},eq:function(l){return this.x===l.x&&this.y===l.y},lt:function(l){return this.x<l.x&&this.y<l.y},lte:function(l){return this.x<=l.x&&this.y<=l.y},gt:function(l){return this.x>l.x&&this.y>l.y},gte:function(l){return this.x>=l.x&&this.y>=l.y},lerp:function(l,n){return typeof n>"u"&&(n=.5),n=Math.max(Math.min(1,n),0),new o(this.x+(l.x-this.x)*n,this.y+(l.y-this.y)*n)},distanceFrom:function(l){var n=this.x-l.x,r=this.y-l.y;return Math.sqrt(n*n+r*r)},midPointFrom:function(l){return this.lerp(l)},min:function(l){return new o(Math.min(this.x,l.x),Math.min(this.y,l.y))},max:function(l){return new o(Math.max(this.x,l.x),Math.max(this.y,l.y))},toString:function(){return this.x+","+this.y},setXY:function(l,n){return this.x=l,this.y=n,this},setX:function(l){return this.x=l,this},setY:function(l){return this.y=l,this},setFromPoint:function(l){return this.x=l.x,this.y=l.y,this},swap:function(l){var n=this.x,r=this.y;this.x=l.x,this.y=l.y,l.x=n,l.y=r},clone:function(){return new o(this.x,this.y)}}}(c),function(h){var e=h.fabric||(h.fabric={});if(e.Intersection){e.warn("fabric.Intersection is already defined");return}function o(l){this.status=l,this.points=[]}e.Intersection=o,e.Intersection.prototype={constructor:o,appendPoint:function(l){return this.points.push(l),this},appendPoints:function(l){return this.points=this.points.concat(l),this}},e.Intersection.intersectLineLine=function(l,n,r,i){var a,u=(i.x-r.x)*(l.y-r.y)-(i.y-r.y)*(l.x-r.x),s=(n.x-l.x)*(l.y-r.y)-(n.y-l.y)*(l.x-r.x),f=(i.y-r.y)*(n.x-l.x)-(i.x-r.x)*(n.y-l.y);if(f!==0){var g=u/f,m=s/f;0<=g&&g<=1&&0<=m&&m<=1?(a=new o("Intersection"),a.appendPoint(new e.Point(l.x+g*(n.x-l.x),l.y+g*(n.y-l.y)))):a=new o}else u===0||s===0?a=new o("Coincident"):a=new o("Parallel");return a},e.Intersection.intersectLinePolygon=function(l,n,r){var i=new o,a=r.length,u,s,f,g;for(g=0;g<a;g++)u=r[g],s=r[(g+1)%a],f=o.intersectLineLine(l,n,u,s),i.appendPoints(f.points);return i.points.length>0&&(i.status="Intersection"),i},e.Intersection.intersectPolygonPolygon=function(l,n){var r=new o,i=l.length,a;for(a=0;a<i;a++){var u=l[a],s=l[(a+1)%i],f=o.intersectLinePolygon(u,s,n);r.appendPoints(f.points)}return r.points.length>0&&(r.status="Intersection"),r},e.Intersection.intersectPolygonRectangle=function(l,n,r){var i=n.min(r),a=n.max(r),u=new e.Point(a.x,i.y),s=new e.Point(i.x,a.y),f=o.intersectLinePolygon(i,u,l),g=o.intersectLinePolygon(u,a,l),m=o.intersectLinePolygon(a,s,l),v=o.intersectLinePolygon(s,i,l),b=new o;return b.appendPoints(f.points),b.appendPoints(g.points),b.appendPoints(m.points),b.appendPoints(v.points),b.points.length>0&&(b.status="Intersection"),b}}(c),function(h){var e=h.fabric||(h.fabric={});if(e.Color){e.warn("fabric.Color is already defined.");return}function o(n){n?this._tryParsingColor(n):this.setSource([0,0,0,1])}e.Color=o,e.Color.prototype={_tryParsingColor:function(n){var r;n in o.colorNameMap&&(n=o.colorNameMap[n]),n==="transparent"&&(r=[255,255,255,0]),r||(r=o.sourceFromHex(n)),r||(r=o.sourceFromRgb(n)),r||(r=o.sourceFromHsl(n)),r||(r=[0,0,0,1]),r&&this.setSource(r)},_rgbToHsl:function(n,r,i){n/=255,r/=255,i/=255;var a,u,s,f=e.util.array.max([n,r,i]),g=e.util.array.min([n,r,i]);if(s=(f+g)/2,f===g)a=u=0;else{var m=f-g;switch(u=s>.5?m/(2-f-g):m/(f+g),f){case n:a=(r-i)/m+(r<i?6:0);break;case r:a=(i-n)/m+2;break;case i:a=(n-r)/m+4;break}a/=6}return[Math.round(a*360),Math.round(u*100),Math.round(s*100)]},getSource:function(){return this._source},setSource:function(n){this._source=n},toRgb:function(){var n=this.getSource();return"rgb("+n[0]+","+n[1]+","+n[2]+")"},toRgba:function(){var n=this.getSource();return"rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")"},toHsl:function(){var n=this.getSource(),r=this._rgbToHsl(n[0],n[1],n[2]);return"hsl("+r[0]+","+r[1]+"%,"+r[2]+"%)"},toHsla:function(){var n=this.getSource(),r=this._rgbToHsl(n[0],n[1],n[2]);return"hsla("+r[0]+","+r[1]+"%,"+r[2]+"%,"+n[3]+")"},toHex:function(){var n=this.getSource(),r,i,a;return r=n[0].toString(16),r=r.length===1?"0"+r:r,i=n[1].toString(16),i=i.length===1?"0"+i:i,a=n[2].toString(16),a=a.length===1?"0"+a:a,r.toUpperCase()+i.toUpperCase()+a.toUpperCase()},toHexa:function(){var n=this.getSource(),r;return r=Math.round(n[3]*255),r=r.toString(16),r=r.length===1?"0"+r:r,this.toHex()+r.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(n){var r=this.getSource();return r[3]=n,this.setSource(r),this},toGrayscale:function(){var n=this.getSource(),r=parseInt((n[0]*.3+n[1]*.59+n[2]*.11).toFixed(0),10),i=n[3];return this.setSource([r,r,r,i]),this},toBlackWhite:function(n){var r=this.getSource(),i=(r[0]*.3+r[1]*.59+r[2]*.11).toFixed(0),a=r[3];return n=n||127,i=Number(i)<Number(n)?0:255,this.setSource([i,i,i,a]),this},overlayWith:function(n){n instanceof o||(n=new o(n));var r=[],i=this.getAlpha(),a=.5,u=this.getSource(),s=n.getSource(),f;for(f=0;f<3;f++)r.push(Math.round(u[f]*(1-a)+s[f]*a));return r[3]=i,this.setSource(r),this}},e.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,e.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,e.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,e.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function l(n,r,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(r-n)*6*i:i<1/2?r:i<2/3?n+(r-n)*(2/3-i)*6:n}e.Color.fromRgb=function(n){return o.fromSource(o.sourceFromRgb(n))},e.Color.sourceFromRgb=function(n){var r=n.match(o.reRGBa);if(r){var i=parseInt(r[1],10)/(/%$/.test(r[1])?100:1)*(/%$/.test(r[1])?255:1),a=parseInt(r[2],10)/(/%$/.test(r[2])?100:1)*(/%$/.test(r[2])?255:1),u=parseInt(r[3],10)/(/%$/.test(r[3])?100:1)*(/%$/.test(r[3])?255:1);return[parseInt(i,10),parseInt(a,10),parseInt(u,10),r[4]?parseFloat(r[4]):1]}},e.Color.fromRgba=o.fromRgb,e.Color.fromHsl=function(n){return o.fromSource(o.sourceFromHsl(n))},e.Color.sourceFromHsl=function(n){var r=n.match(o.reHSLa);if(r){var i=(parseFloat(r[1])%360+360)%360/360,a=parseFloat(r[2])/(/%$/.test(r[2])?100:1),u=parseFloat(r[3])/(/%$/.test(r[3])?100:1),s,f,g;if(a===0)s=f=g=u;else{var m=u<=.5?u*(a+1):u+a-u*a,v=u*2-m;s=l(v,m,i+1/3),f=l(v,m,i),g=l(v,m,i-1/3)}return[Math.round(s*255),Math.round(f*255),Math.round(g*255),r[4]?parseFloat(r[4]):1]}},e.Color.fromHsla=o.fromHsl,e.Color.fromHex=function(n){return o.fromSource(o.sourceFromHex(n))},e.Color.sourceFromHex=function(n){if(n.match(o.reHex)){var r=n.slice(n.indexOf("#")+1),i=r.length===3||r.length===4,a=r.length===8||r.length===4,u=i?r.charAt(0)+r.charAt(0):r.substring(0,2),s=i?r.charAt(1)+r.charAt(1):r.substring(2,4),f=i?r.charAt(2)+r.charAt(2):r.substring(4,6),g=a?i?r.charAt(3)+r.charAt(3):r.substring(6,8):"FF";return[parseInt(u,16),parseInt(s,16),parseInt(f,16),parseFloat((parseInt(g,16)/255).toFixed(2))]}},e.Color.fromSource=function(n){var r=new o;return r.setSource(n),r}}(c),function(h){var e=h.fabric||(h.fabric={}),o=["e","se","s","sw","w","nw","n","ne","e"],l=["ns","nesw","ew","nwse"],n={},r="left",i="top",a="right",u="bottom",s="center",f={top:u,bottom:i,left:a,right:r,center:s},g=e.util.radiansToDegrees,m=Math.sign||function(W){return(W>0)-(W<0)||+W};function v(W,F){var U=W.angle+g(Math.atan2(F.y,F.x))+360;return Math.round(U%360/45)}function b(W,F){var U=F.transform.target,V=U.canvas,N=e.util.object.clone(F);N.target=U,V&&V.fire("object:"+W,N),U.fire(W,F)}function w(W,F){var U=F.canvas,V=U.uniScaleKey,N=W[V];return U.uniformScaling&&!N||!U.uniformScaling&&N}function S(W){return W.originX===s&&W.originY===s}function A(W,F,U){var V=W.lockScalingX,N=W.lockScalingY;return!!(V&&N||!F&&(V||N)&&U||V&&F==="x"||N&&F==="y")}function D(W,F,U){var V="not-allowed",N=w(W,U),q="";if(F.x!==0&&F.y===0?q="x":F.x===0&&F.y!==0&&(q="y"),A(U,q,N))return V;var et=v(U,F);return o[et]+"-resize"}function X(W,F,U){var V="not-allowed";if(F.x!==0&&U.lockSkewingY||F.y!==0&&U.lockSkewingX)return V;var N=v(U,F)%4;return l[N]+"-resize"}function K(W,F,U){return W[U.canvas.altActionKey]?n.skewCursorStyleHandler(W,F,U):n.scaleCursorStyleHandler(W,F,U)}function $(W,F,U){var V=W[U.canvas.altActionKey];if(F.x===0)return V?"skewX":"scaleY";if(F.y===0)return V?"skewY":"scaleX"}function H(W,F,U){return U.lockRotation?"not-allowed":F.cursorStyle}function J(W,F,U,V){return{e:W,transform:F,pointer:{x:U,y:V}}}function Z(W){return function(F,U,V,N){var q=U.target,et=q.getCenterPoint(),dt=q.translateToOriginPoint(et,U.originX,U.originY),ot=W(F,U,V,N);return q.setPositionByOrigin(dt,U.originX,U.originY),ot}}function Q(W,F){return function(U,V,N,q){var et=F(U,V,N,q);return et&&b(W,J(U,V,N,q)),et}}function rt(W,F,U,V,N){var q=W.target,et=q.controls[W.corner],dt=q.canvas.getZoom(),ot=q.padding/dt,z=q.toLocalPoint(new e.Point(V,N),F,U);return z.x>=ot&&(z.x-=ot),z.x<=-ot&&(z.x+=ot),z.y>=ot&&(z.y-=ot),z.y<=ot&&(z.y+=ot),z.x-=et.offsetX,z.y-=et.offsetY,z}function st(W){return W.flipX!==W.flipY}function T(W,F,U,V,N){if(W[F]!==0){var q=W._getTransformedDimensions()[V],et=N/q*W[U];W.set(U,et)}}function k(W,F,U,V){var N=F.target,q=N._getTransformedDimensions(0,N.skewY),et=rt(F,F.originX,F.originY,U,V),dt=Math.abs(et.x*2)-q.x,ot=N.skewX,z;dt<2?z=0:(z=g(Math.atan2(dt/N.scaleX,q.y/N.scaleY)),F.originX===r&&F.originY===u&&(z=-z),F.originX===a&&F.originY===i&&(z=-z),st(N)&&(z=-z));var ct=ot!==z;if(ct){var gt=N._getTransformedDimensions().y;N.set("skewX",z),T(N,"skewY","scaleY","y",gt)}return ct}function P(W,F,U,V){var N=F.target,q=N._getTransformedDimensions(N.skewX,0),et=rt(F,F.originX,F.originY,U,V),dt=Math.abs(et.y*2)-q.y,ot=N.skewY,z;dt<2?z=0:(z=g(Math.atan2(dt/N.scaleY,q.x/N.scaleX)),F.originX===r&&F.originY===u&&(z=-z),F.originX===a&&F.originY===i&&(z=-z),st(N)&&(z=-z));var ct=ot!==z;if(ct){var gt=N._getTransformedDimensions().x;N.set("skewY",z),T(N,"skewX","scaleX","x",gt)}return ct}function E(W,F,U,V){var N=F.target,q=N.skewX,et,dt=F.originY;if(N.lockSkewingX)return!1;if(q===0){var ot=rt(F,s,s,U,V);ot.x>0?et=r:et=a}else q>0&&(et=dt===i?r:a),q<0&&(et=dt===i?a:r),st(N)&&(et=et===r?a:r);F.originX=et;var z=Q("skewing",Z(k));return z(W,F,U,V)}function B(W,F,U,V){var N=F.target,q=N.skewY,et,dt=F.originX;if(N.lockSkewingY)return!1;if(q===0){var ot=rt(F,s,s,U,V);ot.y>0?et=i:et=u}else q>0&&(et=dt===r?i:u),q<0&&(et=dt===r?u:i),st(N)&&(et=et===i?u:i);F.originY=et;var z=Q("skewing",Z(P));return z(W,F,U,V)}function O(W,F,U,V){var N=F,q=N.target,et=q.translateToOriginPoint(q.getCenterPoint(),N.originX,N.originY);if(q.lockRotation)return!1;var dt=Math.atan2(N.ey-et.y,N.ex-et.x),ot=Math.atan2(V-et.y,U-et.x),z=g(ot-dt+N.theta),ct=!0;if(q.snapAngle>0){var gt=q.snapAngle,_t=q.snapThreshold||gt,xt=Math.ceil(z/gt)*gt,wt=Math.floor(z/gt)*gt;Math.abs(z-wt)<_t?z=wt:Math.abs(z-xt)<_t&&(z=xt)}return z<0&&(z=360+z),z%=360,ct=q.angle!==z,q.angle=z,ct}function x(W,F,U,V,N){N=N||{};var q=F.target,et=q.lockScalingX,dt=q.lockScalingY,ot=N.by,z,ct,gt,_t,xt=w(W,q),wt=A(q,ot,xt),Lt,kt,te=F.gestureScale;if(wt)return!1;if(te)ct=F.scaleX*te,gt=F.scaleY*te;else{if(z=rt(F,F.originX,F.originY,U,V),Lt=ot!=="y"?m(z.x):1,kt=ot!=="x"?m(z.y):1,F.signX||(F.signX=Lt),F.signY||(F.signY=kt),q.lockScalingFlip&&(F.signX!==Lt||F.signY!==kt))return!1;if(_t=q._getTransformedDimensions(),xt&&!ot){var ve=Math.abs(z.x)+Math.abs(z.y),zt=F.original,pr=Math.abs(_t.x*zt.scaleX/q.scaleX)+Math.abs(_t.y*zt.scaleY/q.scaleY),Ei=ve/pr;ct=zt.scaleX*Ei,gt=zt.scaleY*Ei}else ct=Math.abs(z.x*q.scaleX/_t.x),gt=Math.abs(z.y*q.scaleY/_t.y);S(F)&&(ct*=2,gt*=2),F.signX!==Lt&&ot!=="y"&&(F.originX=f[F.originX],ct*=-1,F.signX=Lt),F.signY!==kt&&ot!=="x"&&(F.originY=f[F.originY],gt*=-1,F.signY=kt)}var vr=q.scaleX,_r=q.scaleY;return ot?(ot==="x"&&q.set("scaleX",ct),ot==="y"&&q.set("scaleY",gt)):(!et&&q.set("scaleX",ct),!dt&&q.set("scaleY",gt)),vr!==q.scaleX||_r!==q.scaleY}function M(W,F,U,V){return x(W,F,U,V)}function R(W,F,U,V){return x(W,F,U,V,{by:"x"})}function Y(W,F,U,V){return x(W,F,U,V,{by:"y"})}function j(W,F,U,V){return W[F.target.canvas.altActionKey]?n.skewHandlerX(W,F,U,V):n.scalingY(W,F,U,V)}function G(W,F,U,V){return W[F.target.canvas.altActionKey]?n.skewHandlerY(W,F,U,V):n.scalingX(W,F,U,V)}function I(W,F,U,V){var N=F.target,q=rt(F,F.originX,F.originY,U,V),et=N.strokeWidth/(N.strokeUniform?N.scaleX:1),dt=S(F)?2:1,ot=N.width,z=Math.abs(q.x*dt/N.scaleX)-et;return N.set("width",Math.max(z,0)),ot!==z}function tt(W,F,U,V){var N=F.target,q=U-F.offsetX,et=V-F.offsetY,dt=!N.get("lockMovementX")&&N.left!==q,ot=!N.get("lockMovementY")&&N.top!==et;return dt&&N.set("left",q),ot&&N.set("top",et),(dt||ot)&&b("moving",J(W,F,U,V)),dt||ot}n.scaleCursorStyleHandler=D,n.skewCursorStyleHandler=X,n.scaleSkewCursorStyleHandler=K,n.rotationWithSnapping=Q("rotating",Z(O)),n.scalingEqually=Q("scaling",Z(M)),n.scalingX=Q("scaling",Z(R)),n.scalingY=Q("scaling",Z(Y)),n.scalingYOrSkewingX=j,n.scalingXOrSkewingY=G,n.changeWidth=Q("resizing",Z(I)),n.skewHandlerX=E,n.skewHandlerY=B,n.dragHandler=tt,n.scaleOrSkewActionName=$,n.rotationStyleHandler=H,n.fireEvent=b,n.wrapWithFixedAnchor=Z,n.wrapWithFireEvent=Q,n.getLocalPoint=rt,e.controlsUtils=n}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.util.degreesToRadians,l=e.controlsUtils;function n(i,a,u,s,f){s=s||{};var g=this.sizeX||s.cornerSize||f.cornerSize,m=this.sizeY||s.cornerSize||f.cornerSize,v=typeof s.transparentCorners<"u"?s.transparentCorners:f.transparentCorners,b=v?"stroke":"fill",w=!v&&(s.cornerStrokeColor||f.cornerStrokeColor),S=a,A=u,D;i.save(),i.fillStyle=s.cornerColor||f.cornerColor,i.strokeStyle=s.cornerStrokeColor||f.cornerStrokeColor,g>m?(D=g,i.scale(1,m/g),A=u*g/m):m>g?(D=m,i.scale(g/m,1),S=a*m/g):D=g,i.lineWidth=1,i.beginPath(),i.arc(S,A,D/2,0,2*Math.PI,!1),i[b](),w&&i.stroke(),i.restore()}function r(i,a,u,s,f){s=s||{};var g=this.sizeX||s.cornerSize||f.cornerSize,m=this.sizeY||s.cornerSize||f.cornerSize,v=typeof s.transparentCorners<"u"?s.transparentCorners:f.transparentCorners,b=v?"stroke":"fill",w=!v&&(s.cornerStrokeColor||f.cornerStrokeColor),S=g/2,A=m/2;i.save(),i.fillStyle=s.cornerColor||f.cornerColor,i.strokeStyle=s.cornerStrokeColor||f.cornerStrokeColor,i.lineWidth=1,i.translate(a,u),i.rotate(o(f.angle)),i[b+"Rect"](-S,-A,g,m),w&&i.strokeRect(-S,-A,g,m),i.restore()}l.renderCircleControl=n,l.renderSquareControl=r}(c),function(h){var e=h.fabric||(h.fabric={});function o(l){for(var n in l)this[n]=l[n]}e.Control=o,e.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(l,n){return n.cursorStyle},getActionName:function(l,n){return n.actionName},getVisibility:function(l,n){var r=l._controlsVisibility;return r&&typeof r[n]<"u"?r[n]:this.visible},setVisibility:function(l){this.visible=l},positionHandler:function(l,n){var r=e.util.transformPoint({x:this.x*l.x+this.offsetX,y:this.y*l.y+this.offsetY},n);return r},calcCornerCoords:function(l,n,r,i,a){var u,s,f,g,m=a?this.touchSizeX:this.sizeX,v=a?this.touchSizeY:this.sizeY;if(m&&v&&m!==v){var b=Math.atan2(v,m),w=Math.sqrt(m*m+v*v)/2,S=b-e.util.degreesToRadians(l),A=Math.PI/2-b-e.util.degreesToRadians(l);u=w*e.util.cos(S),s=w*e.util.sin(S),f=w*e.util.cos(A),g=w*e.util.sin(A)}else{var D=m&&v?m:n;w=D*.7071067812;var S=e.util.degreesToRadians(45-l);u=f=w*e.util.cos(S),s=g=w*e.util.sin(S)}return{tl:{x:r-g,y:i-f},tr:{x:r+u,y:i-s},bl:{x:r-u,y:i+s},br:{x:r+g,y:i+f}}},render:function(l,n,r,i,a){switch(i=i||{},i.cornerStyle||a.cornerStyle){case"circle":e.controlsUtils.renderCircleControl.call(this,l,n,r,i,a);break;default:e.controlsUtils.renderSquareControl.call(this,l,n,r,i,a)}}}}(c),function(){function h(r,i){var a=r.getAttribute("style"),u=r.getAttribute("offset")||0,s,f,g,m;if(u=parseFloat(u)/(/%$/.test(u)?100:1),u=u<0?0:u>1?1:u,a){var v=a.split(/\s*;\s*/);for(v[v.length-1]===""&&v.pop(),m=v.length;m--;){var b=v[m].split(/\s*:\s*/),w=b[0].trim(),S=b[1].trim();w==="stop-color"?s=S:w==="stop-opacity"&&(g=S)}}return s||(s=r.getAttribute("stop-color")||"rgb(0,0,0)"),g||(g=r.getAttribute("stop-opacity")),s=new t.Color(s),f=s.getAlpha(),g=isNaN(parseFloat(g))?1:parseFloat(g),g*=f*i,{offset:u,color:s.toRgb(),opacity:g}}function e(r){return{x1:r.getAttribute("x1")||0,y1:r.getAttribute("y1")||0,x2:r.getAttribute("x2")||"100%",y2:r.getAttribute("y2")||0}}function o(r){return{x1:r.getAttribute("fx")||r.getAttribute("cx")||"50%",y1:r.getAttribute("fy")||r.getAttribute("cy")||"50%",r1:0,x2:r.getAttribute("cx")||"50%",y2:r.getAttribute("cy")||"50%",r2:r.getAttribute("r")||"50%"}}var l=t.util.object.clone;t.Gradient=t.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(r){r||(r={}),r.coords||(r.coords={});var i,a=this;Object.keys(r).forEach(function(u){a[u]=r[u]}),this.id?this.id+="_"+t.Object.__uid++:this.id=t.Object.__uid++,i={x1:r.coords.x1||0,y1:r.coords.y1||0,x2:r.coords.x2||0,y2:r.coords.y2||0},this.type==="radial"&&(i.r1=r.coords.r1||0,i.r2=r.coords.r2||0),this.coords=i,this.colorStops=r.colorStops.slice()},addColorStop:function(r){for(var i in r){var a=new t.Color(r[i]);this.colorStops.push({offset:parseFloat(i),color:a.toRgb(),opacity:a.getAlpha()})}return this},toObject:function(r){var i={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return t.util.populateWithProperties(this,i,r),i},toSVG:function(r,f){var a=l(this.coords,!0),u,s,f=f||{},g,m,v=l(this.colorStops,!0),b=a.r1>a.r2,w=this.gradientTransform?this.gradientTransform.concat():t.iMatrix.concat(),S=-this.offsetX,A=-this.offsetY,D=!!f.additionalTransform,X=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(v.sort(function(Z,Q){return Z.offset-Q.offset}),X==="objectBoundingBox"?(S/=r.width,A/=r.height):(S+=r.width/2,A+=r.height/2),r.type==="path"&&this.gradientUnits!=="percentage"&&(S-=r.pathOffset.x,A-=r.pathOffset.y),w[4]-=S,w[5]-=A,m='id="SVGID_'+this.id+'" gradientUnits="'+X+'"',m+=' gradientTransform="'+(D?f.additionalTransform+" ":"")+t.util.matrixToSVG(w)+'" ',this.type==="linear"?g=["<linearGradient ",m,' x1="',a.x1,'" y1="',a.y1,'" x2="',a.x2,'" y2="',a.y2,`">
`]:this.type==="radial"&&(g=["<radialGradient ",m,' cx="',b?a.x1:a.x2,'" cy="',b?a.y1:a.y2,'" r="',b?a.r1:a.r2,'" fx="',b?a.x2:a.x1,'" fy="',b?a.y2:a.y1,`">
`]),this.type==="radial"){if(b)for(v=v.concat(),v.reverse(),u=0,s=v.length;u<s;u++)v[u].offset=1-v[u].offset;var K=Math.min(a.r1,a.r2);if(K>0){var $=Math.max(a.r1,a.r2),H=K/$;for(u=0,s=v.length;u<s;u++)v[u].offset+=H*(1-v[u].offset)}}for(u=0,s=v.length;u<s;u++){var J=v[u];g.push("<stop ",'offset="',J.offset*100+"%",'" style="stop-color:',J.color,typeof J.opacity<"u"?";stop-opacity: "+J.opacity:";",`"/>
`)}return g.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),g.join("")},toLive:function(r){var i,a=t.util.object.clone(this.coords),u,s;if(this.type){for(this.type==="linear"?i=r.createLinearGradient(a.x1,a.y1,a.x2,a.y2):this.type==="radial"&&(i=r.createRadialGradient(a.x1,a.y1,a.r1,a.x2,a.y2,a.r2)),u=0,s=this.colorStops.length;u<s;u++){var f=this.colorStops[u].color,g=this.colorStops[u].opacity,m=this.colorStops[u].offset;typeof g<"u"&&(f=new t.Color(f).setAlpha(g).toRgba()),i.addColorStop(m,f)}return i}}}),t.util.object.extend(t.Gradient,{fromElement:function(r,i,a,u){var s=parseFloat(a)/(/%$/.test(a)?100:1);s=s<0?0:s>1?1:s,isNaN(s)&&(s=1);var f=r.getElementsByTagName("stop"),g,m=r.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",v=r.getAttribute("gradientTransform")||"",b=[],w,S,A=0,D=0,X;for(r.nodeName==="linearGradient"||r.nodeName==="LINEARGRADIENT"?(g="linear",w=e(r)):(g="radial",w=o(r)),S=f.length;S--;)b.push(h(f[S],s));X=t.parseTransformAttribute(v),n(i,w,u,m),m==="pixels"&&(A=-i.left,D=-i.top);var K=new t.Gradient({id:r.getAttribute("id"),type:g,coords:w,colorStops:b,gradientUnits:m,gradientTransform:X,offsetX:A,offsetY:D});return K}});function n(r,i,a,u){var s,f;Object.keys(i).forEach(function(g){s=i[g],s==="Infinity"?f=1:s==="-Infinity"?f=0:(f=parseFloat(i[g],10),typeof s=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(s)&&(f*=.01,u==="pixels"&&((g==="x1"||g==="x2"||g==="r2")&&(f*=a.viewBoxWidth||a.width),(g==="y1"||g==="y2")&&(f*=a.viewBoxHeight||a.height)))),i[g]=f})}}(),function(){var h=t.util.toFixed;t.Pattern=t.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(e,o){if(e||(e={}),this.id=t.Object.__uid++,this.setOptions(e),!e.source||e.source&&typeof e.source!="string"){o&&o(this);return}else{var l=this;this.source=t.util.createImage(),t.util.loadImage(e.source,function(n,r){l.source=n,o&&o(l,r)},null,this.crossOrigin)}},toObject:function(e){var o=t.Object.NUM_FRACTION_DIGITS,l,n;return typeof this.source.src=="string"?l=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(l=this.source.toDataURL()),n={type:"pattern",source:l,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:h(this.offsetX,o),offsetY:h(this.offsetY,o),patternTransform:this.patternTransform?this.patternTransform.concat():null},t.util.populateWithProperties(this,n,e),n},toSVG:function(e){var o=typeof this.source=="function"?this.source():this.source,l=o.width/e.width,n=o.height/e.height,r=this.offsetX/e.width,i=this.offsetY/e.height,a="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(n=1,i&&(n+=Math.abs(i))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(l=1,r&&(l+=Math.abs(r))),o.src?a=o.src:o.toDataURL&&(a=o.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+r+'" y="'+i+'" width="'+l+'" height="'+n+`">
<image x="0" y="0" width="`+o.width+'" height="'+o.height+'" xlink:href="'+a+`"></image>
</pattern>
`},setOptions:function(e){for(var o in e)this[o]=e[o]},toLive:function(e){var o=this.source;return!o||typeof o.src<"u"&&(!o.complete||o.naturalWidth===0||o.naturalHeight===0)?"":e.createPattern(o,this.repeat)}})}(),function(h){var e=h.fabric||(h.fabric={}),o=e.util.toFixed;if(e.Shadow){e.warn("fabric.Shadow is already defined.");return}e.Shadow=e.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(l){typeof l=="string"&&(l=this._parseShadow(l));for(var n in l)this[n]=l[n];this.id=e.Object.__uid++},_parseShadow:function(l){var n=l.trim(),r=e.Shadow.reOffsetsAndBlur.exec(n)||[],i=n.replace(e.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:i.trim(),offsetX:parseFloat(r[1],10)||0,offsetY:parseFloat(r[2],10)||0,blur:parseFloat(r[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(l){var n=40,r=40,i=e.Object.NUM_FRACTION_DIGITS,a=e.util.rotateVector({x:this.offsetX,y:this.offsetY},e.util.degreesToRadians(-l.angle)),u=20,s=new e.Color(this.color);return l.width&&l.height&&(n=o((Math.abs(a.x)+this.blur)/l.width,i)*100+u,r=o((Math.abs(a.y)+this.blur)/l.height,i)*100+u),l.flipX&&(a.x*=-1),l.flipY&&(a.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+r+'%" height="'+(100+2*r)+'%" x="-'+n+'%" width="'+(100+2*n)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+o(this.blur?this.blur/2:0,i)+`"></feGaussianBlur>
	<feOffset dx="`+o(a.x,i)+'" dy="'+o(a.y,i)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+s.toRgb()+'" flood-opacity="'+s.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var l={},n=e.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(r){this[r]!==n[r]&&(l[r]=this[r])},this),l}}),e.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}(c),function(){if(t.StaticCanvas){t.warn("fabric.StaticCanvas is already defined.");return}var h=t.util.object.extend,e=t.util.getElementOffset,o=t.util.removeFromArray,l=t.util.toFixed,n=t.util.transformPoint,r=t.util.invertTransform,i=t.util.getNodeCanvas,a=t.util.createCanvasElement,u=new Error("Could not initialize `canvas` element");t.StaticCanvas=t.util.createClass(t.CommonMethods,{initialize:function(s,f){f||(f={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(s,f)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:t.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(s,f){var g=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(s),this._initOptions(f),this.interactive||this._initRetinaScaling(),f.overlayImage&&this.setOverlayImage(f.overlayImage,g),f.backgroundImage&&this.setBackgroundImage(f.backgroundImage,g),f.backgroundColor&&this.setBackgroundColor(f.backgroundColor,g),f.overlayColor&&this.setOverlayColor(f.overlayColor,g),this.calcOffset()},_isRetinaScaling:function(){return t.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,t.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var s=t.devicePixelRatio;this.__initRetinaScaling(s,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(s,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(s,f,g){f.setAttribute("width",this.width*s),f.setAttribute("height",this.height*s),g.scale(s,s)},calcOffset:function(){return this._offset=e(this.lowerCanvasEl),this},setOverlayImage:function(s,f,g){return this.__setBgOverlayImage("overlayImage",s,f,g)},setBackgroundImage:function(s,f,g){return this.__setBgOverlayImage("backgroundImage",s,f,g)},setOverlayColor:function(s,f){return this.__setBgOverlayColor("overlayColor",s,f)},setBackgroundColor:function(s,f){return this.__setBgOverlayColor("backgroundColor",s,f)},__setBgOverlayImage:function(s,f,g,m){return typeof f=="string"?t.util.loadImage(f,function(v,b){if(v){var w=new t.Image(v,m);this[s]=w,w.canvas=this}g&&g(v,b)},this,m&&m.crossOrigin):(m&&f.setOptions(m),this[s]=f,f&&(f.canvas=this),g&&g(f,!1)),this},__setBgOverlayColor:function(s,f,g){return this[s]=f,this._initGradient(f,s),this._initPattern(f,s,g),this},_createCanvasElement:function(){var s=a();if(!s||(s.style||(s.style={}),typeof s.getContext>"u"))throw u;return s},_initOptions:function(s){var f=this.lowerCanvasEl;this._setOptions(s),this.width=this.width||parseInt(f.width,10)||0,this.height=this.height||parseInt(f.height,10)||0,this.lowerCanvasEl.style&&(f.width=this.width,f.height=this.height,f.style.width=this.width+"px",f.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(s){s&&s.getContext?this.lowerCanvasEl=s:this.lowerCanvasEl=t.util.getById(s)||this._createCanvasElement(),t.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(s,f){return this.setDimensions({width:s},f)},setHeight:function(s,f){return this.setDimensions({height:s},f)},setDimensions:function(s,f){var g;f=f||{};for(var m in s)g=s[m],f.cssOnly||(this._setBackstoreDimension(m,s[m]),g+="px",this.hasLostContext=!0),f.backstoreOnly||this._setCssDimension(m,g);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),f.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(s,f){return this.lowerCanvasEl[s]=f,this.upperCanvasEl&&(this.upperCanvasEl[s]=f),this.cacheCanvasEl&&(this.cacheCanvasEl[s]=f),this[s]=f,this},_setCssDimension:function(s,f){return this.lowerCanvasEl.style[s]=f,this.upperCanvasEl&&(this.upperCanvasEl.style[s]=f),this.wrapperEl&&(this.wrapperEl.style[s]=f),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(s){var f=this._activeObject,g=this.backgroundImage,m=this.overlayImage,v,b,w;for(this.viewportTransform=s,b=0,w=this._objects.length;b<w;b++)v=this._objects[b],v.group||v.setCoords(!0);return f&&f.setCoords(),g&&g.setCoords(!0),m&&m.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(s,f){var g=s,m=this.viewportTransform.slice(0);s=n(s,r(this.viewportTransform)),m[0]=f,m[3]=f;var v=n(s,m);return m[4]+=g.x-v.x,m[5]+=g.y-v.y,this.setViewportTransform(m)},setZoom:function(s){return this.zoomToPoint(new t.Point(0,0),s),this},absolutePan:function(s){var f=this.viewportTransform.slice(0);return f[4]=-s.x,f[5]=-s.y,this.setViewportTransform(f)},relativePan:function(s){return this.absolutePan(new t.Point(-s.x-this.viewportTransform[4],-s.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(s){this.stateful&&s.setupState(),s._set("canvas",this),s.setCoords(),this.fire("object:added",{target:s}),s.fire("added")},_onObjectRemoved:function(s){this.fire("object:removed",{target:s}),s.fire("removed"),delete s.canvas},clearContext:function(s){return s.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var s=this.contextContainer;return this.renderCanvas(s,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=t.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var s={},f=this.width,g=this.height,m=r(this.viewportTransform);return s.tl=n({x:0,y:0},m),s.br=n({x:f,y:g},m),s.tr=new t.Point(s.br.x,s.tl.y),s.bl=new t.Point(s.tl.x,s.br.y),this.vptCoords=s,s},cancelRequestedRender:function(){this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(s,f){var g=this.viewportTransform,m=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(s),t.util.setImageSmoothing(s,this.imageSmoothingEnabled),this.fire("before:render",{ctx:s}),this._renderBackground(s),s.save(),s.transform(g[0],g[1],g[2],g[3],g[4],g[5]),this._renderObjects(s,f),s.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(s),m&&(m.canvas=this,m.shouldCache(),m._transformDone=!0,m.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(s)),this._renderOverlay(s),this.controlsAboveOverlay&&this.interactive&&this.drawControls(s),this.fire("after:render",{ctx:s})},drawClipPathOnCanvas:function(s){var f=this.viewportTransform,g=this.clipPath;s.save(),s.transform(f[0],f[1],f[2],f[3],f[4],f[5]),s.globalCompositeOperation="destination-in",g.transform(s),s.scale(1/g.zoomX,1/g.zoomY),s.drawImage(g._cacheCanvas,-g.cacheTranslationX,-g.cacheTranslationY),s.restore()},_renderObjects:function(s,f){var g,m;for(g=0,m=f.length;g<m;++g)f[g]&&f[g].render(s)},_renderBackgroundOrOverlay:function(s,f){var g=this[f+"Color"],m=this[f+"Image"],v=this.viewportTransform,b=this[f+"Vpt"];if(!(!g&&!m)){if(g){s.save(),s.beginPath(),s.moveTo(0,0),s.lineTo(this.width,0),s.lineTo(this.width,this.height),s.lineTo(0,this.height),s.closePath(),s.fillStyle=g.toLive?g.toLive(s,this):g,b&&s.transform(v[0],v[1],v[2],v[3],v[4],v[5]),s.transform(1,0,0,1,g.offsetX||0,g.offsetY||0);var w=g.gradientTransform||g.patternTransform;w&&s.transform(w[0],w[1],w[2],w[3],w[4],w[5]),s.fill(),s.restore()}m&&(s.save(),b&&s.transform(v[0],v[1],v[2],v[3],v[4],v[5]),m.render(s),s.restore())}},_renderBackground:function(s){this._renderBackgroundOrOverlay(s,"background")},_renderOverlay:function(s){this._renderBackgroundOrOverlay(s,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new t.Point(this.width/2,this.height/2)},centerObjectH:function(s){return this._centerObject(s,new t.Point(this.getCenterPoint().x,s.getCenterPoint().y))},centerObjectV:function(s){return this._centerObject(s,new t.Point(s.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(s){var f=this.getCenterPoint();return this._centerObject(s,f)},viewportCenterObject:function(s){var f=this.getVpCenter();return this._centerObject(s,f)},viewportCenterObjectH:function(s){var f=this.getVpCenter();return this._centerObject(s,new t.Point(f.x,s.getCenterPoint().y)),this},viewportCenterObjectV:function(s){var f=this.getVpCenter();return this._centerObject(s,new t.Point(s.getCenterPoint().x,f.y))},getVpCenter:function(){var s=this.getCenterPoint(),f=r(this.viewportTransform);return n(s,f)},_centerObject:function(s,f){return s.setPositionByOrigin(f,"center","center"),s.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(s){return this.toDatalessObject(s)},toObject:function(s){return this._toObjectMethod("toObject",s)},toDatalessObject:function(s){return this._toObjectMethod("toDatalessObject",s)},_toObjectMethod:function(s,f){var g=this.clipPath,m={version:t.version,objects:this._toObjects(s,f)};return g&&!g.excludeFromExport&&(m.clipPath=this._toObject(this.clipPath,s,f)),h(m,this.__serializeBgOverlay(s,f)),t.util.populateWithProperties(this,m,f),m},_toObjects:function(s,f){return this._objects.filter(function(g){return!g.excludeFromExport}).map(function(g){return this._toObject(g,s,f)},this)},_toObject:function(s,f,g){var m;this.includeDefaultValues||(m=s.includeDefaultValues,s.includeDefaultValues=!1);var v=s[f](g);return this.includeDefaultValues||(s.includeDefaultValues=m),v},__serializeBgOverlay:function(s,f){var g={},m=this.backgroundImage,v=this.overlayImage,b=this.backgroundColor,w=this.overlayColor;return b&&b.toObject?b.excludeFromExport||(g.background=b.toObject(f)):b&&(g.background=b),w&&w.toObject?w.excludeFromExport||(g.overlay=w.toObject(f)):w&&(g.overlay=w),m&&!m.excludeFromExport&&(g.backgroundImage=this._toObject(m,s,f)),v&&!v.excludeFromExport&&(g.overlayImage=this._toObject(v,s,f)),g},svgViewportTransformation:!0,toSVG:function(s,f){s||(s={}),s.reviver=f;var g=[];return this._setSVGPreamble(g,s),this._setSVGHeader(g,s),this.clipPath&&g.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(g,"background"),this._setSVGBgOverlayImage(g,"backgroundImage",f),this._setSVGObjects(g,f),this.clipPath&&g.push(`</g>
`),this._setSVGBgOverlayColor(g,"overlay"),this._setSVGBgOverlayImage(g,"overlayImage",f),g.push("</svg>"),g.join("")},_setSVGPreamble:function(s,f){f.suppressPreamble||s.push('<?xml version="1.0" encoding="',f.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(s,f){var g=f.width||this.width,m=f.height||this.height,v,b='viewBox="0 0 '+this.width+" "+this.height+'" ',w=t.Object.NUM_FRACTION_DIGITS;f.viewBox?b='viewBox="'+f.viewBox.x+" "+f.viewBox.y+" "+f.viewBox.width+" "+f.viewBox.height+'" ':this.svgViewportTransformation&&(v=this.viewportTransform,b='viewBox="'+l(-v[4]/v[0],w)+" "+l(-v[5]/v[3],w)+" "+l(this.width/v[0],w)+" "+l(this.height/v[3],w)+'" '),s.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',g,'" ','height="',m,'" ',b,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",t.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(f),`</defs>
`)},createSVGClipPathMarkup:function(s){var f=this.clipPath;return f?(f.clipPathId="CLIPPATH_"+t.Object.__uid++,'<clipPath id="'+f.clipPathId+`" >
`+this.clipPath.toClipPathSVG(s.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var s=this,f=["background","overlay"].map(function(g){var m=s[g+"Color"];if(m&&m.toLive){var v=s[g+"Vpt"],b=s.viewportTransform,w={width:s.width/(v?b[0]:1),height:s.height/(v?b[3]:1)};return m.toSVG(w,{additionalTransform:v?t.util.matrixToSVG(b):""})}});return f.join("")},createSVGFontFacesMarkup:function(){var s="",f={},g,m,v,b,w,S,A,D,X,K=t.fontPaths,$=[];for(this._objects.forEach(function J(Z){$.push(Z),Z._objects&&Z._objects.forEach(J)}),D=0,X=$.length;D<X;D++)if(g=$[D],m=g.fontFamily,!(g.type.indexOf("text")===-1||f[m]||!K[m])&&(f[m]=!0,!!g.styles)){v=g.styles;for(w in v){b=v[w];for(A in b)S=b[A],m=S.fontFamily,!f[m]&&K[m]&&(f[m]=!0)}}for(var H in f)s+=[`		@font-face {
`,"			font-family: '",H,`';
`,"			src: url('",K[H],`');
`,`		}
`].join("");return s&&(s=['	<style type="text/css">',`<![CDATA[
`,s,"]]>",`</style>
`].join("")),s},_setSVGObjects:function(s,f){var g,m,v,b=this._objects;for(m=0,v=b.length;m<v;m++)g=b[m],!g.excludeFromExport&&this._setSVGObject(s,g,f)},_setSVGObject:function(s,f,g){s.push(f.toSVG(g))},_setSVGBgOverlayImage:function(s,f,g){this[f]&&!this[f].excludeFromExport&&this[f].toSVG&&s.push(this[f].toSVG(g))},_setSVGBgOverlayColor:function(s,f){var g=this[f+"Color"],m=this.viewportTransform,v=this.width,b=this.height;if(g)if(g.toLive){var w=g.repeat,S=t.util.invertTransform(m),A=this[f+"Vpt"],D=A?t.util.matrixToSVG(S):"";s.push('<rect transform="'+D+" translate(",v/2,",",b/2,')"',' x="',g.offsetX-v/2,'" y="',g.offsetY-b/2,'" ','width="',w==="repeat-y"||w==="no-repeat"?g.source.width:v,'" height="',w==="repeat-x"||w==="no-repeat"?g.source.height:b,'" fill="url(#SVGID_'+g.id+')"',`></rect>
`)}else s.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',g,'"',`></rect>
`)},sendToBack:function(s){if(!s)return this;var f=this._activeObject,g,m,v;if(s===f&&s.type==="activeSelection")for(v=f._objects,g=v.length;g--;)m=v[g],o(this._objects,m),this._objects.unshift(m);else o(this._objects,s),this._objects.unshift(s);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(s){if(!s)return this;var f=this._activeObject,g,m,v;if(s===f&&s.type==="activeSelection")for(v=f._objects,g=0;g<v.length;g++)m=v[g],o(this._objects,m),this._objects.push(m);else o(this._objects,s),this._objects.push(s);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(s,f){if(!s)return this;var g=this._activeObject,m,v,b,w,S,A=0;if(s===g&&s.type==="activeSelection")for(S=g._objects,m=0;m<S.length;m++)v=S[m],b=this._objects.indexOf(v),b>0+A&&(w=b-1,o(this._objects,v),this._objects.splice(w,0,v)),A++;else b=this._objects.indexOf(s),b!==0&&(w=this._findNewLowerIndex(s,b,f),o(this._objects,s),this._objects.splice(w,0,s));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(s,f,g){var m,v;if(g)for(m=f,v=f-1;v>=0;--v){var b=s.intersectsWithObject(this._objects[v])||s.isContainedWithinObject(this._objects[v])||this._objects[v].isContainedWithinObject(s);if(b){m=v;break}}else m=f-1;return m},bringForward:function(s,f){if(!s)return this;var g=this._activeObject,m,v,b,w,S,A=0;if(s===g&&s.type==="activeSelection")for(S=g._objects,m=S.length;m--;)v=S[m],b=this._objects.indexOf(v),b<this._objects.length-1-A&&(w=b+1,o(this._objects,v),this._objects.splice(w,0,v)),A++;else b=this._objects.indexOf(s),b!==this._objects.length-1&&(w=this._findNewUpperIndex(s,b,f),o(this._objects,s),this._objects.splice(w,0,s));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(s,f,g){var m,v,b;if(g)for(m=f,v=f+1,b=this._objects.length;v<b;++v){var w=s.intersectsWithObject(this._objects[v])||s.isContainedWithinObject(this._objects[v])||this._objects[v].isContainedWithinObject(s);if(w){m=v;break}}else m=f+1;return m},moveTo:function(s,f){return o(this._objects,s),this._objects.splice(f,0,s),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(s){s.dispose&&s.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),t.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),t.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),h(t.StaticCanvas.prototype,t.Observable),h(t.StaticCanvas.prototype,t.Collection),h(t.StaticCanvas.prototype,t.DataURLExporter),h(t.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(s){var f=a();if(!f||!f.getContext)return null;var g=f.getContext("2d");if(!g)return null;switch(s){case"setLineDash":return typeof g.setLineDash<"u";default:return null}}}),t.StaticCanvas.prototype.toJSON=t.StaticCanvas.prototype.toObject,t.isLikelyNode&&(t.StaticCanvas.prototype.createPNGStream=function(){var s=i(this.lowerCanvasEl);return s&&s.createPNGStream()},t.StaticCanvas.prototype.createJPEGStream=function(s){var f=i(this.lowerCanvasEl);return f&&f.createJPEGStream(s)})}(),t.BaseBrush=t.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(h){h.strokeStyle=this.color,h.lineWidth=this.width,h.lineCap=this.strokeLineCap,h.miterLimit=this.strokeMiterLimit,h.lineJoin=this.strokeLineJoin,h.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(h){var e=this.canvas.viewportTransform;h.save(),h.transform(e[0],e[1],e[2],e[3],e[4],e[5])},_setShadow:function(){if(this.shadow){var h=this.canvas,e=this.shadow,o=h.contextTop,l=h.getZoom();h&&h._isRetinaScaling()&&(l*=t.devicePixelRatio),o.shadowColor=e.color,o.shadowBlur=e.blur*l,o.shadowOffsetX=e.offsetX*l,o.shadowOffsetY=e.offsetY*l}},needsFullRender:function(){var h=new t.Color(this.color);return h.getAlpha()<1||!!this.shadow},_resetShadow:function(){var h=this.canvas.contextTop;h.shadowColor="",h.shadowBlur=h.shadowOffsetX=h.shadowOffsetY=0},_isOutSideCanvas:function(h){return h.x<0||h.x>this.canvas.getWidth()||h.y<0||h.y>this.canvas.getHeight()}}),function(){t.PencilBrush=t.util.createClass(t.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(h){this.canvas=h,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(h,e,o){var l=e.midPointFrom(o);return h.quadraticCurveTo(e.x,e.y,l.x,l.y),l},onMouseDown:function(h,e){this.canvas._isMainEvent(e.e)&&(this.drawStraightLine=e.e[this.straightLineKey],this._prepareForDrawing(h),this._captureDrawingPath(h),this._render())},onMouseMove:function(h,e){if(this.canvas._isMainEvent(e.e)&&(this.drawStraightLine=e.e[this.straightLineKey],!(this.limitedToCanvasSize===!0&&this._isOutSideCanvas(h))&&this._captureDrawingPath(h)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var o=this._points,l=o.length,n=this.canvas.contextTop;this._saveAndTransform(n),this.oldEnd&&(n.beginPath(),n.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(n,o[l-2],o[l-1],!0),n.stroke(),n.restore()}},onMouseUp:function(h){return this.canvas._isMainEvent(h.e)?(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(h){var e=new t.Point(h.x,h.y);this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y)},_addPoint:function(h){return this._points.length>1&&h.eq(this._points[this._points.length-1])?!1:(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(h),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(h){var e=new t.Point(h.x,h.y);return this._addPoint(e)},_render:function(h){var e,o,l=this._points[0],n=this._points[1];if(h=h||this.canvas.contextTop,this._saveAndTransform(h),h.beginPath(),this._points.length===2&&l.x===n.x&&l.y===n.y){var r=this.width/1e3;l=new t.Point(l.x,l.y),n=new t.Point(n.x,n.y),l.x-=r,n.x+=r}for(h.moveTo(l.x,l.y),e=1,o=this._points.length;e<o;e++)this._drawSegment(h,l,n),l=this._points[e],n=this._points[e+1];h.lineTo(l.x,l.y),h.stroke(),h.restore()},convertPointsToSVGPath:function(h){var e=this.width/1e3;return t.util.getSmoothPathFromPoints(h,e)},_isEmptySVGPath:function(h){var e=t.util.joinPath(h);return e==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(h){var e=new t.Path(h,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,e.shadow=new t.Shadow(this.shadow)),e},decimatePoints:function(h,e){if(h.length<=2)return h;var o=this.canvas.getZoom(),l=Math.pow(e/o,2),n,r=h.length-1,i=h[0],a=[i],u;for(n=1;n<r-1;n++)u=Math.pow(i.x-h[n].x,2)+Math.pow(i.y-h[n].y,2),u>=l&&(i=h[n],a.push(i));return a.push(h[r]),a},_finalizeAndAddPath:function(){var h=this.canvas.contextTop;h.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var e=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(e)){this.canvas.requestRenderAll();return}var o=this.createPath(e);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:o}),this.canvas.add(o),this.canvas.requestRenderAll(),o.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:o})}})}(),t.CircleBrush=t.util.createClass(t.BaseBrush,{width:10,initialize:function(h){this.canvas=h,this.points=[]},drawDot:function(h){var e=this.addPoint(h),o=this.canvas.contextTop;this._saveAndTransform(o),this.dot(o,e),o.restore()},dot:function(h,e){h.fillStyle=e.fill,h.beginPath(),h.arc(e.x,e.y,e.radius,0,Math.PI*2,!1),h.closePath(),h.fill()},onMouseDown:function(h){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(h)},_render:function(){var h=this.canvas.contextTop,e,o,l=this.points;for(this._saveAndTransform(h),e=0,o=l.length;e<o;e++)this.dot(h,l[e]);h.restore()},onMouseMove:function(h){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(h)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(h),this._render()):this.drawDot(h))},onMouseUp:function(){var h=this.canvas.renderOnAddRemove,e,o;this.canvas.renderOnAddRemove=!1;var l=[];for(e=0,o=this.points.length;e<o;e++){var n=this.points[e],r=new t.Circle({radius:n.radius,left:n.x,top:n.y,originX:"center",originY:"center",fill:n.fill});this.shadow&&(r.shadow=new t.Shadow(this.shadow)),l.push(r)}var i=new t.Group(l);i.canvas=this.canvas,this.canvas.fire("before:path:created",{path:i}),this.canvas.add(i),this.canvas.fire("path:created",{path:i}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=h,this.canvas.requestRenderAll()},addPoint:function(h){var e=new t.Point(h.x,h.y),o=t.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,l=new t.Color(this.color).setAlpha(t.util.getRandomInt(0,100)/100).toRgba();return e.radius=o,e.fill=l,this.points.push(e),e}}),t.SprayBrush=t.util.createClass(t.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(h){this.canvas=h,this.sprayChunks=[]},onMouseDown:function(h){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(h),this.render(this.sprayChunkPoints)},onMouseMove:function(h){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(h)||(this.addSprayChunk(h),this.render(this.sprayChunkPoints))},onMouseUp:function(){var h=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],o=0,l=this.sprayChunks.length;o<l;o++)for(var n=this.sprayChunks[o],r=0,i=n.length;r<i;r++){var a=new t.Rect({width:n[r].width,height:n[r].width,left:n[r].x+1,top:n[r].y+1,originX:"center",originY:"center",fill:this.color});e.push(a)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));var u=new t.Group(e);this.shadow&&u.set("shadow",new t.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:u}),this.canvas.add(u),this.canvas.fire("path:created",{path:u}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=h,this.canvas.requestRenderAll()},_getOptimizedRects:function(h){var e={},o,l,n;for(l=0,n=h.length;l<n;l++)o=h[l].left+""+h[l].top,e[o]||(e[o]=h[l]);var r=[];for(o in e)r.push(e[o]);return r},render:function(h){var e=this.canvas.contextTop,o,l;for(e.fillStyle=this.color,this._saveAndTransform(e),o=0,l=h.length;o<l;o++){var n=h[o];typeof n.opacity<"u"&&(e.globalAlpha=n.opacity),e.fillRect(n.x,n.y,n.width,n.width)}e.restore()},_render:function(){var h=this.canvas.contextTop,e,o;for(h.fillStyle=this.color,this._saveAndTransform(h),e=0,o=this.sprayChunks.length;e<o;e++)this.render(this.sprayChunks[e]);h.restore()},addSprayChunk:function(h){this.sprayChunkPoints=[];var e,o,l,n=this.width/2,r;for(r=0;r<this.density;r++){e=t.util.getRandomInt(h.x-n,h.x+n),o=t.util.getRandomInt(h.y-n,h.y+n),this.dotWidthVariance?l=t.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):l=this.dotWidth;var i=new t.Point(e,o);i.width=l,this.randomOpacity&&(i.opacity=t.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(i)}this.sprayChunks.push(this.sprayChunkPoints)}}),t.PatternBrush=t.util.createClass(t.PencilBrush,{getPatternSrc:function(){var h=20,e=5,o=t.util.createCanvasElement(),l=o.getContext("2d");return o.width=o.height=h+e,l.fillStyle=this.color,l.beginPath(),l.arc(h/2,h/2,h/2,0,Math.PI*2,!1),l.closePath(),l.fill(),o},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(h){return h.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(h){this.callSuper("_setBrushStyles",h),h.strokeStyle=this.getPattern(h)},createPath:function(h){var e=this.callSuper("createPath",h),o=e._getLeftTopCoords().scalarAdd(e.strokeWidth/2);return e.stroke=new t.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-o.x,offsetY:-o.y}),e}}),function(){var h=t.util.getPointer,e=t.util.degreesToRadians,o=t.util.isTouchEvent;t.Canvas=t.util.createClass(t.StaticCanvas,{initialize:function(n,r){r||(r={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(n,r),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=t.PencilBrush&&new t.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var n=this.getActiveObjects(),r,i,a;if(n.length>0&&!this.preserveObjectStacking){i=[],a=[];for(var u=0,s=this._objects.length;u<s;u++)r=this._objects[u],n.indexOf(r)===-1?i.push(r):a.push(r);n.length>1&&(this._activeObject._objects=a),i.push.apply(i,a)}else i=this._objects;return i},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var n=this.contextContainer;return this.renderCanvas(n,this._chooseObjectsToRender()),this},renderTopLayer:function(n){n.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(n),this.contextTopDirty=!0),n.restore()},renderTop:function(){var n=this.contextTop;return this.clearContext(n),this.renderTopLayer(n),this.fire("after:render"),this},_normalizePointer:function(n,r){var i=n.calcTransformMatrix(),a=t.util.invertTransform(i),u=this.restorePointerVpt(r);return t.util.transformPoint(u,a)},isTargetTransparent:function(n,r,i){if(n.shouldCache()&&n._cacheCanvas&&n!==this._activeObject){var a=this._normalizePointer(n,{x:r,y:i}),u=Math.max(n.cacheTranslationX+a.x*n.zoomX,0),s=Math.max(n.cacheTranslationY+a.y*n.zoomY,0),v=t.util.isTransparent(n._cacheContext,Math.round(u),Math.round(s),this.targetFindTolerance);return v}var f=this.contextCache,g=n.selectionBackgroundColor,m=this.viewportTransform;n.selectionBackgroundColor="",this.clearContext(f),f.save(),f.transform(m[0],m[1],m[2],m[3],m[4],m[5]),n.render(f),f.restore(),n.selectionBackgroundColor=g;var v=t.util.isTransparent(f,r,i,this.targetFindTolerance);return v},_isSelectionKeyPressed:function(n){var r=!1;return Array.isArray(this.selectionKey)?r=!!this.selectionKey.find(function(i){return n[i]===!0}):r=n[this.selectionKey],r},_shouldClearSelection:function(n,r){var i=this.getActiveObjects(),a=this._activeObject;return!r||r&&a&&i.length>1&&i.indexOf(r)===-1&&a!==r&&!this._isSelectionKeyPressed(n)||r&&!r.evented||r&&!r.selectable&&a&&a!==r},_shouldCenterTransform:function(n,r,i){if(n){var a;return r==="scale"||r==="scaleX"||r==="scaleY"||r==="resizing"?a=this.centeredScaling||n.centeredScaling:r==="rotate"&&(a=this.centeredRotation||n.centeredRotation),a?!i:i}},_getOriginFromCorner:function(n,r){var i={x:n.originX,y:n.originY};return r==="ml"||r==="tl"||r==="bl"?i.x="right":(r==="mr"||r==="tr"||r==="br")&&(i.x="left"),r==="tl"||r==="mt"||r==="tr"?i.y="bottom":(r==="bl"||r==="mb"||r==="br")&&(i.y="top"),i},_getActionFromCorner:function(n,r,i,a){if(!r||!n)return"drag";var u=a.controls[r];return u.getActionName(i,u,a)},_setupCurrentTransform:function(n,r,i){if(r){var a=this.getPointer(n),u=r.__corner,s=r.controls[u],f=i&&u?s.getActionHandler(n,r,s):t.controlsUtils.dragHandler,g=this._getActionFromCorner(i,u,n,r),m=this._getOriginFromCorner(r,u),v=n[this.centeredKey],b={target:r,action:g,actionHandler:f,corner:u,scaleX:r.scaleX,scaleY:r.scaleY,skewX:r.skewX,skewY:r.skewY,offsetX:a.x-r.left,offsetY:a.y-r.top,originX:m.x,originY:m.y,ex:a.x,ey:a.y,lastX:a.x,lastY:a.y,theta:e(r.angle),width:r.width*r.scaleX,shiftKey:n.shiftKey,altKey:v,original:t.util.saveObjectTransform(r)};this._shouldCenterTransform(r,g,v)&&(b.originX="center",b.originY="center"),b.original.originX=m.x,b.original.originY=m.y,this._currentTransform=b,this._beforeTransform(n)}},setCursor:function(n){this.upperCanvasEl.style.cursor=n},_drawSelection:function(n){var r=this._groupSelector,i=new t.Point(r.ex,r.ey),a=t.util.transformPoint(i,this.viewportTransform),u=new t.Point(r.ex+r.left,r.ey+r.top),s=t.util.transformPoint(u,this.viewportTransform),f=Math.min(a.x,s.x),g=Math.min(a.y,s.y),m=Math.max(a.x,s.x),v=Math.max(a.y,s.y),b=this.selectionLineWidth/2;this.selectionColor&&(n.fillStyle=this.selectionColor,n.fillRect(f,g,m-f,v-g)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(n.lineWidth=this.selectionLineWidth,n.strokeStyle=this.selectionBorderColor,f+=b,g+=b,m-=b,v-=b,t.Object.prototype._setLineDash.call(this,n,this.selectionDashArray),n.strokeRect(f,g,m-f,v-g))},findTarget:function(n,r){if(!this.skipTargetFind){var i=!0,a=this.getPointer(n,i),u=this._activeObject,s=this.getActiveObjects(),f,g,m=o(n),v=s.length>1&&!r||s.length===1;if(this.targets=[],v&&u._findTargetCorner(a,m)||s.length>1&&!r&&u===this._searchPossibleTargets([u],a))return u;if(s.length===1&&u===this._searchPossibleTargets([u],a))if(this.preserveObjectStacking)f=u,g=this.targets,this.targets=[];else return u;var b=this._searchPossibleTargets(this._objects,a);return n[this.altSelectionKey]&&b&&f&&b!==f&&(b=f,this.targets=g),b}},_checkTarget:function(n,r,i){if(r&&r.visible&&r.evented&&r.containsPoint(n))if((this.perPixelTargetFind||r.perPixelTargetFind)&&!r.isEditing){var a=this.isTargetTransparent(r,i.x,i.y);if(!a)return!0}else return!0},_searchPossibleTargets:function(n,r){for(var i,a=n.length,u;a--;){var s=n[a],f=s.group?this._normalizePointer(s.group,r):r;if(this._checkTarget(f,s,r)){i=n[a],i.subTargetCheck&&i instanceof t.Group&&(u=this._searchPossibleTargets(i._objects,r),u&&this.targets.push(u));break}}return i},restorePointerVpt:function(n){return t.util.transformPoint(n,t.util.invertTransform(this.viewportTransform))},getPointer:function(n,r){if(this._absolutePointer&&!r)return this._absolutePointer;if(this._pointer&&r)return this._pointer;var i=h(n),a=this.upperCanvasEl,u=a.getBoundingClientRect(),s=u.width||0,f=u.height||0,g;(!s||!f)&&("top"in u&&"bottom"in u&&(f=Math.abs(u.top-u.bottom)),"right"in u&&"left"in u&&(s=Math.abs(u.right-u.left))),this.calcOffset(),i.x=i.x-this._offset.left,i.y=i.y-this._offset.top,r||(i=this.restorePointerVpt(i));var m=this.getRetinaScaling();return m!==1&&(i.x/=m,i.y/=m),s===0||f===0?g={width:1,height:1}:g={width:a.width/s,height:a.height/f},{x:i.x*g.width,y:i.y*g.height}},_createUpperCanvas:function(){var n=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),r=this.lowerCanvasEl,i=this.upperCanvasEl;i?i.className="":(i=this._createCanvasElement(),this.upperCanvasEl=i),t.util.addClass(i,"upper-canvas "+n),this.wrapperEl.appendChild(i),this._copyCanvasStyle(r,i),this._applyCanvasStyle(i),this.contextTop=i.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=t.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),t.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),t.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(n){var r=this.width||n.width,i=this.height||n.height;t.util.setStyle(n,{position:"absolute",width:r+"px",height:i+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),n.width=r,n.height=i,t.util.makeElementUnselectable(n)},_copyCanvasStyle:function(n,r){r.style.cssText=n.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var n=this._activeObject;return n?n.type==="activeSelection"&&n._objects?n._objects.slice(0):[n]:[]},_onObjectRemoved:function(n){n===this._activeObject&&(this.fire("before:selection:cleared",{target:n}),this._discardActiveObject(),this.fire("selection:cleared",{target:n}),n.fire("deselected")),n===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",n)},_fireSelectionEvents:function(n,r){var i=!1,a=this.getActiveObjects(),u=[],s=[];n.forEach(function(f){a.indexOf(f)===-1&&(i=!0,f.fire("deselected",{e:r,target:f}),s.push(f))}),a.forEach(function(f){n.indexOf(f)===-1&&(i=!0,f.fire("selected",{e:r,target:f}),u.push(f))}),n.length>0&&a.length>0?i&&this.fire("selection:updated",{e:r,selected:u,deselected:s}):a.length>0?this.fire("selection:created",{e:r,selected:u}):n.length>0&&this.fire("selection:cleared",{e:r,deselected:s})},setActiveObject:function(n,r){var i=this.getActiveObjects();return this._setActiveObject(n,r),this._fireSelectionEvents(i,r),this},_setActiveObject:function(n,r){return this._activeObject===n||!this._discardActiveObject(r,n)||n.onSelect({e:r})?!1:(this._activeObject=n,!0)},_discardActiveObject:function(n,r){var i=this._activeObject;if(i){if(i.onDeselect({e:n,object:r}))return!1;this._activeObject=null}return!0},discardActiveObject:function(n){var r=this.getActiveObjects(),i=this.getActiveObject();return r.length&&this.fire("before:selection:cleared",{target:i,e:n}),this._discardActiveObject(n),this._fireSelectionEvents(r,n),this},dispose:function(){var n=this.wrapperEl;return this.removeListeners(),n.removeChild(this.upperCanvasEl),n.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(r){t.util.cleanUpJsdomNode(this[r]),this[r]=void 0}.bind(this)),n.parentNode&&n.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,t.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(n){var r=this._activeObject;r&&r._renderControls(n)},_toObject:function(n,r,i){var a=this._realizeGroupTransformOnObject(n),u=this.callSuper("_toObject",n,r,i);return this._unwindGroupTransformOnObject(n,a),u},_realizeGroupTransformOnObject:function(n){if(n.group&&n.group.type==="activeSelection"&&this._activeObject===n.group){var r=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],i={};return r.forEach(function(a){i[a]=n[a]}),t.util.addTransformToObject(n,this._activeObject.calcOwnMatrix()),i}else return null},_unwindGroupTransformOnObject:function(n,r){r&&n.set(r)},_setSVGObject:function(n,r,i){var a=this._realizeGroupTransformOnObject(r);this.callSuper("_setSVGObject",n,r,i),this._unwindGroupTransformOnObject(r,a)},setViewportTransform:function(n){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),t.StaticCanvas.prototype.setViewportTransform.call(this,n)}});for(var l in t.StaticCanvas)l!=="prototype"&&(t.Canvas[l]=t.StaticCanvas[l])}(),function(){var h=t.util.addListener,e=t.util.removeListener,o=3,l=2,n=1,r={passive:!1};function i(a,u){return a.button&&a.button===u-1}t.util.object.extend(t.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(h,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(a,u){var s=this.upperCanvasEl,f=this._getEventPrefix();a(t.window,"resize",this._onResize),a(s,f+"down",this._onMouseDown),a(s,f+"move",this._onMouseMove,r),a(s,f+"out",this._onMouseOut),a(s,f+"enter",this._onMouseEnter),a(s,"wheel",this._onMouseWheel),a(s,"contextmenu",this._onContextMenu),a(s,"dblclick",this._onDoubleClick),a(s,"dragover",this._onDragOver),a(s,"dragenter",this._onDragEnter),a(s,"dragleave",this._onDragLeave),a(s,"drop",this._onDrop),this.enablePointerEvents||a(s,"touchstart",this._onTouchStart,r),typeof eventjs<"u"&&u in eventjs&&(eventjs[u](s,"gesture",this._onGesture),eventjs[u](s,"drag",this._onDrag),eventjs[u](s,"orientation",this._onOrientationChange),eventjs[u](s,"shake",this._onShake),eventjs[u](s,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(e,"remove");var a=this._getEventPrefix();e(t.document,a+"up",this._onMouseUp),e(t.document,"touchend",this._onTouchEnd,r),e(t.document,a+"move",this._onMouseMove,r),e(t.document,"touchmove",this._onMouseMove,r)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(a,u){this.__onTransformGesture&&this.__onTransformGesture(a,u)},_onDrag:function(a,u){this.__onDrag&&this.__onDrag(a,u)},_onMouseWheel:function(a){this.__onMouseWheel(a)},_onMouseOut:function(a){var u=this._hoveredTarget;this.fire("mouse:out",{target:u,e:a}),this._hoveredTarget=null,u&&u.fire("mouseout",{e:a});var s=this;this._hoveredTargets.forEach(function(f){s.fire("mouse:out",{target:u,e:a}),f&&u.fire("mouseout",{e:a})}),this._hoveredTargets=[]},_onMouseEnter:function(a){!this._currentTransform&&!this.findTarget(a)&&(this.fire("mouse:over",{target:null,e:a}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(a,u){this.__onOrientationChange&&this.__onOrientationChange(a,u)},_onShake:function(a,u){this.__onShake&&this.__onShake(a,u)},_onLongPress:function(a,u){this.__onLongPress&&this.__onLongPress(a,u)},_onDragOver:function(a){a.preventDefault();var u=this._simpleEventHandler("dragover",a);this._fireEnterLeaveEvents(u,a)},_onDrop:function(a){return this._simpleEventHandler("drop:before",a),this._simpleEventHandler("drop",a)},_onContextMenu:function(a){return this.stopContextMenu&&(a.stopPropagation(),a.preventDefault()),!1},_onDoubleClick:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"dblclick"),this._resetTransformEventData(a)},getPointerId:function(a){var u=a.changedTouches;return u?u[0]&&u[0].identifier:this.enablePointerEvents?a.pointerId:-1},_isMainEvent:function(a){return a.isPrimary===!0?!0:a.isPrimary===!1?!1:a.type==="touchend"&&a.touches.length===0?!0:a.changedTouches?a.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(a){a.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(a)),this.__onMouseDown(a),this._resetTransformEventData();var u=this.upperCanvasEl,s=this._getEventPrefix();h(t.document,"touchend",this._onTouchEnd,r),h(t.document,"touchmove",this._onMouseMove,r),e(u,s+"down",this._onMouseDown)},_onMouseDown:function(a){this.__onMouseDown(a),this._resetTransformEventData();var u=this.upperCanvasEl,s=this._getEventPrefix();e(u,s+"move",this._onMouseMove,r),h(t.document,s+"up",this._onMouseUp),h(t.document,s+"move",this._onMouseMove,r)},_onTouchEnd:function(a){if(!(a.touches.length>0)){this.__onMouseUp(a),this._resetTransformEventData(),this.mainTouchId=null;var u=this._getEventPrefix();e(t.document,"touchend",this._onTouchEnd,r),e(t.document,"touchmove",this._onMouseMove,r);var s=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){h(s.upperCanvasEl,u+"down",s._onMouseDown),s._willAddMouseDown=0},400)}},_onMouseUp:function(a){this.__onMouseUp(a),this._resetTransformEventData();var u=this.upperCanvasEl,s=this._getEventPrefix();this._isMainEvent(a)&&(e(t.document,s+"up",this._onMouseUp),e(t.document,s+"move",this._onMouseMove,r),h(u,s+"move",this._onMouseMove,r))},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault(),this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a){var u=this._activeObject;return!!u!=!!a||u&&a&&u!==a?!0:(u&&u.isEditing,!1)},__onMouseUp:function(a){var u,s=this._currentTransform,f=this._groupSelector,g=!1,m=!f||f.left===0&&f.top===0;if(this._cacheTransformEventData(a),u=this._target,this._handleEvent(a,"up:before"),i(a,o)){this.fireRightClick&&this._handleEvent(a,"up",o,m);return}if(i(a,l)){this.fireMiddleClick&&this._handleEvent(a,"up",l,m),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(a);return}if(this._isMainEvent(a)){if(s&&(this._finalizeCurrentTransform(a),g=s.actionPerformed),!m){var v=u===this._activeObject;this._maybeGroupObjects(a),g||(g=this._shouldRender(u)||!v&&u===this._activeObject)}var b,w;if(u){if(b=u._findTargetCorner(this.getPointer(a,!0),t.util.isTouchEvent(a)),u.selectable&&u!==this._activeObject&&u.activeOn==="up")this.setActiveObject(u,a),g=!0;else{var S=u.controls[b],A=S&&S.getMouseUpHandler(a,u,S);A&&(w=this.getPointer(a),A(a,s,w.x,w.y))}u.isMoving=!1}if(s&&(s.target!==u||s.corner!==b)){var D=s.target&&s.target.controls[s.corner],X=D&&D.getMouseUpHandler(a,u,S);w=w||this.getPointer(a),X&&X(a,s,w.x,w.y)}this._setCursorFromEvent(a,u),this._handleEvent(a,"up",n,m),this._groupSelector=null,this._currentTransform=null,u&&(u.__corner=0),g?this.requestRenderAll():m||this.renderTop()}},_simpleEventHandler:function(a,u){var s=this.findTarget(u),f=this.targets,g={e:u,target:s,subTargets:f};if(this.fire(a,g),s&&s.fire(a,g),!f)return s;for(var m=0;m<f.length;m++)f[m].fire(a,g);return s},_handleEvent:function(a,u,s,f){var g=this._target,m=this.targets||[],v={e:a,target:g,subTargets:m,button:s||n,isClick:f||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};u==="up"&&(v.currentTarget=this.findTarget(a),v.currentSubTargets=this.targets),this.fire("mouse:"+u,v),g&&g.fire("mouse"+u,v);for(var b=0;b<m.length;b++)m[b].fire("mouse"+u,v)},_finalizeCurrentTransform:function(a){var u=this._currentTransform,s=u.target,f={e:a,target:s,transform:u,action:u.action};s._scaling&&(s._scaling=!1),s.setCoords(),(u.actionPerformed||this.stateful&&s.hasStateChanged())&&this._fire("modified",f)},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(a).requestRenderAll();var u=this.getPointer(a);this.freeDrawingBrush.onMouseDown(u,{e:a,pointer:u}),this._handleEvent(a,"down")},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var u=this.getPointer(a);this.freeDrawingBrush.onMouseMove(u,{e:a,pointer:u})}this.setCursor(this.freeDrawingCursor),this._handleEvent(a,"move")},_onMouseUpInDrawingMode:function(a){var u=this.getPointer(a);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:a,pointer:u}),this._handleEvent(a,"up")},__onMouseDown:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"down:before");var u=this._target;if(i(a,o)){this.fireRightClick&&this._handleEvent(a,"down",o);return}if(i(a,l)){this.fireMiddleClick&&this._handleEvent(a,"down",l);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(a);return}if(this._isMainEvent(a)&&!this._currentTransform){var s=this._pointer;this._previousPointer=s;var f=this._shouldRender(u),g=this._shouldGroup(a,u);if(this._shouldClearSelection(a,u)?this.discardActiveObject(a):g&&(this._handleGrouping(a,u),u=this._activeObject),this.selection&&(!u||!u.selectable&&!u.isEditing&&u!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),u){var m=u===this._activeObject;u.selectable&&u.activeOn==="down"&&this.setActiveObject(u,a);var v=u._findTargetCorner(this.getPointer(a,!0),t.util.isTouchEvent(a));if(u.__corner=v,u===this._activeObject&&(v||!g)){this._setupCurrentTransform(a,u,m);var b=u.controls[v],s=this.getPointer(a),w=b&&b.getMouseDownHandler(a,u,b);w&&w(a,this._currentTransform,s.x,s.y)}}this._handleEvent(a,"down"),(f||g)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(a){this._resetTransformEventData(),this._pointer=this.getPointer(a,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(a)||null},_beforeTransform:function(a){var u=this._currentTransform;this.stateful&&u.target.saveState(),this.fire("before:transform",{e:a,transform:u})},__onMouseMove:function(a){this._handleEvent(a,"move:before"),this._cacheTransformEventData(a);var u,s;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(a);return}if(this._isMainEvent(a)){var f=this._groupSelector;f?(s=this._absolutePointer,f.left=s.x-f.ex,f.top=s.y-f.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(u=this.findTarget(a)||null,this._setCursorFromEvent(a,u),this._fireOverOutEvents(u,a)),this._handleEvent(a,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(a,u){var s=this._hoveredTarget,f=this._hoveredTargets,g=this.targets,m=Math.max(f.length,g.length);this.fireSyntheticInOutEvents(a,u,{oldTarget:s,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var v=0;v<m;v++)this.fireSyntheticInOutEvents(g[v],u,{oldTarget:f[v],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=a,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(a,u){var s=this._draggedoverTarget,f=this._hoveredTargets,g=this.targets,m=Math.max(f.length,g.length);this.fireSyntheticInOutEvents(a,u,{oldTarget:s,evtOut:"dragleave",evtIn:"dragenter"});for(var v=0;v<m;v++)this.fireSyntheticInOutEvents(g[v],u,{oldTarget:f[v],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=a},fireSyntheticInOutEvents:function(a,u,s){var f,g,m=s.oldTarget,v,b,w=m!==a,S=s.canvasEvtIn,A=s.canvasEvtOut;w&&(f={e:u,target:a,previousTarget:m},g={e:u,target:m,nextTarget:a}),b=a&&w,v=m&&w,v&&(A&&this.fire(A,g),m.fire(s.evtOut,g)),b&&(S&&this.fire(S,f),a.fire(s.evtIn,f))},__onMouseWheel:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"wheel"),this._resetTransformEventData()},_transformObject:function(a){var u=this.getPointer(a),s=this._currentTransform;s.reset=!1,s.shiftKey=a.shiftKey,s.altKey=a[this.centeredKey],this._performTransformAction(a,s,u),s.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(a,u,s){var f=s.x,g=s.y,m=u.action,v=!1,b=u.actionHandler;b&&(v=b(a,u,f,g)),m==="drag"&&v&&(u.target.isMoving=!0,this.setCursor(u.target.moveCursor||this.moveCursor)),u.actionPerformed=u.actionPerformed||v},_fire:t.controlsUtils.fireEvent,_setCursorFromEvent:function(a,u){if(!u)return this.setCursor(this.defaultCursor),!1;var s=u.hoverCursor||this.hoverCursor,f=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,g=(!f||!f.contains(u))&&u._findTargetCorner(this.getPointer(a,!0));g?this.setCursor(this.getCornerCursor(g,u,a)):(u.subTargetCheck&&this.targets.concat().reverse().map(function(m){s=m.hoverCursor||s}),this.setCursor(s))},getCornerCursor:function(a,u,s){var f=u.controls[a];return f.cursorStyleHandler(s,f,u)}})}(),function(){var h=Math.min,e=Math.max;t.util.object.extend(t.Canvas.prototype,{_shouldGroup:function(o,l){var n=this._activeObject;return n&&this._isSelectionKeyPressed(o)&&l&&l.selectable&&this.selection&&(n!==l||n.type==="activeSelection")&&!l.onSelect({e:o})},_handleGrouping:function(o,l){var n=this._activeObject;n.__corner||l===n&&(l=this.findTarget(o,!0),!l||!l.selectable)||(n&&n.type==="activeSelection"?this._updateActiveSelection(l,o):this._createActiveSelection(l,o))},_updateActiveSelection:function(o,l){var n=this._activeObject,r=n._objects.slice(0);n.contains(o)?(n.removeWithUpdate(o),this._hoveredTarget=o,this._hoveredTargets=this.targets.concat(),n.size()===1&&this._setActiveObject(n.item(0),l)):(n.addWithUpdate(o),this._hoveredTarget=n,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(r,l)},_createActiveSelection:function(o,l){var n=this.getActiveObjects(),r=this._createGroup(o);this._hoveredTarget=r,this._setActiveObject(r,l),this._fireSelectionEvents(n,l)},_createGroup:function(o){var l=this._objects,n=l.indexOf(this._activeObject)<l.indexOf(o),r=n?[this._activeObject,o]:[o,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new t.ActiveSelection(r,{canvas:this})},_groupSelectedObjects:function(o){var l=this._collectObjects(o),n;l.length===1?this.setActiveObject(l[0],o):l.length>1&&(n=new t.ActiveSelection(l.reverse(),{canvas:this}),this.setActiveObject(n,o))},_collectObjects:function(o){for(var l=[],n,r=this._groupSelector.ex,i=this._groupSelector.ey,a=r+this._groupSelector.left,u=i+this._groupSelector.top,s=new t.Point(h(r,a),h(i,u)),f=new t.Point(e(r,a),e(i,u)),g=!this.selectionFullyContained,m=r===a&&i===u,v=this._objects.length;v--&&(n=this._objects[v],!(!(!n||!n.selectable||!n.visible)&&(g&&n.intersectsWithRect(s,f,!0)||n.isContainedWithinRect(s,f,!0)||g&&n.containsPoint(s,null,!0)||g&&n.containsPoint(f,null,!0))&&(l.push(n),m))););return l.length>1&&(l=l.filter(function(b){return!b.onSelect({e:o})})),l},_maybeGroupObjects:function(o){this.selection&&this._groupSelector&&this._groupSelectedObjects(o),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){t.util.object.extend(t.StaticCanvas.prototype,{toDataURL:function(h){h||(h={});var e=h.format||"png",o=h.quality||1,l=(h.multiplier||1)*(h.enableRetinaScaling?this.getRetinaScaling():1),n=this.toCanvasElement(l,h);return t.util.toDataURL(n,e,o)},toCanvasElement:function(h,e){h=h||1,e=e||{};var o=(e.width||this.width)*h,l=(e.height||this.height)*h,n=this.getZoom(),r=this.width,i=this.height,a=n*h,u=this.viewportTransform,s=(u[4]-(e.left||0))*h,f=(u[5]-(e.top||0))*h,g=this.interactive,m=[a,0,0,a,s,f],v=this.enableRetinaScaling,b=t.util.createCanvasElement(),w=this.contextTop;return b.width=o,b.height=l,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=m,this.width=o,this.height=l,this.calcViewportBoundaries(),this.renderCanvas(b.getContext("2d"),this._objects),this.viewportTransform=u,this.width=r,this.height=i,this.calcViewportBoundaries(),this.interactive=g,this.enableRetinaScaling=v,this.contextTop=w,b}})}(),t.util.object.extend(t.StaticCanvas.prototype,{loadFromJSON:function(h,e,o){if(h){var l=typeof h=="string"?JSON.parse(h):t.util.object.clone(h),n=this,r=l.clipPath,i=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete l.clipPath,this._enlivenObjects(l.objects,function(a){n.clear(),n._setBgOverlay(l,function(){r?n._enlivenObjects([r],function(u){n.clipPath=u[0],n.__setupCanvas.call(n,l,a,i,e)}):n.__setupCanvas.call(n,l,a,i,e)})},o),this}},__setupCanvas:function(h,e,o,l){var n=this;e.forEach(function(r,i){n.insertAt(r,i)}),this.renderOnAddRemove=o,delete h.objects,delete h.backgroundImage,delete h.overlayImage,delete h.background,delete h.overlay,this._setOptions(h),this.renderAll(),l&&l()},_setBgOverlay:function(h,e){var o={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!h.backgroundImage&&!h.overlayImage&&!h.background&&!h.overlay){e&&e();return}var l=function(){o.backgroundImage&&o.overlayImage&&o.backgroundColor&&o.overlayColor&&e&&e()};this.__setBgOverlay("backgroundImage",h.backgroundImage,o,l),this.__setBgOverlay("overlayImage",h.overlayImage,o,l),this.__setBgOverlay("backgroundColor",h.background,o,l),this.__setBgOverlay("overlayColor",h.overlay,o,l)},__setBgOverlay:function(h,e,o,l){var n=this;if(!e){o[h]=!0,l&&l();return}h==="backgroundImage"||h==="overlayImage"?t.util.enlivenObjects([e],function(r){n[h]=r[0],o[h]=!0,l&&l()}):this["set"+t.util.string.capitalize(h,!0)](e,function(){o[h]=!0,l&&l()})},_enlivenObjects:function(h,e,o){if(!h||h.length===0){e&&e([]);return}t.util.enlivenObjects(h,function(l){e&&e(l)},null,o)},_toDataURL:function(h,e){this.clone(function(o){e(o.toDataURL(h))})},_toDataURLWithMultiplier:function(h,e,o){this.clone(function(l){o(l.toDataURLWithMultiplier(h,e))})},clone:function(h,e){var o=JSON.stringify(this.toJSON(e));this.cloneWithoutData(function(l){l.loadFromJSON(o,function(){h&&h(l)})})},cloneWithoutData:function(h){var e=t.util.createCanvasElement();e.width=this.width,e.height=this.height;var o=new t.Canvas(e);this.backgroundImage?(o.setBackgroundImage(this.backgroundImage.src,function(){o.renderAll(),h&&h(o)}),o.backgroundImageOpacity=this.backgroundImageOpacity,o.backgroundImageStretch=this.backgroundImageStretch):h&&h(o)}}),function(h){var e=h.fabric||(h.fabric={}),o=e.util.object.extend,l=e.util.object.clone,n=e.util.toFixed,r=e.util.string.capitalize,i=e.util.degreesToRadians,a=!e.isLikelyNode,u=2;e.Object||(e.Object=e.util.createClass(e.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:a,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(s){s&&this.setOptions(s)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=e.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(s){var f=e.perfLimitSizeTotal,g=s.width,m=s.height,v=e.maxCacheSideLimit,b=e.minCacheSideLimit;if(g<=v&&m<=v&&g*m<=f)return g<b&&(s.width=b),m<b&&(s.height=b),s;var w=g/m,S=e.util.limitDimsByArea(w,f),A=e.util.capValue,D=A(b,S.x,v),X=A(b,S.y,v);return g>D&&(s.zoomX/=g/D,s.width=D,s.capped=!0),m>X&&(s.zoomY/=m/X,s.height=X,s.capped=!0),s},_getCacheCanvasDimensions:function(){var s=this.getTotalObjectScaling(),f=this._getTransformedDimensions(0,0),g=f.x*s.scaleX/this.scaleX,m=f.y*s.scaleY/this.scaleY;return{width:g+u,height:m+u,zoomX:s.scaleX,zoomY:s.scaleY,x:g,y:m}},_updateCacheCanvas:function(){var s=this.canvas;if(this.noScaleCache&&s&&s._currentTransform){var f=s._currentTransform.target,g=s._currentTransform.action;if(this===f&&g.slice&&g.slice(0,5)==="scale")return!1}var m=this._cacheCanvas,v=this._limitCacheSize(this._getCacheCanvasDimensions()),b=e.minCacheSideLimit,w=v.width,S=v.height,A,D,X=v.zoomX,K=v.zoomY,$=w!==this.cacheWidth||S!==this.cacheHeight,H=this.zoomX!==X||this.zoomY!==K,J=$||H,Z=0,Q=0,rt=!1;if($){var st=this._cacheCanvas.width,T=this._cacheCanvas.height,k=w>st||S>T,P=(w<st*.9||S<T*.9)&&st>b&&T>b;rt=k||P,k&&!v.capped&&(w>b||S>b)&&(Z=w*.1,Q=S*.1)}return this instanceof e.Text&&this.path&&(J=!0,rt=!0,Z+=this.getHeightOfLine(0)*this.zoomX,Q+=this.getHeightOfLine(0)*this.zoomY),J?(rt?(m.width=Math.ceil(w+Z),m.height=Math.ceil(S+Q)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,m.width,m.height)),A=v.x/2,D=v.y/2,this.cacheTranslationX=Math.round(m.width/2-A)+A,this.cacheTranslationY=Math.round(m.height/2-D)+D,this.cacheWidth=w,this.cacheHeight=S,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(X,K),this.zoomX=X,this.zoomY=K,!0):!1},setOptions:function(s){this._setOptions(s),this._initGradient(s.fill,"fill"),this._initGradient(s.stroke,"stroke"),this._initPattern(s.fill,"fill"),this._initPattern(s.stroke,"stroke")},transform:function(s){var f=this.group&&!this.group._transformDone||this.group&&this.canvas&&s===this.canvas.contextTop,g=this.calcTransformMatrix(!f);s.transform(g[0],g[1],g[2],g[3],g[4],g[5])},toObject:function(s){var f=e.Object.NUM_FRACTION_DIGITS,g={type:this.type,version:e.version,originX:this.originX,originY:this.originY,left:n(this.left,f),top:n(this.top,f),width:n(this.width,f),height:n(this.height,f),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:n(this.strokeWidth,f),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:n(this.strokeMiterLimit,f),scaleX:n(this.scaleX,f),scaleY:n(this.scaleY,f),angle:n(this.angle,f),flipX:this.flipX,flipY:this.flipY,opacity:n(this.opacity,f),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:n(this.skewX,f),skewY:n(this.skewY,f)};return this.clipPath&&!this.clipPath.excludeFromExport&&(g.clipPath=this.clipPath.toObject(s),g.clipPath.inverted=this.clipPath.inverted,g.clipPath.absolutePositioned=this.clipPath.absolutePositioned),e.util.populateWithProperties(this,g,s),this.includeDefaultValues||(g=this._removeDefaultValues(g)),g},toDatalessObject:function(s){return this.toObject(s)},_removeDefaultValues:function(s){var f=e.util.getKlass(s.type).prototype,g=f.stateProperties;return g.forEach(function(m){m==="left"||m==="top"||(s[m]===f[m]&&delete s[m],Array.isArray(s[m])&&Array.isArray(f[m])&&s[m].length===0&&f[m].length===0&&delete s[m])}),s},toString:function(){return"#<fabric."+r(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var s=e.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(s.scaleX),scaleY:Math.abs(s.scaleY)}},getTotalObjectScaling:function(){var s=this.getObjectScaling(),f=s.scaleX,g=s.scaleY;if(this.canvas){var m=this.canvas.getZoom(),v=this.canvas.getRetinaScaling();f*=m*v,g*=m*v}return{scaleX:f,scaleY:g}},getObjectOpacity:function(){var s=this.opacity;return this.group&&(s*=this.group.getObjectOpacity()),s},_set:function(s,f){var g=s==="scaleX"||s==="scaleY",m=this[s]!==f,v=!1;return g&&(f=this._constrainScale(f)),s==="scaleX"&&f<0?(this.flipX=!this.flipX,f*=-1):s==="scaleY"&&f<0?(this.flipY=!this.flipY,f*=-1):s==="shadow"&&f&&!(f instanceof e.Shadow)?f=new e.Shadow(f):s==="dirty"&&this.group&&this.group.set("dirty",f),this[s]=f,m&&(v=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(s)>-1?(this.dirty=!0,v&&this.group.set("dirty",!0)):v&&this.stateProperties.indexOf(s)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:e.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(s){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(s.save(),this._setupCompositeOperation(s),this.drawSelectionBackground(s),this.transform(s),this._setOpacity(s),this._setShadow(s,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(s)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(s),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),s.restore())},renderCache:function(s){s=s||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,s.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(s,f){if(s.save(),f.inverted?s.globalCompositeOperation="destination-out":s.globalCompositeOperation="destination-in",f.absolutePositioned){var g=e.util.invertTransform(this.calcTransformMatrix());s.transform(g[0],g[1],g[2],g[3],g[4],g[5])}f.transform(s),s.scale(1/f.zoomX,1/f.zoomY),s.drawImage(f._cacheCanvas,-f.cacheTranslationX,-f.cacheTranslationY),s.restore()},drawObject:function(s,f){var g=this.fill,m=this.stroke;f?(this.fill="black",this.stroke="",this._setClippingProperties(s)):this._renderBackground(s),this._render(s),this._drawClipPath(s,this.clipPath),this.fill=g,this.stroke=m},_drawClipPath:function(s,f){f&&(f.canvas=this.canvas,f.shouldCache(),f._transformDone=!0,f.renderCache({forClipping:!0}),this.drawClipPathOnCache(s,f))},drawCacheOnCanvas:function(s){s.scale(1/this.zoomX,1/this.zoomY),s.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(s){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!s&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!s){var f=this.cacheWidth/this.zoomX,g=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-f/2,-g/2,f,g)}return!0}return!1},_renderBackground:function(s){if(this.backgroundColor){var f=this._getNonTransformedDimensions();s.fillStyle=this.backgroundColor,s.fillRect(-f.x/2,-f.y/2,f.x,f.y),this._removeShadow(s)}},_setOpacity:function(s){this.group&&!this.group._transformDone?s.globalAlpha=this.getObjectOpacity():s.globalAlpha*=this.opacity},_setStrokeStyles:function(s,f){var g=f.stroke;g&&(s.lineWidth=f.strokeWidth,s.lineCap=f.strokeLineCap,s.lineDashOffset=f.strokeDashOffset,s.lineJoin=f.strokeLineJoin,s.miterLimit=f.strokeMiterLimit,g.toLive?g.gradientUnits==="percentage"||g.gradientTransform||g.patternTransform?this._applyPatternForTransformedGradient(s,g):(s.strokeStyle=g.toLive(s,this),this._applyPatternGradientTransform(s,g)):s.strokeStyle=f.stroke)},_setFillStyles:function(s,f){var g=f.fill;g&&(g.toLive?(s.fillStyle=g.toLive(s,this),this._applyPatternGradientTransform(s,f.fill)):s.fillStyle=g)},_setClippingProperties:function(s){s.globalAlpha=1,s.strokeStyle="transparent",s.fillStyle="#000000"},_setLineDash:function(s,f){!f||f.length===0||(1&f.length&&f.push.apply(f,f),s.setLineDash(f))},_renderControls:function(s,f){var g=this.getViewportTransform(),m=this.calcTransformMatrix(),v,b,w;f=f||{},b=typeof f.hasBorders<"u"?f.hasBorders:this.hasBorders,w=typeof f.hasControls<"u"?f.hasControls:this.hasControls,m=e.util.multiplyTransformMatrices(g,m),v=e.util.qrDecompose(m),s.save(),s.translate(v.translateX,v.translateY),s.lineWidth=1*this.borderScaleFactor,this.group||(s.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(v.angle-=180),s.rotate(i(this.group?v.angle:this.angle)),f.forActiveSelection||this.group?b&&this.drawBordersInGroup(s,v,f):b&&this.drawBorders(s,f),w&&this.drawControls(s,f),s.restore()},_setShadow:function(s){if(this.shadow){var f=this.shadow,g=this.canvas,m,v=g&&g.viewportTransform[0]||1,b=g&&g.viewportTransform[3]||1;f.nonScaling?m={scaleX:1,scaleY:1}:m=this.getObjectScaling(),g&&g._isRetinaScaling()&&(v*=e.devicePixelRatio,b*=e.devicePixelRatio),s.shadowColor=f.color,s.shadowBlur=f.blur*e.browserShadowBlurConstant*(v+b)*(m.scaleX+m.scaleY)/4,s.shadowOffsetX=f.offsetX*v*m.scaleX,s.shadowOffsetY=f.offsetY*b*m.scaleY}},_removeShadow:function(s){this.shadow&&(s.shadowColor="",s.shadowBlur=s.shadowOffsetX=s.shadowOffsetY=0)},_applyPatternGradientTransform:function(s,f){if(!f||!f.toLive)return{offsetX:0,offsetY:0};var g=f.gradientTransform||f.patternTransform,m=-this.width/2+f.offsetX||0,v=-this.height/2+f.offsetY||0;return f.gradientUnits==="percentage"?s.transform(this.width,0,0,this.height,m,v):s.transform(1,0,0,1,m,v),g&&s.transform(g[0],g[1],g[2],g[3],g[4],g[5]),{offsetX:m,offsetY:v}},_renderPaintInOrder:function(s){this.paintFirst==="stroke"?(this._renderStroke(s),this._renderFill(s)):(this._renderFill(s),this._renderStroke(s))},_render:function(){},_renderFill:function(s){this.fill&&(s.save(),this._setFillStyles(s,this),this.fillRule==="evenodd"?s.fill("evenodd"):s.fill(),s.restore())},_renderStroke:function(s){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(s),s.save(),this.strokeUniform&&this.group){var f=this.getObjectScaling();s.scale(1/f.scaleX,1/f.scaleY)}else this.strokeUniform&&s.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(s,this.strokeDashArray),this._setStrokeStyles(s,this),s.stroke(),s.restore()}},_applyPatternForTransformedGradient:function(s,f){var g=this._limitCacheSize(this._getCacheCanvasDimensions()),m=e.util.createCanvasElement(),v,b=this.canvas.getRetinaScaling(),w=g.x/this.scaleX/b,S=g.y/this.scaleY/b;m.width=w,m.height=S,v=m.getContext("2d"),v.beginPath(),v.moveTo(0,0),v.lineTo(w,0),v.lineTo(w,S),v.lineTo(0,S),v.closePath(),v.translate(w/2,S/2),v.scale(g.zoomX/this.scaleX/b,g.zoomY/this.scaleY/b),this._applyPatternGradientTransform(v,f),v.fillStyle=f.toLive(s),v.fill(),s.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),s.scale(b*this.scaleX/g.zoomX,b*this.scaleY/g.zoomY),s.strokeStyle=v.createPattern(m,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var s=e.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",s.scaleX),this.set("scaleY",s.scaleY),this.angle=s.angle,this.skewX=s.skewX,this.skewY=0}},_removeTransformMatrix:function(s){var f=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),f=e.util.transformPoint(f,this.transformMatrix)),this.transformMatrix=null,s&&(this.scaleX*=s.scaleX,this.scaleY*=s.scaleY,this.cropX=s.cropX,this.cropY=s.cropY,f.x+=s.offsetLeft,f.y+=s.offsetTop,this.width=s.width,this.height=s.height),this.setPositionByOrigin(f,"center","center")},clone:function(s,f){var g=this.toObject(f);this.constructor.fromObject?this.constructor.fromObject(g,s):e.Object._fromObject("Object",g,s)},cloneAsImage:function(s,f){var g=this.toCanvasElement(f);return s&&s(new e.Image(g)),this},toCanvasElement:function(s){s||(s={});var f=e.util,g=f.saveObjectTransform(this),m=this.group,v=this.shadow,b=Math.abs,w=(s.multiplier||1)*(s.enableRetinaScaling?e.devicePixelRatio:1);delete this.group,s.withoutTransform&&f.resetObjectTransform(this),s.withoutShadow&&(this.shadow=null);var S=e.util.createCanvasElement(),A=this.getBoundingRect(!0,!0),D=this.shadow,X,K={x:0,y:0},$,H,J;D&&($=D.blur,D.nonScaling?X={scaleX:1,scaleY:1}:X=this.getObjectScaling(),K.x=2*Math.round(b(D.offsetX)+$)*b(X.scaleX),K.y=2*Math.round(b(D.offsetY)+$)*b(X.scaleY)),H=A.width+K.x,J=A.height+K.y,S.width=Math.ceil(H),S.height=Math.ceil(J);var Z=new e.StaticCanvas(S,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});s.format==="jpeg"&&(Z.backgroundColor="#fff"),this.setPositionByOrigin(new e.Point(Z.width/2,Z.height/2),"center","center");var Q=this.canvas;Z.add(this);var rt=Z.toCanvasElement(w||1,s);return this.shadow=v,this.set("canvas",Q),m&&(this.group=m),this.set(g).setCoords(),Z._objects=[],Z.dispose(),Z=null,rt},toDataURL:function(s){return s||(s={}),e.util.toDataURL(this.toCanvasElement(s),s.format||"png",s.quality||1)},isType:function(s){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===s},complexity:function(){return 1},toJSON:function(s){return this.toObject(s)},rotate:function(s){var f=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return f&&this._setOriginToCenter(),this.set("angle",s),f&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(s,f){f=f||this.canvas.getPointer(s);var g=new e.Point(f.x,f.y),m=this._getLeftTopCoords();return this.angle&&(g=e.util.rotatePoint(g,m,i(-this.angle))),{x:g.x-m.x,y:g.y-m.y}},_setupCompositeOperation:function(s){this.globalCompositeOperation&&(s.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){e.runningAnimations&&e.runningAnimations.cancelByTarget(this)}}),e.util.createAccessors&&e.util.createAccessors(e.Object),o(e.Object.prototype,e.Observable),e.Object.NUM_FRACTION_DIGITS=2,e.Object.ENLIVEN_PROPS=["clipPath"],e.Object._fromObject=function(s,f,g,m){var v=e[s];f=l(f,!0),e.util.enlivenPatterns([f.fill,f.stroke],function(b){typeof b[0]<"u"&&(f.fill=b[0]),typeof b[1]<"u"&&(f.stroke=b[1]),e.util.enlivenObjectEnlivables(f,f,function(){var w=m?new v(f[m],f):new v(f);g&&g(w)})})},e.Object.__uid=0)}(c),function(){var h=t.util.degreesToRadians,e={left:-.5,center:0,right:.5},o={top:-.5,center:0,bottom:.5};t.util.object.extend(t.Object.prototype,{translateToGivenOrigin:function(l,n,r,i,a){var u=l.x,s=l.y,f,g,m;return typeof n=="string"?n=e[n]:n-=.5,typeof i=="string"?i=e[i]:i-=.5,f=i-n,typeof r=="string"?r=o[r]:r-=.5,typeof a=="string"?a=o[a]:a-=.5,g=a-r,(f||g)&&(m=this._getTransformedDimensions(),u=l.x+f*m.x,s=l.y+g*m.y),new t.Point(u,s)},translateToCenterPoint:function(l,n,r){var i=this.translateToGivenOrigin(l,n,r,"center","center");return this.angle?t.util.rotatePoint(i,l,h(this.angle)):i},translateToOriginPoint:function(l,n,r){var i=this.translateToGivenOrigin(l,"center","center",n,r);return this.angle?t.util.rotatePoint(i,l,h(this.angle)):i},getCenterPoint:function(){var l=new t.Point(this.left,this.top);return this.translateToCenterPoint(l,this.originX,this.originY)},getPointByOrigin:function(l,n){var r=this.getCenterPoint();return this.translateToOriginPoint(r,l,n)},toLocalPoint:function(l,n,r){var i=this.getCenterPoint(),a,u;return typeof n<"u"&&typeof r<"u"?a=this.translateToGivenOrigin(i,"center","center",n,r):a=new t.Point(this.left,this.top),u=new t.Point(l.x,l.y),this.angle&&(u=t.util.rotatePoint(u,i,-h(this.angle))),u.subtractEquals(a)},setPositionByOrigin:function(l,n,r){var i=this.translateToCenterPoint(l,n,r),a=this.translateToOriginPoint(i,this.originX,this.originY);this.set("left",a.x),this.set("top",a.y)},adjustPosition:function(l){var n=h(this.angle),r=this.getScaledWidth(),i=t.util.cos(n)*r,a=t.util.sin(n)*r,u,s;typeof this.originX=="string"?u=e[this.originX]:u=this.originX-.5,typeof l=="string"?s=e[l]:s=l-.5,this.left+=i*(s-u),this.top+=a*(s-u),this.setCoords(),this.originX=l},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var l=this.getCenterPoint();this.originX="center",this.originY="center",this.left=l.x,this.top=l.y},_resetOrigin:function(){var l=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=l.x,this.top=l.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function h(r){return[new t.Point(r.tl.x,r.tl.y),new t.Point(r.tr.x,r.tr.y),new t.Point(r.br.x,r.br.y),new t.Point(r.bl.x,r.bl.y)]}var e=t.util,o=e.degreesToRadians,l=e.multiplyTransformMatrices,n=e.transformPoint;e.object.extend(t.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(r,i){return i?r?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),r?this.aCoords:this.lineCoords)},getCoords:function(r,i){return h(this._getCoords(r,i))},intersectsWithRect:function(r,i,a,u){var s=this.getCoords(a,u),f=t.Intersection.intersectPolygonRectangle(s,r,i);return f.status==="Intersection"},intersectsWithObject:function(r,i,a){var u=t.Intersection.intersectPolygonPolygon(this.getCoords(i,a),r.getCoords(i,a));return u.status==="Intersection"||r.isContainedWithinObject(this,i,a)||this.isContainedWithinObject(r,i,a)},isContainedWithinObject:function(r,i,a){for(var u=this.getCoords(i,a),s=i?r.aCoords:r.lineCoords,f=0,g=r._getImageLines(s);f<4;f++)if(!r.containsPoint(u[f],g))return!1;return!0},isContainedWithinRect:function(r,i,a,u){var s=this.getBoundingRect(a,u);return s.left>=r.x&&s.left+s.width<=i.x&&s.top>=r.y&&s.top+s.height<=i.y},containsPoint:function(r,f,a,u){var s=this._getCoords(a,u),f=f||this._getImageLines(s),g=this._findCrossPoints(r,f);return g!==0&&g%2===1},isOnScreen:function(r){if(!this.canvas)return!1;var i=this.canvas.vptCoords.tl,a=this.canvas.vptCoords.br,u=this.getCoords(!0,r);return u.some(function(s){return s.x<=a.x&&s.x>=i.x&&s.y<=a.y&&s.y>=i.y})||this.intersectsWithRect(i,a,!0,r)?!0:this._containsCenterOfCanvas(i,a,r)},_containsCenterOfCanvas:function(r,i,a){var u={x:(r.x+i.x)/2,y:(r.y+i.y)/2};return!!this.containsPoint(u,null,!0,a)},isPartiallyOnScreen:function(r){if(!this.canvas)return!1;var i=this.canvas.vptCoords.tl,a=this.canvas.vptCoords.br;if(this.intersectsWithRect(i,a,!0,r))return!0;var u=this.getCoords(!0,r).every(function(s){return(s.x>=a.x||s.x<=i.x)&&(s.y>=a.y||s.y<=i.y)});return u&&this._containsCenterOfCanvas(i,a,r)},_getImageLines:function(r){var i={topline:{o:r.tl,d:r.tr},rightline:{o:r.tr,d:r.br},bottomline:{o:r.br,d:r.bl},leftline:{o:r.bl,d:r.tl}};return i},_findCrossPoints:function(r,i){var a,u,s,f,g,m=0,v;for(var b in i)if(v=i[b],!(v.o.y<r.y&&v.d.y<r.y)&&!(v.o.y>=r.y&&v.d.y>=r.y)&&(v.o.x===v.d.x&&v.o.x>=r.x?g=v.o.x:(a=0,u=(v.d.y-v.o.y)/(v.d.x-v.o.x),s=r.y-a*r.x,f=v.o.y-u*v.o.x,g=-(s-f)/(a-u)),g>=r.x&&(m+=1),m===2))break;return m},getBoundingRect:function(r,i){var a=this.getCoords(r,i);return e.makeBoundingBoxFromPoints(a)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(r){return Math.abs(r)<this.minScaleLimit?r<0?-this.minScaleLimit:this.minScaleLimit:r===0?1e-4:r},scale:function(r){return this._set("scaleX",r),this._set("scaleY",r),this.setCoords()},scaleToWidth:function(r,i){var a=this.getBoundingRect(i).width/this.getScaledWidth();return this.scale(r/this.width/a)},scaleToHeight:function(r,i){var a=this.getBoundingRect(i).height/this.getScaledHeight();return this.scale(r/this.height/a)},calcLineCoords:function(){var r=this.getViewportTransform(),i=this.padding,a=o(this.angle),u=e.cos(a),s=e.sin(a),f=u*i,g=s*i,m=f+g,v=f-g,b=this.calcACoords(),w={tl:n(b.tl,r),tr:n(b.tr,r),bl:n(b.bl,r),br:n(b.br,r)};return i&&(w.tl.x-=v,w.tl.y-=m,w.tr.x+=m,w.tr.y-=v,w.bl.x-=m,w.bl.y+=v,w.br.x+=v,w.br.y+=m),w},calcOCoords:function(){var r=this._calcRotateMatrix(),i=this._calcTranslateMatrix(),a=this.getViewportTransform(),u=l(a,i),s=l(u,r),s=l(s,[1/a[0],0,0,1/a[3],0,0]),f=this._calculateCurrentDimensions(),g={};return this.forEachControl(function(m,v,b){g[v]=m.positionHandler(f,s,b)}),g},calcACoords:function(){var r=this._calcRotateMatrix(),i=this._calcTranslateMatrix(),a=l(i,r),u=this._getTransformedDimensions(),s=u.x/2,f=u.y/2;return{tl:n({x:-s,y:-f},a),tr:n({x:s,y:-f},a),bl:n({x:-s,y:f},a),br:n({x:s,y:f},a)}},setCoords:function(r){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),r?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return e.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var r=this.getCenterPoint();return[1,0,0,1,r.x,r.y]},transformMatrixKey:function(r){var i="_",a="";return!r&&this.group&&(a=this.group.transformMatrixKey(r)+i),a+this.top+i+this.left+i+this.scaleX+i+this.scaleY+i+this.skewX+i+this.skewY+i+this.angle+i+this.originX+i+this.originY+i+this.width+i+this.height+i+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(r){var i=this.calcOwnMatrix();if(r||!this.group)return i;var a=this.transformMatrixKey(r),u=this.matrixCache||(this.matrixCache={});return u.key===a?u.value:(this.group&&(i=l(this.group.calcTransformMatrix(!1),i)),u.key=a,u.value=i,i)},calcOwnMatrix:function(){var r=this.transformMatrixKey(!0),i=this.ownMatrixCache||(this.ownMatrixCache={});if(i.key===r)return i.value;var a=this._calcTranslateMatrix(),u={angle:this.angle,translateX:a[4],translateY:a[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return i.key=r,i.value=e.composeMatrix(u),i.value},_getNonTransformedDimensions:function(){var r=this.strokeWidth,i=this.width+r,a=this.height+r;return{x:i,y:a}},_getTransformedDimensions:function(r,i){typeof r>"u"&&(r=this.skewX),typeof i>"u"&&(i=this.skewY);var a,u,s,f=r===0&&i===0;if(this.strokeUniform?(u=this.width,s=this.height):(a=this._getNonTransformedDimensions(),u=a.x,s=a.y),f)return this._finalizeDimensions(u*this.scaleX,s*this.scaleY);var g=e.sizeAfterTransform(u,s,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:r,skewY:i});return this._finalizeDimensions(g.x,g.y)},_finalizeDimensions:function(r,i){return this.strokeUniform?{x:r+this.strokeWidth,y:i+this.strokeWidth}:{x:r,y:i}},_calculateCurrentDimensions:function(){var r=this.getViewportTransform(),i=this._getTransformedDimensions(),a=n(i,r,!0);return a.scalarAdd(2*this.padding)}})}(),t.util.object.extend(t.Object.prototype,{sendToBack:function(){return this.group?t.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?t.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(h){return this.group?t.StaticCanvas.prototype.sendBackwards.call(this.group,this,h):this.canvas&&this.canvas.sendBackwards(this,h),this},bringForward:function(h){return this.group?t.StaticCanvas.prototype.bringForward.call(this.group,this,h):this.canvas&&this.canvas.bringForward(this,h),this},moveTo:function(h){return this.group&&this.group.type!=="activeSelection"?t.StaticCanvas.prototype.moveTo.call(this.group,this,h):this.canvas&&this.canvas.moveTo(this,h),this}}),function(){function h(o,l){if(l){if(l.toLive)return o+": url(#SVGID_"+l.id+"); ";var n=new t.Color(l),r=o+": "+n.toRgb()+"; ",i=n.getAlpha();return i!==1&&(r+=o+"-opacity: "+i.toString()+"; "),r}else return o+": none; "}var e=t.util.toFixed;t.util.object.extend(t.Object.prototype,{getSvgStyles:function(o){var l=this.fillRule?this.fillRule:"nonzero",n=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):"none",i=this.strokeDashOffset?this.strokeDashOffset:"0",a=this.strokeLineCap?this.strokeLineCap:"butt",u=this.strokeLineJoin?this.strokeLineJoin:"miter",s=this.strokeMiterLimit?this.strokeMiterLimit:"4",f=typeof this.opacity<"u"?this.opacity:"1",g=this.visible?"":" visibility: hidden;",m=o?"":this.getSvgFilter(),v=h("fill",this.fill),b=h("stroke",this.stroke);return[b,"stroke-width: ",n,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",a,"; ","stroke-dashoffset: ",i,"; ","stroke-linejoin: ",u,"; ","stroke-miterlimit: ",s,"; ",v,"fill-rule: ",l,"; ","opacity: ",f,";",m,g].join("")},getSvgSpanStyles:function(o,l){var n="; ",i=o.fontFamily?"font-family: "+(o.fontFamily.indexOf("'")===-1&&o.fontFamily.indexOf('"')===-1?"'"+o.fontFamily+"'":o.fontFamily)+n:"",r=o.strokeWidth?"stroke-width: "+o.strokeWidth+n:"",i=i,a=o.fontSize?"font-size: "+o.fontSize+"px"+n:"",u=o.fontStyle?"font-style: "+o.fontStyle+n:"",s=o.fontWeight?"font-weight: "+o.fontWeight+n:"",f=o.fill?h("fill",o.fill):"",g=o.stroke?h("stroke",o.stroke):"",m=this.getSvgTextDecoration(o),v=o.deltaY?"baseline-shift: "+-o.deltaY+"; ":"";return m&&(m="text-decoration: "+m+n),[g,r,i,a,u,s,m,f,v,l?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(o){return["overline","underline","line-through"].filter(function(l){return o[l.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(o,l){var n=o?this.calcTransformMatrix():this.calcOwnMatrix(),r='transform="'+t.util.matrixToSVG(n);return r+(l||"")+'" '},_setSVGBg:function(o){if(this.backgroundColor){var l=t.Object.NUM_FRACTION_DIGITS;o.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',e(-this.width/2,l),'" y="',e(-this.height/2,l),'" width="',e(this.width,l),'" height="',e(this.height,l),`"></rect>
`)}},toSVG:function(o){return this._createBaseSVGMarkup(this._toSVG(o),{reviver:o})},toClipPathSVG:function(o){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(o),{reviver:o})},_createBaseClipPathSVGMarkup:function(o,l){l=l||{};var n=l.reviver,r=l.additionalTransform||"",i=[this.getSvgTransform(!0,r),this.getSvgCommons()].join(""),a=o.indexOf("COMMON_PARTS");return o[a]=i,n?n(o.join("")):o.join("")},_createBaseSVGMarkup:function(o,l){l=l||{};var n=l.noStyle,r=l.reviver,i=n?"":'style="'+this.getSvgStyles()+'" ',a=l.withShadow?'style="'+this.getSvgFilter()+'" ':"",u=this.clipPath,s=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",f=u&&u.absolutePositioned,g=this.stroke,m=this.fill,v=this.shadow,b,w=[],S,A=o.indexOf("COMMON_PARTS"),D=l.additionalTransform;return u&&(u.clipPathId="CLIPPATH_"+t.Object.__uid++,S='<clipPath id="'+u.clipPathId+`" >
`+u.toClipPathSVG(r)+`</clipPath>
`),f&&w.push("<g ",a,this.getSvgCommons(),` >
`),w.push("<g ",this.getSvgTransform(!1),f?"":a+this.getSvgCommons(),` >
`),b=[i,s,n?"":this.addPaintOrder()," ",D?'transform="'+D+'" ':""].join(""),o[A]=b,m&&m.toLive&&w.push(m.toSVG(this)),g&&g.toLive&&w.push(g.toSVG(this)),v&&w.push(v.toSVG(this)),u&&w.push(S),w.push(o.join("")),w.push(`</g>
`),f&&w.push(`</g>
`),r?r(w.join("")):w.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var h=t.util.object.extend,e="stateProperties";function o(n,r,i){var a={},u=!0;i.forEach(function(s){a[s]=n[s]}),h(n[r],a,u)}function l(n,r,i){if(n===r)return!0;if(Array.isArray(n)){if(!Array.isArray(r)||n.length!==r.length)return!1;for(var a=0,u=n.length;a<u;a++)if(!l(n[a],r[a]))return!1;return!0}else if(n&&typeof n=="object"){var s=Object.keys(n),f;if(!r||typeof r!="object"||!i&&s.length!==Object.keys(r).length)return!1;for(var a=0,u=s.length;a<u;a++)if(f=s[a],!(f==="canvas"||f==="group")&&!l(n[f],r[f]))return!1;return!0}}t.util.object.extend(t.Object.prototype,{hasStateChanged:function(n){n=n||e;var r="_"+n;return Object.keys(this[r]).length<this[n].length?!0:!l(this[r],this,!0)},saveState:function(n){var r=n&&n.propertySet||e,i="_"+r;return this[i]?(o(this,i,this[r]),n&&n.stateProperties&&o(this,i,n.stateProperties),this):this.setupState(n)},setupState:function(n){n=n||{};var r=n.propertySet||e;return n.propertySet=r,this["_"+r]={},this.saveState(n),this}})}(),function(){var h=t.util.degreesToRadians;t.util.object.extend(t.Object.prototype,{_findTargetCorner:function(e,o){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var l=e.x,n=e.y,r,i,a=Object.keys(this.oCoords),u=a.length-1,s;for(this.__corner=0;u>=0;u--)if(s=a[u],!!this.isControlVisible(s)&&(i=this._getImageLines(o?this.oCoords[s].touchCorner:this.oCoords[s].corner),r=this._findCrossPoints({x:l,y:n},i),r!==0&&r%2===1))return this.__corner=s,s;return!1},forEachControl:function(e){for(var o in this.controls)e(this.controls[o],o,this)},_setCornerCoords:function(){var e=this.oCoords;for(var o in e){var l=this.controls[o];e[o].corner=l.calcCornerCoords(this.angle,this.cornerSize,e[o].x,e[o].y,!1),e[o].touchCorner=l.calcCornerCoords(this.angle,this.touchCornerSize,e[o].x,e[o].y,!0)}},drawSelectionBackground:function(e){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;e.save();var o=this.getCenterPoint(),l=this._calculateCurrentDimensions(),n=this.canvas.viewportTransform;return e.translate(o.x,o.y),e.scale(1/n[0],1/n[3]),e.rotate(h(this.angle)),e.fillStyle=this.selectionBackgroundColor,e.fillRect(-l.x/2,-l.y/2,l.x,l.y),e.restore(),this},drawBorders:function(e,o){o=o||{};var l=this._calculateCurrentDimensions(),n=this.borderScaleFactor,r=l.x+n,i=l.y+n,a=typeof o.hasControls<"u"?o.hasControls:this.hasControls,u=!1;return e.save(),e.strokeStyle=o.borderColor||this.borderColor,this._setLineDash(e,o.borderDashArray||this.borderDashArray),e.strokeRect(-r/2,-i/2,r,i),a&&(e.beginPath(),this.forEachControl(function(s,f,g){s.withConnection&&s.getVisibility(g,f)&&(u=!0,e.moveTo(s.x*r,s.y*i),e.lineTo(s.x*r+s.offsetX,s.y*i+s.offsetY))}),u&&e.stroke()),e.restore(),this},drawBordersInGroup:function(e,o,l){l=l||{};var n=t.util.sizeAfterTransform(this.width,this.height,o),r=this.strokeWidth,i=this.strokeUniform,a=this.borderScaleFactor,u=n.x+r*(i?this.canvas.getZoom():o.scaleX)+a,s=n.y+r*(i?this.canvas.getZoom():o.scaleY)+a;return e.save(),this._setLineDash(e,l.borderDashArray||this.borderDashArray),e.strokeStyle=l.borderColor||this.borderColor,e.strokeRect(-u/2,-s/2,u,s),e.restore(),this},drawControls:function(e,o){o=o||{},e.save();var l=this.canvas.getRetinaScaling(),n,r;return e.setTransform(l,0,0,l,0,0),e.strokeStyle=e.fillStyle=o.cornerColor||this.cornerColor,this.transparentCorners||(e.strokeStyle=o.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(e,o.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(n=this.group.calcTransformMatrix()),this.forEachControl(function(i,a,u){r=u.oCoords[a],i.getVisibility(u,a)&&(n&&(r=t.util.transformPoint(r,n)),i.render(e,r.x,r.y,o,u))}),e.restore(),this},isControlVisible:function(e){return this.controls[e]&&this.controls[e].getVisibility(this,e)},setControlVisible:function(e,o){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[e]=o,this},setControlsVisibility:function(e){e||(e={});for(var o in e)this.setControlVisible(o,e[o]);return this},onDeselect:function(){},onSelect:function(){}})}(),t.util.object.extend(t.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(h,e){e=e||{};var o=function(){},l=e.onComplete||o,n=e.onChange||o,r=this;return t.util.animate({target:this,startValue:h.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(i){h.set("left",i),r.requestRenderAll(),n()},onComplete:function(){h.setCoords(),l()}})},fxCenterObjectV:function(h,e){e=e||{};var o=function(){},l=e.onComplete||o,n=e.onChange||o,r=this;return t.util.animate({target:this,startValue:h.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(i){h.set("top",i),r.requestRenderAll(),n()},onComplete:function(){h.setCoords(),l()}})},fxRemove:function(h,e){e=e||{};var o=function(){},l=e.onComplete||o,n=e.onChange||o,r=this;return t.util.animate({target:this,startValue:h.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(i){h.set("opacity",i),r.requestRenderAll(),n()},onComplete:function(){r.remove(h),l()}})}}),t.util.object.extend(t.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var h=[],e,o,l=[];for(e in arguments[0])h.push(e);for(var n=0,r=h.length;n<r;n++)e=h[n],o=n!==r-1,l.push(this._animate(e,arguments[0][e],arguments[1],o));return l}else return this._animate.apply(this,arguments)},_animate:function(h,e,o,l){var n=this,r;e=e.toString(),o?o=t.util.object.clone(o):o={},~h.indexOf(".")&&(r=h.split("."));var i=n.colorProperties.indexOf(h)>-1||r&&n.colorProperties.indexOf(r[1])>-1,a=r?this.get(r[0])[r[1]]:this.get(h);"from"in o||(o.from=a),i||(~e.indexOf("=")?e=a+parseFloat(e.replace("=","")):e=parseFloat(e));var u={target:this,startValue:o.from,endValue:e,byValue:o.by,easing:o.easing,duration:o.duration,abort:o.abort&&function(s,f,g){return o.abort.call(n,s,f,g)},onChange:function(s,f,g){r?n[r[0]][r[1]]=s:n.set(h,s),!l&&o.onChange&&o.onChange(s,f,g)},onComplete:function(s,f,g){l||(n.setCoords(),o.onComplete&&o.onComplete(s,f,g))}};return i?t.util.animateColor(u.startValue,u.endValue,u.duration,u):t.util.animate(u)}}),function(h){var e=h.fabric||(h.fabric={}),o=e.util.object.extend,l=e.util.object.clone,n={x1:1,x2:1,y1:1,y2:1};if(e.Line){e.warn("fabric.Line is already defined");return}e.Line=e.util.createClass(e.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:e.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(i,a){i||(i=[0,0,0,0]),this.callSuper("initialize",a),this.set("x1",i[0]),this.set("y1",i[1]),this.set("x2",i[2]),this.set("y2",i[3]),this._setWidthHeight(a)},_setWidthHeight:function(i){i||(i={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in i?i.left:this._getLeftToOriginX(),this.top="top"in i?i.top:this._getTopToOriginY()},_set:function(i,a){return this.callSuper("_set",i,a),typeof n[i]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:r({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:r({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(i){i.beginPath();var a=this.calcLinePoints();i.moveTo(a.x1,a.y1),i.lineTo(a.x2,a.y2),i.lineWidth=this.strokeWidth;var u=i.strokeStyle;i.strokeStyle=this.stroke||i.fillStyle,this.stroke&&this._renderStroke(i),i.strokeStyle=u},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(i){return o(this.callSuper("toObject",i),this.calcLinePoints())},_getNonTransformedDimensions:function(){var i=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(i.y-=this.strokeWidth),this.height===0&&(i.x-=this.strokeWidth)),i},calcLinePoints:function(){var i=this.x1<=this.x2?-1:1,a=this.y1<=this.y2?-1:1,u=i*this.width*.5,s=a*this.height*.5,f=i*this.width*-.5,g=a*this.height*-.5;return{x1:u,x2:f,y1:s,y2:g}},_toSVG:function(){var i=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',i.x1,'" y1="',i.y1,'" x2="',i.x2,'" y2="',i.y2,`" />
`]}}),e.Line.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),e.Line.fromElement=function(i,a,u){u=u||{};var s=e.parseAttributes(i,e.Line.ATTRIBUTE_NAMES),f=[s.x1||0,s.y1||0,s.x2||0,s.y2||0];a(new e.Line(f,o(s,u)))},e.Line.fromObject=function(i,a){function u(f){delete f.points,a&&a(f)}var s=l(i,!0);s.points=[i.x1,i.y1,i.x2,i.y2],e.Object._fromObject("Line",s,u,"points")};function r(i,a){var u=i.origin,s=i.axis1,f=i.axis2,g=i.dimension,m=a.nearest,v=a.center,b=a.farthest;return function(){switch(this.get(u)){case m:return Math.min(this.get(s),this.get(f));case v:return Math.min(this.get(s),this.get(f))+.5*this.get(g);case b:return Math.max(this.get(s),this.get(f))}}}}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.util.degreesToRadians;if(e.Circle){e.warn("fabric.Circle is already defined.");return}e.Circle=e.util.createClass(e.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:e.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(n,r){return this.callSuper("_set",n,r),n==="radius"&&this.setRadius(r),this},toObject:function(n){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(n))},_toSVG:function(){var n,r=0,i=0,a=(this.endAngle-this.startAngle)%360;if(a===0)n=["<circle ","COMMON_PARTS",'cx="'+r+'" cy="'+i+'" ','r="',this.radius,`" />
`];else{var u=o(this.startAngle),s=o(this.endAngle),f=this.radius,g=e.util.cos(u)*f,m=e.util.sin(u)*f,v=e.util.cos(s)*f,b=e.util.sin(s)*f,w=a>180?"1":"0";n=['<path d="M '+g+" "+m," A "+f+" "+f," 0 ",+w+" 1"," "+v+" "+b,'" ',"COMMON_PARTS",` />
`]}return n},_render:function(n){n.beginPath(),n.arc(0,0,this.radius,o(this.startAngle),o(this.endAngle),!1),this._renderPaintInOrder(n)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(n){return this.radius=n,this.set("width",n*2).set("height",n*2)}}),e.Circle.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),e.Circle.fromElement=function(n,r){var i=e.parseAttributes(n,e.Circle.ATTRIBUTE_NAMES);if(!l(i))throw new Error("value of `r` attribute is required and can not be negative");i.left=(i.left||0)-i.radius,i.top=(i.top||0)-i.radius,r(new e.Circle(i))};function l(n){return"radius"in n&&n.radius>=0}e.Circle.fromObject=function(n,r){e.Object._fromObject("Circle",n,r)}}(c),function(h){var e=h.fabric||(h.fabric={});if(e.Triangle){e.warn("fabric.Triangle is already defined");return}e.Triangle=e.util.createClass(e.Object,{type:"triangle",width:100,height:100,_render:function(o){var l=this.width/2,n=this.height/2;o.beginPath(),o.moveTo(-l,n),o.lineTo(0,-n),o.lineTo(l,n),o.closePath(),this._renderPaintInOrder(o)},_toSVG:function(){var o=this.width/2,l=this.height/2,n=[-o+" "+l,"0 "+-l,o+" "+l].join(",");return["<polygon ","COMMON_PARTS",'points="',n,'" />']}}),e.Triangle.fromObject=function(o,l){return e.Object._fromObject("Triangle",o,l)}}(c),function(h){var e=h.fabric||(h.fabric={}),o=Math.PI*2;if(e.Ellipse){e.warn("fabric.Ellipse is already defined.");return}e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:e.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(l){this.callSuper("initialize",l),this.set("rx",l&&l.rx||0),this.set("ry",l&&l.ry||0)},_set:function(l,n){switch(this.callSuper("_set",l,n),l){case"rx":this.rx=n,this.set("width",n*2);break;case"ry":this.ry=n,this.set("height",n*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(l){return this.callSuper("toObject",["rx","ry"].concat(l))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(l){l.beginPath(),l.save(),l.transform(1,0,0,this.ry/this.rx,0,0),l.arc(0,0,this.rx,0,o,!1),l.restore(),this._renderPaintInOrder(l)}}),e.Ellipse.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),e.Ellipse.fromElement=function(l,n){var r=e.parseAttributes(l,e.Ellipse.ATTRIBUTE_NAMES);r.left=(r.left||0)-r.rx,r.top=(r.top||0)-r.ry,n(new e.Ellipse(r))},e.Ellipse.fromObject=function(l,n){e.Object._fromObject("Ellipse",l,n)}}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.util.object.extend;if(e.Rect){e.warn("fabric.Rect is already defined");return}e.Rect=e.util.createClass(e.Object,{stateProperties:e.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:e.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(l){this.callSuper("initialize",l),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(l){var n=this.rx?Math.min(this.rx,this.width/2):0,r=this.ry?Math.min(this.ry,this.height/2):0,i=this.width,a=this.height,u=-this.width/2,s=-this.height/2,f=n!==0||r!==0,g=1-.5522847498;l.beginPath(),l.moveTo(u+n,s),l.lineTo(u+i-n,s),f&&l.bezierCurveTo(u+i-g*n,s,u+i,s+g*r,u+i,s+r),l.lineTo(u+i,s+a-r),f&&l.bezierCurveTo(u+i,s+a-g*r,u+i-g*n,s+a,u+i-n,s+a),l.lineTo(u+n,s+a),f&&l.bezierCurveTo(u+g*n,s+a,u,s+a-g*r,u,s+a-r),l.lineTo(u,s+r),f&&l.bezierCurveTo(u,s+g*r,u+g*n,s,u+n,s),l.closePath(),this._renderPaintInOrder(l)},toObject:function(l){return this.callSuper("toObject",["rx","ry"].concat(l))},_toSVG:function(){var l=-this.width/2,n=-this.height/2;return["<rect ","COMMON_PARTS",'x="',l,'" y="',n,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),e.Rect.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),e.Rect.fromElement=function(l,n,r){if(!l)return n(null);r=r||{};var i=e.parseAttributes(l,e.Rect.ATTRIBUTE_NAMES);i.left=i.left||0,i.top=i.top||0,i.height=i.height||0,i.width=i.width||0;var a=new e.Rect(o(r?e.util.object.clone(r):{},i));a.visible=a.visible&&a.width>0&&a.height>0,n(a)},e.Rect.fromObject=function(l,n){return e.Object._fromObject("Rect",l,n)}}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.util.object.extend,l=e.util.array.min,n=e.util.array.max,r=e.util.toFixed,i=e.util.projectStrokeOnPoints;if(e.Polyline){e.warn("fabric.Polyline is already defined");return}e.Polyline=e.util.createClass(e.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:e.Object.prototype.cacheProperties.concat("points"),initialize:function(a,u){u=u||{},this.points=a||[],this.callSuper("initialize",u),this._setPositionDimensions(u)},_projectStrokeOnPoints:function(){return i(this.points,this,!0)},_setPositionDimensions:function(a){var u=this._calcDimensions(a),s,f=this.exactBoundingBox?this.strokeWidth:0;this.width=u.width-f,this.height=u.height-f,a.fromSVG||(s=this.translateToGivenOrigin({x:u.left-this.strokeWidth/2+f/2,y:u.top-this.strokeWidth/2+f/2},"left","top",this.originX,this.originY)),typeof a.left>"u"&&(this.left=a.fromSVG?u.left:s.x),typeof a.top>"u"&&(this.top=a.fromSVG?u.top:s.y),this.pathOffset={x:u.left+this.width/2+f/2,y:u.top+this.height/2+f/2}},_calcDimensions:function(){var a=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,u=l(a,"x")||0,s=l(a,"y")||0,f=n(a,"x")||0,g=n(a,"y")||0,m=f-u,v=g-s;return{left:u,top:s,width:m,height:v}},toObject:function(a){return o(this.callSuper("toObject",a),{points:this.points.concat()})},_toSVG:function(){for(var a=[],u=this.pathOffset.x,s=this.pathOffset.y,f=e.Object.NUM_FRACTION_DIGITS,g=0,m=this.points.length;g<m;g++)a.push(r(this.points[g].x-u,f),",",r(this.points[g].y-s,f)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',a.join(""),`" />
`]},commonRender:function(a){var u,s=this.points.length,f=this.pathOffset.x,g=this.pathOffset.y;if(!s||isNaN(this.points[s-1].y))return!1;a.beginPath(),a.moveTo(this.points[0].x-f,this.points[0].y-g);for(var m=0;m<s;m++)u=this.points[m],a.lineTo(u.x-f,u.y-g);return!0},_render:function(a){this.commonRender(a)&&this._renderPaintInOrder(a)},complexity:function(){return this.get("points").length}}),e.Polyline.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polyline.fromElementGenerator=function(a){return function(u,s,f){if(!u)return s(null);f||(f={});var g=e.parsePointsAttribute(u.getAttribute("points")),m=e.parseAttributes(u,e[a].ATTRIBUTE_NAMES);m.fromSVG=!0,s(new e[a](g,o(m,f)))}},e.Polyline.fromElement=e.Polyline.fromElementGenerator("Polyline"),e.Polyline.fromObject=function(a,u){return e.Object._fromObject("Polyline",a,u,"points")}}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.util.projectStrokeOnPoints;if(e.Polygon){e.warn("fabric.Polygon is already defined");return}e.Polygon=e.util.createClass(e.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return o(this.points,this)},_render:function(l){this.commonRender(l)&&(l.closePath(),this._renderPaintInOrder(l))}}),e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polygon.fromElement=e.Polyline.fromElementGenerator("Polygon"),e.Polygon.fromObject=function(l,n){e.Object._fromObject("Polygon",l,n,"points")}}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.util.array.min,l=e.util.array.max,n=e.util.object.extend,r=e.util.object.clone,i=e.util.toFixed;if(e.Path){e.warn("fabric.Path is already defined");return}e.Path=e.util.createClass(e.Object,{type:"path",path:null,cacheProperties:e.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:e.Object.prototype.stateProperties.concat("path"),initialize:function(a,u){u=r(u||{}),delete u.path,this.callSuper("initialize",u),this._setPath(a||[],u)},_setPath:function(a,u){this.path=e.util.makePathSimpler(Array.isArray(a)?a:e.util.parsePath(a)),e.Polyline.prototype._setPositionDimensions.call(this,u||{})},_renderPathCommands:function(a){var u,s=0,f=0,g=0,m=0,v=0,b=0,w=-this.pathOffset.x,S=-this.pathOffset.y;a.beginPath();for(var A=0,D=this.path.length;A<D;++A)switch(u=this.path[A],u[0]){case"L":g=u[1],m=u[2],a.lineTo(g+w,m+S);break;case"M":g=u[1],m=u[2],s=g,f=m,a.moveTo(g+w,m+S);break;case"C":g=u[5],m=u[6],v=u[3],b=u[4],a.bezierCurveTo(u[1]+w,u[2]+S,v+w,b+S,g+w,m+S);break;case"Q":a.quadraticCurveTo(u[1]+w,u[2]+S,u[3]+w,u[4]+S),g=u[3],m=u[4],v=u[1],b=u[2];break;case"z":case"Z":g=s,m=f,a.closePath();break}},_render:function(a){this._renderPathCommands(a),this._renderPaintInOrder(a)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){return n(this.callSuper("toObject",a),{path:this.path.map(function(u){return u.slice()})})},toDatalessObject:function(a){var u=this.toObject(["sourcePath"].concat(a));return u.sourcePath&&delete u.path,u},_toSVG:function(){var a=e.util.joinPath(this.path);return["<path ","COMMON_PARTS",'d="',a,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var a=e.Object.NUM_FRACTION_DIGITS;return" translate("+i(-this.pathOffset.x,a)+", "+i(-this.pathOffset.y,a)+")"},toClipPathSVG:function(a){var u=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:a,additionalTransform:u})},toSVG:function(a){var u=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:a,additionalTransform:u})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var a=[],u=[],s,f=0,g=0,m=0,v=0,b,w=0,S=this.path.length;w<S;++w){switch(s=this.path[w],s[0]){case"L":m=s[1],v=s[2],b=[];break;case"M":m=s[1],v=s[2],f=m,g=v,b=[];break;case"C":b=e.util.getBoundsOfCurve(m,v,s[1],s[2],s[3],s[4],s[5],s[6]),m=s[5],v=s[6];break;case"Q":b=e.util.getBoundsOfCurve(m,v,s[1],s[2],s[1],s[2],s[3],s[4]),m=s[3],v=s[4];break;case"z":case"Z":m=f,v=g;break}b.forEach(function(J){a.push(J.x),u.push(J.y)}),a.push(m),u.push(v)}var A=o(a)||0,D=o(u)||0,X=l(a)||0,K=l(u)||0,$=X-A,H=K-D;return{left:A,top:D,width:$,height:H}}}),e.Path.fromObject=function(a,u){if(typeof a.sourcePath=="string"){var s=a.sourcePath;e.loadSVGFromURL(s,function(f){var g=f[0];g.setOptions(a),a.clipPath?e.util.enlivenObjects([a.clipPath],function(m){g.clipPath=m[0],u&&u(g)}):u&&u(g)})}else e.Object._fromObject("Path",a,u,"path")},e.Path.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["d"]),e.Path.fromElement=function(a,u,s){var f=e.parseAttributes(a,e.Path.ATTRIBUTE_NAMES);f.fromSVG=!0,u(new e.Path(f.d,n(f,s)))}}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.util.array.min,l=e.util.array.max;e.Group||(e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(n,r,i){r=r||{},this._objects=[],i&&this.callSuper("initialize",r),this._objects=n||[];for(var a=this._objects.length;a--;)this._objects[a].group=this;if(i)this._updateObjectsACoords();else{var u=r&&r.centerPoint;r.originX!==void 0&&(this.originX=r.originX),r.originY!==void 0&&(this.originY=r.originY),u||this._calcBounds(),this._updateObjectsCoords(u),delete r.centerPoint,this.callSuper("initialize",r)}this.setCoords()},_updateObjectsACoords:function(){for(var n=!0,r=this._objects.length;r--;)this._objects[r].setCoords(n)},_updateObjectsCoords:function(r){for(var r=r||this.getCenterPoint(),i=this._objects.length;i--;)this._updateObjectCoords(this._objects[i],r)},_updateObjectCoords:function(n,r){var i=n.left,a=n.top,u=!0;n.set({left:i-r.x,top:a-r.y}),n.group=this,n.setCoords(u)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(n){var r=!!this.group;return this._restoreObjectsState(),e.util.resetObjectTransform(this),n&&(r&&e.util.removeTransformFromObject(n,this.group.calcTransformMatrix()),this._objects.push(n),n.group=this,n._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,r?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(n){return this._restoreObjectsState(),e.util.resetObjectTransform(this),this.remove(n),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(n){this.dirty=!0,n.group=this,n._set("canvas",this.canvas)},_onObjectRemoved:function(n){this.dirty=!0,delete n.group},_set:function(n,r){var i=this._objects.length;if(this.useSetOnGroup)for(;i--;)this._objects[i].setOnGroup(n,r);if(n==="canvas")for(;i--;)this._objects[i]._set(n,r);e.Object.prototype._set.call(this,n,r)},toObject:function(n){var r=this.includeDefaultValues,i=this._objects.filter(function(u){return!u.excludeFromExport}).map(function(u){var s=u.includeDefaultValues;u.includeDefaultValues=r;var f=u.toObject(n);return u.includeDefaultValues=s,f}),a=e.Object.prototype.toObject.call(this,n);return a.objects=i,a},toDatalessObject:function(n){var r,i=this.sourcePath;if(i)r=i;else{var a=this.includeDefaultValues;r=this._objects.map(function(s){var f=s.includeDefaultValues;s.includeDefaultValues=a;var g=s.toDatalessObject(n);return s.includeDefaultValues=f,g})}var u=e.Object.prototype.toDatalessObject.call(this,n);return u.objects=r,u},render:function(n){this._transformDone=!0,this.callSuper("render",n),this._transformDone=!1},shouldCache:function(){var n=e.Object.prototype.shouldCache.call(this);if(n){for(var r=0,i=this._objects.length;r<i;r++)if(this._objects[r].willDrawShadow())return this.ownCaching=!1,!1}return n},willDrawShadow:function(){if(e.Object.prototype.willDrawShadow.call(this))return!0;for(var n=0,r=this._objects.length;n<r;n++)if(this._objects[n].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(n){for(var r=0,i=this._objects.length;r<i;r++)this._objects[r].render(n);this._drawClipPath(n,this.clipPath)},isCacheDirty:function(n){if(this.callSuper("isCacheDirty",n))return!0;if(!this.statefullCache)return!1;for(var r=0,i=this._objects.length;r<i;r++)if(this._objects[r].isCacheDirty(!0)){if(this._cacheCanvas){var a=this.cacheWidth/this.zoomX,u=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-a/2,-u/2,a,u)}return!0}return!1},_restoreObjectsState:function(){var n=this.calcOwnMatrix();return this._objects.forEach(function(r){e.util.addTransformToObject(r,n),delete r.group,r.setCoords()}),this},destroy:function(){return this._objects.forEach(function(n){n.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(n){n.dispose&&n.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var n=this._objects,r=this.canvas;this._objects=[];var i=this.toObject();delete i.objects;var a=new e.ActiveSelection([]);return a.set(i),a.type="activeSelection",r.remove(this),n.forEach(function(u){u.group=a,u.dirty=!0,r.add(u)}),a.canvas=r,a._objects=n,r._activeObject=a,a.setCoords(),a}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var n=!0;return this.forEachObject(function(r){r.setCoords(n)}),this},_calcBounds:function(n){for(var r=[],i=[],a,u,s,f=["tr","br","bl","tl"],g=0,m=this._objects.length,v,b=f.length;g<m;++g){for(a=this._objects[g],s=a.calcACoords(),v=0;v<b;v++)u=f[v],r.push(s[u].x),i.push(s[u].y);a.aCoords=s}this._getBounds(r,i,n)},_getBounds:function(n,r,i){var a=new e.Point(o(n),o(r)),u=new e.Point(l(n),l(r)),s=a.y||0,f=a.x||0,g=u.x-a.x||0,m=u.y-a.y||0;this.width=g,this.height=m,i||this.setPositionByOrigin({x:f,y:s},"left","top")},_toSVG:function(n){for(var r=["<g ","COMMON_PARTS",` >
`],i=0,a=this._objects.length;i<a;i++)r.push("		",this._objects[i].toSVG(n));return r.push(`</g>
`),r},getSvgStyles:function(){var n=typeof this.opacity<"u"&&this.opacity!==1?"opacity: "+this.opacity+";":"",r=this.visible?"":" visibility: hidden;";return[n,this.getSvgFilter(),r].join("")},toClipPathSVG:function(n){for(var r=[],i=0,a=this._objects.length;i<a;i++)r.push("	",this._objects[i].toClipPathSVG(n));return this._createBaseClipPathSVGMarkup(r,{reviver:n})}}),e.Group.fromObject=function(n,r){var i=n.objects,a=e.util.object.clone(n,!0);if(delete a.objects,typeof i=="string"){e.loadSVGFromURL(i,function(u){var s=e.util.groupSVGElements(u,n,i),f=a.clipPath;delete a.clipPath,s.set(a),f?e.util.enlivenObjects([f],function(g){s.clipPath=g[0],r&&r(s)}):r&&r(s)});return}e.util.enlivenObjects(i,function(u){e.util.enlivenObjectEnlivables(n,a,function(){r&&r(new e.Group(u,a,!0))})})})}(c),function(h){var e=h.fabric||(h.fabric={});e.ActiveSelection||(e.ActiveSelection=e.util.createClass(e.Group,{type:"activeSelection",initialize:function(o,l){l=l||{},this._objects=o||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;l.originX&&(this.originX=l.originX),l.originY&&(this.originY=l.originY),this._calcBounds(),this._updateObjectsCoords(),e.Object.prototype.initialize.call(this,l),this.setCoords()},toGroup:function(){var o=this._objects.concat();this._objects=[];var l=e.Object.prototype.toObject.call(this),n=new e.Group([]);if(delete l.type,n.set(l),o.forEach(function(i){i.canvas.remove(i),i.group=n}),n._objects=o,!this.canvas)return n;var r=this.canvas;return r.add(n),r._activeObject=n,n.setCoords(),n},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(o,l,n){o.save(),o.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",o,l),n=n||{},typeof n.hasControls>"u"&&(n.hasControls=!1),n.forActiveSelection=!0;for(var r=0,i=this._objects.length;r<i;r++)this._objects[r]._renderControls(o,n);o.restore()}}),e.ActiveSelection.fromObject=function(o,l){e.util.enlivenObjects(o.objects,function(n){delete o.objects,l&&l(new e.ActiveSelection(n,o,!0))})})}(c),function(h){var e=t.util.object.extend;if(h.fabric||(h.fabric={}),h.fabric.Image){t.warn("fabric.Image is already defined.");return}t.Image=t.util.createClass(t.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:t.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:t.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(o,l){l||(l={}),this.filters=[],this.cacheKey="texture"+t.Object.__uid++,this.callSuper("initialize",l),this._initElement(o,l)},getElement:function(){return this._element||{}},setElement:function(o,l){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=o,this._originalElement=o,this._initConfig(l),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(o){var l=t.filterBackend;l&&l.evictCachesForKey&&l.evictCachesForKey(o)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(o){t.util.cleanUpJsdomNode(this[o]),this[o]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var o=this.getElement();return{width:o.naturalWidth||o.width,height:o.naturalHeight||o.height}},_stroke:function(o){if(!(!this.stroke||this.strokeWidth===0)){var l=this.width/2,n=this.height/2;o.beginPath(),o.moveTo(-l,-n),o.lineTo(l,-n),o.lineTo(l,n),o.lineTo(-l,n),o.lineTo(-l,-n),o.closePath()}},toObject:function(o){var l=[];this.filters.forEach(function(r){r&&l.push(r.toObject())});var n=e(this.callSuper("toObject",["cropX","cropY"].concat(o)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:l});return this.resizeFilter&&(n.resizeFilter=this.resizeFilter.toObject()),n},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var o=[],l=[],n,r=this._element,i=-this.width/2,a=-this.height/2,u="",s="";if(!r)return[];if(this.hasCrop()){var f=t.Object.__uid++;o.push('<clipPath id="imageCrop_'+f+`">
`,'	<rect x="'+i+'" y="'+a+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),u=' clip-path="url(#imageCrop_'+f+')" '}if(this.imageSmoothing||(s='" image-rendering="optimizeSpeed'),l.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',i-this.cropX,'" y="',a-this.cropY,'" width="',r.width||r.naturalWidth,'" height="',r.height||r.height,s,'"',u,`></image>
`),this.stroke||this.strokeDashArray){var g=this.fill;this.fill=null,n=["	<rect ",'x="',i,'" y="',a,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=g}return this.paintFirst!=="fill"?o=o.concat(n,l):o=o.concat(l,n),o},getSrc:function(o){var l=o?this._element:this._originalElement;return l?l.toDataURL?l.toDataURL():this.srcFromAttribute?l.getAttribute("src"):l.src:this.src||""},setSrc:function(o,l,n){return t.util.loadImage(o,function(r,i){this.setElement(r,n),this._setWidthHeight(),l&&l(this,i)},this,n&&n.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var o=this.resizeFilter,l=this.minimumScaleTrigger,n=this.getTotalObjectScaling(),r=n.scaleX,i=n.scaleY,a=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!o||r>l&&i>l){this._element=a,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=r,this._lastScaleY=i;return}t.filterBackend||(t.filterBackend=t.initFilterBackend());var u=t.util.createCanvasElement(),s=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,f=a.width,g=a.height;u.width=f,u.height=g,this._element=u,this._lastScaleX=o.scaleX=r,this._lastScaleY=o.scaleY=i,t.filterBackend.applyFilters([o],a,f,g,this._element,s),this._filterScalingX=u.width/this._originalElement.width,this._filterScalingY=u.height/this._originalElement.height},applyFilters:function(o){if(o=o||this.filters||[],o=o.filter(function(a){return a&&!a.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),o.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var l=this._originalElement,n=l.naturalWidth||l.width,r=l.naturalHeight||l.height;if(this._element===this._originalElement){var i=t.util.createCanvasElement();i.width=n,i.height=r,this._element=i,this._filteredEl=i}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,n,r),this._lastScaleX=1,this._lastScaleY=1;return t.filterBackend||(t.filterBackend=t.initFilterBackend()),t.filterBackend.applyFilters(o,this._originalElement,n,r,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(o){t.util.setImageSmoothing(o,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(o),this._renderPaintInOrder(o)},drawCacheOnCanvas:function(o){t.util.setImageSmoothing(o,this.imageSmoothing),t.Object.prototype.drawCacheOnCanvas.call(this,o)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(o){var l=this._element;if(l){var n=this._filterScalingX,r=this._filterScalingY,i=this.width,a=this.height,u=Math.min,s=Math.max,f=s(this.cropX,0),g=s(this.cropY,0),m=l.naturalWidth||l.width,v=l.naturalHeight||l.height,b=f*n,w=g*r,S=u(i*n,m-b),A=u(a*r,v-w),D=-i/2,X=-a/2,K=u(i,m/n-f),$=u(a,v/r-g);l&&o.drawImage(l,b,w,S,A,D,X,K,$)}},_needsResize:function(){var o=this.getTotalObjectScaling();return o.scaleX!==this._lastScaleX||o.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(o,l){this.setElement(t.util.getById(o),l),t.util.addClass(this.getElement(),t.Image.CSS_CANVAS)},_initConfig:function(o){o||(o={}),this.setOptions(o),this._setWidthHeight(o)},_initFilters:function(o,l){o&&o.length?t.util.enlivenObjects(o,function(n){l&&l(n)},"fabric.Image.filters"):l&&l()},_setWidthHeight:function(o){o||(o={});var l=this.getElement();this.width=o.width||l.naturalWidth||l.width||0,this.height=o.height||l.naturalHeight||l.height||0},parsePreserveAspectRatioAttribute:function(){var o=t.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),l=this._element.width,n=this._element.height,r=1,i=1,a=0,u=0,s=0,f=0,g,m=this.width,v=this.height,b={width:m,height:v};return o&&(o.alignX!=="none"||o.alignY!=="none")?(o.meetOrSlice==="meet"&&(r=i=t.util.findScaleToFit(this._element,b),g=(m-l*r)/2,o.alignX==="Min"&&(a=-g),o.alignX==="Max"&&(a=g),g=(v-n*i)/2,o.alignY==="Min"&&(u=-g),o.alignY==="Max"&&(u=g)),o.meetOrSlice==="slice"&&(r=i=t.util.findScaleToCover(this._element,b),g=l-m/r,o.alignX==="Mid"&&(s=g/2),o.alignX==="Max"&&(s=g),g=n-v/i,o.alignY==="Mid"&&(f=g/2),o.alignY==="Max"&&(f=g),l=m/r,n=v/i)):(r=m/l,i=v/n),{width:l,height:n,scaleX:r,scaleY:i,offsetLeft:a,offsetTop:u,cropX:s,cropY:f}}}),t.Image.CSS_CANVAS="canvas-img",t.Image.prototype.getSvgSrc=t.Image.prototype.getSrc,t.Image.fromObject=function(o,l){var n=t.util.object.clone(o);t.util.loadImage(n.src,function(r,i){if(i){l&&l(null,!0);return}t.Image.prototype._initFilters.call(n,n.filters,function(a){n.filters=a||[],t.Image.prototype._initFilters.call(n,[n.resizeFilter],function(u){n.resizeFilter=u[0],t.util.enlivenObjectEnlivables(n,n,function(){var s=new t.Image(r,n);l(s,!1)})})})},null,n.crossOrigin)},t.Image.fromURL=function(o,l,n){t.util.loadImage(o,function(r,i){l&&l(new t.Image(r,n),i)},null,n&&n.crossOrigin)},t.Image.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),t.Image.fromElement=function(o,l,n){var r=t.parseAttributes(o,t.Image.ATTRIBUTE_NAMES);t.Image.fromURL(r["xlink:href"],l,e(n?t.util.object.clone(n):{},r))}}(c),t.util.object.extend(t.Object.prototype,{_getAngleValueForStraighten:function(){var h=this.angle%360;return h>0?Math.round((h-1)/90)*90:Math.round(h/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(h){h=h||{};var e=function(){},o=h.onComplete||e,l=h.onChange||e,n=this;return t.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(r){n.rotate(r),l()},onComplete:function(){n.setCoords(),o()}})}}),t.util.object.extend(t.StaticCanvas.prototype,{straightenObject:function(h){return h.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(h){return h.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function h(o,l){var n="precision "+l+` float;
void main(){}`,r=o.createShader(o.FRAGMENT_SHADER);return o.shaderSource(r,n),o.compileShader(r),!!o.getShaderParameter(r,o.COMPILE_STATUS)}t.isWebglSupported=function(o){if(t.isLikelyNode)return!1;o=o||t.WebglFilterBackend.prototype.tileSize;var l=document.createElement("canvas"),n=l.getContext("webgl")||l.getContext("experimental-webgl"),r=!1;if(n){t.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),r=t.maxTextureSize>=o;for(var i=["highp","mediump","lowp"],a=0;a<3;a++)if(h(n,i[a])){t.webGlPrecision=i[a];break}}return this.isSupported=r,r},t.WebglFilterBackend=e;function e(o){o&&o.tileSize&&(this.tileSize=o.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}e.prototype={tileSize:2048,resources:{},setupGLContext:function(o,l){this.dispose(),this.createWebGLCanvas(o,l),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(o,l)},chooseFastestCopyGLTo2DMethod:function(o,l){var n=typeof window.performance<"u",r;try{new ImageData(1,1),r=!0}catch{r=!1}var i=typeof ArrayBuffer<"u",a=typeof Uint8ClampedArray<"u";if(n&&r&&i&&a){var u=t.util.createCanvasElement(),s=new ArrayBuffer(o*l*4);if(t.forceGLPutImageData){this.imageBuffer=s,this.copyGLTo2D=y;return}var f={imageBuffer:s,destinationWidth:o,destinationHeight:l,targetCanvas:u},g,m,v;u.width=o,u.height=l,g=window.performance.now(),C.call(f,this.gl,f),m=window.performance.now()-g,g=window.performance.now(),y.call(f,this.gl,f),v=window.performance.now()-g,m>v?(this.imageBuffer=s,this.copyGLTo2D=y):this.copyGLTo2D=C}},createWebGLCanvas:function(o,l){var n=t.util.createCanvasElement();n.width=o,n.height=l;var r={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},i=n.getContext("webgl",r);i||(i=n.getContext("experimental-webgl",r)),i&&(i.clearColor(0,0,0,0),this.canvas=n,this.gl=i)},applyFilters:function(o,l,n,r,i,a){var u=this.gl,s;a&&(s=this.getCachedTexture(a,l));var f={originalWidth:l.width||l.originalWidth,originalHeight:l.height||l.originalHeight,sourceWidth:n,sourceHeight:r,destinationWidth:n,destinationHeight:r,context:u,sourceTexture:this.createTexture(u,n,r,!s&&l),targetTexture:this.createTexture(u,n,r),originalTexture:s||this.createTexture(u,n,r,!s&&l),passes:o.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:i},g=u.createFramebuffer();return u.bindFramebuffer(u.FRAMEBUFFER,g),o.forEach(function(m){m&&m.applyTo(f)}),_(f),this.copyGLTo2D(u,f),u.bindTexture(u.TEXTURE_2D,null),u.deleteTexture(f.sourceTexture),u.deleteTexture(f.targetTexture),u.deleteFramebuffer(g),i.getContext("2d").setTransform(1,0,0,1,0,0),f},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(o,l,n,r,i){var a=o.createTexture();return o.bindTexture(o.TEXTURE_2D,a),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,i||o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,i||o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),r?o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,r):o.texImage2D(o.TEXTURE_2D,0,o.RGBA,l,n,0,o.RGBA,o.UNSIGNED_BYTE,null),a},getCachedTexture:function(o,l){if(this.textureCache[o])return this.textureCache[o];var n=this.createTexture(this.gl,l.width,l.height,l);return this.textureCache[o]=n,n},evictCachesForKey:function(o){this.textureCache[o]&&(this.gl.deleteTexture(this.textureCache[o]),delete this.textureCache[o])},copyGLTo2D:C,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var o=this.gl,l={renderer:"",vendor:""};if(!o)return l;var n=o.getExtension("WEBGL_debug_renderer_info");if(n){var r=o.getParameter(n.UNMASKED_RENDERER_WEBGL),i=o.getParameter(n.UNMASKED_VENDOR_WEBGL);r&&(l.renderer=r.toLowerCase()),i&&(l.vendor=i.toLowerCase())}return this.gpuInfo=l,l}}}();function _(h){var e=h.targetCanvas,o=e.width,l=e.height,n=h.destinationWidth,r=h.destinationHeight;(o!==n||l!==r)&&(e.width=n,e.height=r)}function C(h,e){var o=h.canvas,l=e.targetCanvas,n=l.getContext("2d");n.translate(0,l.height),n.scale(1,-1);var r=o.height-l.height;n.drawImage(o,0,r,l.width,l.height,0,0,l.width,l.height)}function y(h,e){var o=e.targetCanvas,l=o.getContext("2d"),n=e.destinationWidth,r=e.destinationHeight,i=n*r*4,a=new Uint8Array(this.imageBuffer,0,i),u=new Uint8ClampedArray(this.imageBuffer,0,i);h.readPixels(0,0,n,r,h.RGBA,h.UNSIGNED_BYTE,a);var s=new ImageData(u,n,r);l.putImageData(s,0,0)}(function(){var h=function(){};t.Canvas2dFilterBackend=e;function e(){}e.prototype={evictCachesForKey:h,dispose:h,clearWebGLCaches:h,resources:{},applyFilters:function(o,l,n,r,i){var a=i.getContext("2d");a.drawImage(l,0,0,n,r);var u=a.getImageData(0,0,n,r),s=a.getImageData(0,0,n,r),f={sourceWidth:n,sourceHeight:r,imageData:u,originalEl:l,originalImageData:s,canvasEl:i,ctx:a,filterBackend:this};return o.forEach(function(g){g.applyTo(f)}),(f.imageData.width!==n||f.imageData.height!==r)&&(i.width=f.imageData.width,i.height=f.imageData.height),a.putImageData(f.imageData,0,0),f}}})(),t.Image=t.Image||{},t.Image.filters=t.Image.filters||{},t.Image.filters.BaseFilter=t.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(h){h&&this.setOptions(h)},setOptions:function(h){for(var e in h)this[e]=h[e]},createProgram:function(h,e,o){e=e||this.fragmentSource,o=o||this.vertexSource,t.webGlPrecision!=="highp"&&(e=e.replace(/precision highp float/g,"precision "+t.webGlPrecision+" float"));var l=h.createShader(h.VERTEX_SHADER);if(h.shaderSource(l,o),h.compileShader(l),!h.getShaderParameter(l,h.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+h.getShaderInfoLog(l));var n=h.createShader(h.FRAGMENT_SHADER);if(h.shaderSource(n,e),h.compileShader(n),!h.getShaderParameter(n,h.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+h.getShaderInfoLog(n));var r=h.createProgram();if(h.attachShader(r,l),h.attachShader(r,n),h.linkProgram(r),!h.getProgramParameter(r,h.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+h.getProgramInfoLog(r));var i=this.getAttributeLocations(h,r),a=this.getUniformLocations(h,r)||{};return a.uStepW=h.getUniformLocation(r,"uStepW"),a.uStepH=h.getUniformLocation(r,"uStepH"),{program:r,attributeLocations:i,uniformLocations:a}},getAttributeLocations:function(h,e){return{aPosition:h.getAttribLocation(e,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(h,e,o){var l=e.aPosition,n=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,n),h.enableVertexAttribArray(l),h.vertexAttribPointer(l,2,h.FLOAT,!1,0,0),h.bufferData(h.ARRAY_BUFFER,o,h.STATIC_DRAW)},_setupFrameBuffer:function(h){var e=h.context,o,l;h.passes>1?(o=h.destinationWidth,l=h.destinationHeight,(h.sourceWidth!==o||h.sourceHeight!==l)&&(e.deleteTexture(h.targetTexture),h.targetTexture=h.filterBackend.createTexture(e,o,l)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,h.targetTexture,0)):(e.bindFramebuffer(e.FRAMEBUFFER,null),e.finish())},_swapTextures:function(h){h.passes--,h.pass++;var e=h.targetTexture;h.targetTexture=h.sourceTexture,h.sourceTexture=e},isNeutralState:function(){var h=this.mainParameter,e=t.Image.filters[this.type].prototype;if(h)if(Array.isArray(e[h])){for(var o=e[h].length;o--;)if(this[h][o]!==e[h][o])return!1;return!0}else return e[h]===this[h];else return!1},applyTo:function(h){h.webgl?(this._setupFrameBuffer(h),this.applyToWebGL(h),this._swapTextures(h)):this.applyTo2d(h)},retrieveShader:function(h){return h.programCache.hasOwnProperty(this.type)||(h.programCache[this.type]=this.createProgram(h.context)),h.programCache[this.type]},applyToWebGL:function(h){var e=h.context,o=this.retrieveShader(h);h.pass===0&&h.originalTexture?e.bindTexture(e.TEXTURE_2D,h.originalTexture):e.bindTexture(e.TEXTURE_2D,h.sourceTexture),e.useProgram(o.program),this.sendAttributeData(e,o.attributeLocations,h.aPosition),e.uniform1f(o.uniformLocations.uStepW,1/h.sourceWidth),e.uniform1f(o.uniformLocations.uStepH,1/h.sourceHeight),this.sendUniformData(e,o.uniformLocations),e.viewport(0,0,h.destinationWidth,h.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(h,e,o){h.activeTexture(o),h.bindTexture(h.TEXTURE_2D,e),h.activeTexture(h.TEXTURE0)},unbindAdditionalTexture:function(h,e){h.activeTexture(e),h.bindTexture(h.TEXTURE_2D,null),h.activeTexture(h.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(h){this[this.mainParameter]=h},sendUniformData:function(){},createHelpLayer:function(h){if(!h.helpLayer){var e=document.createElement("canvas");e.width=h.sourceWidth,e.height=h.sourceHeight,h.helpLayer=e}},toObject:function(){var h={type:this.type},e=this.mainParameter;return e&&(h[e]=this[e]),h},toJSON:function(){return this.toObject()}}),t.Image.filters.BaseFilter.fromObject=function(h,e){var o=new t.Image.filters[h.type](h);return e&&e(o),o},function(h){var e=h.fabric||(h.fabric={}),o=e.Image.filters,l=e.util.createClass;o.ColorMatrix=l(o.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(n){this.callSuper("initialize",n),this.matrix=this.matrix.slice(0)},applyTo2d:function(n){var r=n.imageData,i=r.data,a=i.length,u=this.matrix,s,f,g,m,v,b=this.colorsOnly;for(v=0;v<a;v+=4)s=i[v],f=i[v+1],g=i[v+2],b?(i[v]=s*u[0]+f*u[1]+g*u[2]+u[4]*255,i[v+1]=s*u[5]+f*u[6]+g*u[7]+u[9]*255,i[v+2]=s*u[10]+f*u[11]+g*u[12]+u[14]*255):(m=i[v+3],i[v]=s*u[0]+f*u[1]+g*u[2]+m*u[3]+u[4]*255,i[v+1]=s*u[5]+f*u[6]+g*u[7]+m*u[8]+u[9]*255,i[v+2]=s*u[10]+f*u[11]+g*u[12]+m*u[13]+u[14]*255,i[v+3]=s*u[15]+f*u[16]+g*u[17]+m*u[18]+u[19]*255)},getUniformLocations:function(n,r){return{uColorMatrix:n.getUniformLocation(r,"uColorMatrix"),uConstants:n.getUniformLocation(r,"uConstants")}},sendUniformData:function(n,r){var i=this.matrix,a=[i[0],i[1],i[2],i[3],i[5],i[6],i[7],i[8],i[10],i[11],i[12],i[13],i[15],i[16],i[17],i[18]],u=[i[4],i[9],i[14],i[19]];n.uniformMatrix4fv(r.uColorMatrix,!1,a),n.uniform4fv(r.uConstants,u)}}),e.Image.filters.ColorMatrix.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.Image.filters,l=e.util.createClass;o.Brightness=l(o.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(n){if(this.brightness!==0){var r=n.imageData,i=r.data,a,u=i.length,s=Math.round(this.brightness*255);for(a=0;a<u;a+=4)i[a]=i[a]+s,i[a+1]=i[a+1]+s,i[a+2]=i[a+2]+s}},getUniformLocations:function(n,r){return{uBrightness:n.getUniformLocation(r,"uBrightness")}},sendUniformData:function(n,r){n.uniform1f(r.uBrightness,this.brightness)}}),e.Image.filters.Brightness.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.util.object.extend,l=e.Image.filters,n=e.util.createClass;l.Convolute=n(l.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(r){var i=Math.sqrt(this.matrix.length),a=this.type+"_"+i+"_"+(this.opaque?1:0),u=this.fragmentSource[a];return r.programCache.hasOwnProperty(a)||(r.programCache[a]=this.createProgram(r.context,u)),r.programCache[a]},applyTo2d:function(r){var i=r.imageData,a=i.data,u=this.matrix,s=Math.round(Math.sqrt(u.length)),f=Math.floor(s/2),g=i.width,m=i.height,v=r.ctx.createImageData(g,m),b=v.data,w=this.opaque?1:0,S,A,D,X,K,$,H,J,Z,Q,rt,st,T;for(rt=0;rt<m;rt++)for(Q=0;Q<g;Q++){for(K=(rt*g+Q)*4,S=0,A=0,D=0,X=0,T=0;T<s;T++)for(st=0;st<s;st++)H=rt+T-f,$=Q+st-f,!(H<0||H>=m||$<0||$>=g)&&(J=(H*g+$)*4,Z=u[T*s+st],S+=a[J]*Z,A+=a[J+1]*Z,D+=a[J+2]*Z,w||(X+=a[J+3]*Z));b[K]=S,b[K+1]=A,b[K+2]=D,w?b[K+3]=a[K+3]:b[K+3]=X}r.imageData=v},getUniformLocations:function(r,i){return{uMatrix:r.getUniformLocation(i,"uMatrix"),uOpaque:r.getUniformLocation(i,"uOpaque"),uHalfSize:r.getUniformLocation(i,"uHalfSize"),uSize:r.getUniformLocation(i,"uSize")}},sendUniformData:function(r,i){r.uniform1fv(i.uMatrix,this.matrix)},toObject:function(){return o(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),e.Image.filters.Convolute.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.Image.filters,l=e.util.createClass;o.Grayscale=l(o.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(n){var r=n.imageData,i=r.data,a,u=i.length,s,f=this.mode;for(a=0;a<u;a+=4)f==="average"?s=(i[a]+i[a+1]+i[a+2])/3:f==="lightness"?s=(Math.min(i[a],i[a+1],i[a+2])+Math.max(i[a],i[a+1],i[a+2]))/2:f==="luminosity"&&(s=.21*i[a]+.72*i[a+1]+.07*i[a+2]),i[a]=s,i[a+1]=s,i[a+2]=s},retrieveShader:function(n){var r=this.type+"_"+this.mode;if(!n.programCache.hasOwnProperty(r)){var i=this.fragmentSource[this.mode];n.programCache[r]=this.createProgram(n.context,i)}return n.programCache[r]},getUniformLocations:function(n,r){return{uMode:n.getUniformLocation(r,"uMode")}},sendUniformData:function(n,r){var i=1;n.uniform1i(r.uMode,i)},isNeutralState:function(){return!1}}),e.Image.filters.Grayscale.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.Image.filters,l=e.util.createClass;o.Invert=l(o.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(n){var r=n.imageData,i=r.data,a,u=i.length;for(a=0;a<u;a+=4)i[a]=255-i[a],i[a+1]=255-i[a+1],i[a+2]=255-i[a+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(n,r){return{uInvert:n.getUniformLocation(r,"uInvert")}},sendUniformData:function(n,r){n.uniform1i(r.uInvert,this.invert)}}),e.Image.filters.Invert.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.util.object.extend,l=e.Image.filters,n=e.util.createClass;l.Noise=n(l.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(r){if(this.noise!==0){var i=r.imageData,a=i.data,u,s=a.length,f=this.noise,g;for(u=0,s=a.length;u<s;u+=4)g=(.5-Math.random())*f,a[u]+=g,a[u+1]+=g,a[u+2]+=g}},getUniformLocations:function(r,i){return{uNoise:r.getUniformLocation(i,"uNoise"),uSeed:r.getUniformLocation(i,"uSeed")}},sendUniformData:function(r,i){r.uniform1f(i.uNoise,this.noise/255),r.uniform1f(i.uSeed,Math.random())},toObject:function(){return o(this.callSuper("toObject"),{noise:this.noise})}}),e.Image.filters.Noise.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.Image.filters,l=e.util.createClass;o.Pixelate=l(o.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(n){var r=n.imageData,i=r.data,a=r.height,u=r.width,s,f,g,m,v,b,w,S,A,D,X;for(f=0;f<a;f+=this.blocksize)for(g=0;g<u;g+=this.blocksize)for(s=f*4*u+g*4,m=i[s],v=i[s+1],b=i[s+2],w=i[s+3],D=Math.min(f+this.blocksize,a),X=Math.min(g+this.blocksize,u),S=f;S<D;S++)for(A=g;A<X;A++)s=S*4*u+A*4,i[s]=m,i[s+1]=v,i[s+2]=b,i[s+3]=w},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(n,r){return{uBlocksize:n.getUniformLocation(r,"uBlocksize"),uStepW:n.getUniformLocation(r,"uStepW"),uStepH:n.getUniformLocation(r,"uStepH")}},sendUniformData:function(n,r){n.uniform1f(r.uBlocksize,this.blocksize)}}),e.Image.filters.Pixelate.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.util.object.extend,l=e.Image.filters,n=e.util.createClass;l.RemoveColor=n(l.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(r){var i=r.imageData,a=i.data,u,s=this.distance*255,f,g,m,v=new e.Color(this.color).getSource(),b=[v[0]-s,v[1]-s,v[2]-s],w=[v[0]+s,v[1]+s,v[2]+s];for(u=0;u<a.length;u+=4)f=a[u],g=a[u+1],m=a[u+2],f>b[0]&&g>b[1]&&m>b[2]&&f<w[0]&&g<w[1]&&m<w[2]&&(a[u+3]=0)},getUniformLocations:function(r,i){return{uLow:r.getUniformLocation(i,"uLow"),uHigh:r.getUniformLocation(i,"uHigh")}},sendUniformData:function(r,i){var a=new e.Color(this.color).getSource(),u=parseFloat(this.distance),s=[0+a[0]/255-u,0+a[1]/255-u,0+a[2]/255-u,1],f=[a[0]/255+u,a[1]/255+u,a[2]/255+u,1];r.uniform4fv(i.uLow,s),r.uniform4fv(i.uHigh,f)},toObject:function(){return o(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),e.Image.filters.RemoveColor.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.Image.filters,l=e.util.createClass,n={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var r in n)o[r]=l(o.ColorMatrix,{type:r,matrix:n[r],mainParameter:!1,colorsOnly:!0}),e.Image.filters[r].fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric,o=e.Image.filters,l=e.util.createClass;o.BlendColor=l(o.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(n){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[n]+`}
}`},retrieveShader:function(n){var r=this.type+"_"+this.mode,i;return n.programCache.hasOwnProperty(r)||(i=this.buildSource(this.mode),n.programCache[r]=this.createProgram(n.context,i)),n.programCache[r]},applyTo2d:function(n){var r=n.imageData,i=r.data,a=i.length,u,s,f,g,m,v,b,w=1-this.alpha;b=new e.Color(this.color).getSource(),u=b[0]*this.alpha,s=b[1]*this.alpha,f=b[2]*this.alpha;for(var S=0;S<a;S+=4)switch(g=i[S],m=i[S+1],v=i[S+2],this.mode){case"multiply":i[S]=g*u/255,i[S+1]=m*s/255,i[S+2]=v*f/255;break;case"screen":i[S]=255-(255-g)*(255-u)/255,i[S+1]=255-(255-m)*(255-s)/255,i[S+2]=255-(255-v)*(255-f)/255;break;case"add":i[S]=g+u,i[S+1]=m+s,i[S+2]=v+f;break;case"diff":case"difference":i[S]=Math.abs(g-u),i[S+1]=Math.abs(m-s),i[S+2]=Math.abs(v-f);break;case"subtract":i[S]=g-u,i[S+1]=m-s,i[S+2]=v-f;break;case"darken":i[S]=Math.min(g,u),i[S+1]=Math.min(m,s),i[S+2]=Math.min(v,f);break;case"lighten":i[S]=Math.max(g,u),i[S+1]=Math.max(m,s),i[S+2]=Math.max(v,f);break;case"overlay":i[S]=u<128?2*g*u/255:255-2*(255-g)*(255-u)/255,i[S+1]=s<128?2*m*s/255:255-2*(255-m)*(255-s)/255,i[S+2]=f<128?2*v*f/255:255-2*(255-v)*(255-f)/255;break;case"exclusion":i[S]=u+g-2*u*g/255,i[S+1]=s+m-2*s*m/255,i[S+2]=f+v-2*f*v/255;break;case"tint":i[S]=u+g*w,i[S+1]=s+m*w,i[S+2]=f+v*w}},getUniformLocations:function(n,r){return{uColor:n.getUniformLocation(r,"uColor")}},sendUniformData:function(n,r){var i=new e.Color(this.color).getSource();i[0]=this.alpha*i[0]/255,i[1]=this.alpha*i[1]/255,i[2]=this.alpha*i[2]/255,i[3]=this.alpha,n.uniform4fv(r.uColor,i)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),e.Image.filters.BlendColor.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric,o=e.Image.filters,l=e.util.createClass;o.BlendImage=l(o.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(n){var r=this.type+"_"+this.mode,i=this.fragmentSource[this.mode];return n.programCache.hasOwnProperty(r)||(n.programCache[r]=this.createProgram(n.context,i)),n.programCache[r]},applyToWebGL:function(n){var r=n.context,i=this.createTexture(n.filterBackend,this.image);this.bindAdditionalTexture(r,i,r.TEXTURE1),this.callSuper("applyToWebGL",n),this.unbindAdditionalTexture(r,r.TEXTURE1)},createTexture:function(n,r){return n.getCachedTexture(r.cacheKey,r._element)},calculateMatrix:function(){var n=this.image,r=n._element.width,i=n._element.height;return[1/n.scaleX,0,0,0,1/n.scaleY,0,-n.left/r,-n.top/i,1]},applyTo2d:function(n){var r=n.imageData,i=n.filterBackend.resources,a=r.data,u=a.length,s=r.width,f=r.height,g,m,v,b,w,S,A,D,X,K,$=this.image,H;i.blendImage||(i.blendImage=e.util.createCanvasElement()),X=i.blendImage,K=X.getContext("2d"),X.width!==s||X.height!==f?(X.width=s,X.height=f):K.clearRect(0,0,s,f),K.setTransform($.scaleX,0,0,$.scaleY,$.left,$.top),K.drawImage($._element,0,0,s,f),H=K.getImageData(0,0,s,f).data;for(var J=0;J<u;J+=4)switch(w=a[J],S=a[J+1],A=a[J+2],D=a[J+3],g=H[J],m=H[J+1],v=H[J+2],b=H[J+3],this.mode){case"multiply":a[J]=w*g/255,a[J+1]=S*m/255,a[J+2]=A*v/255,a[J+3]=D*b/255;break;case"mask":a[J+3]=b;break}},getUniformLocations:function(n,r){return{uTransformMatrix:n.getUniformLocation(r,"uTransformMatrix"),uImage:n.getUniformLocation(r,"uImage")}},sendUniformData:function(n,r){var i=this.calculateMatrix();n.uniform1i(r.uImage,1),n.uniformMatrix3fv(r.uTransformMatrix,!1,i)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),e.Image.filters.BlendImage.fromObject=function(n,r){e.Image.fromObject(n.image,function(i){var a=e.util.object.clone(n);a.image=i,r(new e.Image.filters.BlendImage(a))})}}(c),function(h){var e=h.fabric||(h.fabric={}),o=Math.pow,l=Math.floor,n=Math.sqrt,r=Math.abs,i=Math.round,a=Math.sin,u=Math.ceil,s=e.Image.filters,f=e.util.createClass;s.Resize=f(s.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(g,m){return{uDelta:g.getUniformLocation(m,"uDelta"),uTaps:g.getUniformLocation(m,"uTaps")}},sendUniformData:function(g,m){g.uniform2fv(m.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),g.uniform1fv(m.uTaps,this.taps)},retrieveShader:function(g){var m=this.getFilterWindow(),v=this.type+"_"+m;if(!g.programCache.hasOwnProperty(v)){var b=this.generateShader(m);g.programCache[v]=this.createProgram(g.context,b)}return g.programCache[v]},getFilterWindow:function(){var g=this.tempScale;return Math.ceil(this.lanczosLobes/g)},getTaps:function(){for(var g=this.lanczosCreate(this.lanczosLobes),m=this.tempScale,v=this.getFilterWindow(),b=new Array(v),w=1;w<=v;w++)b[w-1]=g(w*m);return b},generateShader:function(b){for(var m=new Array(b),v=this.fragmentSourceTOP,b,w=1;w<=b;w++)m[w-1]=w+".0 * uDelta";return v+="uniform float uTaps["+b+`];
`,v+=`void main() {
`,v+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,v+=`  float sum = 1.0;
`,m.forEach(function(S,A){v+="  color += texture2D(uTexture, vTexCoord + "+S+") * uTaps["+A+`];
`,v+="  color += texture2D(uTexture, vTexCoord - "+S+") * uTaps["+A+`];
`,v+="  sum += 2.0 * uTaps["+A+`];
`}),v+=`  gl_FragColor = color / sum;
`,v+="}",v},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(g){g.webgl?(g.passes++,this.width=g.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=g.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),g.destinationWidth=this.dW,this._setupFrameBuffer(g),this.applyToWebGL(g),this._swapTextures(g),g.sourceWidth=g.destinationWidth,this.height=g.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),g.destinationHeight=this.dH,this._setupFrameBuffer(g),this.applyToWebGL(g),this._swapTextures(g),g.sourceHeight=g.destinationHeight):this.applyTo2d(g)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(g){return function(m){if(m>=g||m<=-g)return 0;if(m<11920929e-14&&m>-11920929e-14)return 1;m*=Math.PI;var v=m/g;return a(m)/m*a(v)/v}},applyTo2d:function(g){var m=g.imageData,v=this.scaleX,b=this.scaleY;this.rcpScaleX=1/v,this.rcpScaleY=1/b;var w=m.width,S=m.height,A=i(w*v),D=i(S*b),X;this.resizeType==="sliceHack"?X=this.sliceByTwo(g,w,S,A,D):this.resizeType==="hermite"?X=this.hermiteFastResize(g,w,S,A,D):this.resizeType==="bilinear"?X=this.bilinearFiltering(g,w,S,A,D):this.resizeType==="lanczos"&&(X=this.lanczosResize(g,w,S,A,D)),g.imageData=X},sliceByTwo:function(g,m,v,b,w){var S=g.imageData,A=.5,D=!1,X=!1,K=m*A,$=v*A,H=e.filterBackend.resources,J,Z,Q=0,rt=0,st=m,T=0;for(H.sliceByTwo||(H.sliceByTwo=document.createElement("canvas")),J=H.sliceByTwo,(J.width<m*1.5||J.height<v)&&(J.width=m*1.5,J.height=v),Z=J.getContext("2d"),Z.clearRect(0,0,m*1.5,v),Z.putImageData(S,0,0),b=l(b),w=l(w);!D||!X;)m=K,v=$,b<l(K*A)?K=l(K*A):(K=b,D=!0),w<l($*A)?$=l($*A):($=w,X=!0),Z.drawImage(J,Q,rt,m,v,st,T,K,$),Q=st,rt=T,T+=$;return Z.getImageData(Q,rt,b,w)},lanczosResize:function(g,m,v,b,w){function S(P){var E,B,O,x,M,R,Y,j,G,I,tt;for(T.x=(P+.5)*$,k.x=l(T.x),E=0;E<w;E++){for(T.y=(E+.5)*H,k.y=l(T.y),M=0,R=0,Y=0,j=0,G=0,B=k.x-Q;B<=k.x+Q;B++)if(!(B<0||B>=m)){I=l(1e3*r(B-T.x)),st[I]||(st[I]={});for(var W=k.y-rt;W<=k.y+rt;W++)W<0||W>=v||(tt=l(1e3*r(W-T.y)),st[I][tt]||(st[I][tt]=K(n(o(I*J,2)+o(tt*Z,2))/1e3)),O=st[I][tt],O>0&&(x=(W*m+B)*4,M+=O,R+=O*A[x],Y+=O*A[x+1],j+=O*A[x+2],G+=O*A[x+3]))}x=(E*b+P)*4,X[x]=R/M,X[x+1]=Y/M,X[x+2]=j/M,X[x+3]=G/M}return++P<b?S(P):D}var A=g.imageData.data,D=g.ctx.createImageData(b,w),X=D.data,K=this.lanczosCreate(this.lanczosLobes),$=this.rcpScaleX,H=this.rcpScaleY,J=2/this.rcpScaleX,Z=2/this.rcpScaleY,Q=u($*this.lanczosLobes/2),rt=u(H*this.lanczosLobes/2),st={},T={},k={};return S(0)},bilinearFiltering:function(g,m,v,b,w){var S,A,D,X,K,$,H,J,Z,Q,rt,st,T=0,k,P=this.rcpScaleX,E=this.rcpScaleY,B=4*(m-1),O=g.imageData,x=O.data,M=g.ctx.createImageData(b,w),R=M.data;for(H=0;H<w;H++)for(J=0;J<b;J++)for(K=l(P*J),$=l(E*H),Z=P*J-K,Q=E*H-$,k=4*($*m+K),rt=0;rt<4;rt++)S=x[k+rt],A=x[k+4+rt],D=x[k+B+rt],X=x[k+B+4+rt],st=S*(1-Z)*(1-Q)+A*Z*(1-Q)+D*Q*(1-Z)+X*Z*Q,R[T++]=st;return M},hermiteFastResize:function(g,m,v,b,w){for(var S=this.rcpScaleX,A=this.rcpScaleY,D=u(S/2),X=u(A/2),K=g.imageData,$=K.data,H=g.ctx.createImageData(b,w),J=H.data,Z=0;Z<w;Z++)for(var Q=0;Q<b;Q++){for(var rt=(Q+Z*b)*4,st=0,T=0,k=0,P=0,E=0,B=0,O=0,x=(Z+.5)*A,M=l(Z*A);M<(Z+1)*A;M++)for(var R=r(x-(M+.5))/X,Y=(Q+.5)*S,j=R*R,G=l(Q*S);G<(Q+1)*S;G++){var I=r(Y-(G+.5))/D,tt=n(j+I*I);tt>1&&tt<-1||(st=2*tt*tt*tt-3*tt*tt+1,st>0&&(I=4*(G+M*m),O+=st*$[I+3],k+=st,$[I+3]<255&&(st=st*$[I+3]/250),P+=st*$[I],E+=st*$[I+1],B+=st*$[I+2],T+=st))}J[rt]=P/T,J[rt+1]=E/T,J[rt+2]=B/T,J[rt+3]=O/k}return H},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),e.Image.filters.Resize.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.Image.filters,l=e.util.createClass;o.Contrast=l(o.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(n){if(this.contrast!==0){var r=n.imageData,i,u,a=r.data,u=a.length,s=Math.floor(this.contrast*255),f=259*(s+255)/(255*(259-s));for(i=0;i<u;i+=4)a[i]=f*(a[i]-128)+128,a[i+1]=f*(a[i+1]-128)+128,a[i+2]=f*(a[i+2]-128)+128}},getUniformLocations:function(n,r){return{uContrast:n.getUniformLocation(r,"uContrast")}},sendUniformData:function(n,r){n.uniform1f(r.uContrast,this.contrast)}}),e.Image.filters.Contrast.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.Image.filters,l=e.util.createClass;o.Saturation=l(o.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(n){if(this.saturation!==0){var r=n.imageData,i=r.data,a=i.length,u=-this.saturation,s,f;for(s=0;s<a;s+=4)f=Math.max(i[s],i[s+1],i[s+2]),i[s]+=f!==i[s]?(f-i[s])*u:0,i[s+1]+=f!==i[s+1]?(f-i[s+1])*u:0,i[s+2]+=f!==i[s+2]?(f-i[s+2])*u:0}},getUniformLocations:function(n,r){return{uSaturation:n.getUniformLocation(r,"uSaturation")}},sendUniformData:function(n,r){n.uniform1f(r.uSaturation,-this.saturation)}}),e.Image.filters.Saturation.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.Image.filters,l=e.util.createClass;o.Vibrance=l(o.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(n){if(this.vibrance!==0){var r=n.imageData,i=r.data,a=i.length,u=-this.vibrance,s,f,g,m;for(s=0;s<a;s+=4)f=Math.max(i[s],i[s+1],i[s+2]),g=(i[s]+i[s+1]+i[s+2])/3,m=Math.abs(f-g)*2/255*u,i[s]+=f!==i[s]?(f-i[s])*m:0,i[s+1]+=f!==i[s+1]?(f-i[s+1])*m:0,i[s+2]+=f!==i[s+2]?(f-i[s+2])*m:0}},getUniformLocations:function(n,r){return{uVibrance:n.getUniformLocation(r,"uVibrance")}},sendUniformData:function(n,r){n.uniform1f(r.uVibrance,-this.vibrance)}}),e.Image.filters.Vibrance.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.Image.filters,l=e.util.createClass;o.Blur=l(o.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(n){n.webgl?(this.aspectRatio=n.sourceWidth/n.sourceHeight,n.passes++,this._setupFrameBuffer(n),this.horizontal=!0,this.applyToWebGL(n),this._swapTextures(n),this._setupFrameBuffer(n),this.horizontal=!1,this.applyToWebGL(n),this._swapTextures(n)):this.applyTo2d(n)},applyTo2d:function(n){n.imageData=this.simpleBlur(n)},simpleBlur:function(n){var r=n.filterBackend.resources,i,a,u=n.imageData.width,s=n.imageData.height;r.blurLayer1||(r.blurLayer1=e.util.createCanvasElement(),r.blurLayer2=e.util.createCanvasElement()),i=r.blurLayer1,a=r.blurLayer2,(i.width!==u||i.height!==s)&&(a.width=i.width=u,a.height=i.height=s);var f=i.getContext("2d"),g=a.getContext("2d"),m=15,v,b,w,S,A=this.blur*.06*.5;for(f.putImageData(n.imageData,0,0),g.clearRect(0,0,u,s),S=-m;S<=m;S++)v=(Math.random()-.5)/4,b=S/m,w=A*b*u+v,g.globalAlpha=1-Math.abs(b),g.drawImage(i,w,v),f.drawImage(a,0,0),g.globalAlpha=1,g.clearRect(0,0,a.width,a.height);for(S=-m;S<=m;S++)v=(Math.random()-.5)/4,b=S/m,w=A*b*s+v,g.globalAlpha=1-Math.abs(b),g.drawImage(i,v,w),f.drawImage(a,0,0),g.globalAlpha=1,g.clearRect(0,0,a.width,a.height);n.ctx.drawImage(i,0,0);var D=n.ctx.getImageData(0,0,i.width,i.height);return f.globalAlpha=1,f.clearRect(0,0,i.width,i.height),D},getUniformLocations:function(n,r){return{delta:n.getUniformLocation(r,"uDelta")}},sendUniformData:function(n,r){var i=this.chooseRightDelta();n.uniform2fv(r.delta,i)},chooseRightDelta:function(){var n=1,r=[0,0],i;return this.horizontal?this.aspectRatio>1&&(n=1/this.aspectRatio):this.aspectRatio<1&&(n=this.aspectRatio),i=n*this.blur*.12,this.horizontal?r[0]=i:r[1]=i,r}}),o.Blur.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.Image.filters,l=e.util.createClass;o.Gamma=l(o.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(n){this.gamma=[1,1,1],o.BaseFilter.prototype.initialize.call(this,n)},applyTo2d:function(n){var r=n.imageData,i=r.data,a=this.gamma,u=i.length,s=1/a[0],f=1/a[1],g=1/a[2],m;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),m=0,u=256;m<u;m++)this.rVals[m]=Math.pow(m/255,s)*255,this.gVals[m]=Math.pow(m/255,f)*255,this.bVals[m]=Math.pow(m/255,g)*255;for(m=0,u=i.length;m<u;m+=4)i[m]=this.rVals[i[m]],i[m+1]=this.gVals[i[m+1]],i[m+2]=this.bVals[i[m+2]]},getUniformLocations:function(n,r){return{uGamma:n.getUniformLocation(r,"uGamma")}},sendUniformData:function(n,r){n.uniform3fv(r.uGamma,this.gamma)}}),e.Image.filters.Gamma.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.Image.filters,l=e.util.createClass;o.Composed=l(o.BaseFilter,{type:"Composed",subFilters:[],initialize:function(n){this.callSuper("initialize",n),this.subFilters=this.subFilters.slice(0)},applyTo:function(n){n.passes+=this.subFilters.length-1,this.subFilters.forEach(function(r){r.applyTo(n)})},toObject:function(){return e.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(n){return n.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(n){return!n.isNeutralState()})}}),e.Image.filters.Composed.fromObject=function(n,r){var i=n.subFilters||[],a=i.map(function(s){return new e.Image.filters[s.type](s)}),u=new e.Image.filters.Composed({subFilters:a});return r&&r(u),u}}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.Image.filters,l=e.util.createClass;o.HueRotation=l(o.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var n=this.rotation*Math.PI,r=e.util.cos(n),i=e.util.sin(n),a=1/3,u=Math.sqrt(a)*i,s=1-r;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=r+s/3,this.matrix[1]=a*s-u,this.matrix[2]=a*s+u,this.matrix[5]=a*s+u,this.matrix[6]=r+a*s,this.matrix[7]=a*s-u,this.matrix[10]=a*s-u,this.matrix[11]=a*s+u,this.matrix[12]=r+a*s},isNeutralState:function(n){return this.calculateMatrix(),o.BaseFilter.prototype.isNeutralState.call(this,n)},applyTo:function(n){this.calculateMatrix(),o.BaseFilter.prototype.applyTo.call(this,n)}}),e.Image.filters.HueRotation.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),o=e.util.object.clone;if(e.Text){e.warn("fabric.Text is already defined");return}var l="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");e.Text=e.util.createClass(e.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:e.Object.prototype.stateProperties.concat(l),cacheProperties:e.Object.prototype.cacheProperties.concat(l),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(n,r){this.styles=r?r.styles||{}:{},this.text=n,this.__skipDimension=!0,this.callSuper("initialize",r),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var n=this.path;n&&(n.segmentsInfo=e.util.getPathSegmentsInfo(n.path))},getMeasuringContext:function(){return e._measuringContext||(e._measuringContext=this.canvas&&this.canvas.contextCache||e.util.createCanvasElement().getContext("2d")),e._measuringContext},_splitText:function(){var n=this._splitTextIntoLines(this.text);return this.textLines=n.lines,this._textLines=n.graphemeLines,this._unwrappedTextLines=n._unwrappedLines,this._text=n.graphemeText,n},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var n,r,i,a,u,s,f,g=0,m=this._textLines.length;g<m;g++)if(!(this.textAlign!=="justify"&&(g===m-1||this.isEndOfWrapping(g)))&&(a=0,u=this._textLines[g],r=this.getLineWidth(g),r<this.width&&(f=this.textLines[g].match(this._reSpacesAndTabs)))){i=f.length,n=(this.width-r)/i;for(var v=0,b=u.length;v<=b;v++)s=this.__charBounds[g][v],this._reSpaceAndTab.test(u[v])?(s.width+=n,s.kernedWidth+=n,s.left+=a,a+=n):s.left+=a}},isEndOfWrapping:function(n){return n===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var n=this.callSuper("_getCacheCanvasDimensions"),r=this.fontSize;return n.width+=r*n.zoomX,n.height+=r*n.zoomY,n},_render:function(n){var r=this.path;r&&!r.isNotVisible()&&r._render(n),this._setTextStyles(n),this._renderTextLinesBackground(n),this._renderTextDecoration(n,"underline"),this._renderText(n),this._renderTextDecoration(n,"overline"),this._renderTextDecoration(n,"linethrough")},_renderText:function(n){this.paintFirst==="stroke"?(this._renderTextStroke(n),this._renderTextFill(n)):(this._renderTextFill(n),this._renderTextStroke(n))},_setTextStyles:function(n,r,i){if(n.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":n.textBaseline="middle";break;case"ascender":n.textBaseline="top";break;case"descender":n.textBaseline="bottom";break}n.font=this._getFontDeclaration(r,i)},calcTextWidth:function(){for(var n=this.getLineWidth(0),r=1,i=this._textLines.length;r<i;r++){var a=this.getLineWidth(r);a>n&&(n=a)}return n},_renderTextLine:function(n,r,i,a,u,s){this._renderChars(n,r,i,a,u,s)},_renderTextLinesBackground:function(n){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var r,i,a=n.fillStyle,u,s,f=this._getLeftOffset(),g=this._getTopOffset(),m=0,v=0,b,w,S=this.path,A,D=0,X=this._textLines.length;D<X;D++){if(r=this.getHeightOfLine(D),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",D)){g+=r;continue}u=this._textLines[D],i=this._getLineLeftOffset(D),v=0,m=0,s=this.getValueOfPropertyAt(D,0,"textBackgroundColor");for(var K=0,$=u.length;K<$;K++)b=this.__charBounds[D][K],w=this.getValueOfPropertyAt(D,K,"textBackgroundColor"),S?(n.save(),n.translate(b.renderLeft,b.renderTop),n.rotate(b.angle),n.fillStyle=w,w&&n.fillRect(-b.width/2,-r/this.lineHeight*(1-this._fontSizeFraction),b.width,r/this.lineHeight),n.restore()):w!==s?(A=f+i+m,this.direction==="rtl"&&(A=this.width-A-v),n.fillStyle=s,s&&n.fillRect(A,g,v,r/this.lineHeight),m=b.left,v=b.width,s=w):v+=b.kernedWidth;w&&!S&&(A=f+i+m,this.direction==="rtl"&&(A=this.width-A-v),n.fillStyle=w,n.fillRect(A,g,v,r/this.lineHeight)),g+=r}n.fillStyle=a,this._removeShadow(n)}},getFontCache:function(n){var r=n.fontFamily.toLowerCase();e.charWidthsCache[r]||(e.charWidthsCache[r]={});var i=e.charWidthsCache[r],a=n.fontStyle.toLowerCase()+"_"+(n.fontWeight+"").toLowerCase();return i[a]||(i[a]={}),i[a]},_measureChar:function(n,r,i,a){var u=this.getFontCache(r),s=this._getFontDeclaration(r),f=this._getFontDeclaration(a),g=i+n,m=s===f,v,b,w,S=r.fontSize/this.CACHE_FONT_SIZE,A;if(i&&u[i]!==void 0&&(w=u[i]),u[n]!==void 0&&(A=v=u[n]),m&&u[g]!==void 0&&(b=u[g],A=b-w),v===void 0||w===void 0||b===void 0){var D=this.getMeasuringContext();this._setTextStyles(D,r,!0)}return v===void 0&&(A=v=D.measureText(n).width,u[n]=v),w===void 0&&m&&i&&(w=D.measureText(i).width,u[i]=w),m&&b===void 0&&(b=D.measureText(g).width,u[g]=b,A=b-w),{width:v*S,kernedWidth:A*S}},getHeightOfChar:function(n,r){return this.getValueOfPropertyAt(n,r,"fontSize")},measureLine:function(n){var r=this._measureLine(n);return this.charSpacing!==0&&(r.width-=this._getWidthOfCharSpacing()),r.width<0&&(r.width=0),r},_measureLine:function(n){var r=0,i,a,u=this._textLines[n],s,f,g=0,m=new Array(u.length),v=0,b,w,S=this.path,A=this.pathSide==="right";for(this.__charBounds[n]=m,i=0;i<u.length;i++)a=u[i],f=this._getGraphemeBox(a,n,i,s),m[i]=f,r+=f.kernedWidth,s=a;if(m[i]={left:f?f.left+f.width:0,width:0,kernedWidth:0,height:this.fontSize},S){switch(w=S.segmentsInfo[S.segmentsInfo.length-1].length,b=e.util.getPointOnPath(S.path,0,S.segmentsInfo),b.x+=S.pathOffset.x,b.y+=S.pathOffset.y,this.textAlign){case"left":v=A?w-r:0;break;case"center":v=(w-r)/2;break;case"right":v=A?0:w-r;break}for(v+=this.pathStartOffset*(A?-1:1),i=A?u.length-1:0;A?i>=0:i<u.length;A?i--:i++)f=m[i],v>w?v%=w:v<0&&(v+=w),this._setGraphemeOnPath(v,f,b),v+=f.kernedWidth}return{width:r,numOfSpaces:g}},_setGraphemeOnPath:function(n,r,i){var a=n+r.kernedWidth/2,u=this.path,s=e.util.getPointOnPath(u.path,a,u.segmentsInfo);r.renderLeft=s.x-i.x,r.renderTop=s.y-i.y,r.angle=s.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(n,r,i,a,u){var s=this.getCompleteStyleDeclaration(r,i),f=a?this.getCompleteStyleDeclaration(r,i-1):{},g=this._measureChar(n,s,a,f),m=g.kernedWidth,v=g.width,b;this.charSpacing!==0&&(b=this._getWidthOfCharSpacing(),v+=b,m+=b);var w={width:v,left:0,height:s.fontSize,kernedWidth:m,deltaY:s.deltaY};if(i>0&&!u){var S=this.__charBounds[r][i-1];w.left=S.left+S.width+g.kernedWidth-g.width}return w},getHeightOfLine:function(n){if(this.__lineHeights[n])return this.__lineHeights[n];for(var r=this._textLines[n],i=this.getHeightOfChar(n,0),a=1,u=r.length;a<u;a++)i=Math.max(this.getHeightOfChar(n,a),i);return this.__lineHeights[n]=i*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var n,r=0,i=0,a=this._textLines.length;i<a;i++)n=this.getHeightOfLine(i),r+=i===a-1?n/this.lineHeight:n;return r},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(n,r){n.save();for(var i=0,a=this._getLeftOffset(),u=this._getTopOffset(),s=0,f=this._textLines.length;s<f;s++){var g=this.getHeightOfLine(s),m=g/this.lineHeight,v=this._getLineLeftOffset(s);this._renderTextLine(r,n,this._textLines[s],a+v,u+i+m,s),i+=g}n.restore()},_renderTextFill:function(n){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(n,"fillText")},_renderTextStroke:function(n){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(n),n.save(),this._setLineDash(n,this.strokeDashArray),n.beginPath(),this._renderTextCommon(n,"strokeText"),n.closePath(),n.restore())},_renderChars:function(n,r,i,a,u,s){var f=this.getHeightOfLine(s),g=this.textAlign.indexOf("justify")!==-1,m,v,b="",w,S=0,A,D=this.path,X=!g&&this.charSpacing===0&&this.isEmptyStyles(s)&&!D,K=this.direction==="ltr",$=this.direction==="ltr"?1:-1,H,J=r.canvas.getAttribute("dir");if(r.save(),J!==this.direction&&(r.canvas.setAttribute("dir",K?"ltr":"rtl"),r.direction=K?"ltr":"rtl",r.textAlign=K?"left":"right"),u-=f*this._fontSizeFraction/this.lineHeight,X){this._renderChar(n,r,s,0,i.join(""),a,u,f),r.restore();return}for(var Z=0,Q=i.length-1;Z<=Q;Z++)A=Z===Q||this.charSpacing||D,b+=i[Z],w=this.__charBounds[s][Z],S===0?(a+=$*(w.kernedWidth-w.width),S+=w.width):S+=w.kernedWidth,g&&!A&&this._reSpaceAndTab.test(i[Z])&&(A=!0),A||(m=m||this.getCompleteStyleDeclaration(s,Z),v=this.getCompleteStyleDeclaration(s,Z+1),A=e.util.hasStyleChanged(m,v,!1)),A&&(D?(r.save(),r.translate(w.renderLeft,w.renderTop),r.rotate(w.angle),this._renderChar(n,r,s,Z,b,-S/2,0,f),r.restore()):(H=a,this._renderChar(n,r,s,Z,b,H,u,f)),b="",m=v,a+=$*S,S=0);r.restore()},_applyPatternGradientTransformText:function(n){var r=e.util.createCanvasElement(),i,a=this.width+this.strokeWidth,u=this.height+this.strokeWidth;return r.width=a,r.height=u,i=r.getContext("2d"),i.beginPath(),i.moveTo(0,0),i.lineTo(a,0),i.lineTo(a,u),i.lineTo(0,u),i.closePath(),i.translate(a/2,u/2),i.fillStyle=n.toLive(i),this._applyPatternGradientTransform(i,n),i.fill(),i.createPattern(r,"no-repeat")},handleFiller:function(n,r,i){var a,u;return i.toLive?i.gradientUnits==="percentage"||i.gradientTransform||i.patternTransform?(a=-this.width/2,u=-this.height/2,n.translate(a,u),n[r]=this._applyPatternGradientTransformText(i),{offsetX:a,offsetY:u}):(n[r]=i.toLive(n,this),this._applyPatternGradientTransform(n,i)):(n[r]=i,{offsetX:0,offsetY:0})},_setStrokeStyles:function(n,r){return n.lineWidth=r.strokeWidth,n.lineCap=this.strokeLineCap,n.lineDashOffset=this.strokeDashOffset,n.lineJoin=this.strokeLineJoin,n.miterLimit=this.strokeMiterLimit,this.handleFiller(n,"strokeStyle",r.stroke)},_setFillStyles:function(n,r){return this.handleFiller(n,"fillStyle",r.fill)},_renderChar:function(n,r,i,a,u,s,f){var g=this._getStyleDeclaration(i,a),m=this.getCompleteStyleDeclaration(i,a),v=n==="fillText"&&m.fill,b=n==="strokeText"&&m.stroke&&m.strokeWidth,w,S;!b&&!v||(r.save(),v&&(w=this._setFillStyles(r,m)),b&&(S=this._setStrokeStyles(r,m)),r.font=this._getFontDeclaration(m),g&&g.textBackgroundColor&&this._removeShadow(r),g&&g.deltaY&&(f+=g.deltaY),v&&r.fillText(u,s-w.offsetX,f-w.offsetY),b&&r.strokeText(u,s-S.offsetX,f-S.offsetY),r.restore())},setSuperscript:function(n,r){return this._setScript(n,r,this.superscript)},setSubscript:function(n,r){return this._setScript(n,r,this.subscript)},_setScript:function(n,r,i){var a=this.get2DCursorLocation(n,!0),u=this.getValueOfPropertyAt(a.lineIndex,a.charIndex,"fontSize"),s=this.getValueOfPropertyAt(a.lineIndex,a.charIndex,"deltaY"),f={fontSize:u*i.size,deltaY:s+u*i.baseline};return this.setSelectionStyles(f,n,r),this},_getLineLeftOffset:function(n){var r=this.getLineWidth(n),i=this.width-r,a=this.textAlign,u=this.direction,f,s=0,f=this.isEndOfWrapping(n);return a==="justify"||a==="justify-center"&&!f||a==="justify-right"&&!f||a==="justify-left"&&!f?0:(a==="center"&&(s=i/2),a==="right"&&(s=i),a==="justify-center"&&(s=i/2),a==="justify-right"&&(s=i),u==="rtl"&&(s-=i),s)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var n=this._forceClearCache;return n||(n=this.hasStateChanged("_dimensionAffectingProps")),n&&(this.dirty=!0,this._forceClearCache=!1),n},getLineWidth:function(n){if(this.__lineWidths[n]!==void 0)return this.__lineWidths[n];var r=this.measureLine(n),i=r.width;return this.__lineWidths[n]=i,i},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(n,r,i){var a=this._getStyleDeclaration(n,r);return a&&typeof a[i]<"u"?a[i]:this[i]},_renderTextDecoration:function(n,r){if(!(!this[r]&&!this.styleHas(r))){for(var i,a,u,s,f,g,m,v,b=this._getLeftOffset(),w=this._getTopOffset(),S,A,D,X,K,$,H,J,Z=this.path,Q=this._getWidthOfCharSpacing(),rt=this.offsets[r],st=0,T=this._textLines.length;st<T;st++){if(i=this.getHeightOfLine(st),!this[r]&&!this.styleHas(r,st)){w+=i;continue}m=this._textLines[st],$=i/this.lineHeight,s=this._getLineLeftOffset(st),A=0,D=0,v=this.getValueOfPropertyAt(st,0,r),J=this.getValueOfPropertyAt(st,0,"fill"),S=w+$*(1-this._fontSizeFraction),a=this.getHeightOfChar(st,0),f=this.getValueOfPropertyAt(st,0,"deltaY");for(var k=0,P=m.length;k<P;k++)if(X=this.__charBounds[st][k],K=this.getValueOfPropertyAt(st,k,r),H=this.getValueOfPropertyAt(st,k,"fill"),u=this.getHeightOfChar(st,k),g=this.getValueOfPropertyAt(st,k,"deltaY"),Z&&K&&H)n.save(),n.fillStyle=J,n.translate(X.renderLeft,X.renderTop),n.rotate(X.angle),n.fillRect(-X.kernedWidth/2,rt*u+g,X.kernedWidth,this.fontSize/15),n.restore();else if((K!==v||H!==J||u!==a||g!==f)&&D>0){var E=b+s+A;this.direction==="rtl"&&(E=this.width-E-D),v&&J&&(n.fillStyle=J,n.fillRect(E,S+rt*a+f,D,this.fontSize/15)),A=X.left,D=X.width,v=K,J=H,a=u,f=g}else D+=X.kernedWidth;var E=b+s+A;this.direction==="rtl"&&(E=this.width-E-D),n.fillStyle=H,K&&H&&n.fillRect(E,S+rt*a+f,D-Q,this.fontSize/15),w+=i}this._removeShadow(n)}},_getFontDeclaration:function(n,r){var i=n||this,a=this.fontFamily,u=e.Text.genericFonts.indexOf(a.toLowerCase())>-1,s=a===void 0||a.indexOf("'")>-1||a.indexOf(",")>-1||a.indexOf('"')>-1||u?i.fontFamily:'"'+i.fontFamily+'"';return[e.isLikelyNode?i.fontWeight:i.fontStyle,e.isLikelyNode?i.fontStyle:i.fontWeight,r?this.CACHE_FONT_SIZE+"px":i.fontSize+"px",s].join(" ")},render:function(n){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",n)))},_splitTextIntoLines:function(n){for(var r=n.split(this._reNewline),i=new Array(r.length),a=[`
`],u=[],s=0;s<r.length;s++)i[s]=e.util.string.graphemeSplit(r[s]),u=u.concat(i[s],a);return u.pop(),{_unwrappedLines:i,lines:r,graphemeText:u,graphemeLines:i}},toObject:function(n){var r=l.concat(n),i=this.callSuper("toObject",r);return i.styles=e.util.stylesToArray(this.styles,this.text),i.path&&(i.path=this.path.toObject()),i},set:function(n,r){this.callSuper("set",n,r);var i=!1,a=!1;if(typeof n=="object")for(var u in n)u==="path"&&this.setPathInfo(),i=i||this._dimensionAffectingProps.indexOf(u)!==-1,a=a||u==="path";else i=this._dimensionAffectingProps.indexOf(n)!==-1,a=n==="path";return a&&this.setPathInfo(),i&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),e.Text.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),e.Text.DEFAULT_SVG_FONT_SIZE=16,e.Text.fromElement=function(n,r,i){if(!n)return r(null);var a=e.parseAttributes(n,e.Text.ATTRIBUTE_NAMES),u=a.textAnchor||"left";if(i=e.util.object.extend(i?o(i):{},a),i.top=i.top||0,i.left=i.left||0,a.textDecoration){var s=a.textDecoration;s.indexOf("underline")!==-1&&(i.underline=!0),s.indexOf("overline")!==-1&&(i.overline=!0),s.indexOf("line-through")!==-1&&(i.linethrough=!0),delete i.textDecoration}"dx"in a&&(i.left+=a.dx),"dy"in a&&(i.top+=a.dy),"fontSize"in i||(i.fontSize=e.Text.DEFAULT_SVG_FONT_SIZE);var f="";"textContent"in n?f=n.textContent:"firstChild"in n&&n.firstChild!==null&&"data"in n.firstChild&&n.firstChild.data!==null&&(f=n.firstChild.data),f=f.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var g=i.strokeWidth;i.strokeWidth=0;var m=new e.Text(f,i),v=m.getScaledHeight()/m.height,b=(m.height+m.strokeWidth)*m.lineHeight-m.height,w=b*v,S=m.getScaledHeight()+w,A=0;u==="center"&&(A=m.getScaledWidth()/2),u==="right"&&(A=m.getScaledWidth()),m.set({left:m.left-A,top:m.top-(S-m.fontSize*(.07+m._fontSizeFraction))/m.lineHeight,strokeWidth:typeof g<"u"?g:1}),r(m)},e.Text.fromObject=function(n,r){var i=o(n),a=n.path;return delete i.path,e.Object._fromObject("Text",i,function(u){u.styles=e.util.stylesFromArray(n.styles,n.text),a?e.Object._fromObject("Path",a,function(s){u.set("path",s),r(u)},"path"):r(u)},"text")},e.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],e.util.createAccessors&&e.util.createAccessors(e.Text)}(c),function(){t.util.object.extend(t.Text.prototype,{isEmptyStyles:function(h){if(!this.styles||typeof h<"u"&&!this.styles[h])return!0;var e=typeof h>"u"?this.styles:{line:this.styles[h]};for(var o in e)for(var l in e[o])for(var n in e[o][l])return!1;return!0},styleHas:function(h,e){if(!this.styles||!h||h===""||typeof e<"u"&&!this.styles[e])return!1;var o=typeof e>"u"?this.styles:{0:this.styles[e]};for(var l in o)for(var n in o[l])if(typeof o[l][n][h]<"u")return!0;return!1},cleanStyle:function(h){if(!this.styles||!h||h==="")return!1;var e=this.styles,o=0,l,n,r=!0,i=0,a;for(var u in e){l=0;for(var s in e[u]){var a=e[u][s],f=a.hasOwnProperty(h);o++,f?(n?a[h]!==n&&(r=!1):n=a[h],a[h]===this[h]&&delete a[h]):r=!1,Object.keys(a).length!==0?l++:delete e[u][s]}l===0&&delete e[u]}for(var g=0;g<this._textLines.length;g++)i+=this._textLines[g].length;r&&o===i&&(this[h]=n,this.removeStyle(h))},removeStyle:function(h){if(!(!this.styles||!h||h==="")){var e=this.styles,o,l,n;for(l in e){o=e[l];for(n in o)delete o[n][h],Object.keys(o[n]).length===0&&delete o[n];Object.keys(o).length===0&&delete e[l]}}},_extendStyles:function(h,e){var o=this.get2DCursorLocation(h);this._getLineStyle(o.lineIndex)||this._setLineStyle(o.lineIndex),this._getStyleDeclaration(o.lineIndex,o.charIndex)||this._setStyleDeclaration(o.lineIndex,o.charIndex,{}),t.util.object.extend(this._getStyleDeclaration(o.lineIndex,o.charIndex),e)},get2DCursorLocation:function(h,e){typeof h>"u"&&(h=this.selectionStart);for(var o=e?this._unwrappedTextLines:this._textLines,l=o.length,n=0;n<l;n++){if(h<=o[n].length)return{lineIndex:n,charIndex:h};h-=o[n].length+this.missingNewlineOffset(n)}return{lineIndex:n-1,charIndex:o[n-1].length<h?o[n-1].length:h}},getSelectionStyles:function(h,e,o){typeof h>"u"&&(h=this.selectionStart||0),typeof e>"u"&&(e=this.selectionEnd||h);for(var l=[],n=h;n<e;n++)l.push(this.getStyleAtPosition(n,o));return l},getStyleAtPosition:function(h,e){var o=this.get2DCursorLocation(h),l=e?this.getCompleteStyleDeclaration(o.lineIndex,o.charIndex):this._getStyleDeclaration(o.lineIndex,o.charIndex);return l||{}},setSelectionStyles:function(h,e,o){typeof e>"u"&&(e=this.selectionStart||0),typeof o>"u"&&(o=this.selectionEnd||e);for(var l=e;l<o;l++)this._extendStyles(l,h);return this._forceClearCache=!0,this},_getStyleDeclaration:function(h,e){var o=this.styles&&this.styles[h];return o?o[e]:null},getCompleteStyleDeclaration:function(h,e){for(var o=this._getStyleDeclaration(h,e)||{},l={},n,r=0;r<this._styleProperties.length;r++)n=this._styleProperties[r],l[n]=typeof o[n]>"u"?this[n]:o[n];return l},_setStyleDeclaration:function(h,e,o){this.styles[h][e]=o},_deleteStyleDeclaration:function(h,e){delete this.styles[h][e]},_getLineStyle:function(h){return!!this.styles[h]},_setLineStyle:function(h){this.styles[h]={}},_deleteLineStyle:function(h){delete this.styles[h]}})}(),function(){function h(e){e.textDecoration&&(e.textDecoration.indexOf("underline")>-1&&(e.underline=!0),e.textDecoration.indexOf("line-through")>-1&&(e.linethrough=!0),e.textDecoration.indexOf("overline")>-1&&(e.overline=!0),delete e.textDecoration)}t.IText=t.util.createClass(t.Text,t.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(e,o){this.callSuper("initialize",e,o),this.initBehavior()},setSelectionStart:function(e){e=Math.max(e,0),this._updateAndFire("selectionStart",e)},setSelectionEnd:function(e){e=Math.min(e,this.text.length),this._updateAndFire("selectionEnd",e)},_updateAndFire:function(e,o){this[e]!==o&&(this._fireSelectionChanged(),this[e]=o),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(e){this.clearContextTop(),this.callSuper("render",e),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(e){this.callSuper("_render",e)},clearContextTop:function(e){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var o=this.canvas.contextTop,l=this.canvas.viewportTransform;o.save(),o.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this.transform(o),this._clearTextArea(o),e||o.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var e=this._getCursorBoundaries(),o=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(e,o):this.renderSelection(e,o),o.restore()}},_clearTextArea:function(e){var o=this.width+4,l=this.height+4;e.clearRect(-o/2,-l/2,o,l)},_getCursorBoundaries:function(e){typeof e>"u"&&(e=this.selectionStart);var o=this._getLeftOffset(),l=this._getTopOffset(),n=this._getCursorBoundariesOffsets(e);return{left:o,top:l,leftOffset:n.left,topOffset:n.top}},_getCursorBoundariesOffsets:function(e){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var o,l,n,r=0,i=0,a,u=this.get2DCursorLocation(e);n=u.charIndex,l=u.lineIndex;for(var s=0;s<l;s++)r+=this.getHeightOfLine(s);o=this._getLineLeftOffset(l);var f=this.__charBounds[l][n];return f&&(i=f.left),this.charSpacing!==0&&n===this._textLines[l].length&&(i-=this._getWidthOfCharSpacing()),a={top:r,left:o+(i>0?i:0)},this.direction==="rtl"&&(a.left*=-1),this.cursorOffsetCache=a,this.cursorOffsetCache},renderCursor:function(e,o){var l=this.get2DCursorLocation(),n=l.lineIndex,r=l.charIndex>0?l.charIndex-1:0,i=this.getValueOfPropertyAt(n,r,"fontSize"),a=this.scaleX*this.canvas.getZoom(),u=this.cursorWidth/a,s=e.topOffset,f=this.getValueOfPropertyAt(n,r,"deltaY");s+=(1-this._fontSizeFraction)*this.getHeightOfLine(n)/this.lineHeight-i*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(e,o),o.fillStyle=this.cursorColor||this.getValueOfPropertyAt(n,r,"fill"),o.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,o.fillRect(e.left+e.leftOffset-u/2,s+e.top+f,u,i)},renderSelection:function(e,o){for(var l=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,n=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,r=this.textAlign.indexOf("justify")!==-1,i=this.get2DCursorLocation(l),a=this.get2DCursorLocation(n),u=i.lineIndex,s=a.lineIndex,f=i.charIndex<0?0:i.charIndex,g=a.charIndex<0?0:a.charIndex,m=u;m<=s;m++){var v=this._getLineLeftOffset(m)||0,b=this.getHeightOfLine(m),w=0,S=0,A=0;if(m===u&&(S=this.__charBounds[u][f].left),m>=u&&m<s)A=r&&!this.isEndOfWrapping(m)?this.width:this.getLineWidth(m)||5;else if(m===s)if(g===0)A=this.__charBounds[s][g].left;else{var D=this._getWidthOfCharSpacing();A=this.__charBounds[s][g-1].left+this.__charBounds[s][g-1].width-D}w=b,(this.lineHeight<1||m===s&&this.lineHeight>1)&&(b/=this.lineHeight);var X=e.left+v+S,K=A-S,$=b,H=0;this.inCompositionMode?(o.fillStyle=this.compositionColor||"black",$=1,H=b):o.fillStyle=this.selectionColor,this.direction==="rtl"&&(X=this.width-X-K),o.fillRect(X,e.top+e.topOffset+H,K,$),e.topOffset+=w}},getCurrentCharFontSize:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fontSize")},getCurrentCharColor:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fill")},_getCurrentCharIndex:function(){var e=this.get2DCursorLocation(this.selectionStart,!0),o=e.charIndex>0?e.charIndex-1:0;return{l:e.lineIndex,c:o}}}),t.IText.fromObject=function(e,o){var l=t.util.stylesFromArray(e.styles,e.text),n=Object.assign({},e,{styles:l});if(h(n),n.styles)for(var r in n.styles)for(var i in n.styles[r])h(n.styles[r][i]);t.Object._fromObject("IText",n,o,"text")}}(),function(){var h=t.util.object.clone;t.util.object.extend(t.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var e=this;this.on("added",function(){var o=e.canvas;o&&(o._hasITextHandlers||(o._hasITextHandlers=!0,e._initCanvasHandlers(o)),o._iTextInstances=o._iTextInstances||[],o._iTextInstances.push(e))})},initRemovedHandler:function(){var e=this;this.on("removed",function(){var o=e.canvas;o&&(o._iTextInstances=o._iTextInstances||[],t.util.removeFromArray(o._iTextInstances,e),o._iTextInstances.length===0&&(o._hasITextHandlers=!1,e._removeCanvasHandlers(o)))})},_initCanvasHandlers:function(e){e._mouseUpITextHandler=function(){e._iTextInstances&&e._iTextInstances.forEach(function(o){o.__isMousedown=!1})},e.on("mouse:up",e._mouseUpITextHandler)},_removeCanvasHandlers:function(e){e.off("mouse:up",e._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(e,o,l,n){var r;return r={isAborted:!1,abort:function(){this.isAborted=!0}},e.animate("_currentCursorOpacity",o,{duration:l,onComplete:function(){r.isAborted||e[n]()},onChange:function(){e.canvas&&e.selectionStart===e.selectionEnd&&e.renderCursorOrSelection()},abort:function(){return r.isAborted}}),r},_onTickComplete:function(){var e=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){e._currentTickCompleteState=e._animateCursor(e,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(e){var o=this,l=e?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){o._tick()},l)},abortCursorAnimation:function(){var e=this._currentTickState||this._currentTickCompleteState,o=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,e&&o&&o.clearContext(o.contextTop||o.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(e){var o=0,l=e-1;if(this._reSpace.test(this._text[l]))for(;this._reSpace.test(this._text[l]);)o++,l--;for(;/\S/.test(this._text[l])&&l>-1;)o++,l--;return e-o},findWordBoundaryRight:function(e){var o=0,l=e;if(this._reSpace.test(this._text[l]))for(;this._reSpace.test(this._text[l]);)o++,l++;for(;/\S/.test(this._text[l])&&l<this._text.length;)o++,l++;return e+o},findLineBoundaryLeft:function(e){for(var o=0,l=e-1;!/\n/.test(this._text[l])&&l>-1;)o++,l--;return e-o},findLineBoundaryRight:function(e){for(var o=0,l=e;!/\n/.test(this._text[l])&&l<this._text.length;)o++,l++;return e+o},searchWordBoundary:function(e,o){for(var l=this._text,n=this._reSpace.test(l[e])?e-1:e,r=l[n],i=t.reNonWord;!i.test(r)&&n>0&&n<l.length;)n+=o,r=l[n];return i.test(r)&&(n+=o===1?0:1),n},selectWord:function(e){e=e||this.selectionStart;var o=this.searchWordBoundary(e,-1),l=this.searchWordBoundary(e,1);this.selectionStart=o,this.selectionEnd=l,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(e){e=e||this.selectionStart;var o=this.findLineBoundaryLeft(e),l=this.findLineBoundaryRight(e);return this.selectionStart=o,this.selectionEnd=l,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(e){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(e),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(e){e._iTextInstances&&e._iTextInstances.forEach(function(o){o.selected=!1,o.isEditing&&o.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(e){if(!(!this.__isMousedown||!this.isEditing)){document.activeElement!==this.hiddenTextarea&&this.hiddenTextarea.focus();var o=this.getSelectionStartFromPointer(e.e),l=this.selectionStart,n=this.selectionEnd;(o!==this.__selectionStartOnMouseDown||l===n)&&(l===o||n===o)||(o>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=o):(this.selectionStart=o,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==l||this.selectionEnd!==n)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(e,o,l){var n=l.slice(0,e),r=t.util.string.graphemeSplit(n).length;if(e===o)return{selectionStart:r,selectionEnd:r};var i=l.slice(e,o),a=t.util.string.graphemeSplit(i).length;return{selectionStart:r,selectionEnd:r+a}},fromGraphemeToStringSelection:function(e,o,l){var n=l.slice(0,e),r=n.join("").length;if(e===o)return{selectionStart:r,selectionEnd:r};var i=l.slice(e,o),a=i.join("").length;return{selectionStart:r,selectionEnd:r+a}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var e=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=e.selectionStart,this.hiddenTextarea.selectionEnd=e.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var e=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var e=this._calcTextareaPosition();this.hiddenTextarea.style.left=e.left,this.hiddenTextarea.style.top=e.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var e=this.inCompositionMode?this.compositionStart:this.selectionStart,o=this._getCursorBoundaries(e),l=this.get2DCursorLocation(e),n=l.lineIndex,r=l.charIndex,i=this.getValueOfPropertyAt(n,r,"fontSize")*this.lineHeight,a=o.leftOffset,u=this.calcTransformMatrix(),s={x:o.left+a,y:o.top+o.topOffset+i},f=this.canvas.getRetinaScaling(),g=this.canvas.upperCanvasEl,m=g.width/f,v=g.height/f,b=m-i,w=v-i,S=g.clientWidth/m,A=g.clientHeight/v;return s=t.util.transformPoint(s,u),s=t.util.transformPoint(s,this.canvas.viewportTransform),s.x*=S,s.y*=A,s.x<0&&(s.x=0),s.x>b&&(s.x=b),s.y<0&&(s.y=0),s.y>w&&(s.y=w),s.x+=this.canvas._offset.left,s.y+=this.canvas._offset.top,{left:s.x+"px",top:s.y+"px",fontSize:i+"px",charHeight:i}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var e=this._textBeforeEdit!==this.text,o=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,o&&(o.blur&&o.blur(),o.parentNode&&o.parentNode.removeChild(o)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),e&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),e&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var e in this.styles)this._textLines[e]||delete this.styles[e]},removeStyleFromTo:function(e,o){var l=this.get2DCursorLocation(e,!0),n=this.get2DCursorLocation(o,!0),r=l.lineIndex,i=l.charIndex,a=n.lineIndex,u=n.charIndex,s,f;if(r!==a){if(this.styles[r])for(s=i;s<this._unwrappedTextLines[r].length;s++)delete this.styles[r][s];if(this.styles[a])for(s=u;s<this._unwrappedTextLines[a].length;s++)f=this.styles[a][s],f&&(this.styles[r]||(this.styles[r]={}),this.styles[r][i+s-u]=f);for(s=r+1;s<=a;s++)delete this.styles[s];this.shiftLineStyles(a,r-a)}else if(this.styles[r]){f=this.styles[r];var g=u-i,m,v;for(s=i;s<u;s++)delete f[s];for(v in this.styles[r])m=parseInt(v,10),m>=u&&(f[m-g]=f[v],delete f[v])}},shiftLineStyles:function(e,o){var l=h(this.styles);for(var n in this.styles){var r=parseInt(n,10);r>e&&(this.styles[r+o]=l[r],l[r-o]||delete this.styles[r])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(e,o,l,n){var r,i={},a=!1,u=this._unwrappedTextLines[e].length===o;l||(l=1),this.shiftLineStyles(e,l),this.styles[e]&&(r=this.styles[e][o===0?o:o-1]);for(var s in this.styles[e]){var f=parseInt(s,10);f>=o&&(a=!0,i[f-o]=this.styles[e][s],u&&o===0||delete this.styles[e][s])}var g=!1;for(a&&!u&&(this.styles[e+l]=i,g=!0),g&&l--;l>0;)n&&n[l-1]?this.styles[e+l]={0:h(n[l-1])}:r?this.styles[e+l]={0:h(r)}:delete this.styles[e+l],l--;this._forceClearCache=!0},insertCharStyleObject:function(e,o,l,n){this.styles||(this.styles={});var r=this.styles[e],i=r?h(r):{};l||(l=1);for(var a in i){var u=parseInt(a,10);u>=o&&(r[u+l]=i[u],i[u-l]||delete r[u])}if(this._forceClearCache=!0,n){for(;l--;)Object.keys(n[l]).length&&(this.styles[e]||(this.styles[e]={}),this.styles[e][o+l]=h(n[l]));return}if(r)for(var s=r[o?o-1:1];s&&l--;)this.styles[e][o+l]=h(s)},insertNewStyleBlock:function(e,o,l){for(var n=this.get2DCursorLocation(o,!0),r=[0],i=0,a=0;a<e.length;a++)e[a]===`
`?(i++,r[i]=0):r[i]++;r[0]>0&&(this.insertCharStyleObject(n.lineIndex,n.charIndex,r[0],l),l=l&&l.slice(r[0]+1)),i&&this.insertNewlineStyleObject(n.lineIndex,n.charIndex+r[0],i);for(var a=1;a<i;a++)r[a]>0?this.insertCharStyleObject(n.lineIndex+a,0,r[a],l):l&&this.styles[n.lineIndex+a]&&l[0]&&(this.styles[n.lineIndex+a][0]=l[0]),l=l&&l.slice(r[a]+1);r[a]>0&&this.insertCharStyleObject(n.lineIndex+a,0,r[a],l)},setSelectionStartEndWithShift:function(e,o,l){l<=e?(o===e?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=e),this.selectionStart=l):l>e&&l<o?this._selectionDirection==="right"?this.selectionEnd=l:this.selectionStart=l:(o===e?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=o),this.selectionEnd=l)},setSelectionInBoundaries:function(){var e=this.text.length;this.selectionStart>e?this.selectionStart=e:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>e?this.selectionEnd=e:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),t.util.object.extend(t.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(h){if(this.canvas){this.__newClickTime=+new Date;var e=h.pointer;this.isTripleClick(e)&&(this.fire("tripleclick",h),this._stopEvent(h.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(h){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===h.x&&this.__lastPointer.y===h.y},_stopEvent:function(h){h.preventDefault&&h.preventDefault(),h.stopPropagation&&h.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(h){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(h.e))},tripleClickHandler:function(h){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(h.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(h){!this.canvas||!this.editable||h.e.button&&h.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(h.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(h){!this.canvas||!this.editable||h.e.button&&h.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(h){if(this.__isMousedown=!1,!(!this.editable||this.group||h.transform&&h.transform.actionPerformed||h.e.button&&h.e.button!==1)){if(this.canvas){var e=this.canvas._activeObject;if(e&&e!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(h.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(h){var e=this.getSelectionStartFromPointer(h),o=this.selectionStart,l=this.selectionEnd;h.shiftKey?this.setSelectionStartEndWithShift(o,l,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(h){for(var e=this.getLocalPointer(h),o=0,l=0,n=0,r=0,i=0,a,u,s=0,f=this._textLines.length;s<f&&n<=e.y;s++)n+=this.getHeightOfLine(s)*this.scaleY,i=s,s>0&&(r+=this._textLines[s-1].length+this.missingNewlineOffset(s-1));a=this._getLineLeftOffset(i),l=a*this.scaleX,u=this._textLines[i],this.direction==="rtl"&&(e.x=this.width*this.scaleX-e.x+l);for(var g=0,m=u.length;g<m&&(o=l,l+=this.__charBounds[i][g].kernedWidth*this.scaleX,l<=e.x);g++)r++;return this._getNewSelectionStartFromOffset(e,o,l,r,m)},_getNewSelectionStartFromOffset:function(h,e,o,l,n){var r=h.x-e,i=o-h.x,a=i>r||i<0?0:1,u=l+a;return this.flipX&&(u=n-u),u>this._text.length&&(u=this._text.length),u}}),t.util.object.extend(t.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=t.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var h=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+h.top+"; left: "+h.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: "+h.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):t.document.body.appendChild(this.hiddenTextarea),t.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),t.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),t.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),t.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(t.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(h){if(this.isEditing){var e=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(h.keyCode in e)this[e[h.keyCode]](h);else if(h.keyCode in this.ctrlKeysMapDown&&(h.ctrlKey||h.metaKey))this[this.ctrlKeysMapDown[h.keyCode]](h);else return;h.stopImmediatePropagation(),h.preventDefault(),h.keyCode>=33&&h.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(h){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(h.keyCode in this.ctrlKeysMapUp&&(h.ctrlKey||h.metaKey))this[this.ctrlKeysMapUp[h.keyCode]](h);else return;h.stopImmediatePropagation(),h.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(h){var e=this.fromPaste;if(this.fromPaste=!1,h&&h.stopPropagation(),!!this.isEditing){var o=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,l=this._text.length,n=o.length,r,i,a=n-l,u=this.selectionStart,s=this.selectionEnd,f=u!==s,g,m,v;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var b=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),w=u>b.selectionStart;f?(r=this._text.slice(u,s),a+=s-u):n<l&&(w?r=this._text.slice(s+a,s):r=this._text.slice(u,u-a)),i=o.slice(b.selectionEnd-a,b.selectionEnd),r&&r.length&&(i.length&&(g=this.getSelectionStyles(u,u+1,!1),g=i.map(function(){return g[0]})),f?(m=u,v=s):w?(m=s-r.length,v=s):(m=s,v=s+r.length),this.removeStyleFromTo(m,v)),i.length&&(e&&i.join("")===t.copiedText&&!t.disableStyleCopyPaste&&(g=t.copiedTextStyle),this.insertNewStyleBlock(i,u,g)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(h){this.compositionStart=h.target.selectionStart,this.compositionEnd=h.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(t.copiedText=this.getSelectedText(),t.disableStyleCopyPaste?t.copiedTextStyle=null:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(h){return h&&h.clipboardData||t.window.clipboardData},_getWidthBeforeCursor:function(h,e){var o=this._getLineLeftOffset(h),l;return e>0&&(l=this.__charBounds[h][e-1],o+=l.left+l.width),o},getDownCursorOffset:function(h,e){var o=this._getSelectionForOffset(h,e),l=this.get2DCursorLocation(o),n=l.lineIndex;if(n===this._textLines.length-1||h.metaKey||h.keyCode===34)return this._text.length-o;var r=l.charIndex,i=this._getWidthBeforeCursor(n,r),a=this._getIndexOnLine(n+1,i),u=this._textLines[n].slice(r);return u.length+a+1+this.missingNewlineOffset(n)},_getSelectionForOffset:function(h,e){return h.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(h,e){var o=this._getSelectionForOffset(h,e),l=this.get2DCursorLocation(o),n=l.lineIndex;if(n===0||h.metaKey||h.keyCode===33)return-o;var r=l.charIndex,i=this._getWidthBeforeCursor(n,r),a=this._getIndexOnLine(n-1,i),u=this._textLines[n].slice(0,r),s=this.missingNewlineOffset(n-1);return-this._textLines[n-1].length+a-u.length+(1-s)},_getIndexOnLine:function(h,e){for(var o=this._textLines[h],l=this._getLineLeftOffset(h),n=l,r=0,i,a,u=0,s=o.length;u<s;u++)if(i=this.__charBounds[h][u].width,n+=i,n>e){a=!0;var f=n-i,g=n,m=Math.abs(f-e),v=Math.abs(g-e);r=v<m?u:u-1;break}return a||(r=o.length-1),r},moveCursorDown:function(h){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",h)},moveCursorUp:function(h){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",h)},_moveCursorUpOrDown:function(h,e){var o="get"+h+"CursorOffset",l=this[o](e,this._selectionDirection==="right");e.shiftKey?this.moveCursorWithShift(l):this.moveCursorWithoutShift(l),l!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(h){var e=this._selectionDirection==="left"?this.selectionStart+h:this.selectionEnd+h;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),h!==0},moveCursorWithoutShift:function(h){return h<0?(this.selectionStart+=h,this.selectionEnd=this.selectionStart):(this.selectionEnd+=h,this.selectionStart=this.selectionEnd),h!==0},moveCursorLeft:function(h){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",h)},_move:function(h,e,o){var l;if(h.altKey)l=this["findWordBoundary"+o](this[e]);else if(h.metaKey||h.keyCode===35||h.keyCode===36)l=this["findLineBoundary"+o](this[e]);else return this[e]+=o==="Left"?-1:1,!0;if(typeof l<"u"&&this[e]!==l)return this[e]=l,!0},_moveLeft:function(h,e){return this._move(h,e,"Left")},_moveRight:function(h,e){return this._move(h,e,"Right")},moveCursorLeftWithoutShift:function(h){var e=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(e=this._moveLeft(h,"selectionStart")),this.selectionEnd=this.selectionStart,e},moveCursorLeftWithShift:function(h){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(h,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(h,"selectionStart")},moveCursorRight:function(h){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",h)},_moveCursorLeftOrRight:function(h,e){var o="moveCursor"+h+"With";this._currentCursorOpacity=1,e.shiftKey?o+="Shift":o+="outShift",this[o](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(h){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(h,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(h,"selectionEnd")},moveCursorRightWithoutShift:function(h){var e=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(e=this._moveRight(h,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e},removeChars:function(h,e){typeof e>"u"&&(e=h+1),this.removeStyleFromTo(h,e),this._text.splice(h,e-h),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(h,e,o,l){typeof l>"u"&&(l=o),l>o&&this.removeStyleFromTo(o,l);var n=t.util.string.graphemeSplit(h);this.insertNewStyleBlock(n,o,e),this._text=[].concat(this._text.slice(0,o),n,this._text.slice(l)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var h=t.util.toFixed,e=/  +/g;t.util.object.extend(t.Text.prototype,{_toSVG:function(){var o=this._getSVGLeftTopOffsets(),l=this._getSVGTextAndBg(o.textTop,o.textLeft);return this._wrapSVGTextAndBg(l)},toSVG:function(o){return this._createBaseSVGMarkup(this._toSVG(),{reviver:o,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(o){var l=!0,n=this.getSvgTextDecoration(this);return[o.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",n?'text-decoration="'+n+'" ':"",'style="',this.getSvgStyles(l),'"',this.addPaintOrder()," >",o.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(o,l){var n=[],r=[],i=o,a;this._setSVGBg(r);for(var u=0,s=this._textLines.length;u<s;u++)a=this._getLineLeftOffset(u),(this.textBackgroundColor||this.styleHas("textBackgroundColor",u))&&this._setSVGTextLineBg(r,u,l+a,i),this._setSVGTextLineText(n,u,l+a,i),i+=this.getHeightOfLine(u);return{textSpans:n,textBgRects:r}},_createTextCharSpan:function(o,l,n,r){var i=o!==o.trim()||o.match(e),a=this.getSvgSpanStyles(l,i),u=a?'style="'+a+'"':"",s=l.deltaY,f="",g=t.Object.NUM_FRACTION_DIGITS;return s&&(f=' dy="'+h(s,g)+'" '),['<tspan x="',h(n,g),'" y="',h(r,g),'" ',f,u,">",t.util.string.escapeXml(o),"</tspan>"].join("")},_setSVGTextLineText:function(o,l,n,r){var i=this.getHeightOfLine(l),a=this.textAlign.indexOf("justify")!==-1,u,s,f="",g,m,v=0,b=this._textLines[l],w;r+=i*(1-this._fontSizeFraction)/this.lineHeight;for(var S=0,A=b.length-1;S<=A;S++)w=S===A||this.charSpacing,f+=b[S],g=this.__charBounds[l][S],v===0?(n+=g.kernedWidth-g.width,v+=g.width):v+=g.kernedWidth,a&&!w&&this._reSpaceAndTab.test(b[S])&&(w=!0),w||(u=u||this.getCompleteStyleDeclaration(l,S),s=this.getCompleteStyleDeclaration(l,S+1),w=t.util.hasStyleChanged(u,s,!0)),w&&(m=this._getStyleDeclaration(l,S)||{},o.push(this._createTextCharSpan(f,m,n,r)),f="",u=s,n+=v,v=0)},_pushTextBgRect:function(o,l,n,r,i,a){var u=t.Object.NUM_FRACTION_DIGITS;o.push("		<rect ",this._getFillAttributes(l),' x="',h(n,u),'" y="',h(r,u),'" width="',h(i,u),'" height="',h(a,u),`"></rect>
`)},_setSVGTextLineBg:function(o,l,n,r){for(var i=this._textLines[l],a=this.getHeightOfLine(l)/this.lineHeight,u=0,s=0,f,g,m=this.getValueOfPropertyAt(l,0,"textBackgroundColor"),v=0,b=i.length;v<b;v++)f=this.__charBounds[l][v],g=this.getValueOfPropertyAt(l,v,"textBackgroundColor"),g!==m?(m&&this._pushTextBgRect(o,m,n+s,r,u,a),s=f.left,u=f.width,m=g):u+=f.kernedWidth;g&&this._pushTextBgRect(o,g,n+s,r,u,a)},_getFillAttributes:function(o){var l=o&&typeof o=="string"?new t.Color(o):"";return!l||!l.getSource()||l.getAlpha()===1?'fill="'+o+'"':'opacity="'+l.getAlpha()+'" fill="'+l.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(o){for(var l=0,n=0,r=0;r<o;r++)l+=this.getHeightOfLine(r);return n=this.getHeightOfLine(r),{lineTop:l,offset:(this._fontSizeMult-this._fontSizeFraction)*n/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(o){var l=t.Object.prototype.getSvgStyles.call(this,o);return l+" white-space: pre;"}})}(),function(h){var e=h.fabric||(h.fabric={});e.Textbox=e.util.createClass(e.IText,e.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:e.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(o){for(var l=0,n=0,r=0,i={},a=0;a<o.graphemeLines.length;a++)o.graphemeText[r]===`
`&&a>0?(n=0,r++,l++):!this.splitByGrapheme&&this._reSpaceAndTab.test(o.graphemeText[r])&&a>0&&(n++,r++),i[a]={line:l,offset:n},r+=o.graphemeLines[a].length,n+=o.graphemeLines[a].length;return i},styleHas:function(o,l){if(this._styleMap&&!this.isWrapping){var n=this._styleMap[l];n&&(l=n.line)}return e.Text.prototype.styleHas.call(this,o,l)},isEmptyStyles:function(o){if(!this.styles)return!0;var l=0,n=o+1,r,i,a=!1,u=this._styleMap[o],s=this._styleMap[o+1];u&&(o=u.line,l=u.offset),s&&(n=s.line,a=n===o,r=s.offset),i=typeof o>"u"?this.styles:{line:this.styles[o]};for(var f in i)for(var g in i[f])if(g>=l&&(!a||g<r))for(var m in i[f][g])return!1;return!0},_getStyleDeclaration:function(o,l){if(this._styleMap&&!this.isWrapping){var n=this._styleMap[o];if(!n)return null;o=n.line,l=n.offset+l}return this.callSuper("_getStyleDeclaration",o,l)},_setStyleDeclaration:function(o,l,n){var r=this._styleMap[o];o=r.line,l=r.offset+l,this.styles[o][l]=n},_deleteStyleDeclaration:function(o,l){var n=this._styleMap[o];o=n.line,l=n.offset+l,delete this.styles[o][l]},_getLineStyle:function(o){var l=this._styleMap[o];return!!this.styles[l.line]},_setLineStyle:function(o){var l=this._styleMap[o];this.styles[l.line]={}},_wrapText:function(o,l){var n=[],r;for(this.isWrapping=!0,r=0;r<o.length;r++)n=n.concat(this._wrapLine(o[r],r,l));return this.isWrapping=!1,n},_measureWord:function(o,l,n){var r=0,i,a=!0;n=n||0;for(var u=0,s=o.length;u<s;u++){var f=this._getGraphemeBox(o[u],l,u+n,i,a);r+=f.kernedWidth,i=o[u]}return r},_wrapLine:function(o,l,n,X){var i=0,a=this.splitByGrapheme,u=[],s=[],f=a?e.util.string.graphemeSplit(o):o.split(this._wordJoiners),g="",m=0,v=a?"":" ",b=0,w=0,S=0,A=!0,D=this._getWidthOfCharSpacing(),X=X||0;f.length===0&&f.push([]),n-=X;for(var K=0;K<f.length;K++)g=a?f[K]:e.util.string.graphemeSplit(f[K]),b=this._measureWord(g,l,m),m+=g.length,i+=w+b-D,i>n&&!A?(u.push(s),s=[],i=b,A=!0):i+=D,!A&&!a&&s.push(v),s=s.concat(g),w=a?0:this._measureWord([v],l,m),m++,A=!1,b>S&&(S=b);return K&&u.push(s),S+X>this.dynamicMinWidth&&(this.dynamicMinWidth=S-D+X),u},isEndOfWrapping:function(o){return!this._styleMap[o+1]||this._styleMap[o+1].line!==this._styleMap[o].line},missingNewlineOffset:function(o){return this.splitByGrapheme?this.isEndOfWrapping(o)?1:0:1},_splitTextIntoLines:function(o){for(var l=e.Text.prototype._splitTextIntoLines.call(this,o),n=this._wrapText(l.lines,this.width),r=new Array(n.length),i=0;i<n.length;i++)r[i]=n[i].join("");return l.lines=r,l.graphemeLines=n,l},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var o={};for(var l in this._styleMap)this._textLines[l]&&(o[this._styleMap[l].line]=1);for(var l in this.styles)o[l]||delete this.styles[l]},toObject:function(o){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(o))}}),e.Textbox.fromObject=function(o,l){var n=e.util.stylesFromArray(o.styles,o.text),r=Object.assign({},o,{styles:n});return e.Object._fromObject("Textbox",r,l,"text")}}(c),function(){var h=t.controlsUtils,e=h.scaleSkewCursorStyleHandler,o=h.scaleCursorStyleHandler,l=h.scalingEqually,n=h.scalingYOrSkewingX,r=h.scalingXOrSkewingY,i=h.scaleOrSkewActionName,a=t.Object.prototype.controls;if(a.ml=new t.Control({x:-.5,y:0,cursorStyleHandler:e,actionHandler:r,getActionName:i}),a.mr=new t.Control({x:.5,y:0,cursorStyleHandler:e,actionHandler:r,getActionName:i}),a.mb=new t.Control({x:0,y:.5,cursorStyleHandler:e,actionHandler:n,getActionName:i}),a.mt=new t.Control({x:0,y:-.5,cursorStyleHandler:e,actionHandler:n,getActionName:i}),a.tl=new t.Control({x:-.5,y:-.5,cursorStyleHandler:o,actionHandler:l}),a.tr=new t.Control({x:.5,y:-.5,cursorStyleHandler:o,actionHandler:l}),a.bl=new t.Control({x:-.5,y:.5,cursorStyleHandler:o,actionHandler:l}),a.br=new t.Control({x:.5,y:.5,cursorStyleHandler:o,actionHandler:l}),a.mtr=new t.Control({x:0,y:-.5,actionHandler:h.rotationWithSnapping,cursorStyleHandler:h.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),t.Textbox){var u=t.Textbox.prototype.controls={};u.mtr=a.mtr,u.tr=a.tr,u.br=a.br,u.tl=a.tl,u.bl=a.bl,u.mt=a.mt,u.mb=a.mb,u.mr=new t.Control({x:.5,y:0,actionHandler:h.changeWidth,cursorStyleHandler:e,actionName:"resizing"}),u.ml=new t.Control({x:-.5,y:0,actionHandler:h.changeWidth,cursorStyleHandler:e,actionName:"resizing"})}}()})(me);var Rr={grad:.9,turn:360,rad:360/(2*Math.PI)},qt=function(c){return typeof c=="string"?c.length>0:typeof c=="number"},Ft=function(c,t,d){return t===void 0&&(t=0),d===void 0&&(d=Math.pow(10,t)),Math.round(d*c)/d+0},Ht=function(c,t,d){return t===void 0&&(t=0),d===void 0&&(d=1),c>d?d:c>t?c:t},kn=function(c){return(c=isFinite(c)?c%360:0)>0?c:c+360},Pi=function(c){return{r:Ht(c.r,0,255),g:Ht(c.g,0,255),b:Ht(c.b,0,255),a:Ht(c.a)}},Je=function(c){return{r:Ft(c.r),g:Ft(c.g),b:Ft(c.b),a:Ft(c.a,3)}},Lr=/^#([0-9a-f]{3,8})$/i,Pe=function(c){var t=c.toString(16);return t.length<2?"0"+t:t},Pn=function(c){var t=c.r,d=c.g,p=c.b,_=c.a,C=Math.max(t,d,p),y=C-Math.min(t,d,p),h=y?C===t?(d-p)/y:C===d?2+(p-t)/y:4+(t-d)/y:0;return{h:60*(h<0?h+6:h),s:C?y/C*100:0,v:C/255*100,a:_}},Dn=function(c){var t=c.h,d=c.s,p=c.v,_=c.a;t=t/360*6,d/=100,p/=100;var C=Math.floor(t),y=p*(1-d),h=p*(1-(t-C)*d),e=p*(1-(1-t+C)*d),o=C%6;return{r:255*[p,h,y,y,e,p][o],g:255*[e,p,p,h,y,y][o],b:255*[y,y,e,p,p,h][o],a:_}},Di=function(c){return{h:kn(c.h),s:Ht(c.s,0,100),l:Ht(c.l,0,100),a:Ht(c.a)}},Mi=function(c){return{h:Ft(c.h),s:Ft(c.s),l:Ft(c.l),a:Ft(c.a,3)}},Ii=function(c){return Dn((d=(t=c).s,{h:t.h,s:(d*=((p=t.l)<50?p:100-p)/100)>0?2*d/(p+d)*100:0,v:p+d,a:t.a}));var t,d,p},be=function(c){return{h:(t=Pn(c)).h,s:(_=(200-(d=t.s))*(p=t.v)/100)>0&&_<200?d*p/100/(_<=100?_:200-_)*100:0,l:_/2,a:t.a};var t,d,p,_},Br=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,jr=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Wr=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Nr=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,fi={string:[[function(c){var t=Lr.exec(c);return t?(c=t[1]).length<=4?{r:parseInt(c[0]+c[0],16),g:parseInt(c[1]+c[1],16),b:parseInt(c[2]+c[2],16),a:c.length===4?Ft(parseInt(c[3]+c[3],16)/255,2):1}:c.length===6||c.length===8?{r:parseInt(c.substr(0,2),16),g:parseInt(c.substr(2,2),16),b:parseInt(c.substr(4,2),16),a:c.length===8?Ft(parseInt(c.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(c){var t=Wr.exec(c)||Nr.exec(c);return t?t[2]!==t[4]||t[4]!==t[6]?null:Pi({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(c){var t=Br.exec(c)||jr.exec(c);if(!t)return null;var d,p,_=Di({h:(d=t[1],p=t[2],p===void 0&&(p="deg"),Number(d)*(Rr[p]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Ii(_)},"hsl"]],object:[[function(c){var t=c.r,d=c.g,p=c.b,_=c.a,C=_===void 0?1:_;return qt(t)&&qt(d)&&qt(p)?Pi({r:Number(t),g:Number(d),b:Number(p),a:Number(C)}):null},"rgb"],[function(c){var t=c.h,d=c.s,p=c.l,_=c.a,C=_===void 0?1:_;if(!qt(t)||!qt(d)||!qt(p))return null;var y=Di({h:Number(t),s:Number(d),l:Number(p),a:Number(C)});return Ii(y)},"hsl"],[function(c){var t=c.h,d=c.s,p=c.v,_=c.a,C=_===void 0?1:_;if(!qt(t)||!qt(d)||!qt(p))return null;var y=function(h){return{h:kn(h.h),s:Ht(h.s,0,100),v:Ht(h.v,0,100),a:Ht(h.a)}}({h:Number(t),s:Number(d),v:Number(p),a:Number(C)});return Dn(y)},"hsv"]]},Fi=function(c,t){for(var d=0;d<t.length;d++){var p=t[d][0](c);if(p)return[p,t[d][1]]}return[null,void 0]},Xr=function(c){return typeof c=="string"?Fi(c.trim(),fi.string):typeof c=="object"&&c!==null?Fi(c,fi.object):[null,void 0]},Qe=function(c,t){var d=be(c);return{h:d.h,s:Ht(d.s+100*t,0,100),l:d.l,a:d.a}},Ze=function(c){return(299*c.r+587*c.g+114*c.b)/1e3/255},Ri=function(c,t){var d=be(c);return{h:d.h,s:d.s,l:Ht(d.l+100*t,0,100),a:d.a}},di=function(){function c(t){this.parsed=Xr(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return c.prototype.isValid=function(){return this.parsed!==null},c.prototype.brightness=function(){return Ft(Ze(this.rgba),2)},c.prototype.isDark=function(){return Ze(this.rgba)<.5},c.prototype.isLight=function(){return Ze(this.rgba)>=.5},c.prototype.toHex=function(){return t=Je(this.rgba),d=t.r,p=t.g,_=t.b,y=(C=t.a)<1?Pe(Ft(255*C)):"","#"+Pe(d)+Pe(p)+Pe(_)+y;var t,d,p,_,C,y},c.prototype.toRgb=function(){return Je(this.rgba)},c.prototype.toRgbString=function(){return t=Je(this.rgba),d=t.r,p=t.g,_=t.b,(C=t.a)<1?"rgba("+d+", "+p+", "+_+", "+C+")":"rgb("+d+", "+p+", "+_+")";var t,d,p,_,C},c.prototype.toHsl=function(){return Mi(be(this.rgba))},c.prototype.toHslString=function(){return t=Mi(be(this.rgba)),d=t.h,p=t.s,_=t.l,(C=t.a)<1?"hsla("+d+", "+p+"%, "+_+"%, "+C+")":"hsl("+d+", "+p+"%, "+_+"%)";var t,d,p,_,C},c.prototype.toHsv=function(){return t=Pn(this.rgba),{h:Ft(t.h),s:Ft(t.s),v:Ft(t.v),a:Ft(t.a,3)};var t},c.prototype.invert=function(){return Bt({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},c.prototype.saturate=function(t){return t===void 0&&(t=.1),Bt(Qe(this.rgba,t))},c.prototype.desaturate=function(t){return t===void 0&&(t=.1),Bt(Qe(this.rgba,-t))},c.prototype.grayscale=function(){return Bt(Qe(this.rgba,-1))},c.prototype.lighten=function(t){return t===void 0&&(t=.1),Bt(Ri(this.rgba,t))},c.prototype.darken=function(t){return t===void 0&&(t=.1),Bt(Ri(this.rgba,-t))},c.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},c.prototype.alpha=function(t){return typeof t=="number"?Bt({r:(d=this.rgba).r,g:d.g,b:d.b,a:t}):Ft(this.rgba.a,3);var d},c.prototype.hue=function(t){var d=be(this.rgba);return typeof t=="number"?Bt({h:t,s:d.s,l:d.l,a:d.a}):Ft(d.h)},c.prototype.isEqual=function(t){return this.toHex()===Bt(t).toHex()},c}(),Bt=function(c){return c instanceof di?c:new di(c)},Li=[],Hr=function(c){c.forEach(function(t){Li.indexOf(t)<0&&(t(di,fi),Li.push(t))})},$e=function(c){var t=c/255;return t<.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},ti=function(c){return .2126*$e(c.r)+.7152*$e(c.g)+.0722*$e(c.b)};function Yr(c){c.prototype.luminance=function(){return t=ti(this.rgba),(d=2)===void 0&&(d=0),p===void 0&&(p=Math.pow(10,d)),Math.round(p*t)/p+0;var t,d,p},c.prototype.contrast=function(t){t===void 0&&(t="#FFF");var d,p,_,C,y,h,e,o=t instanceof c?t:new c(t);return C=this.rgba,y=o.toRgb(),h=ti(C),e=ti(y),d=h>e?(h+.05)/(e+.05):(e+.05)/(h+.05),(p=2)===void 0&&(p=0),_===void 0&&(_=Math.pow(10,p)),Math.floor(_*d)/_+0},c.prototype.isReadable=function(t,d){return t===void 0&&(t="#FFF"),d===void 0&&(d={}),this.contrast(t)>=(h=(y=(p=d).size)===void 0?"normal":y,(C=(_=p.level)===void 0?"AA":_)==="AAA"&&h==="normal"?7:C==="AA"&&h==="large"?3:4.5);var p,_,C,y,h}}const ue=[];function zr(c,t){return{subscribe:pe(c,t).subscribe}}function pe(c,t=bt){let d;const p=new Set;function _(h){if(Ot(c,h)&&(c=h,d)){const e=!ue.length;for(const o of p)o[1](),ue.push(o,c);if(e){for(let o=0;o<ue.length;o+=2)ue[o][0](ue[o+1]);ue.length=0}}}function C(h){_(h(c))}function y(h,e=bt){const o=[h,e];return p.add(o),p.size===1&&(d=t(_)||bt),h(c),()=>{p.delete(o),p.size===0&&d&&(d(),d=null)}}return{set:_,update:C,subscribe:y}}function Ur(c,t,d){const p=!Array.isArray(c),_=p?[c]:c,C=t.length<2;return zr(d,y=>{let h=!1;const e=[];let o=0,l=bt;const n=()=>{if(o)return;l();const i=t(p?e[0]:e,y);C?y(i):l=Ye(i)?i:bt},r=_.map((i,a)=>Tn(i,u=>{e[a]=u,o&=~(1<<a),h&&n()},()=>{o|=1<<a}));return h=!0,n(),function(){It(r),l(),h=!1}})}const Kt=pe({ArrowLeft:0,ArrowUp:0,ArrowRight:0,ArrowDown:0}),Ci=Ur(Kt,c=>({...c,ArrowV:c.ArrowUp+c.ArrowDown,ArrowH:c.ArrowLeft+c.ArrowRight,ArrowVH:c.ArrowUp+c.ArrowDown+c.ArrowLeft+c.ArrowRight}));function wi(c,t=.001,d=.01){const C=Math.min(1,Math.max(1,c-50)/50);return t+(d-t)/2*(1-Math.cos(Math.PI*C))}const{window:_e}=bi;function Vr(c){let t,d,p,_,C,y;var h=c[2].pickerIndicator;function e(o){return{props:{pos:o[9],isDark:o[5],hex:Bt({h:o[3],s:o[0],v:o[1],a:1}).toHex()}}}return h&&(d=St(h,e(c))),{c(){var o,l;t=nt("div"),d&&yt(d.$$.fragment),L(t,"class","picker svelte-uiwgvv"),L(t,"tabindex","0"),Nt(t,"--color-bg",c[8]),L(t,"aria-label","saturation and brightness picker (arrow keyboard navigation)"),L(t,"aria-valuemin",0),L(t,"aria-valuemax",100),L(t,"aria-valuetext",p="saturation "+((o=c[9].x)==null?void 0:o.toFixed())+"%, brightness "+((l=c[9].y)==null?void 0:l.toFixed())+"%")},m(o,l){ht(o,t,l),d&&pt(d,t,null),c[18](t),_=!0,C||(y=[ut(t,"mousedown",re(Ut(c[10]))),ut(t,"touchstart",c[16]),ut(t,"touchmove",re(Ut(c[16]))),ut(t,"touchend",c[16])],C=!0)},p(o,l){var r,i;const n={};if(l&512&&(n.pos=o[9]),l&32&&(n.isDark=o[5]),l&11&&(n.hex=Bt({h:o[3],s:o[0],v:o[1],a:1}).toHex()),l&4&&h!==(h=o[2].pickerIndicator)){if(d){Dt();const a=d;ft(a.$$.fragment,1,0,()=>{vt(a,1)}),Mt()}h?(d=St(h,e(o)),yt(d.$$.fragment),at(d.$$.fragment,1),pt(d,t,null)):d=null}else h&&d.$set(n);(!_||l&256)&&Nt(t,"--color-bg",o[8]),(!_||l&512&&p!==(p="saturation "+((r=o[9].x)==null?void 0:r.toFixed())+"%, brightness "+((i=o[9].y)==null?void 0:i.toFixed())+"%"))&&L(t,"aria-valuetext",p)},i(o){_||(d&&at(d.$$.fragment,o),_=!0)},o(o){d&&ft(d.$$.fragment,o),_=!1},d(o){o&&lt(t),d&&vt(d),c[18](null),C=!1,It(y)}}}function Gr(c){let t,d,p,_,C;var y=c[2].pickerWrapper;function h(e){return{props:{focused:e[7],toRight:e[4],$$slots:{default:[Vr]},$$scope:{ctx:e}}}}return y&&(t=St(y,h(c))),{c(){t&&yt(t.$$.fragment),d=Gt()},m(e,o){t&&pt(t,e,o),ht(e,d,o),p=!0,_||(C=[ut(_e,"mouseup",c[11]),ut(_e,"mousedown",c[13]),ut(_e,"mousemove",c[12]),ut(_e,"keyup",c[14]),ut(_e,"keydown",c[15])],_=!0)},p(e,[o]){const l={};if(o&128&&(l.focused=e[7]),o&16&&(l.toRight=e[4]),o&67109743&&(l.$$scope={dirty:o,ctx:e}),o&4&&y!==(y=e[2].pickerWrapper)){if(t){Dt();const n=t;ft(n.$$.fragment,1,0,()=>{vt(n,1)}),Mt()}y?(t=St(y,h(e)),yt(t.$$.fragment),at(t.$$.fragment,1),pt(t,d.parentNode,d)):t=null}else y&&t.$set(l)},i(e){p||(t&&at(t.$$.fragment,e),p=!0)},o(e){t&&ft(t.$$.fragment,e),p=!1},d(e){e&&lt(d),t&&vt(t,e),_=!1,It(C)}}}function Bi(c,t,d){return Math.min(Math.max(t,c),d)}function qr(c,t,d){let p,_;jt(c,Kt,H=>d(22,p=H)),jt(c,Ci,H=>d(23,_=H));let{components:C}=t,{h:y}=t,{s:h}=t,{v:e}=t,{isOpen:o}=t,{toRight:l}=t,{isDark:n}=t,r,i=!1,a=!1,u,s,f,g={x:100,y:0};function m(H){let J={x:H.offsetX,y:H.offsetY},Z=r.getBoundingClientRect().width,Q=r.getBoundingClientRect().height;d(0,h=Bi(J.x/Z,0,1)*100),d(1,e=Bi((Q-J.y)/Q,0,1)*100)}function v(H){H.button===0&&(i=!0,m(H))}function b(){i=!1}function w(H){i&&m({offsetX:Math.max(0,Math.min(r.getBoundingClientRect().width,H.clientX-r.getBoundingClientRect().left)),offsetY:Math.max(0,Math.min(r.getBoundingClientRect().height,H.clientY-r.getBoundingClientRect().top))})}function S(H){H.target.isSameNode(r)||d(7,a=!1)}function A(H){var J;H.key==="Tab"&&d(7,a=!!((J=document.activeElement)!=null&&J.isSameNode(r))),!H.repeat&&a&&X()}function D(H){a&&_.ArrowVH&&(H.preventDefault(),H.repeat||X())}function X(){_.ArrowVH?u||(s=0,u=window.setInterval(()=>{let H=wi(++s);d(0,h=Math.min(100,Math.max(0,h+(p.ArrowRight-p.ArrowLeft)*H*100))),d(1,e=Math.min(100,Math.max(0,e+(p.ArrowUp-p.ArrowDown)*H*100)))},10)):u&&(clearInterval(u),u=void 0)}function K(H){H.preventDefault(),m({offsetX:H.changedTouches[0].clientX-r.getBoundingClientRect().left,offsetY:H.changedTouches[0].clientY-r.getBoundingClientRect().top})}function $(H){Ct[H?"unshift":"push"](()=>{r=H,d(6,r)})}return c.$$set=H=>{"components"in H&&d(2,C=H.components),"h"in H&&d(3,y=H.h),"s"in H&&d(0,h=H.s),"v"in H&&d(1,e=H.v),"isOpen"in H&&d(17,o=H.isOpen),"toRight"in H&&d(4,l=H.toRight),"isDark"in H&&d(5,n=H.isDark)},c.$$.update=()=>{c.$$.dirty&8&&typeof y=="number"&&d(8,f=Bt({h:y,s:100,v:100,a:1}).toHex()),c.$$.dirty&67&&typeof h=="number"&&typeof e=="number"&&r&&d(9,g={x:h,y:100-e})},[h,e,C,y,l,n,r,a,f,g,v,b,w,S,A,D,K,o,$]}class Kr extends Et{constructor(t){super(),At(this,t,qr,Gr,Ot,{components:2,h:3,s:0,v:1,isOpen:17,toRight:4,isDark:5})}}const{window:De}=bi;function Jr(c){let t,d,p,_,C,y;var h=c[1].sliderIndicator;function e(o){return{props:{pos:o[4],toRight:o[2]}}}return h&&(d=St(h,e(c))),{c(){t=nt("div"),d&&yt(d.$$.fragment),L(t,"class","slider svelte-14nweqy"),L(t,"tabindex","0"),L(t,"aria-label","hue picker (arrow keyboard navigation)"),L(t,"aria-valuemin",0),L(t,"aria-valuemax",360),L(t,"aria-valuenow",p=Math.round(c[0])),Rt(t,"to-right",c[2])},m(o,l){ht(o,t,l),d&&pt(d,t,null),c[12](t),_=!0,C||(y=[ut(t,"mousedown",re(Ut(c[6]))),ut(t,"touchstart",c[11]),ut(t,"touchmove",re(Ut(c[11]))),ut(t,"touchend",c[11])],C=!0)},p(o,l){const n={};if(l&16&&(n.pos=o[4]),l&4&&(n.toRight=o[2]),l&2&&h!==(h=o[1].sliderIndicator)){if(d){Dt();const r=d;ft(r.$$.fragment,1,0,()=>{vt(r,1)}),Mt()}h?(d=St(h,e(o)),yt(d.$$.fragment),at(d.$$.fragment,1),pt(d,t,null)):d=null}else h&&d.$set(n);(!_||l&1&&p!==(p=Math.round(o[0])))&&L(t,"aria-valuenow",p),(!_||l&4)&&Rt(t,"to-right",o[2])},i(o){_||(d&&at(d.$$.fragment,o),_=!0)},o(o){d&&ft(d.$$.fragment,o),_=!1},d(o){o&&lt(t),d&&vt(d),c[12](null),C=!1,It(y)}}}function Qr(c){let t,d,p,_,C;var y=c[1].sliderWrapper;function h(e){return{props:{focused:e[5],toRight:e[2],$$slots:{default:[Jr]},$$scope:{ctx:e}}}}return y&&(t=St(y,h(c))),{c(){t&&yt(t.$$.fragment),d=Gt()},m(e,o){t&&pt(t,e,o),ht(e,d,o),p=!0,_||(C=[ut(De,"mouseup",c[7]),ut(De,"mousemove",c[8]),ut(De,"keyup",c[9]),ut(De,"keydown",c[10])],_=!0)},p(e,[o]){const l={};if(o&32&&(l.focused=e[5]),o&4&&(l.toRight=e[2]),o&1048607&&(l.$$scope={dirty:o,ctx:e}),o&2&&y!==(y=e[1].sliderWrapper)){if(t){Dt();const n=t;ft(n.$$.fragment,1,0,()=>{vt(n,1)}),Mt()}y?(t=St(y,h(e)),yt(t.$$.fragment),at(t.$$.fragment,1),pt(t,d.parentNode,d)):t=null}else y&&t.$set(l)},i(e){p||(t&&at(t.$$.fragment,e),p=!0)},o(e){t&&ft(t.$$.fragment,e),p=!1},d(e){e&&lt(d),t&&vt(t,e),_=!1,It(C)}}}function Zr(c,t,d){let p,_;jt(c,Kt,S=>d(16,p=S)),jt(c,Ci,S=>d(17,_=S));let{components:C}=t,{toRight:y}=t,h,e=!1,{h:o}=t,l=0,n=!1,r,i;function a(S){const A=y?h.getBoundingClientRect().width:h.getBoundingClientRect().height,D=Math.max(0,Math.min(A,S));d(0,o=D/A*360)}function u(S){S.button===0&&(e=!0,a(y?S.offsetX:S.offsetY))}function s(){e=!1}function f(S){e&&a(y?S.clientX-h.getBoundingClientRect().left:S.clientY-h.getBoundingClientRect().top)}function g(S){var A;S.key==="Tab"&&d(5,n=!!((A=document.activeElement)!=null&&A.isSameNode(h))),!S.repeat&&n&&v()}function m(S){n&&_.ArrowVH&&(S.preventDefault(),S.repeat||v())}function v(){_.ArrowVH?r||(i=0,r=window.setInterval(()=>{const S=wi(++i),A=y?p.ArrowRight-p.ArrowLeft:p.ArrowDown-p.ArrowUp;d(0,o=Math.min(360,Math.max(0,o+A*360*S)))},10)):r&&(clearInterval(r),r=void 0)}function b(S){S.preventDefault(),a(y?S.changedTouches[0].clientX-h.getBoundingClientRect().left:S.changedTouches[0].clientY-h.getBoundingClientRect().top)}function w(S){Ct[S?"unshift":"push"](()=>{h=S,d(3,h)})}return c.$$set=S=>{"components"in S&&d(1,C=S.components),"toRight"in S&&d(2,y=S.toRight),"h"in S&&d(0,o=S.h)},c.$$.update=()=>{c.$$.dirty&9&&typeof o=="number"&&h&&d(4,l=100*o/360)},[o,C,y,h,l,n,u,s,f,g,m,b,w]}class $r extends Et{constructor(t){super(),At(this,t,Zr,Qr,Ot,{components:1,toRight:2,h:0})}}const{window:Me}=bi;function ts(c){let t,d,p,_,C,y,h;var e=c[0].alphaIndicator;function o(l){return{props:{pos:l[5],toRight:l[2]}}}return e&&(d=St(e,o(c))),{c(){var l,n;t=nt("div"),d&&yt(d.$$.fragment),L(t,"class","alpha svelte-f2vq53"),L(t,"tabindex","0"),Nt(t,"--alpha-color",(l=c[1])==null?void 0:l.substring(0,7)),L(t,"aria-label","transparency picker (arrow keyboard navigation)"),L(t,"aria-valuemin",0),L(t,"aria-valuemax",100),L(t,"aria-valuenow",p=Math.round(c[5])),L(t,"aria-valuetext",_=((n=c[5])==null?void 0:n.toFixed())+"%"),Rt(t,"to-right",c[2])},m(l,n){ht(l,t,n),d&&pt(d,t,null),c[14](t),C=!0,y||(h=[ut(t,"mousedown",re(Ut(c[6]))),ut(t,"touchstart",c[11]),ut(t,"touchmove",re(Ut(c[11]))),ut(t,"touchend",c[11])],y=!0)},p(l,n){var i,a;const r={};if(n&32&&(r.pos=l[5]),n&4&&(r.toRight=l[2]),n&1&&e!==(e=l[0].alphaIndicator)){if(d){Dt();const u=d;ft(u.$$.fragment,1,0,()=>{vt(u,1)}),Mt()}e?(d=St(e,o(l)),yt(d.$$.fragment),at(d.$$.fragment,1),pt(d,t,null)):d=null}else e&&d.$set(r);(!C||n&2)&&Nt(t,"--alpha-color",(i=l[1])==null?void 0:i.substring(0,7)),(!C||n&32&&p!==(p=Math.round(l[5])))&&L(t,"aria-valuenow",p),(!C||n&32&&_!==(_=((a=l[5])==null?void 0:a.toFixed())+"%"))&&L(t,"aria-valuetext",_),(!C||n&4)&&Rt(t,"to-right",l[2])},i(l){C||(d&&at(d.$$.fragment,l),C=!0)},o(l){d&&ft(d.$$.fragment,l),C=!1},d(l){l&&lt(t),d&&vt(d),c[14](null),y=!1,It(h)}}}function es(c){let t,d,p,_,C;var y=c[0].alphaWrapper;function h(e){return{props:{focused:e[4],toRight:e[2],$$slots:{default:[ts]},$$scope:{ctx:e}}}}return y&&(t=St(y,h(c))),{c(){t&&yt(t.$$.fragment),d=Gt()},m(e,o){t&&pt(t,e,o),ht(e,d,o),p=!0,_||(C=[ut(Me,"mouseup",c[7]),ut(Me,"mousemove",c[8]),ut(Me,"keyup",c[9]),ut(Me,"keydown",c[10])],_=!0)},p(e,[o]){const l={};if(o&16&&(l.focused=e[4]),o&4&&(l.toRight=e[2]),o&4194351&&(l.$$scope={dirty:o,ctx:e}),o&1&&y!==(y=e[0].alphaWrapper)){if(t){Dt();const n=t;ft(n.$$.fragment,1,0,()=>{vt(n,1)}),Mt()}y?(t=St(y,h(e)),yt(t.$$.fragment),at(t.$$.fragment,1),pt(t,d.parentNode,d)):t=null}else y&&t.$set(l)},i(e){p||(t&&at(t.$$.fragment,e),p=!0)},o(e){t&&ft(t.$$.fragment,e),p=!1},d(e){e&&lt(d),t&&vt(t,e),_=!1,It(C)}}}function is(c,t,d){let p,_;jt(c,Kt,D=>d(18,p=D)),jt(c,Ci,D=>d(19,_=D));let{components:C}=t,{isOpen:y}=t,{a:h=1}=t,{hex:e}=t,{toRight:o}=t,l,n=!1,r=!1,i,a,u;function s(D){const X=o?l.getBoundingClientRect().width:l.getBoundingClientRect().height,K=Math.max(0,Math.min(X,D));d(12,h=K/X)}function f(D){D.button===0&&(n=!0,s(o?D.offsetX:D.offsetY))}function g(){n=!1}function m(D){n&&s(o?D.clientX-l.getBoundingClientRect().left:D.clientY-l.getBoundingClientRect().top)}function v(D){var X;D.key==="Tab"&&d(4,r=!!((X=document.activeElement)!=null&&X.isSameNode(l))),!D.repeat&&r&&w()}function b(D){r&&_.ArrowVH&&(D.preventDefault(),D.repeat||w())}function w(){_.ArrowVH?i||(a=0,i=window.setInterval(()=>{const D=wi(++a),X=o?p.ArrowRight-p.ArrowLeft:p.ArrowDown-p.ArrowUp;d(12,h=Math.min(1,Math.max(0,h+X*D)))},10)):i&&(clearInterval(i),i=void 0)}function S(D){D.preventDefault(),s(o?D.changedTouches[0].clientX-l.getBoundingClientRect().left:D.changedTouches[0].clientY-l.getBoundingClientRect().top)}function A(D){Ct[D?"unshift":"push"](()=>{l=D,d(3,l)})}return c.$$set=D=>{"components"in D&&d(0,C=D.components),"isOpen"in D&&d(13,y=D.isOpen),"a"in D&&d(12,h=D.a),"hex"in D&&d(1,e=D.hex),"toRight"in D&&d(2,o=D.toRight)},c.$$.update=()=>{c.$$.dirty&4104&&typeof h=="number"&&l&&d(5,u=100*h)},[C,e,o,l,r,u,f,g,m,v,b,S,h,y,A]}class ns extends Et{constructor(t){super(),At(this,t,is,es,Ot,{components:0,isOpen:13,a:12,hex:1,toRight:2})}}function rs(c){let t,d,p,_,C,y,h,e,o,l=c[2]&&ji(c);return{c(){t=nt("div"),d=nt("input"),p=mt(),_=nt("input"),C=mt(),y=nt("input"),h=mt(),l&&l.c(),L(d,"aria-label","hue chanel color"),d.value=c[8],L(d,"type","number"),L(d,"min","0"),L(d,"max","360"),L(d,"class","svelte-11z4jba"),L(_,"aria-label","saturation chanel color"),_.value=c[7],L(_,"type","number"),L(_,"min","0"),L(_,"max","100"),L(_,"class","svelte-11z4jba"),L(y,"aria-label","brightness chanel color"),y.value=c[6],L(y,"type","number"),L(y,"min","0"),L(y,"max","100"),L(y,"class","svelte-11z4jba"),L(t,"class","input-container svelte-11z4jba")},m(n,r){ht(n,t,r),it(t,d),it(t,p),it(t,_),it(t,C),it(t,y),it(t,h),l&&l.m(t,null),e||(o=[ut(d,"input",c[12]("h")),ut(_,"input",c[12]("s")),ut(y,"input",c[12]("v"))],e=!0)},p(n,r){r&256&&d.value!==n[8]&&(d.value=n[8]),r&128&&_.value!==n[7]&&(_.value=n[7]),r&64&&y.value!==n[6]&&(y.value=n[6]),n[2]?l?l.p(n,r):(l=ji(n),l.c(),l.m(t,null)):l&&(l.d(1),l=null)},d(n){n&&lt(t),l&&l.d(),e=!1,It(o)}}}function ss(c){let t,d,p,_,C,y,h,e,o,l,n,r,i=c[2]&&Wi(c);return{c(){t=nt("div"),d=nt("input"),_=mt(),C=nt("input"),h=mt(),e=nt("input"),l=mt(),i&&i.c(),L(d,"aria-label","red chanel color"),d.value=p=c[0].r,L(d,"type","number"),L(d,"min","0"),L(d,"max","255"),L(d,"class","svelte-11z4jba"),L(C,"aria-label","green chanel color"),C.value=y=c[0].g,L(C,"type","number"),L(C,"min","0"),L(C,"max","255"),L(C,"class","svelte-11z4jba"),L(e,"aria-label","blue chanel color"),e.value=o=c[0].b,L(e,"type","number"),L(e,"min","0"),L(e,"max","255"),L(e,"class","svelte-11z4jba"),L(t,"class","input-container svelte-11z4jba")},m(a,u){ht(a,t,u),it(t,d),it(t,_),it(t,C),it(t,h),it(t,e),it(t,l),i&&i.m(t,null),n||(r=[ut(d,"input",c[11]("r")),ut(C,"input",c[11]("g")),ut(e,"input",c[11]("b"))],n=!0)},p(a,u){u&1&&p!==(p=a[0].r)&&d.value!==p&&(d.value=p),u&1&&y!==(y=a[0].g)&&C.value!==y&&(C.value=y),u&1&&o!==(o=a[0].b)&&e.value!==o&&(e.value=o),a[2]?i?i.p(a,u):(i=Wi(a),i.c(),i.m(t,null)):i&&(i.d(1),i=null)},d(a){a&&lt(t),i&&i.d(),n=!1,It(r)}}}function as(c){let t,d,p,_,C,y=c[2]&&Ni(c);return{c(){t=nt("div"),d=nt("input"),p=mt(),y&&y.c(),d.value=c[1],Nt(d,"flex","3"),L(d,"class","svelte-11z4jba"),L(t,"class","input-container svelte-11z4jba")},m(h,e){ht(h,t,e),it(t,d),it(t,p),y&&y.m(t,null),_||(C=ut(d,"input",c[10]),_=!0)},p(h,e){e&2&&d.value!==h[1]&&(d.value=h[1]),h[2]?y?y.p(h,e):(y=Ni(h),y.c(),y.m(t,null)):y&&(y.d(1),y=null)},d(h){h&&lt(t),y&&y.d(),_=!1,C()}}}function ji(c){let t,d,p;return{c(){t=nt("input"),L(t,"aria-label","transparency chanel color"),t.value=c[5],L(t,"type","number"),L(t,"min","0"),L(t,"max","1"),L(t,"step","0.01"),L(t,"class","svelte-11z4jba")},m(_,C){ht(_,t,C),d||(p=ut(t,"input",c[12]("a")),d=!0)},p(_,C){C&32&&t.value!==_[5]&&(t.value=_[5])},d(_){_&&lt(t),d=!1,p()}}}function Wi(c){let t,d,p;return{c(){t=nt("input"),L(t,"aria-label","transparency chanel color"),t.value=c[5],L(t,"type","number"),L(t,"min","0"),L(t,"max","1"),L(t,"step","0.01"),L(t,"class","svelte-11z4jba")},m(_,C){ht(_,t,C),d||(p=ut(t,"input",c[11]("a")),d=!0)},p(_,C){C&32&&t.value!==_[5]&&(t.value=_[5])},d(_){_&&lt(t),d=!1,p()}}}function Ni(c){let t,d,p;return{c(){t=nt("input"),L(t,"aria-label","hexadecimal color"),t.value=c[5],L(t,"type","number"),L(t,"min","0"),L(t,"max","1"),L(t,"step","0.01"),L(t,"class","svelte-11z4jba")},m(_,C){ht(_,t,C),d||(p=ut(t,"input",c[11]("a")),d=!0)},p(_,C){C&32&&t.value!==_[5]&&(t.value=_[5])},d(_){_&&lt(t),d=!1,p()}}}function Xi(c){let t,d=c[9][c[4]]+"",p,_,C,y;return{c(){t=nt("button"),p=Vt(d),L(t,"aria-label",_="change inputs to "+c[9][(c[4]+1)%3]),L(t,"class","svelte-11z4jba")},m(h,e){ht(h,t,e),it(t,p),C||(y=ut(t,"click",c[14]),C=!0)},p(h,e){e&16&&d!==(d=h[9][h[4]]+"")&&ge(p,d),e&16&&_!==(_="change inputs to "+h[9][(h[4]+1)%3])&&L(t,"aria-label",_)},d(h){h&&lt(t),C=!1,y()}}}function os(c){let t,d;function p(h,e){return h[4]===0?as:h[4]===1?ss:rs}let _=p(c),C=_(c),y=c[3]&&Xi(c);return{c(){t=nt("div"),C.c(),d=mt(),y&&y.c(),L(t,"class","text-input svelte-11z4jba")},m(h,e){ht(h,t,e),C.m(t,null),it(t,d),y&&y.m(t,null)},p(h,[e]){_===(_=p(h))&&C?C.p(h,e):(C.d(1),C=_(h),C&&(C.c(),C.m(t,d))),h[3]?y?y.p(h,e):(y=Xi(h),y.c(),y.m(t,null)):y&&(y.d(1),y=null)},i:bt,o:bt,d(h){h&&lt(t),C.d(),y&&y.d()}}}const ls=/^#?([A-F0-9]{6}|[A-F0-9]{8})$/i;function hs(c,t,d){let p,_,C,y,{isAlpha:h}=t,{rgb:e}=t,{hsv:o}=t,{hex:l}=t,{canChangeMode:n}=t;const r=["HEX","RGB","HSV"];let i=0;function a(g){const m=g.target;ls.test(m.value)&&d(1,l=m.value)}function u(g){return function(m){d(0,e={...e,[g]:parseFloat(m.target.value)})}}function s(g){return function(m){d(13,o={...o,[g]:parseFloat(m.target.value)})}}const f=()=>d(4,i=(i+1)%3);return c.$$set=g=>{"isAlpha"in g&&d(2,h=g.isAlpha),"rgb"in g&&d(0,e=g.rgb),"hsv"in g&&d(13,o=g.hsv),"hex"in g&&d(1,l=g.hex),"canChangeMode"in g&&d(3,n=g.canChangeMode)},c.$$.update=()=>{c.$$.dirty&8192&&d(8,p=Math.round(o.h)),c.$$.dirty&8192&&d(7,_=Math.round(o.s)),c.$$.dirty&8192&&d(6,C=Math.round(o.v)),c.$$.dirty&8192&&d(5,y=o.a===void 0?1:Math.round(o.a*100)/100)},[e,l,h,n,i,y,C,_,p,r,a,u,s,o,f]}class cs extends Et{constructor(t){super(),At(this,t,hs,os,Ot,{isAlpha:2,rgb:0,hsv:13,hex:1,canChangeMode:3})}}function us(c){let t,d;return{c(){t=nt("div"),L(t,"class","slider-indicator svelte-htgglv"),L(t,"style",d=`top: calc(${c[0]/200*186}% + 2px);`)},m(p,_){ht(p,t,_)},p(p,[_]){_&1&&d!==(d=`top: calc(${p[0]/200*186}% + 2px);`)&&L(t,"style",d)},i:bt,o:bt,d(p){p&&lt(t)}}}function fs(c,t,d){let{pos:p}=t,{toRight:_}=t;return c.$$set=C=>{"pos"in C&&d(0,p=C.pos),"toRight"in C&&d(1,_=C.toRight)},[p,_]}class Hi extends Et{constructor(t){super(),At(this,t,fs,us,Ot,{pos:0,toRight:1})}}function ds(c){let t,d;return{c(){t=nt("div"),L(t,"class","picker-indicator svelte-1nw247x"),L(t,"style",d=`left: calc(${c[0].x/200*186}% + 2px); top: calc(${c[0].y/200*186}% + 2px); box-shadow: 0 0 4px ${c[1]?"white":"black"};`)},m(p,_){ht(p,t,_)},p(p,[_]){_&3&&d!==(d=`left: calc(${p[0].x/200*186}% + 2px); top: calc(${p[0].y/200*186}% + 2px); box-shadow: 0 0 4px ${p[1]?"white":"black"};`)&&L(t,"style",d)},i:bt,o:bt,d(p){p&&lt(t)}}}function gs(c,t,d){let{pos:p}=t,{hex:_}=t,{isDark:C}=t;return c.$$set=y=>{"pos"in y&&d(0,p=y.pos),"hex"in y&&d(2,_=y.hex),"isDark"in y&&d(1,C=y.isDark)},[p,C,_]}class ms extends Et{constructor(t){super(),At(this,t,gs,ds,Ot,{pos:0,hex:2,isDark:1})}}function ps(c){let t,d;return{c:bt,m(p,_){t||(d=[ut(window,"keyup",c[0]),ut(window,"keydown",c[1])],t=!0)},p:bt,i:bt,o:bt,d(p){t=!1,It(d)}}}function vs(c,t,d){let p;jt(c,Kt,y=>d(2,p=y));function _(y){["ArrowLeft","ArrowUp","ArrowRight","ArrowDown"].includes(y.key)&&(Re(Kt,p[y.key]=0,p),Kt.set(p))}function C(y){["ArrowLeft","ArrowUp","ArrowRight","ArrowDown"].includes(y.key)&&(y.repeat||(Re(Kt,p[y.key]=1,p),Kt.set(p)))}return[_,C]}class _s extends Et{constructor(t){super(),At(this,t,vs,ps,Ot,{})}}function ys(c){let t,d;const p=c[3].default,_=we(p,c,c[2],null);return{c(){t=nt("div"),_&&_.c(),L(t,"class","picker-wrapper svelte-1isc651"),Rt(t,"focused",c[0])},m(C,y){ht(C,t,y),_&&_.m(t,null),d=!0},p(C,[y]){_&&_.p&&(!d||y&4)&&Te(_,p,C,C[2],d?Se(p,C[2],y,null):xe(C[2]),null),(!d||y&1)&&Rt(t,"focused",C[0])},i(C){d||(at(_,C),d=!0)},o(C){ft(_,C),d=!1},d(C){C&&lt(t),_&&_.d(C)}}}function bs(c,t,d){let{$$slots:p={},$$scope:_}=t,{focused:C}=t,{toRight:y}=t;return c.$$set=h=>{"focused"in h&&d(0,C=h.focused),"toRight"in h&&d(1,y=h.toRight),"$$scope"in h&&d(2,_=h.$$scope)},[C,y,_,p]}class Cs extends Et{constructor(t){super(),At(this,t,bs,ys,Ot,{focused:0,toRight:1})}}function ws(c){let t,d;const p=c[3].default,_=we(p,c,c[2],null);return{c(){t=nt("div"),_&&_.c(),L(t,"class","slider-wrapper svelte-1udewng"),Rt(t,"focused",c[0])},m(C,y){ht(C,t,y),_&&_.m(t,null),d=!0},p(C,[y]){_&&_.p&&(!d||y&4)&&Te(_,p,C,C[2],d?Se(p,C[2],y,null):xe(C[2]),null),(!d||y&1)&&Rt(t,"focused",C[0])},i(C){d||(at(_,C),d=!0)},o(C){ft(_,C),d=!1},d(C){C&&lt(t),_&&_.d(C)}}}function Ss(c,t,d){let{$$slots:p={},$$scope:_}=t,{focused:C}=t,{toRight:y}=t;return c.$$set=h=>{"focused"in h&&d(0,C=h.focused),"toRight"in h&&d(1,y=h.toRight),"$$scope"in h&&d(2,_=h.$$scope)},[C,y,_,p]}class Yi extends Et{constructor(t){super(),At(this,t,Ss,ws,Ot,{focused:0,toRight:1})}}function Ts(c){let t,d,p,_,C,y,h,e,o,l,n;return{c(){t=nt("label"),d=nt("div"),p=nt("input"),_=mt(),C=nt("div"),y=mt(),h=nt("div"),e=mt(),o=Vt(c[2]),L(p,"type","color"),p.value=c[1],L(p,"aria-haspopup","dialog"),L(p,"class","svelte-2ybi8r"),L(C,"class","alpha svelte-2ybi8r"),L(h,"class","color svelte-2ybi8r"),Nt(h,"background",c[1]),L(d,"class","container svelte-2ybi8r"),L(t,"class","svelte-2ybi8r")},m(r,i){ht(r,t,i),it(t,d),it(d,p),it(d,_),it(d,C),it(d,y),it(d,h),it(t,e),it(t,o),c[4](t),l||(n=[ut(p,"click",Ut(xs)),ut(p,"mousedown",Ut(Os)),ut(t,"click",Ut(As)),ut(t,"mousedown",Ut(Es))],l=!0)},p(r,[i]){i&2&&(p.value=r[1]),i&2&&Nt(h,"background",r[1]),i&4&&ge(o,r[2])},i:bt,o:bt,d(r){r&&lt(t),c[4](null),l=!1,It(n)}}}const xs=()=>{},Os=()=>{},As=()=>{},Es=()=>{};function ks(c,t,d){let{labelWrapper:p}=t,{hex:_}=t,{label:C}=t,{isOpen:y}=t;function h(e){Ct[e?"unshift":"push"](()=>{p=e,d(0,p)})}return c.$$set=e=>{"labelWrapper"in e&&d(0,p=e.labelWrapper),"hex"in e&&d(1,_=e.hex),"label"in e&&d(2,C=e.label),"isOpen"in e&&d(3,y=e.isOpen)},[p,_,C,y,h]}class Ps extends Et{constructor(t){super(),At(this,t,ks,Ts,Ot,{labelWrapper:0,hex:1,label:2,isOpen:3})}}function Ds(c){let t,d,p;const _=c[5].default,C=we(_,c,c[4],null);return{c(){t=nt("div"),C&&C.c(),L(t,"class","wrapper svelte-160vdtq"),L(t,"role",d=c[2]?"dialog":void 0),L(t,"aria-label","color picker"),Rt(t,"isOpen",c[1]),Rt(t,"isPopup",c[2])},m(y,h){ht(y,t,h),C&&C.m(t,null),c[6](t),p=!0},p(y,[h]){C&&C.p&&(!p||h&16)&&Te(C,_,y,y[4],p?Se(_,y[4],h,null):xe(y[4]),null),(!p||h&4&&d!==(d=y[2]?"dialog":void 0))&&L(t,"role",d),(!p||h&2)&&Rt(t,"isOpen",y[1]),(!p||h&4)&&Rt(t,"isPopup",y[2])},i(y){p||(at(C,y),p=!0)},o(y){ft(C,y),p=!1},d(y){y&&lt(t),C&&C.d(y),c[6](null)}}}function Ms(c,t,d){let{$$slots:p={},$$scope:_}=t,{wrapper:C}=t,{isOpen:y}=t,{isPopup:h}=t,{toRight:e}=t;function o(l){Ct[l?"unshift":"push"](()=>{C=l,d(0,C)})}return c.$$set=l=>{"wrapper"in l&&d(0,C=l.wrapper),"isOpen"in l&&d(1,y=l.isOpen),"isPopup"in l&&d(2,h=l.isPopup),"toRight"in l&&d(3,e=l.toRight),"$$scope"in l&&d(4,_=l.$$scope)},[C,y,h,e,_,p,o]}class Is extends Et{constructor(t){super(),At(this,t,Ms,Ds,Ot,{wrapper:0,isOpen:1,isPopup:2,toRight:3})}}function zi(c,t,d){const p=c.slice();return p[9]=t[d].contrast,p[10]=t[d].hex,p[11]=t[d].placeholder,p[12]=t[d].reverse,p[13]=t[d].size,p}function Ui(c){let t,d,p;var _=c[0].a11ySingleNotice;function C(y){return{props:{contrast:y[9],textColor:y[12]?y[10]:y[1],bgColor:y[12]?y[1]:y[10],placeholder:y[11],size:y[13]}}}return _&&(t=St(_,C(c))),{c(){t&&yt(t.$$.fragment),d=Gt()},m(y,h){t&&pt(t,y,h),ht(y,d,h),p=!0},p(y,h){const e={};if(h&16&&(e.contrast=y[9]),h&18&&(e.textColor=y[12]?y[10]:y[1]),h&18&&(e.bgColor=y[12]?y[1]:y[10]),h&16&&(e.placeholder=y[11]),h&16&&(e.size=y[13]),h&1&&_!==(_=y[0].a11ySingleNotice)){if(t){Dt();const o=t;ft(o.$$.fragment,1,0,()=>{vt(o,1)}),Mt()}_?(t=St(_,C(y)),yt(t.$$.fragment),at(t.$$.fragment,1),pt(t,d.parentNode,d)):t=null}else _&&t.$set(e)},i(y){p||(t&&at(t.$$.fragment,y),p=!0)},o(y){t&&ft(t.$$.fragment,y),p=!1},d(y){y&&lt(d),t&&vt(t,y)}}}function Vi(c){let t;return{c(){t=nt("span"),L(t,"class","svelte-1s4dluu")},m(d,p){ht(d,t,p),t.innerHTML=c[2]},p(d,p){p&4&&(t.innerHTML=d[2])},d(d){d&&lt(t)}}}function Fs(c){let t,d,p,_,C,y,h,e,o;var l=c[0].a11ySummary;function n(s){return{props:{a11yColors:s[4],hex:s[1]}}}l&&(p=St(l,n(c)));let r=c[4],i=[];for(let s=0;s<r.length;s+=1)i[s]=Ui(zi(c,r,s));const a=s=>ft(i[s],1,1,()=>{i[s]=null});let u=c[2]&&Vi(c);return{c(){t=nt("details"),d=nt("summary"),p&&yt(p.$$.fragment),C=mt(),y=nt("div");for(let s=0;s<i.length;s+=1)i[s].c();h=mt(),u&&u.c(),L(d,"tabindex",_=c[5]?-1:void 0),L(d,"class","svelte-1s4dluu"),L(y,"class","svelte-1s4dluu"),L(t,"class",e="a11y-notice "+(c[5]?"not-closable":"")+" svelte-1s4dluu"),t.open=c[3]},m(s,f){ht(s,t,f),it(t,d),p&&pt(p,d,null),it(t,C),it(t,y);for(let g=0;g<i.length;g+=1)i[g]&&i[g].m(y,null);it(y,h),u&&u.m(y,null),o=!0},p(s,[f]){const g={};if(f&16&&(g.a11yColors=s[4]),f&2&&(g.hex=s[1]),f&1&&l!==(l=s[0].a11ySummary)){if(p){Dt();const m=p;ft(m.$$.fragment,1,0,()=>{vt(m,1)}),Mt()}l?(p=St(l,n(s)),yt(p.$$.fragment),at(p.$$.fragment,1),pt(p,d,null)):p=null}else l&&p.$set(g);if((!o||f&32&&_!==(_=s[5]?-1:void 0))&&L(d,"tabindex",_),f&19){r=s[4];let m;for(m=0;m<r.length;m+=1){const v=zi(s,r,m);i[m]?(i[m].p(v,f),at(i[m],1)):(i[m]=Ui(v),i[m].c(),at(i[m],1),i[m].m(y,h))}for(Dt(),m=r.length;m<i.length;m+=1)a(m);Mt()}s[2]?u?u.p(s,f):(u=Vi(s),u.c(),u.m(y,null)):u&&(u.d(1),u=null),(!o||f&32&&e!==(e="a11y-notice "+(s[5]?"not-closable":"")+" svelte-1s4dluu"))&&L(t,"class",e),(!o||f&8)&&(t.open=s[3])},i(s){if(!o){p&&at(p.$$.fragment,s);for(let f=0;f<r.length;f+=1)at(i[f]);o=!0}},o(s){p&&ft(p.$$.fragment,s),i=i.filter(Boolean);for(let f=0;f<i.length;f+=1)ft(i[f]);o=!1},d(s){s&&lt(t),p&&vt(p),Le(i,s),u&&u.d()}}}function Rs(c,t,d){let p,_,{components:C}=t,{a11yColors:y}=t,{hex:h}=t,{color:e}=t,{a11yGuidelines:o}=t,{isA11yOpen:l}=t,{isA11yClosable:n}=t;return c.$$set=r=>{"components"in r&&d(0,C=r.components),"a11yColors"in r&&d(6,y=r.a11yColors),"hex"in r&&d(1,h=r.hex),"color"in r&&d(7,e=r.color),"a11yGuidelines"in r&&d(2,o=r.a11yGuidelines),"isA11yOpen"in r&&d(3,l=r.isA11yOpen),"isA11yClosable"in r&&d(8,n=r.isA11yClosable)},c.$$.update=()=>{c.$$.dirty&264&&d(5,p=l&&!n),c.$$.dirty&192&&d(4,_=y.map(r=>({...r,contrast:e==null?void 0:e.contrast(r.hex)})))},[C,h,o,l,_,p,y,e,n]}class Ls extends Et{constructor(t){super(),At(this,t,Rs,Fs,Ot,{components:0,a11yColors:6,hex:1,color:7,a11yGuidelines:2,isA11yOpen:3,isA11yClosable:8})}}function Bs(c){let t,d,p=(c[2]||"Lorem Ipsum")+"",_,C,y,h,e,o,l=(c[3]>=10?c[3].toFixed(1):c[3])+"",n,r,i,a,u;return{c(){t=nt("div"),d=nt("p"),_=Vt(p),y=mt(),h=nt("div"),e=nt("p"),o=Vt("contrast: "),n=Vt(l),r=mt(),i=nt("span"),i.textContent="AA",a=mt(),u=nt("span"),u.textContent="AAA",L(d,"class",C="lorem "+(c[4]==="large"&&"large")+" svelte-obnxge"),Nt(d,"color",c[0]),Nt(d,"background-color",c[1]),L(e,"class","svelte-obnxge"),L(i,"class","grade svelte-obnxge"),Rt(i,"grade-ok",c[3]>(c[4]==="large"?3:4.5)),L(u,"class","grade svelte-obnxge"),Rt(u,"grade-ok",c[3]>(c[4]==="large"?4.5:7)),L(h,"class","score svelte-obnxge"),L(t,"class","a11y-single-notice svelte-obnxge")},m(s,f){ht(s,t,f),it(t,d),it(d,_),it(t,y),it(t,h),it(h,e),it(e,o),it(e,n),it(h,r),it(h,i),it(h,a),it(h,u)},p(s,[f]){f&4&&p!==(p=(s[2]||"Lorem Ipsum")+"")&&ge(_,p),f&16&&C!==(C="lorem "+(s[4]==="large"&&"large")+" svelte-obnxge")&&L(d,"class",C),f&1&&Nt(d,"color",s[0]),f&2&&Nt(d,"background-color",s[1]),f&8&&l!==(l=(s[3]>=10?s[3].toFixed(1):s[3])+"")&&ge(n,l),f&24&&Rt(i,"grade-ok",s[3]>(s[4]==="large"?3:4.5)),f&24&&Rt(u,"grade-ok",s[3]>(s[4]==="large"?4.5:7))},i:bt,o:bt,d(s){s&&lt(t)}}}function js(c,t,d){let{textColor:p}=t,{bgColor:_}=t,{placeholder:C=void 0}=t,{contrast:y=1}=t,{size:h=void 0}=t;return c.$$set=e=>{"textColor"in e&&d(0,p=e.textColor),"bgColor"in e&&d(1,_=e.bgColor),"placeholder"in e&&d(2,C=e.placeholder),"contrast"in e&&d(3,y=e.contrast),"size"in e&&d(4,h=e.size)},[p,_,C,y,h]}class Ws extends Et{constructor(t){super(),At(this,t,js,Bs,Ot,{textColor:0,bgColor:1,placeholder:2,contrast:3,size:4})}}function Ns(c){let t;return{c(){t=Vt(c[0])},m(d,p){ht(d,t,p)},p(d,[p]){p&1&&ge(t,d[0])},i:bt,o:bt,d(d){d&&lt(t)}}}function Xs({contrast:c,size:t}){return c?t==="large"?c<3?2:c<4.5?1:0:c<4.5?2:c<7?1:0:1}function Hs(c,t,d){let p,_,{a11yColors:C}=t,{hex:y}=t;return c.$$set=h=>{"a11yColors"in h&&d(1,C=h.a11yColors),"hex"in h&&d(2,y=h.hex)},c.$$.update=()=>{c.$$.dirty&2&&d(3,p=C.map(Xs).reduce((h,e)=>h+e)),c.$$.dirty&8&&d(0,_=p?`⚠️ ${p} contrast grade${p&&"s"} fail`:"Contrast grade information")},[_,C,y,p]}class Ys extends Et{constructor(t){super(),At(this,t,Hs,Ns,Ot,{a11yColors:1,hex:2})}}function zs(c){let t;return{c(){t=nt("input"),L(t,"type","hidden"),t.value=c[2]},m(d,p){ht(d,t,p)},p(d,p){p[0]&4&&(t.value=d[2])},i:bt,o:bt,d(d){d&&lt(t)}}}function Us(c){let t,d,p,_,C;function y(l){c[25](l)}function h(l){c[26](l)}var e=c[21]().input;function o(l){let n={hex:l[2],label:l[6]};return l[19]!==void 0&&(n.labelWrapper=l[19]),l[3]!==void 0&&(n.isOpen=l[3]),{props:n}}return e&&(t=St(e,o(c)),Ct.push(()=>Pt(t,"labelWrapper",y)),Ct.push(()=>Pt(t,"isOpen",h))),{c(){t&&yt(t.$$.fragment),_=Gt()},m(l,n){t&&pt(t,l,n),ht(l,_,n),C=!0},p(l,n){const r={};if(n[0]&4&&(r.hex=l[2]),n[0]&64&&(r.label=l[6]),!d&&n[0]&524288&&(d=!0,r.labelWrapper=l[19],Wt(()=>d=!1)),!p&&n[0]&8&&(p=!0,r.isOpen=l[3],Wt(()=>p=!1)),e!==(e=l[21]().input)){if(t){Dt();const i=t;ft(i.$$.fragment,1,0,()=>{vt(i,1)}),Mt()}e?(t=St(e,o(l)),Ct.push(()=>Pt(t,"labelWrapper",y)),Ct.push(()=>Pt(t,"isOpen",h)),yt(t.$$.fragment),at(t.$$.fragment,1),pt(t,_.parentNode,_)):t=null}else e&&t.$set(r)},i(l){C||(t&&at(t.$$.fragment,l),C=!0)},o(l){t&&ft(t.$$.fragment,l),C=!1},d(l){l&&lt(_),t&&vt(t,l)}}}function Gi(c){let t,d,p,_;function C(e){c[31](e)}function y(e){c[32](e)}let h={components:c[21](),hex:c[2],toRight:c[17]};return c[1].a!==void 0&&(h.a=c[1].a),c[3]!==void 0&&(h.isOpen=c[3]),t=new ns({props:h}),Ct.push(()=>Pt(t,"a",C)),Ct.push(()=>Pt(t,"isOpen",y)),{c(){yt(t.$$.fragment)},m(e,o){pt(t,e,o),_=!0},p(e,o){const l={};o[0]&4&&(l.hex=e[2]),o[0]&131072&&(l.toRight=e[17]),!d&&o[0]&2&&(d=!0,l.a=e[1].a,Wt(()=>d=!1)),!p&&o[0]&8&&(p=!0,l.isOpen=e[3],Wt(()=>p=!1)),t.$set(l)},i(e){_||(at(t.$$.fragment,e),_=!0)},o(e){ft(t.$$.fragment,e),_=!1},d(e){vt(t,e)}}}function qi(c){let t,d,p,_,C,y;function h(r){c[33](r)}function e(r){c[34](r)}function o(r){c[35](r)}var l=c[21]().textInput;function n(r){let i={isAlpha:r[7],canChangeMode:r[10]};return r[2]!==void 0&&(i.hex=r[2]),r[0]!==void 0&&(i.rgb=r[0]),r[1]!==void 0&&(i.hsv=r[1]),{props:i}}return l&&(t=St(l,n(c)),Ct.push(()=>Pt(t,"hex",h)),Ct.push(()=>Pt(t,"rgb",e)),Ct.push(()=>Pt(t,"hsv",o))),{c(){t&&yt(t.$$.fragment),C=Gt()},m(r,i){t&&pt(t,r,i),ht(r,C,i),y=!0},p(r,i){const a={};if(i[0]&128&&(a.isAlpha=r[7]),i[0]&1024&&(a.canChangeMode=r[10]),!d&&i[0]&4&&(d=!0,a.hex=r[2],Wt(()=>d=!1)),!p&&i[0]&1&&(p=!0,a.rgb=r[0],Wt(()=>p=!1)),!_&&i[0]&2&&(_=!0,a.hsv=r[1],Wt(()=>_=!1)),l!==(l=r[21]().textInput)){if(t){Dt();const u=t;ft(u.$$.fragment,1,0,()=>{vt(u,1)}),Mt()}l?(t=St(l,n(r)),Ct.push(()=>Pt(t,"hex",h)),Ct.push(()=>Pt(t,"rgb",e)),Ct.push(()=>Pt(t,"hsv",o)),yt(t.$$.fragment),at(t.$$.fragment,1),pt(t,C.parentNode,C)):t=null}else l&&t.$set(a)},i(r){y||(t&&at(t.$$.fragment,r),y=!0)},o(r){t&&ft(t.$$.fragment,r),y=!1},d(r){r&&lt(C),t&&vt(t,r)}}}function Ki(c){let t,d,p;var _=c[21]().a11yNotice;function C(y){return{props:{components:y[21](),a11yColors:y[12],color:y[4],hex:y[2],a11yGuidelines:y[13],isA11yOpen:y[14],isA11yClosable:y[15]}}}return _&&(t=St(_,C(c))),{c(){t&&yt(t.$$.fragment),d=Gt()},m(y,h){t&&pt(t,y,h),ht(y,d,h),p=!0},p(y,h){const e={};if(h[0]&4096&&(e.a11yColors=y[12]),h[0]&16&&(e.color=y[4]),h[0]&4&&(e.hex=y[2]),h[0]&8192&&(e.a11yGuidelines=y[13]),h[0]&16384&&(e.isA11yOpen=y[14]),h[0]&32768&&(e.isA11yClosable=y[15]),_!==(_=y[21]().a11yNotice)){if(t){Dt();const o=t;ft(o.$$.fragment,1,0,()=>{vt(o,1)}),Mt()}_?(t=St(_,C(y)),yt(t.$$.fragment),at(t.$$.fragment,1),pt(t,d.parentNode,d)):t=null}else _&&t.$set(e)},i(y){p||(t&&at(t.$$.fragment,y),p=!0)},o(y){t&&ft(t.$$.fragment,y),p=!1},d(y){y&&lt(d),t&&vt(t,y)}}}function Vs(c){let t,d,p,_,C,y,h,e,o,l,n,r;function i(w){c[27](w)}function a(w){c[28](w)}function u(w){c[29](w)}let s={components:c[21](),h:c[1].h,toRight:c[17],isDark:c[5]};c[1].s!==void 0&&(s.s=c[1].s),c[1].v!==void 0&&(s.v=c[1].v),c[3]!==void 0&&(s.isOpen=c[3]),t=new Kr({props:s}),Ct.push(()=>Pt(t,"s",i)),Ct.push(()=>Pt(t,"v",a)),Ct.push(()=>Pt(t,"isOpen",u));function f(w){c[30](w)}let g={components:c[21](),toRight:c[17]};c[1].h!==void 0&&(g.h=c[1].h),y=new $r({props:g}),Ct.push(()=>Pt(y,"h",f));let m=c[7]&&Gi(c),v=c[9]&&qi(c),b=c[11]&&Ki(c);return{c(){yt(t.$$.fragment),C=mt(),yt(y.$$.fragment),e=mt(),m&&m.c(),o=mt(),v&&v.c(),l=mt(),b&&b.c(),n=Gt()},m(w,S){pt(t,w,S),ht(w,C,S),pt(y,w,S),ht(w,e,S),m&&m.m(w,S),ht(w,o,S),v&&v.m(w,S),ht(w,l,S),b&&b.m(w,S),ht(w,n,S),r=!0},p(w,S){const A={};S[0]&2&&(A.h=w[1].h),S[0]&131072&&(A.toRight=w[17]),S[0]&32&&(A.isDark=w[5]),!d&&S[0]&2&&(d=!0,A.s=w[1].s,Wt(()=>d=!1)),!p&&S[0]&2&&(p=!0,A.v=w[1].v,Wt(()=>p=!1)),!_&&S[0]&8&&(_=!0,A.isOpen=w[3],Wt(()=>_=!1)),t.$set(A);const D={};S[0]&131072&&(D.toRight=w[17]),!h&&S[0]&2&&(h=!0,D.h=w[1].h,Wt(()=>h=!1)),y.$set(D),w[7]?m?(m.p(w,S),S[0]&128&&at(m,1)):(m=Gi(w),m.c(),at(m,1),m.m(o.parentNode,o)):m&&(Dt(),ft(m,1,1,()=>{m=null}),Mt()),w[9]?v?(v.p(w,S),S[0]&512&&at(v,1)):(v=qi(w),v.c(),at(v,1),v.m(l.parentNode,l)):v&&(Dt(),ft(v,1,1,()=>{v=null}),Mt()),w[11]?b?(b.p(w,S),S[0]&2048&&at(b,1)):(b=Ki(w),b.c(),at(b,1),b.m(n.parentNode,n)):b&&(Dt(),ft(b,1,1,()=>{b=null}),Mt())},i(w){r||(at(t.$$.fragment,w),at(y.$$.fragment,w),at(m),at(v),at(b),r=!0)},o(w){ft(t.$$.fragment,w),ft(y.$$.fragment,w),ft(m),ft(v),ft(b),r=!1},d(w){vt(t,w),w&&lt(C),vt(y,w),w&&lt(e),m&&m.d(w),w&&lt(o),v&&v.d(w),w&&lt(l),b&&b.d(w),w&&lt(n)}}}function Gs(c){let t,d,p,_,C,y,h,e,o,l,n;t=new _s({});const r=[Us,zs],i=[];function a(g,m){return g[8]?0:1}_=a(c),C=i[_]=r[_](c);function u(g){c[36](g)}var s=c[21]().wrapper;function f(g){let m={isOpen:g[3],isPopup:g[16],toRight:g[17],$$slots:{default:[Vs]},$$scope:{ctx:g}};return g[20]!==void 0&&(m.wrapper=g[20]),{props:m}}return s&&(h=St(s,f(c)),Ct.push(()=>Pt(h,"wrapper",u))),{c(){yt(t.$$.fragment),d=mt(),p=nt("span"),C.c(),y=mt(),h&&yt(h.$$.fragment),L(p,"class","color-picker svelte-7ntk55")},m(g,m){pt(t,g,m),ht(g,d,m),ht(g,p,m),i[_].m(p,null),it(p,y),h&&pt(h,p,null),c[37](p),o=!0,l||(n=[ut(window,"mousedown",c[22]),ut(window,"keyup",c[23])],l=!0)},p(g,m){let v=_;_=a(g),_===v?i[_].p(g,m):(Dt(),ft(i[v],1,1,()=>{i[v]=null}),Mt(),C=i[_],C?C.p(g,m):(C=i[_]=r[_](g),C.c()),at(C,1),C.m(p,y));const b={};if(m[0]&8&&(b.isOpen=g[3]),m[0]&65536&&(b.isPopup=g[16]),m[0]&131072&&(b.toRight=g[17]),m[0]&196287|m[1]&8192&&(b.$$scope={dirty:m,ctx:g}),!e&&m[0]&1048576&&(e=!0,b.wrapper=g[20],Wt(()=>e=!1)),s!==(s=g[21]().wrapper)){if(h){Dt();const w=h;ft(w.$$.fragment,1,0,()=>{vt(w,1)}),Mt()}s?(h=St(s,f(g)),Ct.push(()=>Pt(h,"wrapper",u)),yt(h.$$.fragment),at(h.$$.fragment,1),pt(h,p,null)):h=null}else s&&h.$set(b)},i(g){o||(at(t.$$.fragment,g),at(C),h&&at(h.$$.fragment,g),o=!0)},o(g){ft(t.$$.fragment,g),ft(C),h&&ft(h.$$.fragment,g),o=!1},d(g){vt(t,g),g&&lt(d),g&&lt(p),i[_].d(),h&&vt(h),c[37](null),l=!1,It(n)}}}function qs(c,t,d){Hr([Yr]);let{components:p={}}=t;const _=Tr();let{label:C="Choose a color"}=t,{isAlpha:y=!0}=t,{isInput:h=!0}=t,{isTextInput:e=!0}=t,{canChangeMode:o=!0}=t,{isA11y:l=!1}=t,{a11yColors:n=[{hex:"#ffffff"}]}=t,{a11yGuidelines:r='<p style="margin: 0; font-size: 12px;">Learn more at <a href="https://webaim.org/articles/contrast/" target="_blank">WebAIM contrast guide</a></p>'}=t,{isA11yOpen:i=!1}=t,{isA11yClosable:a=!0}=t,{isPopup:u=h}=t,{isOpen:s=!h}=t,{toRight:f=!1}=t,{rgb:g={r:255,g:0,b:0,a:1}}=t,{hsv:m={h:0,s:100,v:100,a:1}}=t,{hex:v="#ff0000"}=t,{color:b=void 0}=t,{isDark:w=!1}=t,S={r:255,g:0,b:0,a:1},A={h:0,s:100,v:100,a:1},D="#ff0000",X;const K={sliderIndicator:Hi,pickerIndicator:ms,alphaIndicator:Hi,pickerWrapper:Cs,sliderWrapper:Yi,alphaWrapper:Yi,textInput:cs,a11yNotice:Ls,a11ySingleNotice:Ws,a11ySummary:Ys,input:Ps,wrapper:Is};function $(){return{...K,...p}}let H,J;function Z({target:I}){h&&(H.contains(I)||H.isSameNode(I)?d(3,s=!s):s&&!J.contains(I)&&d(3,s=!1))}function Q(I){I.key==="Tab"&&d(3,s=X==null?void 0:X.contains(document.activeElement))}function rt(){m.h===A.h&&m.s===A.s&&m.v===A.v&&m.a===A.a&&g.r===S.r&&g.g===S.g&&g.b===S.b&&g.a===S.a&&v===D||(m.a===void 0&&d(1,m.a=1,m),A.a===void 0&&(A.a=1),g.a===void 0&&d(0,g.a=1,g),S.a===void 0&&(S.a=1),(v==null?void 0:v.substring(7))==="ff"&&d(2,v=v.substring(0,7)),(v==null?void 0:v.substring(7))==="ff"&&d(2,v=v.substring(0,7)),m.h!==A.h||m.s!==A.s||m.v!==A.v||m.a!==A.a?(d(4,b=Bt(m)),d(0,g=b.toRgb()),d(2,v=b.toHex())):g.r!==S.r||g.g!==S.g||g.b!==S.b||g.a!==S.a?(d(4,b=Bt(g)),d(2,v=b.toHex()),d(1,m=b.toHsv())):v!==D&&(d(4,b=Bt(v)),d(0,g=b.toRgb()),d(1,m=b.toHsv())),b&&d(5,w=b.isDark()),A=Object.assign({},m),S=Object.assign({},g),D=v,_("input",{color:b,hsv:m,rgb:g,hex:v}))}function st(I){H=I,d(19,H)}function T(I){s=I,d(3,s)}function k(I){c.$$.not_equal(m.s,I)&&(m.s=I,d(1,m))}function P(I){c.$$.not_equal(m.v,I)&&(m.v=I,d(1,m))}function E(I){s=I,d(3,s)}function B(I){c.$$.not_equal(m.h,I)&&(m.h=I,d(1,m))}function O(I){c.$$.not_equal(m.a,I)&&(m.a=I,d(1,m))}function x(I){s=I,d(3,s)}function M(I){v=I,d(2,v)}function R(I){g=I,d(0,g)}function Y(I){m=I,d(1,m)}function j(I){J=I,d(20,J)}function G(I){Ct[I?"unshift":"push"](()=>{X=I,d(18,X)})}return c.$$set=I=>{"components"in I&&d(24,p=I.components),"label"in I&&d(6,C=I.label),"isAlpha"in I&&d(7,y=I.isAlpha),"isInput"in I&&d(8,h=I.isInput),"isTextInput"in I&&d(9,e=I.isTextInput),"canChangeMode"in I&&d(10,o=I.canChangeMode),"isA11y"in I&&d(11,l=I.isA11y),"a11yColors"in I&&d(12,n=I.a11yColors),"a11yGuidelines"in I&&d(13,r=I.a11yGuidelines),"isA11yOpen"in I&&d(14,i=I.isA11yOpen),"isA11yClosable"in I&&d(15,a=I.isA11yClosable),"isPopup"in I&&d(16,u=I.isPopup),"isOpen"in I&&d(3,s=I.isOpen),"toRight"in I&&d(17,f=I.toRight),"rgb"in I&&d(0,g=I.rgb),"hsv"in I&&d(1,m=I.hsv),"hex"in I&&d(2,v=I.hex),"color"in I&&d(4,b=I.color),"isDark"in I&&d(5,w=I.isDark)},c.$$.update=()=>{c.$$.dirty[0]&7&&(m||g||v)&&rt()},[g,m,v,s,b,w,C,y,h,e,o,l,n,r,i,a,u,f,X,H,J,$,Z,Q,p,st,T,k,P,E,B,O,x,M,R,Y,j,G]}class Ks extends Et{constructor(t){super(),At(this,t,qs,Gs,Ot,{components:24,label:6,isAlpha:7,isInput:8,isTextInput:9,canChangeMode:10,isA11y:11,a11yColors:12,a11yGuidelines:13,isA11yOpen:14,isA11yClosable:15,isPopup:16,isOpen:3,toRight:17,rgb:0,hsv:1,hex:2,color:4,isDark:5},null,[-1,-1])}}const Js="/assets/glasses-ca8642be.png",Qs="/assets/laptop-afa03861.png",Zs="/assets/hair-416c3326.png",$s="/assets/coffee-7794bf02.png",Ji=pe("#F9BB01"),Be=pe(),Ae=pe(600),ta={glasses:!1,hair:!1,laptop:!1,coffee:!1},je={glasses:{title:"안경",src:Js},hair:{title:"앞머리",src:Zs},laptop:{title:"노트북",src:Qs},coffee:{title:"커피",src:$s}},Mn=pe(ta),ea=c=>{Mn.update(t=>({...t,[c]:!t[c]}))},ia="/assets/watermark-c2d43a34.png",na="/assets/close-7faef788.svg";const ra=c=>({}),Qi=c=>({});function sa(c){let t,d,p,_,C,y,h,e,o,l;const n=c[3].header,r=we(n,c,c[2],Qi),i=c[3].default,a=we(i,c,c[2],null);return{c(){t=nt("dialog"),d=nt("div"),r&&r.c(),p=mt(),a&&a.c(),_=mt(),C=nt("button"),y=nt("img"),li(y.src,h=na)||L(y,"src",h),L(y,"aria-hidden",""),L(y,"alt","닫기"),L(C,"class","close svelte-ckxgtn"),C.autofocus=!0,L(C,"aria-label","닫기"),L(d,"class","svelte-ckxgtn"),L(t,"class","svelte-ckxgtn")},m(u,s){ht(u,t,s),it(t,d),r&&r.m(d,null),it(d,p),a&&a.m(d,null),it(d,_),it(d,C),it(C,y),c[6](t),e=!0,C.focus(),o||(l=[ut(C,"click",c[5]),ut(d,"click",re(c[4])),ut(t,"close",c[7]),ut(t,"click",Cr(c[8]))],o=!0)},p(u,[s]){r&&r.p&&(!e||s&4)&&Te(r,n,u,u[2],e?Se(n,u[2],s,ra):xe(u[2]),Qi),a&&a.p&&(!e||s&4)&&Te(a,i,u,u[2],e?Se(i,u[2],s,null):xe(u[2]),null)},i(u){e||(at(r,u),at(a,u),e=!0)},o(u){ft(r,u),ft(a,u),e=!1},d(u){u&&lt(t),r&&r.d(u),a&&a.d(u),c[6](null),o=!1,It(l)}}}function aa(c,t,d){let{$$slots:p={},$$scope:_}=t,{showModal:C}=t,y;function h(r){xr.call(this,c,r)}const e=()=>y.close();function o(r){Ct[r?"unshift":"push"](()=>{y=r,d(1,y)})}const l=()=>d(0,C=!1),n=()=>y.close();return c.$$set=r=>{"showModal"in r&&d(0,C=r.showModal),"$$scope"in r&&d(2,_=r.$$scope)},c.$$.update=()=>{c.$$.dirty&3&&y&&C&&y.showModal()},[C,y,_,p,h,e,o,l,n]}class oa extends Et{constructor(t){super(),At(this,t,aa,sa,Ot,{showModal:0})}}function la(c){let t,d,p,_,C,y;return{c(){t=nt("img"),p=mt(),_=nt("button"),_.textContent="저장하기",li(t.src,d=c[3])||L(t,"src",d),L(t,"alt","데브진스"),L(_,"class","save svelte-9v3wcg")},m(h,e){ht(h,t,e),ht(h,p,e),ht(h,_,e),C||(y=ut(_,"click",c[7]),C=!0)},p(h,e){e&8&&!li(t.src,d=h[3])&&L(t,"src",d)},d(h){h&&lt(t),h&&lt(p),h&&lt(_),C=!1,y()}}}function ha(c){let t;return{c(){t=nt("h2"),t.textContent="짜잔~ 완성된 이미지에요.",L(t,"slot","header"),L(t,"class","svelte-9v3wcg")},m(d,p){ht(d,t,p)},p:bt,d(d){d&&lt(t)}}}function ca(c){let t,d,p,_,C,y,h,e,o,l,n,r,i,a,u,s,f,g,m,v,b,w,S,A,D,X,K;function $(Q){c[9](Q)}let H={$$slots:{header:[ha],default:[la]},$$scope:{ctx:c}};c[2]!==void 0&&(H.showModal=c[2]),t=new oa({props:H}),Ct.push(()=>Pt(t,"showModal",$));function J(Q){c[10](Q)}let Z={isA11yClosable:!1,label:"배경색"};return c[0]!==void 0&&(Z.hex=c[0]),e=new Ks({props:Z}),Ct.push(()=>Pt(e,"hex",J)),{c(){yt(t.$$.fragment),p=mt(),_=nt("div"),C=nt("div"),y=nt("h2"),y.textContent="배경색",h=mt(),yt(e.$$.fragment),l=mt(),n=nt("div"),r=nt("h2"),r.textContent="사진 추가",i=mt(),a=nt("div"),u=nt("button"),u.textContent="추가",s=mt(),f=nt("button"),f.textContent="제거",g=mt(),m=nt("input"),v=mt(),b=nt("div"),w=nt("h2"),w.textContent="이미지",S=mt(),A=nt("button"),A.textContent="만들기",L(y,"class","svelte-9v3wcg"),L(C,"class","svelte-9v3wcg"),L(r,"class","svelte-9v3wcg"),L(u,"class","svelte-9v3wcg"),L(f,"class","svelte-9v3wcg"),L(m,"type","file"),L(m,"accept","image/*"),Nt(m,"display","none"),L(n,"class","svelte-9v3wcg"),L(w,"class","svelte-9v3wcg"),L(A,"class","svelte-9v3wcg"),L(b,"class","svelte-9v3wcg"),L(_,"class","toolbar svelte-9v3wcg")},m(Q,rt){pt(t,Q,rt),ht(Q,p,rt),ht(Q,_,rt),it(_,C),it(C,y),it(C,h),pt(e,C,null),it(_,l),it(_,n),it(n,r),it(n,i),it(n,a),it(a,u),it(a,s),it(a,f),it(n,g),it(n,m),c[12](m),it(_,v),it(_,b),it(b,w),it(b,S),it(b,A),D=!0,X||(K=[ut(u,"click",c[11]),ut(f,"click",c[5]),ut(m,"change",c[4]),ut(A,"click",c[6])],X=!0)},p(Q,[rt]){const st={};rt&16392&&(st.$$scope={dirty:rt,ctx:Q}),!d&&rt&4&&(d=!0,st.showModal=Q[2],Wt(()=>d=!1)),t.$set(st);const T={};!o&&rt&1&&(o=!0,T.hex=Q[0],Wt(()=>o=!1)),e.$set(T)},i(Q){D||(at(t.$$.fragment,Q),at(e.$$.fragment,Q),D=!0)},o(Q){ft(t.$$.fragment,Q),ft(e.$$.fragment,Q),D=!1},d(Q){vt(t,Q),Q&&lt(p),Q&&lt(_),vt(e),c[12](null),X=!1,It(K)}}}function ua(c,t,d){let p,_,C;jt(c,Be,f=>d(8,p=f)),jt(c,Ae,f=>d(13,_=f)),jt(c,Ji,f=>d(0,C=f));let y,h=!1,e="";const o=f=>{const g=f.currentTarget.files;if(!g)return;const m=g[0];if(!m)return;l();const v=URL.createObjectURL(m);me.fabric.Image.fromURL(v,function(b){const w=.39166666666666666,S=360/600;b.set({left:w*_,top:S*_,angle:-10}),b.set("logo","logo"),b.scaleToWidth(_/6),p.add(b)})},l=()=>{p.getObjects().filter(m=>m.logo==="logo").forEach(m=>p.remove(m))},n=()=>{me.fabric.Image.fromURL(ia,function(f){f.scaleToWidth(_),f.scaleToWidth(_),f.selectable=!1,p.add(f),p.renderAll(),d(3,e=p.toDataURL({format:"png",quality:1,multiplier:4})),p.remove(f),d(2,h=!0)})},r=()=>{const f=document.createElement("a");f.download="dev-jeans.png",f.href=e,f.click()};function i(f){h=f,d(2,h)}function a(f){C=f,Ji.set(C)}const u=()=>y.click();function s(f){Ct[f?"unshift":"push"](()=>{y=f,d(1,y)})}return c.$$.update=()=>{c.$$.dirty&257&&p&&p.setBackgroundColor(C,()=>{p.renderAll()})},[C,y,h,e,o,l,n,r,p,i,a,u,s]}class fa extends Et{constructor(t){super(),At(this,t,ua,ca,Ot,{})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const In=function(c){const t=[];let d=0;for(let p=0;p<c.length;p++){let _=c.charCodeAt(p);_<128?t[d++]=_:_<2048?(t[d++]=_>>6|192,t[d++]=_&63|128):(_&64512)===55296&&p+1<c.length&&(c.charCodeAt(p+1)&64512)===56320?(_=65536+((_&1023)<<10)+(c.charCodeAt(++p)&1023),t[d++]=_>>18|240,t[d++]=_>>12&63|128,t[d++]=_>>6&63|128,t[d++]=_&63|128):(t[d++]=_>>12|224,t[d++]=_>>6&63|128,t[d++]=_&63|128)}return t},da=function(c){const t=[];let d=0,p=0;for(;d<c.length;){const _=c[d++];if(_<128)t[p++]=String.fromCharCode(_);else if(_>191&&_<224){const C=c[d++];t[p++]=String.fromCharCode((_&31)<<6|C&63)}else if(_>239&&_<365){const C=c[d++],y=c[d++],h=c[d++],e=((_&7)<<18|(C&63)<<12|(y&63)<<6|h&63)-65536;t[p++]=String.fromCharCode(55296+(e>>10)),t[p++]=String.fromCharCode(56320+(e&1023))}else{const C=c[d++],y=c[d++];t[p++]=String.fromCharCode((_&15)<<12|(C&63)<<6|y&63)}}return t.join("")},Fn={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(c,t){if(!Array.isArray(c))throw Error("encodeByteArray takes an array as a parameter");this.init_();const d=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,p=[];for(let _=0;_<c.length;_+=3){const C=c[_],y=_+1<c.length,h=y?c[_+1]:0,e=_+2<c.length,o=e?c[_+2]:0,l=C>>2,n=(C&3)<<4|h>>4;let r=(h&15)<<2|o>>6,i=o&63;e||(i=64,y||(r=64)),p.push(d[l],d[n],d[r],d[i])}return p.join("")},encodeString(c,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(c):this.encodeByteArray(In(c),t)},decodeString(c,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(c):da(this.decodeStringToByteArray(c,t))},decodeStringToByteArray(c,t){this.init_();const d=t?this.charToByteMapWebSafe_:this.charToByteMap_,p=[];for(let _=0;_<c.length;){const C=d[c.charAt(_++)],h=_<c.length?d[c.charAt(_)]:0;++_;const o=_<c.length?d[c.charAt(_)]:64;++_;const n=_<c.length?d[c.charAt(_)]:64;if(++_,C==null||h==null||o==null||n==null)throw new ga;const r=C<<2|h>>4;if(p.push(r),o!==64){const i=h<<4&240|o>>2;if(p.push(i),n!==64){const a=o<<6&192|n;p.push(a)}}}return p},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let c=0;c<this.ENCODED_VALS.length;c++)this.byteToCharMap_[c]=this.ENCODED_VALS.charAt(c),this.charToByteMap_[this.byteToCharMap_[c]]=c,this.byteToCharMapWebSafe_[c]=this.ENCODED_VALS_WEBSAFE.charAt(c),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[c]]=c,c>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(c)]=c,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(c)]=c)}}};class ga extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ma=function(c){const t=In(c);return Fn.encodeByteArray(t,!0)},Rn=function(c){return ma(c).replace(/\./g,"")},pa=function(c){try{return Fn.decodeString(c,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function va(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _a=()=>va().__FIREBASE_DEFAULTS__,ya=()=>{if(typeof process>"u"||typeof process.env>"u")return;const c={}.__FIREBASE_DEFAULTS__;if(c)return JSON.parse(c)},ba=()=>{if(typeof document>"u")return;let c;try{c=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=c&&pa(c[1]);return t&&JSON.parse(t)},Ca=()=>{try{return _a()||ya()||ba()}catch(c){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${c}`);return}},wa=()=>{var c;return(c=Ca())===null||c===void 0?void 0:c.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sa{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,d)=>{this.resolve=t,this.reject=d})}wrapCallback(t){return(d,p)=>{d?this.reject(d):this.resolve(p),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(d):t(d,p))}}}function Ta(){const c=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof c=="object"&&c.id!==void 0}function Ln(){try{return typeof indexedDB=="object"}catch{return!1}}function Bn(){return new Promise((c,t)=>{try{let d=!0;const p="validate-browser-context-for-indexeddb-analytics-module",_=self.indexedDB.open(p);_.onsuccess=()=>{_.result.close(),d||self.indexedDB.deleteDatabase(p),c(!0)},_.onupgradeneeded=()=>{d=!1},_.onerror=()=>{var C;t(((C=_.error)===null||C===void 0?void 0:C.message)||"")}}catch(d){t(d)}})}function xa(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oa="FirebaseError";class he extends Error{constructor(t,d,p){super(d),this.code=t,this.customData=p,this.name=Oa,Object.setPrototypeOf(this,he.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ze.prototype.create)}}class ze{constructor(t,d,p){this.service=t,this.serviceName=d,this.errors=p}create(t,...d){const p=d[0]||{},_=`${this.service}/${t}`,C=this.errors[t],y=C?Aa(C,p):"Error",h=`${this.serviceName}: ${y} (${_}).`;return new he(_,h,p)}}function Aa(c,t){return c.replace(Ea,(d,p)=>{const _=t[p];return _!=null?String(_):`<${p}?>`})}const Ea=/\{\$([^}]+)}/g;function We(c,t){if(c===t)return!0;const d=Object.keys(c),p=Object.keys(t);for(const _ of d){if(!p.includes(_))return!1;const C=c[_],y=t[_];if(Zi(C)&&Zi(y)){if(!We(C,y))return!1}else if(C!==y)return!1}for(const _ of p)if(!d.includes(_))return!1;return!0}function Zi(c){return c!==null&&typeof c=="object"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ka=1e3,Pa=2,Da=4*60*60*1e3,Ma=.5;function $i(c,t=ka,d=Pa){const p=t*Math.pow(d,c),_=Math.round(Ma*p*(Math.random()-.5)*2);return Math.min(Da,p+_)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jn(c){return c&&c._delegate?c._delegate:c}class $t{constructor(t,d,p){this.name=t,this.instanceFactory=d,this.type=p,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ee="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ia{constructor(t,d){this.name=t,this.container=d,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const d=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(d)){const p=new Sa;if(this.instancesDeferred.set(d,p),this.isInitialized(d)||this.shouldAutoInitialize())try{const _=this.getOrInitializeService({instanceIdentifier:d});_&&p.resolve(_)}catch{}}return this.instancesDeferred.get(d).promise}getImmediate(t){var d;const p=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),_=(d=t==null?void 0:t.optional)!==null&&d!==void 0?d:!1;if(this.isInitialized(p)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:p})}catch(C){if(_)return null;throw C}else{if(_)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Ra(t))try{this.getOrInitializeService({instanceIdentifier:ee})}catch{}for(const[d,p]of this.instancesDeferred.entries()){const _=this.normalizeInstanceIdentifier(d);try{const C=this.getOrInitializeService({instanceIdentifier:_});p.resolve(C)}catch{}}}}clearInstance(t=ee){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(d=>"INTERNAL"in d).map(d=>d.INTERNAL.delete()),...t.filter(d=>"_delete"in d).map(d=>d._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=ee){return this.instances.has(t)}getOptions(t=ee){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:d={}}=t,p=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(p))throw Error(`${this.name}(${p}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const _=this.getOrInitializeService({instanceIdentifier:p,options:d});for(const[C,y]of this.instancesDeferred.entries()){const h=this.normalizeInstanceIdentifier(C);p===h&&y.resolve(_)}return _}onInit(t,d){var p;const _=this.normalizeInstanceIdentifier(d),C=(p=this.onInitCallbacks.get(_))!==null&&p!==void 0?p:new Set;C.add(t),this.onInitCallbacks.set(_,C);const y=this.instances.get(_);return y&&t(y,_),()=>{C.delete(t)}}invokeOnInitCallbacks(t,d){const p=this.onInitCallbacks.get(d);if(p)for(const _ of p)try{_(t,d)}catch{}}getOrInitializeService({instanceIdentifier:t,options:d={}}){let p=this.instances.get(t);if(!p&&this.component&&(p=this.component.instanceFactory(this.container,{instanceIdentifier:Fa(t),options:d}),this.instances.set(t,p),this.instancesOptions.set(t,d),this.invokeOnInitCallbacks(p,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,p)}catch{}return p||null}normalizeInstanceIdentifier(t=ee){return this.component?this.component.multipleInstances?t:ee:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Fa(c){return c===ee?void 0:c}function Ra(c){return c.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class La{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const d=this.getProvider(t.name);if(d.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);d.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const d=new Ia(t,this);return this.providers.set(t,d),d}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Tt;(function(c){c[c.DEBUG=0]="DEBUG",c[c.VERBOSE=1]="VERBOSE",c[c.INFO=2]="INFO",c[c.WARN=3]="WARN",c[c.ERROR=4]="ERROR",c[c.SILENT=5]="SILENT"})(Tt||(Tt={}));const Ba={debug:Tt.DEBUG,verbose:Tt.VERBOSE,info:Tt.INFO,warn:Tt.WARN,error:Tt.ERROR,silent:Tt.SILENT},ja=Tt.INFO,Wa={[Tt.DEBUG]:"log",[Tt.VERBOSE]:"log",[Tt.INFO]:"info",[Tt.WARN]:"warn",[Tt.ERROR]:"error"},Na=(c,t,...d)=>{if(t<c.logLevel)return;const p=new Date().toISOString(),_=Wa[t];if(_)console[_](`[${p}]  ${c.name}:`,...d);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Wn{constructor(t){this.name=t,this._logLevel=ja,this._logHandler=Na,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Tt))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Ba[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Tt.DEBUG,...t),this._logHandler(this,Tt.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Tt.VERBOSE,...t),this._logHandler(this,Tt.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Tt.INFO,...t),this._logHandler(this,Tt.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Tt.WARN,...t),this._logHandler(this,Tt.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Tt.ERROR,...t),this._logHandler(this,Tt.ERROR,...t)}}const Xa=(c,t)=>t.some(d=>c instanceof d);let tn,en;function Ha(){return tn||(tn=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ya(){return en||(en=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Nn=new WeakMap,gi=new WeakMap,Xn=new WeakMap,ei=new WeakMap,Si=new WeakMap;function za(c){const t=new Promise((d,p)=>{const _=()=>{c.removeEventListener("success",C),c.removeEventListener("error",y)},C=()=>{d(Jt(c.result)),_()},y=()=>{p(c.error),_()};c.addEventListener("success",C),c.addEventListener("error",y)});return t.then(d=>{d instanceof IDBCursor&&Nn.set(d,c)}).catch(()=>{}),Si.set(t,c),t}function Ua(c){if(gi.has(c))return;const t=new Promise((d,p)=>{const _=()=>{c.removeEventListener("complete",C),c.removeEventListener("error",y),c.removeEventListener("abort",y)},C=()=>{d(),_()},y=()=>{p(c.error||new DOMException("AbortError","AbortError")),_()};c.addEventListener("complete",C),c.addEventListener("error",y),c.addEventListener("abort",y)});gi.set(c,t)}let mi={get(c,t,d){if(c instanceof IDBTransaction){if(t==="done")return gi.get(c);if(t==="objectStoreNames")return c.objectStoreNames||Xn.get(c);if(t==="store")return d.objectStoreNames[1]?void 0:d.objectStore(d.objectStoreNames[0])}return Jt(c[t])},set(c,t,d){return c[t]=d,!0},has(c,t){return c instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in c}};function Va(c){mi=c(mi)}function Ga(c){return c===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...d){const p=c.call(ii(this),t,...d);return Xn.set(p,t.sort?t.sort():[t]),Jt(p)}:Ya().includes(c)?function(...t){return c.apply(ii(this),t),Jt(Nn.get(this))}:function(...t){return Jt(c.apply(ii(this),t))}}function qa(c){return typeof c=="function"?Ga(c):(c instanceof IDBTransaction&&Ua(c),Xa(c,Ha())?new Proxy(c,mi):c)}function Jt(c){if(c instanceof IDBRequest)return za(c);if(ei.has(c))return ei.get(c);const t=qa(c);return t!==c&&(ei.set(c,t),Si.set(t,c)),t}const ii=c=>Si.get(c);function Hn(c,t,{blocked:d,upgrade:p,blocking:_,terminated:C}={}){const y=indexedDB.open(c,t),h=Jt(y);return p&&y.addEventListener("upgradeneeded",e=>{p(Jt(y.result),e.oldVersion,e.newVersion,Jt(y.transaction))}),d&&y.addEventListener("blocked",()=>d()),h.then(e=>{C&&e.addEventListener("close",()=>C()),_&&e.addEventListener("versionchange",()=>_())}).catch(()=>{}),h}const Ka=["get","getKey","getAll","getAllKeys","count"],Ja=["put","add","delete","clear"],ni=new Map;function nn(c,t){if(!(c instanceof IDBDatabase&&!(t in c)&&typeof t=="string"))return;if(ni.get(t))return ni.get(t);const d=t.replace(/FromIndex$/,""),p=t!==d,_=Ja.includes(d);if(!(d in(p?IDBIndex:IDBObjectStore).prototype)||!(_||Ka.includes(d)))return;const C=async function(y,...h){const e=this.transaction(y,_?"readwrite":"readonly");let o=e.store;return p&&(o=o.index(h.shift())),(await Promise.all([o[d](...h),_&&e.done]))[0]};return ni.set(t,C),C}Va(c=>({...c,get:(t,d,p)=>nn(t,d)||c.get(t,d,p),has:(t,d)=>!!nn(t,d)||c.has(t,d)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qa{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(d=>{if(Za(d)){const p=d.getImmediate();return`${p.library}/${p.version}`}else return null}).filter(d=>d).join(" ")}}function Za(c){const t=c.getComponent();return(t==null?void 0:t.type)==="VERSION"}const pi="@firebase/app",rn="0.9.5";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const se=new Wn("@firebase/app"),$a="@firebase/app-compat",to="@firebase/analytics-compat",eo="@firebase/analytics",io="@firebase/app-check-compat",no="@firebase/app-check",ro="@firebase/auth",so="@firebase/auth-compat",ao="@firebase/database",oo="@firebase/database-compat",lo="@firebase/functions",ho="@firebase/functions-compat",co="@firebase/installations",uo="@firebase/installations-compat",fo="@firebase/messaging",go="@firebase/messaging-compat",mo="@firebase/performance",po="@firebase/performance-compat",vo="@firebase/remote-config",_o="@firebase/remote-config-compat",yo="@firebase/storage",bo="@firebase/storage-compat",Co="@firebase/firestore",wo="@firebase/firestore-compat",So="firebase";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vi="[DEFAULT]",To={[pi]:"fire-core",[$a]:"fire-core-compat",[eo]:"fire-analytics",[to]:"fire-analytics-compat",[no]:"fire-app-check",[io]:"fire-app-check-compat",[ro]:"fire-auth",[so]:"fire-auth-compat",[ao]:"fire-rtdb",[oo]:"fire-rtdb-compat",[lo]:"fire-fn",[ho]:"fire-fn-compat",[co]:"fire-iid",[uo]:"fire-iid-compat",[fo]:"fire-fcm",[go]:"fire-fcm-compat",[mo]:"fire-perf",[po]:"fire-perf-compat",[vo]:"fire-rc",[_o]:"fire-rc-compat",[yo]:"fire-gcs",[bo]:"fire-gcs-compat",[Co]:"fire-fst",[wo]:"fire-fst-compat","fire-js":"fire-js",[So]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ne=new Map,_i=new Map;function xo(c,t){try{c.container.addComponent(t)}catch(d){se.debug(`Component ${t.name} failed to register with FirebaseApp ${c.name}`,d)}}function ae(c){const t=c.name;if(_i.has(t))return se.debug(`There were multiple attempts to register component ${t}.`),!1;_i.set(t,c);for(const d of Ne.values())xo(d,c);return!0}function Ue(c,t){const d=c.container.getProvider("heartbeat").getImmediate({optional:!0});return d&&d.triggerHeartbeat(),c.container.getProvider(t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oo={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},Qt=new ze("app","Firebase",Oo);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ao{constructor(t,d,p){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},d),this._name=d.name,this._automaticDataCollectionEnabled=d.automaticDataCollectionEnabled,this._container=p,this.container.addComponent(new $t("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Qt.create("app-deleted",{appName:this._name})}}function Yn(c,t={}){let d=c;typeof t!="object"&&(t={name:t});const p=Object.assign({name:vi,automaticDataCollectionEnabled:!1},t),_=p.name;if(typeof _!="string"||!_)throw Qt.create("bad-app-name",{appName:String(_)});if(d||(d=wa()),!d)throw Qt.create("no-options");const C=Ne.get(_);if(C){if(We(d,C.options)&&We(p,C.config))return C;throw Qt.create("duplicate-app",{appName:_})}const y=new La(_);for(const e of _i.values())y.addComponent(e);const h=new Ao(d,p,y);return Ne.set(_,h),h}function Eo(c=vi){const t=Ne.get(c);if(!t&&c===vi)return Yn();if(!t)throw Qt.create("no-app",{appName:c});return t}function Zt(c,t,d){var p;let _=(p=To[c])!==null&&p!==void 0?p:c;d&&(_+=`-${d}`);const C=_.match(/\s|\//),y=t.match(/\s|\//);if(C||y){const h=[`Unable to register library "${_}" with version "${t}":`];C&&h.push(`library name "${_}" contains illegal characters (whitespace or "/")`),C&&y&&h.push("and"),y&&h.push(`version name "${t}" contains illegal characters (whitespace or "/")`),se.warn(h.join(" "));return}ae(new $t(`${_}-version`,()=>({library:_,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ko="firebase-heartbeat-database",Po=1,Ee="firebase-heartbeat-store";let ri=null;function zn(){return ri||(ri=Hn(ko,Po,{upgrade:(c,t)=>{switch(t){case 0:c.createObjectStore(Ee)}}}).catch(c=>{throw Qt.create("idb-open",{originalErrorMessage:c.message})})),ri}async function Do(c){try{return(await zn()).transaction(Ee).objectStore(Ee).get(Un(c))}catch(t){if(t instanceof he)se.warn(t.message);else{const d=Qt.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});se.warn(d.message)}}}async function sn(c,t){try{const p=(await zn()).transaction(Ee,"readwrite");return await p.objectStore(Ee).put(t,Un(c)),p.done}catch(d){if(d instanceof he)se.warn(d.message);else{const p=Qt.create("idb-set",{originalErrorMessage:d==null?void 0:d.message});se.warn(p.message)}}}function Un(c){return`${c.name}!${c.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mo=1024,Io=30*24*60*60*1e3;class Fo{constructor(t){this.container=t,this._heartbeatsCache=null;const d=this.container.getProvider("app").getImmediate();this._storage=new Lo(d),this._heartbeatsCachePromise=this._storage.read().then(p=>(this._heartbeatsCache=p,p))}async triggerHeartbeat(){const d=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),p=an();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===p||this._heartbeatsCache.heartbeats.some(_=>_.date===p)))return this._heartbeatsCache.heartbeats.push({date:p,agent:d}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(_=>{const C=new Date(_.date).valueOf();return Date.now()-C<=Io}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const t=an(),{heartbeatsToSend:d,unsentEntries:p}=Ro(this._heartbeatsCache.heartbeats),_=Rn(JSON.stringify({version:2,heartbeats:d}));return this._heartbeatsCache.lastSentHeartbeatDate=t,p.length>0?(this._heartbeatsCache.heartbeats=p,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),_}}function an(){return new Date().toISOString().substring(0,10)}function Ro(c,t=Mo){const d=[];let p=c.slice();for(const _ of c){const C=d.find(y=>y.agent===_.agent);if(C){if(C.dates.push(_.date),on(d)>t){C.dates.pop();break}}else if(d.push({agent:_.agent,dates:[_.date]}),on(d)>t){d.pop();break}p=p.slice(1)}return{heartbeatsToSend:d,unsentEntries:p}}class Lo{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ln()?Bn().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await Do(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(t){var d;if(await this._canUseIndexedDBPromise){const _=await this.read();return sn(this.app,{lastSentHeartbeatDate:(d=t.lastSentHeartbeatDate)!==null&&d!==void 0?d:_.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var d;if(await this._canUseIndexedDBPromise){const _=await this.read();return sn(this.app,{lastSentHeartbeatDate:(d=t.lastSentHeartbeatDate)!==null&&d!==void 0?d:_.lastSentHeartbeatDate,heartbeats:[..._.heartbeats,...t.heartbeats]})}else return}}function on(c){return Rn(JSON.stringify({version:2,heartbeats:c})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bo(c){ae(new $t("platform-logger",t=>new Qa(t),"PRIVATE")),ae(new $t("heartbeat",t=>new Fo(t),"PRIVATE")),Zt(pi,rn,c),Zt(pi,rn,"esm2017"),Zt("fire-js","")}Bo("");const Vn="@firebase/installations",Ti="0.6.4";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gn=1e4,qn=`w:${Ti}`,Kn="FIS_v2",jo="https://firebaseinstallations.googleapis.com/v1",Wo=60*60*1e3,No="installations",Xo="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ho={["missing-app-config-values"]:'Missing App configuration value: "{$valueName}"',["not-registered"]:"Firebase Installation is not registered.",["installation-not-found"]:"Firebase Installation not found.",["request-failed"]:'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',["app-offline"]:"Could not process request. Application offline.",["delete-pending-registration"]:"Can't delete installation while there is a pending registration request."},oe=new ze(No,Xo,Ho);function Jn(c){return c instanceof he&&c.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qn({projectId:c}){return`${jo}/projects/${c}/installations`}function Zn(c){return{token:c.token,requestStatus:2,expiresIn:zo(c.expiresIn),creationTime:Date.now()}}async function $n(c,t){const p=(await t.json()).error;return oe.create("request-failed",{requestName:c,serverCode:p.code,serverMessage:p.message,serverStatus:p.status})}function tr({apiKey:c}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":c})}function Yo(c,{refreshToken:t}){const d=tr(c);return d.append("Authorization",Uo(t)),d}async function er(c){const t=await c();return t.status>=500&&t.status<600?c():t}function zo(c){return Number(c.replace("s","000"))}function Uo(c){return`${Kn} ${c}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vo({appConfig:c,heartbeatServiceProvider:t},{fid:d}){const p=Qn(c),_=tr(c),C=t.getImmediate({optional:!0});if(C){const o=await C.getHeartbeatsHeader();o&&_.append("x-firebase-client",o)}const y={fid:d,authVersion:Kn,appId:c.appId,sdkVersion:qn},h={method:"POST",headers:_,body:JSON.stringify(y)},e=await er(()=>fetch(p,h));if(e.ok){const o=await e.json();return{fid:o.fid||d,registrationStatus:2,refreshToken:o.refreshToken,authToken:Zn(o.authToken)}}else throw await $n("Create Installation",e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ir(c){return new Promise(t=>{setTimeout(t,c)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Go(c){return btoa(String.fromCharCode(...c)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qo=/^[cdef][\w-]{21}$/,yi="";function Ko(){try{const c=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(c),c[0]=112+c[0]%16;const d=Jo(c);return qo.test(d)?d:yi}catch{return yi}}function Jo(c){return Go(c).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ve(c){return`${c.appName}!${c.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nr=new Map;function rr(c,t){const d=Ve(c);sr(d,t),Qo(d,t)}function sr(c,t){const d=nr.get(c);if(d)for(const p of d)p(t)}function Qo(c,t){const d=Zo();d&&d.postMessage({key:c,fid:t}),$o()}let ne=null;function Zo(){return!ne&&"BroadcastChannel"in self&&(ne=new BroadcastChannel("[Firebase] FID Change"),ne.onmessage=c=>{sr(c.data.key,c.data.fid)}),ne}function $o(){nr.size===0&&ne&&(ne.close(),ne=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tl="firebase-installations-database",el=1,le="firebase-installations-store";let si=null;function xi(){return si||(si=Hn(tl,el,{upgrade:(c,t)=>{switch(t){case 0:c.createObjectStore(le)}}})),si}async function Xe(c,t){const d=Ve(c),_=(await xi()).transaction(le,"readwrite"),C=_.objectStore(le),y=await C.get(d);return await C.put(t,d),await _.done,(!y||y.fid!==t.fid)&&rr(c,t.fid),t}async function ar(c){const t=Ve(c),p=(await xi()).transaction(le,"readwrite");await p.objectStore(le).delete(t),await p.done}async function Ge(c,t){const d=Ve(c),_=(await xi()).transaction(le,"readwrite"),C=_.objectStore(le),y=await C.get(d),h=t(y);return h===void 0?await C.delete(d):await C.put(h,d),await _.done,h&&(!y||y.fid!==h.fid)&&rr(c,h.fid),h}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Oi(c){let t;const d=await Ge(c.appConfig,p=>{const _=il(p),C=nl(c,_);return t=C.registrationPromise,C.installationEntry});return d.fid===yi?{installationEntry:await t}:{installationEntry:d,registrationPromise:t}}function il(c){const t=c||{fid:Ko(),registrationStatus:0};return or(t)}function nl(c,t){if(t.registrationStatus===0){if(!navigator.onLine){const _=Promise.reject(oe.create("app-offline"));return{installationEntry:t,registrationPromise:_}}const d={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},p=rl(c,d);return{installationEntry:d,registrationPromise:p}}else return t.registrationStatus===1?{installationEntry:t,registrationPromise:sl(c)}:{installationEntry:t}}async function rl(c,t){try{const d=await Vo(c,t);return Xe(c.appConfig,d)}catch(d){throw Jn(d)&&d.customData.serverCode===409?await ar(c.appConfig):await Xe(c.appConfig,{fid:t.fid,registrationStatus:0}),d}}async function sl(c){let t=await ln(c.appConfig);for(;t.registrationStatus===1;)await ir(100),t=await ln(c.appConfig);if(t.registrationStatus===0){const{installationEntry:d,registrationPromise:p}=await Oi(c);return p||d}return t}function ln(c){return Ge(c,t=>{if(!t)throw oe.create("installation-not-found");return or(t)})}function or(c){return al(c)?{fid:c.fid,registrationStatus:0}:c}function al(c){return c.registrationStatus===1&&c.registrationTime+Gn<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ol({appConfig:c,heartbeatServiceProvider:t},d){const p=ll(c,d),_=Yo(c,d),C=t.getImmediate({optional:!0});if(C){const o=await C.getHeartbeatsHeader();o&&_.append("x-firebase-client",o)}const y={installation:{sdkVersion:qn,appId:c.appId}},h={method:"POST",headers:_,body:JSON.stringify(y)},e=await er(()=>fetch(p,h));if(e.ok){const o=await e.json();return Zn(o)}else throw await $n("Generate Auth Token",e)}function ll(c,{fid:t}){return`${Qn(c)}/${t}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ai(c,t=!1){let d;const p=await Ge(c.appConfig,C=>{if(!lr(C))throw oe.create("not-registered");const y=C.authToken;if(!t&&ul(y))return C;if(y.requestStatus===1)return d=hl(c,t),C;{if(!navigator.onLine)throw oe.create("app-offline");const h=dl(C);return d=cl(c,h),h}});return d?await d:p.authToken}async function hl(c,t){let d=await hn(c.appConfig);for(;d.authToken.requestStatus===1;)await ir(100),d=await hn(c.appConfig);const p=d.authToken;return p.requestStatus===0?Ai(c,t):p}function hn(c){return Ge(c,t=>{if(!lr(t))throw oe.create("not-registered");const d=t.authToken;return gl(d)?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t})}async function cl(c,t){try{const d=await ol(c,t),p=Object.assign(Object.assign({},t),{authToken:d});return await Xe(c.appConfig,p),d}catch(d){if(Jn(d)&&(d.customData.serverCode===401||d.customData.serverCode===404))await ar(c.appConfig);else{const p=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await Xe(c.appConfig,p)}throw d}}function lr(c){return c!==void 0&&c.registrationStatus===2}function ul(c){return c.requestStatus===2&&!fl(c)}function fl(c){const t=Date.now();return t<c.creationTime||c.creationTime+c.expiresIn<t+Wo}function dl(c){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},c),{authToken:t})}function gl(c){return c.requestStatus===1&&c.requestTime+Gn<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ml(c){const t=c,{installationEntry:d,registrationPromise:p}=await Oi(t);return p?p.catch(console.error):Ai(t).catch(console.error),d.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pl(c,t=!1){const d=c;return await vl(d),(await Ai(d,t)).token}async function vl(c){const{registrationPromise:t}=await Oi(c);t&&await t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _l(c){if(!c||!c.options)throw ai("App Configuration");if(!c.name)throw ai("App Name");const t=["projectId","apiKey","appId"];for(const d of t)if(!c.options[d])throw ai(d);return{appName:c.name,projectId:c.options.projectId,apiKey:c.options.apiKey,appId:c.options.appId}}function ai(c){return oe.create("missing-app-config-values",{valueName:c})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hr="installations",yl="installations-internal",bl=c=>{const t=c.getProvider("app").getImmediate(),d=_l(t),p=Ue(t,"heartbeat");return{app:t,appConfig:d,heartbeatServiceProvider:p,_delete:()=>Promise.resolve()}},Cl=c=>{const t=c.getProvider("app").getImmediate(),d=Ue(t,hr).getImmediate();return{getId:()=>ml(d),getToken:_=>pl(d,_)}};function wl(){ae(new $t(hr,bl,"PUBLIC")),ae(new $t(yl,Cl,"PRIVATE"))}wl();Zt(Vn,Ti);Zt(Vn,Ti,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const He="analytics",Sl="firebase_id",Tl="origin",xl=60*1e3,Ol="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",cr="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xt=new Wn("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ur(c){return Promise.all(c.map(t=>t.catch(d=>d)))}function Al(c,t){const d=document.createElement("script");d.src=`${cr}?l=${c}&id=${t}`,d.async=!0,document.head.appendChild(d)}function El(c){let t=[];return Array.isArray(window[c])?t=window[c]:window[c]=t,t}async function kl(c,t,d,p,_,C){const y=p[_];try{if(y)await t[y];else{const e=(await ur(d)).find(o=>o.measurementId===_);e&&await t[e.appId]}}catch(h){Xt.error(h)}c("config",_,C)}async function Pl(c,t,d,p,_){try{let C=[];if(_&&_.send_to){let y=_.send_to;Array.isArray(y)||(y=[y]);const h=await ur(d);for(const e of y){const o=h.find(n=>n.measurementId===e),l=o&&t[o.appId];if(l)C.push(l);else{C=[];break}}}C.length===0&&(C=Object.values(t)),await Promise.all(C),c("event",p,_||{})}catch(C){Xt.error(C)}}function Dl(c,t,d,p){async function _(C,y,h){try{C==="event"?await Pl(c,t,d,y,h):C==="config"?await kl(c,t,d,p,y,h):C==="consent"?c("consent","update",h):c("set",y)}catch(e){Xt.error(e)}}return _}function Ml(c,t,d,p,_){let C=function(...y){window[p].push(arguments)};return window[_]&&typeof window[_]=="function"&&(C=window[_]),window[_]=Dl(C,c,t,d),{gtagCore:C,wrappedGtag:window[_]}}function Il(c){const t=window.document.getElementsByTagName("script");for(const d of Object.values(t))if(d.src&&d.src.includes(cr)&&d.src.includes(c))return d;return null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fl={["already-exists"]:"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.",["already-initialized"]:"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.",["already-initialized-settings"]:"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",["interop-component-reg-failed"]:"Firebase Analytics Interop Component failed to instantiate: {$reason}",["invalid-analytics-context"]:"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",["indexeddb-unavailable"]:"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",["fetch-throttle"]:"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.",["config-fetch-failed"]:"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}",["no-api-key"]:'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',["no-app-id"]:'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'},Yt=new ze("analytics","Analytics",Fl);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rl=30,Ll=1e3;class Bl{constructor(t={},d=Ll){this.throttleMetadata=t,this.intervalMillis=d}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,d){this.throttleMetadata[t]=d}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}}const fr=new Bl;function jl(c){return new Headers({Accept:"application/json","x-goog-api-key":c})}async function Wl(c){var t;const{appId:d,apiKey:p}=c,_={method:"GET",headers:jl(p)},C=Ol.replace("{app-id}",d),y=await fetch(C,_);if(y.status!==200&&y.status!==304){let h="";try{const e=await y.json();!((t=e.error)===null||t===void 0)&&t.message&&(h=e.error.message)}catch{}throw Yt.create("config-fetch-failed",{httpStatus:y.status,responseMessage:h})}return y.json()}async function Nl(c,t=fr,d){const{appId:p,apiKey:_,measurementId:C}=c.options;if(!p)throw Yt.create("no-app-id");if(!_){if(C)return{measurementId:C,appId:p};throw Yt.create("no-api-key")}const y=t.getThrottleMetadata(p)||{backoffCount:0,throttleEndTimeMillis:Date.now()},h=new Yl;return setTimeout(async()=>{h.abort()},d!==void 0?d:xl),dr({appId:p,apiKey:_,measurementId:C},y,h,t)}async function dr(c,{throttleEndTimeMillis:t,backoffCount:d},p,_=fr){var C;const{appId:y,measurementId:h}=c;try{await Xl(p,t)}catch(e){if(h)return Xt.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${h} provided in the "measurementId" field in the local Firebase config. [${e==null?void 0:e.message}]`),{appId:y,measurementId:h};throw e}try{const e=await Wl(c);return _.deleteThrottleMetadata(y),e}catch(e){const o=e;if(!Hl(o)){if(_.deleteThrottleMetadata(y),h)return Xt.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${h} provided in the "measurementId" field in the local Firebase config. [${o==null?void 0:o.message}]`),{appId:y,measurementId:h};throw e}const l=Number((C=o==null?void 0:o.customData)===null||C===void 0?void 0:C.httpStatus)===503?$i(d,_.intervalMillis,Rl):$i(d,_.intervalMillis),n={throttleEndTimeMillis:Date.now()+l,backoffCount:d+1};return _.setThrottleMetadata(y,n),Xt.debug(`Calling attemptFetch again in ${l} millis`),dr(c,n,p,_)}}function Xl(c,t){return new Promise((d,p)=>{const _=Math.max(t-Date.now(),0),C=setTimeout(d,_);c.addEventListener(()=>{clearTimeout(C),p(Yt.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}function Hl(c){if(!(c instanceof he)||!c.customData)return!1;const t=Number(c.customData.httpStatus);return t===429||t===500||t===503||t===504}class Yl{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach(t=>t())}}async function zl(c,t,d,p,_){if(_&&_.global){c("event",d,p);return}else{const C=await t,y=Object.assign(Object.assign({},p),{send_to:C});c("event",d,y)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ul(){if(Ln())try{await Bn()}catch(c){return Xt.warn(Yt.create("indexeddb-unavailable",{errorInfo:c==null?void 0:c.toString()}).message),!1}else return Xt.warn(Yt.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function Vl(c,t,d,p,_,C,y){var h;const e=Nl(c);e.then(i=>{d[i.measurementId]=i.appId,c.options.measurementId&&i.measurementId!==c.options.measurementId&&Xt.warn(`The measurement ID in the local Firebase config (${c.options.measurementId}) does not match the measurement ID fetched from the server (${i.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(i=>Xt.error(i)),t.push(e);const o=Ul().then(i=>{if(i)return p.getId()}),[l,n]=await Promise.all([e,o]);Il(C)||Al(C,l.measurementId),_("js",new Date);const r=(h=y==null?void 0:y.config)!==null&&h!==void 0?h:{};return r[Tl]="firebase",r.update=!0,n!=null&&(r[Sl]=n),_("config",l.measurementId,r),l.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gl{constructor(t){this.app=t}_delete(){return delete Ce[this.app.options.appId],Promise.resolve()}}let Ce={},cn=[];const un={};let oi="dataLayer",ql="gtag",fn,gr,dn=!1;function Kl(){const c=[];if(Ta()&&c.push("This is a browser extension environment."),xa()||c.push("Cookies are not available."),c.length>0){const t=c.map((p,_)=>`(${_+1}) ${p}`).join(" "),d=Yt.create("invalid-analytics-context",{errorInfo:t});Xt.warn(d.message)}}function Jl(c,t,d){Kl();const p=c.options.appId;if(!p)throw Yt.create("no-app-id");if(!c.options.apiKey)if(c.options.measurementId)Xt.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${c.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Yt.create("no-api-key");if(Ce[p]!=null)throw Yt.create("already-exists",{id:p});if(!dn){El(oi);const{wrappedGtag:C,gtagCore:y}=Ml(Ce,cn,un,oi,ql);gr=C,fn=y,dn=!0}return Ce[p]=Vl(c,cn,un,t,fn,oi,d),new Gl(c)}function Ql(c=Eo()){c=jn(c);const t=Ue(c,He);return t.isInitialized()?t.getImmediate():Zl(c)}function Zl(c,t={}){const d=Ue(c,He);if(d.isInitialized()){const _=d.getImmediate();if(We(t,d.getOptions()))return _;throw Yt.create("already-initialized")}return d.initialize({options:t})}function mr(c,t,d,p){c=jn(c),zl(gr,Ce[c.app.options.appId],t,d,p).catch(_=>Xt.error(_))}const gn="@firebase/analytics",mn="0.9.4";function $l(){ae(new $t(He,(t,{options:d})=>{const p=t.getProvider("app").getImmediate(),_=t.getProvider("installations-internal").getImmediate();return Jl(p,_,d)},"PUBLIC")),ae(new $t("analytics-internal",c,"PRIVATE")),Zt(gn,mn),Zt(gn,mn,"esm2017");function c(t){try{const d=t.getProvider(He).getImmediate();return{logEvent:(p,_,C)=>mr(d,p,_,C)}}catch(d){throw Yt.create("interop-component-reg-failed",{reason:d})}}}$l();var th="firebase",eh="9.18.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Zt(th,eh,"app");const ih={apiKey:"AIzaSyBN69Xtmcwq-WRkz5aGZOCkZHAmYtKpXwY",authDomain:"dev-jeans-9f478.firebaseapp.com",projectId:"dev-jeans-9f478",storageBucket:"dev-jeans-9f478.appspot.com",messagingSenderId:"31771451735",appId:"1:31771451735:web:92841c507a7ee00301de12",measurementId:"G-LLL5G2XTTH"},nh=Yn(ih),rh=Ql(nh);function pn(c,t,d){const p=c.slice();return p[6]=t[d],p}function vn(c){let t,d,p=je[c[6]].title+"",_,C,y,h,e;return{c(){t=nt("li"),d=nt("button"),_=Vt(p),y=mt(),L(d,"class",C=Fe(c[0][c[6]]?"active":"")+" svelte-1pxcdh4"),L(t,"class","svelte-1pxcdh4")},m(o,l){ht(o,t,l),it(t,d),it(d,_),it(t,y),h||(e=ut(d,"click",c[1](c[6])),h=!0)},p(o,l){c=o,l&1&&C!==(C=Fe(c[0][c[6]]?"active":"")+" svelte-1pxcdh4")&&L(d,"class",C)},d(o){o&&lt(t),h=!1,e()}}}function sh(c){let t,d,p,_,C=Object.keys(je),y=[];for(let h=0;h<C.length;h+=1)y[h]=vn(pn(c,C,h));return{c(){t=nt("div"),d=nt("h2"),d.textContent="아이템을 추가해 꾸며주세요!",p=mt(),_=nt("ul");for(let h=0;h<y.length;h+=1)y[h].c();L(d,"class","svelte-1pxcdh4"),L(_,"class","toolbar svelte-1pxcdh4"),L(t,"class","container svelte-1pxcdh4")},m(h,e){ht(h,t,e),it(t,d),it(t,p),it(t,_);for(let o=0;o<y.length;o+=1)y[o]&&y[o].m(_,null)},p(h,[e]){if(e&3){C=Object.keys(je);let o;for(o=0;o<C.length;o+=1){const l=pn(h,C,o);y[o]?y[o].p(l,e):(y[o]=vn(l),y[o].c(),y[o].m(_,null))}for(;o<y.length;o+=1)y[o].d(1);y.length=C.length}},i:bt,o:bt,d(h){h&&lt(t),Le(y,h)}}}function ah(c,t,d){let p,_,C;jt(c,Mn,o=>d(0,p=o)),jt(c,Be,o=>d(2,_=o)),jt(c,Ae,o=>d(3,C=o)),An(()=>{mr(rh,"꾸미기 탭 진입")});const y=o=>{let l=je[o].src;me.fabric.Image.fromURL(l,function(n){n.scaleToWidth(C),n.scaleToWidth(C),n.selectable=!1,n.set("costume",o),_.add(n),_.renderAll()})},h=o=>{_.getObjects().filter(r=>r.costume===o).forEach(r=>_.remove(r))},e=o=>()=>{ea(o)};return c.$$.update=()=>{if(c.$$.dirty&5){const o=_.getObjects();for(const l in p){const n=o.find(r=>r.costume===l);n&&!p[l]&&h(l),!n&&p[l]&&y(l)}}},[p,e,_]}class oh extends Et{constructor(t){super(),At(this,t,ah,sh,Ot,{})}}function _n(c,t,d){const p=c.slice();return p[3]=t[d],p}function yn(c,t,d){const p=c.slice();return p[3]=t[d],p}function bn(c){let t,d,p=c[3].label+"",_,C,y,h,e;return{c(){t=nt("li"),d=nt("button"),_=Vt(p),C=mt(),L(d,"type","button"),L(d,"class","svelte-bzko04"),L(t,"class",y=Fe(c[0]===c[3].value?"active":"")+" svelte-bzko04")},m(o,l){ht(o,t,l),it(t,d),it(d,_),it(t,C),h||(e=ut(d,"click",function(){Ye(c[2](c[3].value))&&c[2](c[3].value).apply(this,arguments)}),h=!0)},p(o,l){c=o,l&2&&p!==(p=c[3].label+"")&&ge(_,p),l&3&&y!==(y=Fe(c[0]===c[3].value?"active":"")+" svelte-bzko04")&&L(t,"class",y)},d(o){o&&lt(t),h=!1,e()}}}function Cn(c){let t,d,p,_;var C=c[3].component;function y(h){return{}}return C&&(d=St(C,y())),{c(){t=nt("div"),d&&yt(d.$$.fragment),p=mt(),L(t,"class","box svelte-bzko04")},m(h,e){ht(h,t,e),d&&pt(d,t,null),it(t,p),_=!0},p(h,e){if(e&2&&C!==(C=h[3].component)){if(d){Dt();const o=d;ft(o.$$.fragment,1,0,()=>{vt(o,1)}),Mt()}C?(d=St(C,y()),yt(d.$$.fragment),at(d.$$.fragment,1),pt(d,t,p)):d=null}},i(h){_||(d&&at(d.$$.fragment,h),_=!0)},o(h){d&&ft(d.$$.fragment,h),_=!1},d(h){h&&lt(t),d&&vt(d)}}}function wn(c){let t,d,p=c[0]==c[3].value&&Cn(c);return{c(){p&&p.c(),t=Gt()},m(_,C){p&&p.m(_,C),ht(_,t,C),d=!0},p(_,C){_[0]==_[3].value?p?(p.p(_,C),C&3&&at(p,1)):(p=Cn(_),p.c(),at(p,1),p.m(t.parentNode,t)):p&&(Dt(),ft(p,1,1,()=>{p=null}),Mt())},i(_){d||(at(p),d=!0)},o(_){ft(p),d=!1},d(_){p&&p.d(_),_&&lt(t)}}}function lh(c){let t,d,p,_,C=c[1],y=[];for(let l=0;l<C.length;l+=1)y[l]=bn(yn(c,C,l));let h=c[1],e=[];for(let l=0;l<h.length;l+=1)e[l]=wn(_n(c,h,l));const o=l=>ft(e[l],1,1,()=>{e[l]=null});return{c(){t=nt("ul");for(let l=0;l<y.length;l+=1)y[l].c();d=mt();for(let l=0;l<e.length;l+=1)e[l].c();p=Gt(),L(t,"class","taps svelte-bzko04")},m(l,n){ht(l,t,n);for(let r=0;r<y.length;r+=1)y[r]&&y[r].m(t,null);ht(l,d,n);for(let r=0;r<e.length;r+=1)e[r]&&e[r].m(l,n);ht(l,p,n),_=!0},p(l,[n]){if(n&7){C=l[1];let r;for(r=0;r<C.length;r+=1){const i=yn(l,C,r);y[r]?y[r].p(i,n):(y[r]=bn(i),y[r].c(),y[r].m(t,null))}for(;r<y.length;r+=1)y[r].d(1);y.length=C.length}if(n&3){h=l[1];let r;for(r=0;r<h.length;r+=1){const i=_n(l,h,r);e[r]?(e[r].p(i,n),at(e[r],1)):(e[r]=wn(i),e[r].c(),at(e[r],1),e[r].m(p.parentNode,p))}for(Dt(),r=h.length;r<e.length;r+=1)o(r);Mt()}},i(l){if(!_){for(let n=0;n<h.length;n+=1)at(e[n]);_=!0}},o(l){e=e.filter(Boolean);for(let n=0;n<e.length;n+=1)ft(e[n]);_=!1},d(l){l&&lt(t),Le(y,l),l&&lt(d),Le(e,l),l&&lt(p)}}}function hh(c,t,d){let{items:p=[]}=t,{activeTabValue:_=1}=t;const C=y=>()=>d(0,_=y);return c.$$set=y=>{"items"in y&&d(1,p=y.items),"activeTabValue"in y&&d(0,_=y.activeTabValue)},[_,p,C]}class ch extends Et{constructor(t){super(),At(this,t,hh,lh,Ot,{items:1,activeTabValue:0})}}function uh(c){let t,d,p;return d=new ch({props:{items:c[0]}}),{c(){t=nt("div"),yt(d.$$.fragment),L(t,"class","container svelte-1nz23oh")},m(_,C){ht(_,t,C),pt(d,t,null),p=!0},p:bt,i(_){p||(at(d.$$.fragment,_),p=!0)},o(_){ft(d.$$.fragment,_),p=!1},d(_){_&&lt(t),vt(d)}}}function fh(c){return[[{label:"편집 하기",value:1,component:fa},{label:"꾸미기",value:2,component:oh}]]}class dh extends Et{constructor(t){super(),At(this,t,fh,uh,Ot,{})}}function gh(c){let t,d,p,_,C,y,h,e,o,l,n,r,i;return y=new dh({}),{c(){t=nt("main"),d=nt("h1"),d.textContent="~개발진스 짤 만들어 쓰기~",p=mt(),_=nt("canvas"),C=mt(),yt(y.$$.fragment),h=mt(),e=nt("footer"),o=nt("span"),o.innerHTML='Instagram: <a href="https://www.instagram.com/dev_hee/" class="svelte-15k31bi">@dev_hee</a>',l=mt(),n=nt("span"),n.innerHTML='Blog: <a href="https://velog.io/@heelieben" class="svelte-15k31bi">@pigme</a>',L(d,"class","svelte-15k31bi"),L(_,"id","canvas"),L(_,"width","2400"),L(_,"height","2400"),Nt(_,"border","1px solid #ccc"),L(t,"style",`width: ${Ae}`),L(t,"class","svelte-15k31bi"),L(e,"style",r=`width: ${c[0]}`),L(e,"class","svelte-15k31bi")},m(a,u){ht(a,t,u),it(t,d),it(t,p),it(t,_),ht(a,C,u),pt(y,a,u),ht(a,h,u),ht(a,e,u),it(e,o),it(e,l),it(e,n),i=!0},p(a,[u]){(!i||u&1&&r!==(r=`width: ${a[0]}`))&&L(e,"style",r)},i(a){i||(at(y.$$.fragment,a),i=!0)},o(a){ft(y.$$.fragment,a),i=!1},d(a){a&&lt(t),a&&lt(C),vt(y,a),a&&lt(h),a&&lt(e)}}}function mh(c,t,d){let p,_;jt(c,Be,h=>d(1,p=h)),jt(c,Ae,h=>d(0,_=h));const C=()=>window.innerWidth<600?window.innerWidth:600;return An(()=>{Re(Be,p=new me.fabric.Canvas("canvas"),p),Re(Ae,_=C(),_),p.setWidth(_*p.getZoom()),p.setHeight(_*p.getZoom()),me.fabric.Image.fromURL(Dr,function(h){h.scaleToWidth(_),h.scaleToWidth(_),h.selectable=!1,p.add(h),p.renderAll()})}),[_]}class ph extends Et{constructor(t){super(),At(this,t,mh,gh,Ot,{})}}new ph({target:document.getElementById("app")});
