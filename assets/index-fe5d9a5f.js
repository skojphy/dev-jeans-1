(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))v(_);new MutationObserver(_=>{for(const C of _)if(C.type==="childList")for(const b of C.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&v(b)}).observe(document,{childList:!0,subtree:!0});function g(_){const C={};return _.integrity&&(C.integrity=_.integrity),_.referrerPolicy&&(C.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?C.credentials="include":_.crossOrigin==="anonymous"?C.credentials="omit":C.credentials="same-origin",C}function v(_){if(_.ep)return;_.ep=!0;const C=g(_);fetch(_.href,C)}})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gi=function(f){const t=[];let g=0;for(let v=0;v<f.length;v++){let _=f.charCodeAt(v);_<128?t[g++]=_:_<2048?(t[g++]=_>>6|192,t[g++]=_&63|128):(_&64512)===55296&&v+1<f.length&&(f.charCodeAt(v+1)&64512)===56320?(_=65536+((_&1023)<<10)+(f.charCodeAt(++v)&1023),t[g++]=_>>18|240,t[g++]=_>>12&63|128,t[g++]=_>>6&63|128,t[g++]=_&63|128):(t[g++]=_>>12|224,t[g++]=_>>6&63|128,t[g++]=_&63|128)}return t},dn=function(f){const t=[];let g=0,v=0;for(;g<f.length;){const _=f[g++];if(_<128)t[v++]=String.fromCharCode(_);else if(_>191&&_<224){const C=f[g++];t[v++]=String.fromCharCode((_&31)<<6|C&63)}else if(_>239&&_<365){const C=f[g++],b=f[g++],c=f[g++],i=((_&7)<<18|(C&63)<<12|(b&63)<<6|c&63)-65536;t[v++]=String.fromCharCode(55296+(i>>10)),t[v++]=String.fromCharCode(56320+(i&1023))}else{const C=f[g++],b=f[g++];t[v++]=String.fromCharCode((_&15)<<12|(C&63)<<6|b&63)}}return t.join("")},qi={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(f,t){if(!Array.isArray(f))throw Error("encodeByteArray takes an array as a parameter");this.init_();const g=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,v=[];for(let _=0;_<f.length;_+=3){const C=f[_],b=_+1<f.length,c=b?f[_+1]:0,i=_+2<f.length,l=i?f[_+2]:0,o=C>>2,r=(C&3)<<4|c>>4;let n=(c&15)<<2|l>>6,e=l&63;i||(e=64,b||(n=64)),v.push(g[o],g[r],g[n],g[e])}return v.join("")},encodeString(f,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(f):this.encodeByteArray(Gi(f),t)},decodeString(f,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(f):dn(this.decodeStringToByteArray(f,t))},decodeStringToByteArray(f,t){this.init_();const g=t?this.charToByteMapWebSafe_:this.charToByteMap_,v=[];for(let _=0;_<f.length;){const C=g[f.charAt(_++)],c=_<f.length?g[f.charAt(_)]:0;++_;const l=_<f.length?g[f.charAt(_)]:64;++_;const r=_<f.length?g[f.charAt(_)]:64;if(++_,C==null||c==null||l==null||r==null)throw new gn;const n=C<<2|c>>4;if(v.push(n),l!==64){const e=c<<4&240|l>>2;if(v.push(e),r!==64){const a=l<<6&192|r;v.push(a)}}}return v},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let f=0;f<this.ENCODED_VALS.length;f++)this.byteToCharMap_[f]=this.ENCODED_VALS.charAt(f),this.charToByteMap_[this.byteToCharMap_[f]]=f,this.byteToCharMapWebSafe_[f]=this.ENCODED_VALS_WEBSAFE.charAt(f),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[f]]=f,f>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(f)]=f,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(f)]=f)}}};class gn extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const mn=function(f){const t=Gi(f);return qi.encodeByteArray(t,!0)},Ki=function(f){return mn(f).replace(/\./g,"")},pn=function(f){try{return qi.decodeString(f,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vn(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _n=()=>vn().__FIREBASE_DEFAULTS__,yn=()=>{if(typeof process>"u"||typeof process.env>"u")return;const f={}.__FIREBASE_DEFAULTS__;if(f)return JSON.parse(f)},bn=()=>{if(typeof document>"u")return;let f;try{f=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=f&&pn(f[1]);return t&&JSON.parse(t)},Cn=()=>{try{return _n()||yn()||bn()}catch(f){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${f}`);return}},wn=()=>{var f;return(f=Cn())===null||f===void 0?void 0:f.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sn{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,g)=>{this.resolve=t,this.reject=g})}wrapCallback(t){return(g,v)=>{g?this.reject(g):this.resolve(v),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(g):t(g,v))}}}function Tn(){try{return typeof indexedDB=="object"}catch{return!1}}function xn(){return new Promise((f,t)=>{try{let g=!0;const v="validate-browser-context-for-indexeddb-analytics-module",_=self.indexedDB.open(v);_.onsuccess=()=>{_.result.close(),g||self.indexedDB.deleteDatabase(v),f(!0)},_.onupgradeneeded=()=>{g=!1},_.onerror=()=>{var C;t(((C=_.error)===null||C===void 0?void 0:C.message)||"")}}catch(g){t(g)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const On="FirebaseError";class Ce extends Error{constructor(t,g,v){super(g),this.code=t,this.customData=v,this.name=On,Object.setPrototypeOf(this,Ce.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ji.prototype.create)}}class Ji{constructor(t,g,v){this.service=t,this.serviceName=g,this.errors=v}create(t,...g){const v=g[0]||{},_=`${this.service}/${t}`,C=this.errors[t],b=C?En(C,v):"Error",c=`${this.serviceName}: ${b} (${_}).`;return new Ce(_,c,v)}}function En(f,t){return f.replace(kn,(g,v)=>{const _=t[v];return _!=null?String(_):`<${v}?>`})}const kn=/\{\$([^}]+)}/g;function Ne(f,t){if(f===t)return!0;const g=Object.keys(f),v=Object.keys(t);for(const _ of g){if(!v.includes(_))return!1;const C=f[_],b=t[_];if(oi(C)&&oi(b)){if(!Ne(C,b))return!1}else if(C!==b)return!1}for(const _ of v)if(!g.includes(_))return!1;return!0}function oi(f){return f!==null&&typeof f=="object"}class ke{constructor(t,g,v){this.name=t,this.instanceFactory=g,this.type=v,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $t="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class An{constructor(t,g){this.name=t,this.container=g,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const g=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(g)){const v=new Sn;if(this.instancesDeferred.set(g,v),this.isInitialized(g)||this.shouldAutoInitialize())try{const _=this.getOrInitializeService({instanceIdentifier:g});_&&v.resolve(_)}catch{}}return this.instancesDeferred.get(g).promise}getImmediate(t){var g;const v=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),_=(g=t==null?void 0:t.optional)!==null&&g!==void 0?g:!1;if(this.isInitialized(v)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:v})}catch(C){if(_)return null;throw C}else{if(_)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Dn(t))try{this.getOrInitializeService({instanceIdentifier:$t})}catch{}for(const[g,v]of this.instancesDeferred.entries()){const _=this.normalizeInstanceIdentifier(g);try{const C=this.getOrInitializeService({instanceIdentifier:_});v.resolve(C)}catch{}}}}clearInstance(t=$t){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(g=>"INTERNAL"in g).map(g=>g.INTERNAL.delete()),...t.filter(g=>"_delete"in g).map(g=>g._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=$t){return this.instances.has(t)}getOptions(t=$t){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:g={}}=t,v=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(v))throw Error(`${this.name}(${v}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const _=this.getOrInitializeService({instanceIdentifier:v,options:g});for(const[C,b]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(C);v===c&&b.resolve(_)}return _}onInit(t,g){var v;const _=this.normalizeInstanceIdentifier(g),C=(v=this.onInitCallbacks.get(_))!==null&&v!==void 0?v:new Set;C.add(t),this.onInitCallbacks.set(_,C);const b=this.instances.get(_);return b&&t(b,_),()=>{C.delete(t)}}invokeOnInitCallbacks(t,g){const v=this.onInitCallbacks.get(g);if(v)for(const _ of v)try{_(t,g)}catch{}}getOrInitializeService({instanceIdentifier:t,options:g={}}){let v=this.instances.get(t);if(!v&&this.component&&(v=this.component.instanceFactory(this.container,{instanceIdentifier:Pn(t),options:g}),this.instances.set(t,v),this.instancesOptions.set(t,g),this.invokeOnInitCallbacks(v,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,v)}catch{}return v||null}normalizeInstanceIdentifier(t=$t){return this.component?this.component.multipleInstances?t:$t:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Pn(f){return f===$t?void 0:f}function Dn(f){return f.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mn{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const g=this.getProvider(t.name);if(g.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);g.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const g=new An(t,this);return this.providers.set(t,g),g}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Tt;(function(f){f[f.DEBUG=0]="DEBUG",f[f.VERBOSE=1]="VERBOSE",f[f.INFO=2]="INFO",f[f.WARN=3]="WARN",f[f.ERROR=4]="ERROR",f[f.SILENT=5]="SILENT"})(Tt||(Tt={}));const Fn={debug:Tt.DEBUG,verbose:Tt.VERBOSE,info:Tt.INFO,warn:Tt.WARN,error:Tt.ERROR,silent:Tt.SILENT},In=Tt.INFO,Ln={[Tt.DEBUG]:"log",[Tt.VERBOSE]:"log",[Tt.INFO]:"info",[Tt.WARN]:"warn",[Tt.ERROR]:"error"},Rn=(f,t,...g)=>{if(t<f.logLevel)return;const v=new Date().toISOString(),_=Ln[t];if(_)console[_](`[${v}]  ${f.name}:`,...g);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Bn{constructor(t){this.name=t,this._logLevel=In,this._logHandler=Rn,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Tt))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Fn[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Tt.DEBUG,...t),this._logHandler(this,Tt.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Tt.VERBOSE,...t),this._logHandler(this,Tt.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Tt.INFO,...t),this._logHandler(this,Tt.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Tt.WARN,...t),this._logHandler(this,Tt.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Tt.ERROR,...t),this._logHandler(this,Tt.ERROR,...t)}}const jn=(f,t)=>t.some(g=>f instanceof g);let li,hi;function Wn(){return li||(li=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Xn(){return hi||(hi=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Qi=new WeakMap,Ye=new WeakMap,Zi=new WeakMap,De=new WeakMap,ii=new WeakMap;function Hn(f){const t=new Promise((g,v)=>{const _=()=>{f.removeEventListener("success",C),f.removeEventListener("error",b)},C=()=>{g(Qt(f.result)),_()},b=()=>{v(f.error),_()};f.addEventListener("success",C),f.addEventListener("error",b)});return t.then(g=>{g instanceof IDBCursor&&Qi.set(g,f)}).catch(()=>{}),ii.set(t,f),t}function Nn(f){if(Ye.has(f))return;const t=new Promise((g,v)=>{const _=()=>{f.removeEventListener("complete",C),f.removeEventListener("error",b),f.removeEventListener("abort",b)},C=()=>{g(),_()},b=()=>{v(f.error||new DOMException("AbortError","AbortError")),_()};f.addEventListener("complete",C),f.addEventListener("error",b),f.addEventListener("abort",b)});Ye.set(f,t)}let ze={get(f,t,g){if(f instanceof IDBTransaction){if(t==="done")return Ye.get(f);if(t==="objectStoreNames")return f.objectStoreNames||Zi.get(f);if(t==="store")return g.objectStoreNames[1]?void 0:g.objectStore(g.objectStoreNames[0])}return Qt(f[t])},set(f,t,g){return f[t]=g,!0},has(f,t){return f instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in f}};function Yn(f){ze=f(ze)}function zn(f){return f===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...g){const v=f.call(Me(this),t,...g);return Zi.set(v,t.sort?t.sort():[t]),Qt(v)}:Xn().includes(f)?function(...t){return f.apply(Me(this),t),Qt(Qi.get(this))}:function(...t){return Qt(f.apply(Me(this),t))}}function Un(f){return typeof f=="function"?zn(f):(f instanceof IDBTransaction&&Nn(f),jn(f,Wn())?new Proxy(f,ze):f)}function Qt(f){if(f instanceof IDBRequest)return Hn(f);if(De.has(f))return De.get(f);const t=Un(f);return t!==f&&(De.set(f,t),ii.set(t,f)),t}const Me=f=>ii.get(f);function Vn(f,t,{blocked:g,upgrade:v,blocking:_,terminated:C}={}){const b=indexedDB.open(f,t),c=Qt(b);return v&&b.addEventListener("upgradeneeded",i=>{v(Qt(b.result),i.oldVersion,i.newVersion,Qt(b.transaction))}),g&&b.addEventListener("blocked",()=>g()),c.then(i=>{C&&i.addEventListener("close",()=>C()),_&&i.addEventListener("versionchange",()=>_())}).catch(()=>{}),c}const Gn=["get","getKey","getAll","getAllKeys","count"],qn=["put","add","delete","clear"],Fe=new Map;function ci(f,t){if(!(f instanceof IDBDatabase&&!(t in f)&&typeof t=="string"))return;if(Fe.get(t))return Fe.get(t);const g=t.replace(/FromIndex$/,""),v=t!==g,_=qn.includes(g);if(!(g in(v?IDBIndex:IDBObjectStore).prototype)||!(_||Gn.includes(g)))return;const C=async function(b,...c){const i=this.transaction(b,_?"readwrite":"readonly");let l=i.store;return v&&(l=l.index(c.shift())),(await Promise.all([l[g](...c),_&&i.done]))[0]};return Fe.set(t,C),C}Yn(f=>({...f,get:(t,g,v)=>ci(t,g)||f.get(t,g,v),has:(t,g)=>!!ci(t,g)||f.has(t,g)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kn{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(g=>{if(Jn(g)){const v=g.getImmediate();return`${v.library}/${v.version}`}else return null}).filter(g=>g).join(" ")}}function Jn(f){const t=f.getComponent();return(t==null?void 0:t.type)==="VERSION"}const Ue="@firebase/app",ui="0.9.5";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ie=new Bn("@firebase/app"),Qn="@firebase/app-compat",Zn="@firebase/analytics-compat",$n="@firebase/analytics",tr="@firebase/app-check-compat",er="@firebase/app-check",ir="@firebase/auth",nr="@firebase/auth-compat",rr="@firebase/database",sr="@firebase/database-compat",ar="@firebase/functions",or="@firebase/functions-compat",lr="@firebase/installations",hr="@firebase/installations-compat",cr="@firebase/messaging",ur="@firebase/messaging-compat",fr="@firebase/performance",dr="@firebase/performance-compat",gr="@firebase/remote-config",mr="@firebase/remote-config-compat",pr="@firebase/storage",vr="@firebase/storage-compat",_r="@firebase/firestore",yr="@firebase/firestore-compat",br="firebase";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cr="[DEFAULT]",wr={[Ue]:"fire-core",[Qn]:"fire-core-compat",[$n]:"fire-analytics",[Zn]:"fire-analytics-compat",[er]:"fire-app-check",[tr]:"fire-app-check-compat",[ir]:"fire-auth",[nr]:"fire-auth-compat",[rr]:"fire-rtdb",[sr]:"fire-rtdb-compat",[ar]:"fire-fn",[or]:"fire-fn-compat",[lr]:"fire-iid",[hr]:"fire-iid-compat",[cr]:"fire-fcm",[ur]:"fire-fcm-compat",[fr]:"fire-perf",[dr]:"fire-perf-compat",[gr]:"fire-rc",[mr]:"fire-rc-compat",[pr]:"fire-gcs",[vr]:"fire-gcs-compat",[_r]:"fire-fst",[yr]:"fire-fst-compat","fire-js":"fire-js",[br]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ve=new Map,Ge=new Map;function Sr(f,t){try{f.container.addComponent(t)}catch(g){ie.debug(`Component ${t.name} failed to register with FirebaseApp ${f.name}`,g)}}function qe(f){const t=f.name;if(Ge.has(t))return ie.debug(`There were multiple attempts to register component ${t}.`),!1;Ge.set(t,f);for(const g of Ve.values())Sr(g,f);return!0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tr={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},ee=new Ji("app","Firebase",Tr);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xr{constructor(t,g,v){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},g),this._name=g.name,this._automaticDataCollectionEnabled=g.automaticDataCollectionEnabled,this._container=v,this.container.addComponent(new ke("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ee.create("app-deleted",{appName:this._name})}}function Or(f,t={}){let g=f;typeof t!="object"&&(t={name:t});const v=Object.assign({name:Cr,automaticDataCollectionEnabled:!1},t),_=v.name;if(typeof _!="string"||!_)throw ee.create("bad-app-name",{appName:String(_)});if(g||(g=wn()),!g)throw ee.create("no-options");const C=Ve.get(_);if(C){if(Ne(g,C.options)&&Ne(v,C.config))return C;throw ee.create("duplicate-app",{appName:_})}const b=new Mn(_);for(const i of Ge.values())b.addComponent(i);const c=new xr(g,v,b);return Ve.set(_,c),c}function Oe(f,t,g){var v;let _=(v=wr[f])!==null&&v!==void 0?v:f;g&&(_+=`-${g}`);const C=_.match(/\s|\//),b=t.match(/\s|\//);if(C||b){const c=[`Unable to register library "${_}" with version "${t}":`];C&&c.push(`library name "${_}" contains illegal characters (whitespace or "/")`),C&&b&&c.push("and"),b&&c.push(`version name "${t}" contains illegal characters (whitespace or "/")`),ie.warn(c.join(" "));return}qe(new ke(`${_}-version`,()=>({library:_,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Er="firebase-heartbeat-database",kr=1,ge="firebase-heartbeat-store";let Ie=null;function $i(){return Ie||(Ie=Vn(Er,kr,{upgrade:(f,t)=>{switch(t){case 0:f.createObjectStore(ge)}}}).catch(f=>{throw ee.create("idb-open",{originalErrorMessage:f.message})})),Ie}async function Ar(f){try{return(await $i()).transaction(ge).objectStore(ge).get(tn(f))}catch(t){if(t instanceof Ce)ie.warn(t.message);else{const g=ee.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});ie.warn(g.message)}}}async function fi(f,t){try{const v=(await $i()).transaction(ge,"readwrite");return await v.objectStore(ge).put(t,tn(f)),v.done}catch(g){if(g instanceof Ce)ie.warn(g.message);else{const v=ee.create("idb-set",{originalErrorMessage:g==null?void 0:g.message});ie.warn(v.message)}}}function tn(f){return`${f.name}!${f.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pr=1024,Dr=30*24*60*60*1e3;class Mr{constructor(t){this.container=t,this._heartbeatsCache=null;const g=this.container.getProvider("app").getImmediate();this._storage=new Ir(g),this._heartbeatsCachePromise=this._storage.read().then(v=>(this._heartbeatsCache=v,v))}async triggerHeartbeat(){const g=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),v=di();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===v||this._heartbeatsCache.heartbeats.some(_=>_.date===v)))return this._heartbeatsCache.heartbeats.push({date:v,agent:g}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(_=>{const C=new Date(_.date).valueOf();return Date.now()-C<=Dr}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const t=di(),{heartbeatsToSend:g,unsentEntries:v}=Fr(this._heartbeatsCache.heartbeats),_=Ki(JSON.stringify({version:2,heartbeats:g}));return this._heartbeatsCache.lastSentHeartbeatDate=t,v.length>0?(this._heartbeatsCache.heartbeats=v,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),_}}function di(){return new Date().toISOString().substring(0,10)}function Fr(f,t=Pr){const g=[];let v=f.slice();for(const _ of f){const C=g.find(b=>b.agent===_.agent);if(C){if(C.dates.push(_.date),gi(g)>t){C.dates.pop();break}}else if(g.push({agent:_.agent,dates:[_.date]}),gi(g)>t){g.pop();break}v=v.slice(1)}return{heartbeatsToSend:g,unsentEntries:v}}class Ir{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Tn()?xn().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await Ar(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(t){var g;if(await this._canUseIndexedDBPromise){const _=await this.read();return fi(this.app,{lastSentHeartbeatDate:(g=t.lastSentHeartbeatDate)!==null&&g!==void 0?g:_.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var g;if(await this._canUseIndexedDBPromise){const _=await this.read();return fi(this.app,{lastSentHeartbeatDate:(g=t.lastSentHeartbeatDate)!==null&&g!==void 0?g:_.lastSentHeartbeatDate,heartbeats:[..._.heartbeats,...t.heartbeats]})}else return}}function gi(f){return Ki(JSON.stringify({version:2,heartbeats:f})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lr(f){qe(new ke("platform-logger",t=>new Kn(t),"PRIVATE")),qe(new ke("heartbeat",t=>new Mr(t),"PRIVATE")),Oe(Ue,ui,f),Oe(Ue,ui,"esm2017"),Oe("fire-js","")}Lr("");var Rr="firebase",Br="9.18.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Oe(Rr,Br,"app");function bt(){}function jr(f,t){for(const g in t)f[g]=t[g];return f}function en(f){return f()}function mi(){return Object.create(null)}function Ft(f){f.forEach(en)}function Pe(f){return typeof f=="function"}function Ot(f,t){return f!=f?t==t:f!==t||f&&typeof f=="object"||typeof f=="function"}let we;function Ke(f,t){return we||(we=document.createElement("a")),we.href=t,f===we.href}function Wr(f){return Object.keys(f).length===0}function nn(f,...t){if(f==null)return bt;const g=f.subscribe(...t);return g.unsubscribe?()=>g.unsubscribe():g}function Lt(f,t,g){f.$$.on_destroy.push(nn(t,g))}function me(f,t,g,v){if(f){const _=rn(f,t,g,v);return f[0](_)}}function rn(f,t,g,v){return f[1]&&v?jr(g.ctx.slice(),f[1](v(t))):g.ctx}function pe(f,t,g,v){if(f[2]&&v){const _=f[2](v(g));if(t.dirty===void 0)return _;if(typeof _=="object"){const C=[],b=Math.max(t.dirty.length,_.length);for(let c=0;c<b;c+=1)C[c]=t.dirty[c]|_[c];return C}return t.dirty|_}return t.dirty}function ve(f,t,g,v,_,C){if(_){const b=rn(t,g,v,C);f.p(b,_)}}function _e(f){if(f.ctx.length>32){const t=[],g=f.ctx.length/32;for(let v=0;v<g;v++)t[v]=-1;return t}return-1}function zt(f){return f??""}function Jt(f,t,g){return f.set(g),t}function Q(f,t){f.appendChild(t)}function ut(f,t,g){f.insertBefore(t,g||null)}function ht(f){f.parentNode&&f.parentNode.removeChild(f)}function Je(f,t){for(let g=0;g<f.length;g+=1)f[g]&&f[g].d(t)}function et(f){return document.createElement(f)}function Xt(f){return document.createTextNode(f)}function gt(){return Xt(" ")}function Vt(){return Xt("")}function ot(f,t,g,v){return f.addEventListener(t,g,v),()=>f.removeEventListener(t,g,v)}function Ut(f){return function(t){return t.preventDefault(),f.call(this,t)}}function ne(f){return function(t){return t.stopPropagation(),f.call(this,t)}}function Xr(f){return function(t){t.target===this&&f.call(this,t)}}function I(f,t,g){g==null?f.removeAttribute(t):f.getAttribute(t)!==g&&f.setAttribute(t,g)}function Hr(f){return Array.from(f.childNodes)}function le(f,t){t=""+t,f.wholeText!==t&&(f.data=t)}function Ht(f,t,g,v){g===null?f.style.removeProperty(t):f.style.setProperty(t,g,v?"important":"")}function Rt(f,t,g){f.classList[g?"add":"remove"](t)}function Nr(f,t,{bubbles:g=!1,cancelable:v=!1}={}){const _=document.createEvent("CustomEvent");return _.initCustomEvent(f,g,v,t),_}function St(f,t){return new f(t)}let ye;function fe(f){ye=f}function sn(){if(!ye)throw new Error("Function called outside component initialization");return ye}function Yr(f){sn().$$.on_mount.push(f)}function zr(){const f=sn();return(t,g,{cancelable:v=!1}={})=>{const _=f.$$.callbacks[t];if(_){const C=Nr(t,g,{cancelable:v});return _.slice().forEach(b=>{b.call(f,C)}),!C.defaultPrevented}return!0}}function Ur(f,t){const g=f.$$.callbacks[t.type];g&&g.slice().forEach(v=>v.call(this,t))}const ae=[],Ct=[];let oe=[];const Qe=[],Vr=Promise.resolve();let Ze=!1;function Gr(){Ze||(Ze=!0,Vr.then(an))}function $e(f){oe.push(f)}function Wt(f){Qe.push(f)}const Le=new Set;let re=0;function an(){if(re!==0)return;const f=ye;do{try{for(;re<ae.length;){const t=ae[re];re++,fe(t),qr(t.$$)}}catch(t){throw ae.length=0,re=0,t}for(fe(null),ae.length=0,re=0;Ct.length;)Ct.pop()();for(let t=0;t<oe.length;t+=1){const g=oe[t];Le.has(g)||(Le.add(g),g())}oe.length=0}while(ae.length);for(;Qe.length;)Qe.pop()();Ze=!1,Le.clear(),fe(f)}function qr(f){if(f.fragment!==null){f.update(),Ft(f.before_update);const t=f.dirty;f.dirty=[-1],f.fragment&&f.fragment.p(f.ctx,t),f.after_update.forEach($e)}}function Kr(f){const t=[],g=[];oe.forEach(v=>f.indexOf(v)===-1?t.push(v):g.push(v)),g.forEach(v=>v()),oe=t}const Ee=new Set;let te;function Dt(){te={r:0,c:[],p:te}}function Mt(){te.r||Ft(te.c),te=te.p}function at(f,t){f&&f.i&&(Ee.delete(f),f.i(t))}function ft(f,t,g,v){if(f&&f.o){if(Ee.has(f))return;Ee.add(f),te.c.push(()=>{Ee.delete(f),v&&(g&&f.d(1),v())}),f.o(t)}else v&&v()}const ni=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Pt(f,t,g){const v=f.$$.props[t];v!==void 0&&(f.$$.bound[v]=g,g(f.$$.ctx[v]))}function yt(f){f&&f.c()}function pt(f,t,g,v){const{fragment:_,after_update:C}=f.$$;_&&_.m(t,g),v||$e(()=>{const b=f.$$.on_mount.map(en).filter(Pe);f.$$.on_destroy?f.$$.on_destroy.push(...b):Ft(b),f.$$.on_mount=[]}),C.forEach($e)}function vt(f,t){const g=f.$$;g.fragment!==null&&(Kr(g.after_update),Ft(g.on_destroy),g.fragment&&g.fragment.d(t),g.on_destroy=g.fragment=null,g.ctx=[])}function Jr(f,t){f.$$.dirty[0]===-1&&(ae.push(f),Gr(),f.$$.dirty.fill(0)),f.$$.dirty[t/31|0]|=1<<t%31}function Et(f,t,g,v,_,C,b,c=[-1]){const i=ye;fe(f);const l=f.$$={fragment:null,ctx:[],props:C,update:bt,not_equal:_,bound:mi(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(i?i.$$.context:[])),callbacks:mi(),dirty:c,skip_bound:!1,root:t.target||i.$$.root};b&&b(l.root);let o=!1;if(l.ctx=g?g(f,t.props||{},(r,n,...e)=>{const a=e.length?e[0]:n;return l.ctx&&_(l.ctx[r],l.ctx[r]=a)&&(!l.skip_bound&&l.bound[r]&&l.bound[r](a),o&&Jr(f,r)),n}):[],l.update(),o=!0,Ft(l.before_update),l.fragment=v?v(l.ctx):!1,t.target){if(t.hydrate){const r=Hr(t.target);l.fragment&&l.fragment.l(r),r.forEach(ht)}else l.fragment&&l.fragment.c();t.intro&&at(f.$$.fragment),pt(f,t.target,t.anchor,t.customElement),an()}fe(i)}class kt{$destroy(){vt(this,1),this.$destroy=bt}$on(t,g){if(!Pe(g))return bt;const v=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return v.push(g),()=>{const _=v.indexOf(g);_!==-1&&v.splice(_,1)}}$set(t){this.$$set&&!Wr(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Qr="/assets/dev-jeans-a579548d.png";function Zr(f){if(f.__esModule)return f;var t=f.default;if(typeof t=="function"){var g=function v(){if(this instanceof v){var _=[null];_.push.apply(_,arguments);var C=Function.bind.apply(t,_);return new C}return t.apply(this,arguments)};g.prototype=t.prototype}else g={};return Object.defineProperty(g,"__esModule",{value:!0}),Object.keys(f).forEach(function(v){var _=Object.getOwnPropertyDescriptor(f,v);Object.defineProperty(g,v,_.get?_:{enumerable:!0,get:function(){return f[v]}})}),g}var he={};const $r={},ts=Object.freeze(Object.defineProperty({__proto__:null,default:$r},Symbol.toStringTag,{value:"Module"})),Re=Zr(ts);(function(f){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var t=t||{version:"5.3.0"};if(f.fabric=t,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?t.document=document:t.document=document.implementation.createHTMLDocument(""),t.window=window;else{var g=Re,v=new g.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;t.document=v.document,t.jsdomImplForWrapper=Re.implForWrapper,t.nodeCanvas=Re.Canvas,t.window=v,DOMParser=t.window.DOMParser}t.isTouchSupported="ontouchstart"in t.window||"ontouchstart"in t.document||t.window&&t.window.navigator&&t.window.navigator.maxTouchPoints>0,t.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",t.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],t.DPI=96,t.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",t.commaWsp="(?:\\s+,?\\s*|,\\s*)",t.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,t.reNonWord=/[ \n\.,;!\?\-]/,t.fontPaths={},t.iMatrix=[1,0,0,1,0,0],t.svgNS="http://www.w3.org/2000/svg",t.perfLimitSizeTotal=2097152,t.maxCacheSideLimit=4096,t.minCacheSideLimit=256,t.charWidthsCache={},t.textureSize=2048,t.disableStyleCopyPaste=!1,t.enableGLFiltering=!0,t.devicePixelRatio=t.window.devicePixelRatio||t.window.webkitDevicePixelRatio||t.window.mozDevicePixelRatio||1,t.browserShadowBlurConstant=1,t.arcToSegmentsCache={},t.boundsOfCurveCache={},t.cachesBoundsOfCurve=!0,t.forceGLPutImageData=!1,t.initFilterBackend=function(){if(t.enableGLFiltering&&t.isWebglSupported&&t.isWebglSupported(t.textureSize))return console.log("max texture size: "+t.maxTextureSize),new t.WebglFilterBackend({tileSize:t.textureSize});if(t.Canvas2dFilterBackend)return new t.Canvas2dFilterBackend},typeof document<"u"&&typeof window<"u"&&(window.fabric=t),function(){function c(e,a){if(this.__eventListeners[e]){var h=this.__eventListeners[e];a?h[h.indexOf(a)]=!1:t.util.array.fill(h,!1)}}function i(e,a){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var h in e)this.on(h,e[h]);else this.__eventListeners[e]||(this.__eventListeners[e]=[]),this.__eventListeners[e].push(a);return this}function l(e,a){var h=function(){a.apply(this,arguments),this.off(e,h)}.bind(this);this.on(e,h)}function o(e,a){if(arguments.length===1)for(var h in e)l.call(this,h,e[h]);else l.call(this,e,a);return this}function r(e,a){if(!this.__eventListeners)return this;if(arguments.length===0)for(e in this.__eventListeners)c.call(this,e);else if(arguments.length===1&&typeof arguments[0]=="object")for(var h in e)c.call(this,h,e[h]);else c.call(this,e,a);return this}function n(e,a){if(!this.__eventListeners)return this;var h=this.__eventListeners[e];if(!h)return this;for(var s=0,u=h.length;s<u;s++)h[s]&&h[s].call(this,a||{});return this.__eventListeners[e]=h.filter(function(d){return d!==!1}),this}t.Observable={fire:n,on:i,once:o,off:r}}(),t.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var c=0,i=arguments.length;c<i;c++)this._onObjectAdded(arguments[c]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(c,i,l){var o=this._objects;return l?o[i]=c:o.splice(i,0,c),this._onObjectAdded&&this._onObjectAdded(c),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var c=this._objects,i,l=!1,o=0,r=arguments.length;o<r;o++)i=c.indexOf(arguments[o]),i!==-1&&(l=!0,c.splice(i,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[o]));return this.renderOnAddRemove&&l&&this.requestRenderAll(),this},forEachObject:function(c,i){for(var l=this.getObjects(),o=0,r=l.length;o<r;o++)c.call(i,l[o],o,l);return this},getObjects:function(c){return typeof c>"u"?this._objects.concat():this._objects.filter(function(i){return i.type===c})},item:function(c){return this._objects[c]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(c,i){return this._objects.indexOf(c)>-1?!0:i?this._objects.some(function(l){return typeof l.contains=="function"&&l.contains(c,!0)}):!1},complexity:function(){return this._objects.reduce(function(c,i){return c+=i.complexity?i.complexity():0,c},0)}},t.CommonMethods={_setOptions:function(c){for(var i in c)this.set(i,c[i])},_initGradient:function(c,i){c&&c.colorStops&&!(c instanceof t.Gradient)&&this.set(i,new t.Gradient(c))},_initPattern:function(c,i,l){c&&c.source&&!(c instanceof t.Pattern)?this.set(i,new t.Pattern(c,l)):l&&l()},_setObject:function(c){for(var i in c)this._set(i,c[i])},set:function(c,i){return typeof c=="object"?this._setObject(c):this._set(c,i),this},_set:function(c,i){this[c]=i},toggle:function(c){var i=this.get(c);return typeof i=="boolean"&&this.set(c,!i),this},get:function(c){return this[c]}},function(c){var i=Math.sqrt,l=Math.atan2,o=Math.pow,r=Math.PI/180,n=Math.PI/2;t.util={cos:function(e){if(e===0)return 1;e<0&&(e=-e);var a=e/n;switch(a){case 1:case 3:return 0;case 2:return-1}return Math.cos(e)},sin:function(e){if(e===0)return 0;var a=e/n,h=1;switch(e<0&&(h=-1),a){case 1:return h;case 2:return 0;case 3:return-h}return Math.sin(e)},removeFromArray:function(e,a){var h=e.indexOf(a);return h!==-1&&e.splice(h,1),e},getRandomInt:function(e,a){return Math.floor(Math.random()*(a-e+1))+e},degreesToRadians:function(e){return e*r},radiansToDegrees:function(e){return e/r},rotatePoint:function(e,a,h){var s=new t.Point(e.x-a.x,e.y-a.y),u=t.util.rotateVector(s,h);return new t.Point(u.x,u.y).addEquals(a)},rotateVector:function(e,a){var h=t.util.sin(a),s=t.util.cos(a),u=e.x*s-e.y*h,d=e.x*h+e.y*s;return{x:u,y:d}},createVector:function(e,a){return new t.Point(a.x-e.x,a.y-e.y)},calcAngleBetweenVectors:function(e,a){return Math.acos((e.x*a.x+e.y*a.y)/(Math.hypot(e.x,e.y)*Math.hypot(a.x,a.y)))},getHatVector:function(e){return new t.Point(e.x,e.y).multiply(1/Math.hypot(e.x,e.y))},getBisector:function(e,a,h){var s=t.util.createVector(e,a),u=t.util.createVector(e,h),d=t.util.calcAngleBetweenVectors(s,u),m=t.util.calcAngleBetweenVectors(t.util.rotateVector(s,d),u),p=d*(m===0?1:-1)/2;return{vector:t.util.getHatVector(t.util.rotateVector(s,p)),angle:d}},projectStrokeOnPoints:function(e,a,h){var s=[],u=a.strokeWidth/2,d=a.strokeUniform?new t.Point(1/a.scaleX,1/a.scaleY):new t.Point(1,1),m=function(p){var y=u/Math.hypot(p.x,p.y);return new t.Point(p.x*y*d.x,p.y*y*d.y)};return e.length<=1||e.forEach(function(p,y){var w=new t.Point(p.x,p.y),S,E;y===0?(E=e[y+1],S=h?m(t.util.createVector(E,w)).addEquals(w):e[e.length-1]):y===e.length-1?(S=e[y-1],E=h?m(t.util.createVector(S,w)).addEquals(w):e[0]):(S=e[y-1],E=e[y+1]);var D=t.util.getBisector(w,S,E),W=D.vector,K=D.angle,tt,N;if(a.strokeLineJoin==="miter"&&(tt=-u/Math.sin(K/2),N=new t.Point(W.x*tt*d.x,W.y*tt*d.y),Math.hypot(N.x,N.y)/u<=a.strokeMiterLimit)){s.push(w.add(N)),s.push(w.subtract(N));return}tt=-u*Math.SQRT2,N=new t.Point(W.x*tt*d.x,W.y*tt*d.y),s.push(w.add(N)),s.push(w.subtract(N))}),s},transformPoint:function(e,a,h){return h?new t.Point(a[0]*e.x+a[2]*e.y,a[1]*e.x+a[3]*e.y):new t.Point(a[0]*e.x+a[2]*e.y+a[4],a[1]*e.x+a[3]*e.y+a[5])},makeBoundingBoxFromPoints:function(e,a){if(a)for(var h=0;h<e.length;h++)e[h]=t.util.transformPoint(e[h],a);var s=[e[0].x,e[1].x,e[2].x,e[3].x],u=t.util.array.min(s),d=t.util.array.max(s),m=d-u,p=[e[0].y,e[1].y,e[2].y,e[3].y],y=t.util.array.min(p),w=t.util.array.max(p),S=w-y;return{left:u,top:y,width:m,height:S}},invertTransform:function(e){var a=1/(e[0]*e[3]-e[1]*e[2]),h=[a*e[3],-a*e[1],-a*e[2],a*e[0]],s=t.util.transformPoint({x:e[4],y:e[5]},h,!0);return h[4]=-s.x,h[5]=-s.y,h},toFixed:function(e,a){return parseFloat(Number(e).toFixed(a))},parseUnit:function(e,a){var h=/\D{0,2}$/.exec(e),s=parseFloat(e);switch(a||(a=t.Text.DEFAULT_SVG_FONT_SIZE),h[0]){case"mm":return s*t.DPI/25.4;case"cm":return s*t.DPI/2.54;case"in":return s*t.DPI;case"pt":return s*t.DPI/72;case"pc":return s*t.DPI/72*12;case"em":return s*a;default:return s}},falseFunction:function(){return!1},getKlass:function(e,a){return e=t.util.string.camelize(e.charAt(0).toUpperCase()+e.slice(1)),t.util.resolveNamespace(a)[e]},getSvgAttributes:function(e){var a=["instantiated_by_use","style","id","class"];switch(e){case"linearGradient":a=a.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":a=a.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":a=a.concat(["offset","stop-color","stop-opacity"]);break}return a},resolveNamespace:function(e){if(!e)return t;var a=e.split("."),h=a.length,s,u=c||t.window;for(s=0;s<h;++s)u=u[a[s]];return u},loadImage:function(e,a,h,s){if(!e){a&&a.call(h,e);return}var u=t.util.createImage(),d=function(){a&&a.call(h,u,!1),u=u.onload=u.onerror=null};u.onload=d,u.onerror=function(){t.log("Error loading "+u.src),a&&a.call(h,null,!0),u=u.onload=u.onerror=null},e.indexOf("data")!==0&&s!==void 0&&s!==null&&(u.crossOrigin=s),e.substring(0,14)==="data:image/svg"&&(u.onload=null,t.util.loadImageInDom(u,d)),u.src=e},loadImageInDom:function(e,a){var h=t.document.createElement("div");h.style.width=h.style.height="1px",h.style.left=h.style.top="-100%",h.style.position="absolute",h.appendChild(e),t.document.querySelector("body").appendChild(h),e.onload=function(){a(),h.parentNode.removeChild(h),h=null}},enlivenObjects:function(e,a,h,s){e=e||[];var u=[],d=0,m=e.length;function p(){++d===m&&a&&a(u.filter(function(y){return y}))}if(!m){a&&a(u);return}e.forEach(function(y,w){if(!y||!y.type){p();return}var S=t.util.getKlass(y.type,h);S.fromObject(y,function(E,D){D||(u[w]=E),s&&s(y,E,D),p()})})},enlivenObjectEnlivables:function(e,a,h){var s=t.Object.ENLIVEN_PROPS.filter(function(u){return!!e[u]});t.util.enlivenObjects(s.map(function(u){return e[u]}),function(u){var d={};s.forEach(function(m,p){d[m]=u[p],a&&(a[m]=u[p])}),h&&h(d)})},enlivenPatterns:function(e,a){e=e||[];function h(){++u===d&&a&&a(s)}var s=[],u=0,d=e.length;if(!d){a&&a(s);return}e.forEach(function(m,p){m&&m.source?new t.Pattern(m,function(y){s[p]=y,h()}):(s[p]=m,h())})},groupSVGElements:function(e,a,h){var s;return e&&e.length===1?(typeof h<"u"&&(e[0].sourcePath=h),e[0]):(a&&(a.width&&a.height?a.centerPoint={x:a.width/2,y:a.height/2}:(delete a.width,delete a.height)),s=new t.Group(e,a),typeof h<"u"&&(s.sourcePath=h),s)},populateWithProperties:function(e,a,h){if(h&&Array.isArray(h))for(var s=0,u=h.length;s<u;s++)h[s]in e&&(a[h[s]]=e[h[s]])},createCanvasElement:function(){return t.document.createElement("canvas")},copyCanvasElement:function(e){var a=t.util.createCanvasElement();return a.width=e.width,a.height=e.height,a.getContext("2d").drawImage(e,0,0),a},toDataURL:function(e,a,h){return e.toDataURL("image/"+a,h)},createImage:function(){return t.document.createElement("img")},multiplyTransformMatrices:function(e,a,h){return[e[0]*a[0]+e[2]*a[1],e[1]*a[0]+e[3]*a[1],e[0]*a[2]+e[2]*a[3],e[1]*a[2]+e[3]*a[3],h?0:e[0]*a[4]+e[2]*a[5]+e[4],h?0:e[1]*a[4]+e[3]*a[5]+e[5]]},qrDecompose:function(e){var a=l(e[1],e[0]),h=o(e[0],2)+o(e[1],2),s=i(h),u=(e[0]*e[3]-e[2]*e[1])/s,d=l(e[0]*e[2]+e[1]*e[3],h);return{angle:a/r,scaleX:s,scaleY:u,skewX:d/r,skewY:0,translateX:e[4],translateY:e[5]}},calcRotateMatrix:function(e){if(!e.angle)return t.iMatrix.concat();var a=t.util.degreesToRadians(e.angle),h=t.util.cos(a),s=t.util.sin(a);return[h,s,-s,h,0,0]},calcDimensionsMatrix:function(e){var a=typeof e.scaleX>"u"?1:e.scaleX,h=typeof e.scaleY>"u"?1:e.scaleY,s=[e.flipX?-a:a,0,0,e.flipY?-h:h,0,0],u=t.util.multiplyTransformMatrices,d=t.util.degreesToRadians;return e.skewX&&(s=u(s,[1,0,Math.tan(d(e.skewX)),1],!0)),e.skewY&&(s=u(s,[1,Math.tan(d(e.skewY)),0,1],!0)),s},composeMatrix:function(e){var a=[1,0,0,1,e.translateX||0,e.translateY||0],h=t.util.multiplyTransformMatrices;return e.angle&&(a=h(a,t.util.calcRotateMatrix(e))),(e.scaleX!==1||e.scaleY!==1||e.skewX||e.skewY||e.flipX||e.flipY)&&(a=h(a,t.util.calcDimensionsMatrix(e))),a},resetObjectTransform:function(e){e.scaleX=1,e.scaleY=1,e.skewX=0,e.skewY=0,e.flipX=!1,e.flipY=!1,e.rotate(0)},saveObjectTransform:function(e){return{scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,angle:e.angle,left:e.left,flipX:e.flipX,flipY:e.flipY,top:e.top}},isTransparent:function(e,a,h,s){s>0&&(a>s?a-=s:a=0,h>s?h-=s:h=0);var u=!0,d,m,p=e.getImageData(a,h,s*2||1,s*2||1),y=p.data.length;for(d=3;d<y&&(m=p.data[d],u=m<=0,u!==!1);d+=4);return p=null,u},parsePreserveAspectRatioAttribute:function(e){var a="meet",h="Mid",s="Mid",u=e.split(" "),d;return u&&u.length&&(a=u.pop(),a!=="meet"&&a!=="slice"?(d=a,a="meet"):u.length&&(d=u.pop())),h=d!=="none"?d.slice(1,4):"none",s=d!=="none"?d.slice(5,8):"none",{meetOrSlice:a,alignX:h,alignY:s}},clearFabricFontCache:function(e){e=(e||"").toLowerCase(),e?t.charWidthsCache[e]&&delete t.charWidthsCache[e]:t.charWidthsCache={}},limitDimsByArea:function(e,a){var h=Math.sqrt(a*e),s=Math.floor(a/h);return{x:Math.floor(h),y:s}},capValue:function(e,a,h){return Math.max(e,Math.min(a,h))},findScaleToFit:function(e,a){return Math.min(a.width/e.width,a.height/e.height)},findScaleToCover:function(e,a){return Math.max(a.width/e.width,a.height/e.height)},matrixToSVG:function(e){return"matrix("+e.map(function(a){return t.util.toFixed(a,t.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(e,a){var h=t.util.invertTransform(a),s=t.util.multiplyTransformMatrices(h,e.calcOwnMatrix());t.util.applyTransformToObject(e,s)},addTransformToObject:function(e,a){t.util.applyTransformToObject(e,t.util.multiplyTransformMatrices(a,e.calcOwnMatrix()))},applyTransformToObject:function(e,a){var h=t.util.qrDecompose(a),s=new t.Point(h.translateX,h.translateY);e.flipX=!1,e.flipY=!1,e.set("scaleX",h.scaleX),e.set("scaleY",h.scaleY),e.skewX=h.skewX,e.skewY=h.skewY,e.angle=h.angle,e.setPositionByOrigin(s,"center","center")},sizeAfterTransform:function(e,a,h){var s=e/2,u=a/2,d=[{x:-s,y:-u},{x:s,y:-u},{x:-s,y:u},{x:s,y:u}],m=t.util.calcDimensionsMatrix(h),p=t.util.makeBoundingBoxFromPoints(d,m);return{x:p.width,y:p.height}},mergeClipPaths:function(e,a){var h=e,s=a;h.inverted&&!s.inverted&&(h=a,s=e),t.util.applyTransformToObject(s,t.util.multiplyTransformMatrices(t.util.invertTransform(h.calcTransformMatrix()),s.calcTransformMatrix()));var u=h.inverted&&s.inverted;return u&&(h.inverted=s.inverted=!1),new t.Group([h],{clipPath:s,inverted:u})},hasStyleChanged:function(e,a,h){return h=h||!1,e.fill!==a.fill||e.stroke!==a.stroke||e.strokeWidth!==a.strokeWidth||e.fontSize!==a.fontSize||e.fontFamily!==a.fontFamily||e.fontWeight!==a.fontWeight||e.fontStyle!==a.fontStyle||e.textBackgroundColor!==a.textBackgroundColor||e.deltaY!==a.deltaY||h&&(e.overline!==a.overline||e.underline!==a.underline||e.linethrough!==a.linethrough)},stylesToArray:function(h,a){for(var h=t.util.object.clone(h,!0),s=a.split(`
`),u=-1,d={},m=[],p=0;p<s.length;p++){if(!h[p]){u+=s[p].length;continue}for(var y=0;y<s[p].length;y++){u++;var w=h[p][y];if(w&&Object.keys(w).length>0){var S=t.util.hasStyleChanged(d,w,!0);S?m.push({start:u,end:u+1,style:w}):m[m.length-1].end++}d=w||{}}}return m},stylesFromArray:function(e,a){if(!Array.isArray(e))return e;for(var h=a.split(`
`),s=-1,u=0,d={},m=0;m<h.length;m++)for(var p=0;p<h[m].length;p++)s++,e[u]&&e[u].start<=s&&s<e[u].end&&(d[m]=d[m]||{},d[m][p]=Object.assign({},e[u].style),s===e[u].end-1&&u++);return d}}}(f),function(){var c=Array.prototype.join,i={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},l={m:"l",M:"L"};function o(T,A,P,k,B,O,x,M,R,Y,j){var G=t.util.cos(T),F=t.util.sin(T),it=t.util.cos(A),X=t.util.sin(A),L=P*B*it-k*O*X+x,U=k*B*it+P*O*X+M,V=Y+R*(-P*B*F-k*O*G),H=j+R*(-k*B*F+P*O*G),q=L+R*(P*B*X+k*O*it),nt=U+R*(k*B*X-P*O*it);return["C",V,H,q,nt,L,U]}function r(T,A,P,k,B,O,x){var M=Math.PI,R=x*M/180,Y=t.util.sin(R),j=t.util.cos(R),G=0,F=0;P=Math.abs(P),k=Math.abs(k);var it=-j*T*.5-Y*A*.5,X=-j*A*.5+Y*T*.5,L=P*P,U=k*k,V=X*X,H=it*it,q=L*U-L*V-U*H,nt=0;if(q<0){var dt=Math.sqrt(1-q/(L*U));P*=dt,k*=dt}else nt=(B===O?-1:1)*Math.sqrt(q/(L*V+U*H));var lt=nt*P*X/k,z=-nt*k*it/P,ct=j*lt-Y*z+T*.5,mt=Y*lt+j*z+A*.5,_t=n(1,0,(it-lt)/P,(X-z)/k),xt=n((it-lt)/P,(X-z)/k,(-it-lt)/P,(-X-z)/k);O===0&&xt>0?xt-=2*M:O===1&&xt<0&&(xt+=2*M);for(var wt=Math.ceil(Math.abs(xt/M*2)),Bt=[],At=xt/wt,Zt=8/3*Math.sin(At/4)*Math.sin(At/4)/Math.sin(At/2),ce=_t+At,Yt=0;Yt<wt;Yt++)Bt[Yt]=o(_t,ce,j,Y,P,k,ct,mt,Zt,G,F),G=Bt[Yt][5],F=Bt[Yt][6],_t=ce,ce+=At;return Bt}function n(T,A,P,k){var B=Math.atan2(A,T),O=Math.atan2(k,P);return O>=B?O-B:2*Math.PI-(B-O)}function e(T,A,P,k,B,O,x,M){var R;if(t.cachesBoundsOfCurve&&(R=c.call(arguments),t.boundsOfCurveCache[R]))return t.boundsOfCurveCache[R];var Y=Math.sqrt,j=Math.min,G=Math.max,F=Math.abs,it=[],X=[[],[]],L,U,V,H,q,nt,dt,lt;U=6*T-12*P+6*B,L=-3*T+9*P-9*B+3*x,V=3*P-3*T;for(var z=0;z<2;++z){if(z>0&&(U=6*A-12*k+6*O,L=-3*A+9*k-9*O+3*M,V=3*k-3*A),F(L)<1e-12){if(F(U)<1e-12)continue;H=-V/U,0<H&&H<1&&it.push(H);continue}dt=U*U-4*V*L,!(dt<0)&&(lt=Y(dt),q=(-U+lt)/(2*L),0<q&&q<1&&it.push(q),nt=(-U-lt)/(2*L),0<nt&&nt<1&&it.push(nt))}for(var ct,mt,_t=it.length,xt=_t,wt;_t--;)H=it[_t],wt=1-H,ct=wt*wt*wt*T+3*wt*wt*H*P+3*wt*H*H*B+H*H*H*x,X[0][_t]=ct,mt=wt*wt*wt*A+3*wt*wt*H*k+3*wt*H*H*O+H*H*H*M,X[1][_t]=mt;X[0][xt]=T,X[1][xt]=A,X[0][xt+1]=x,X[1][xt+1]=M;var Bt=[{x:j.apply(null,X[0]),y:j.apply(null,X[1])},{x:G.apply(null,X[0]),y:G.apply(null,X[1])}];return t.cachesBoundsOfCurve&&(t.boundsOfCurveCache[R]=Bt),Bt}function a(T,A,P){for(var k=P[1],B=P[2],O=P[3],x=P[4],M=P[5],R=P[6],Y=P[7],j=r(R-T,Y-A,k,B,x,M,O),G=0,F=j.length;G<F;G++)j[G][1]+=T,j[G][2]+=A,j[G][3]+=T,j[G][4]+=A,j[G][5]+=T,j[G][6]+=A;return j}function h(T){var A=0,P=0,k=T.length,B=0,O=0,x,M,R,Y=[],j,G,F;for(M=0;M<k;++M){switch(R=!1,x=T[M].slice(0),x[0]){case"l":x[0]="L",x[1]+=A,x[2]+=P;case"L":A=x[1],P=x[2];break;case"h":x[1]+=A;case"H":x[0]="L",x[2]=P,A=x[1];break;case"v":x[1]+=P;case"V":x[0]="L",P=x[1],x[1]=A,x[2]=P;break;case"m":x[0]="M",x[1]+=A,x[2]+=P;case"M":A=x[1],P=x[2],B=x[1],O=x[2];break;case"c":x[0]="C",x[1]+=A,x[2]+=P,x[3]+=A,x[4]+=P,x[5]+=A,x[6]+=P;case"C":G=x[3],F=x[4],A=x[5],P=x[6];break;case"s":x[0]="S",x[1]+=A,x[2]+=P,x[3]+=A,x[4]+=P;case"S":j==="C"?(G=2*A-G,F=2*P-F):(G=A,F=P),A=x[3],P=x[4],x[0]="C",x[5]=x[3],x[6]=x[4],x[3]=x[1],x[4]=x[2],x[1]=G,x[2]=F,G=x[3],F=x[4];break;case"q":x[0]="Q",x[1]+=A,x[2]+=P,x[3]+=A,x[4]+=P;case"Q":G=x[1],F=x[2],A=x[3],P=x[4];break;case"t":x[0]="T",x[1]+=A,x[2]+=P;case"T":j==="Q"?(G=2*A-G,F=2*P-F):(G=A,F=P),x[0]="Q",A=x[1],P=x[2],x[1]=G,x[2]=F,x[3]=A,x[4]=P;break;case"a":x[0]="A",x[6]+=A,x[7]+=P;case"A":R=!0,Y=Y.concat(a(A,P,x)),A=x[6],P=x[7];break;case"z":case"Z":A=B,P=O;break}R||Y.push(x),j=x[0]}return Y}function s(T,A,P,k){return Math.sqrt((P-T)*(P-T)+(k-A)*(k-A))}function u(T){return T*T*T}function d(T){return 3*T*T*(1-T)}function m(T){return 3*T*(1-T)*(1-T)}function p(T){return(1-T)*(1-T)*(1-T)}function y(T,A,P,k,B,O,x,M){return function(R){var Y=u(R),j=d(R),G=m(R),F=p(R);return{x:x*Y+B*j+P*G+T*F,y:M*Y+O*j+k*G+A*F}}}function w(T,A,P,k,B,O,x,M){return function(R){var Y=1-R,j=3*Y*Y*(P-T)+6*Y*R*(B-P)+3*R*R*(x-B),G=3*Y*Y*(k-A)+6*Y*R*(O-k)+3*R*R*(M-O);return Math.atan2(G,j)}}function S(T){return T*T}function E(T){return 2*T*(1-T)}function D(T){return(1-T)*(1-T)}function W(T,A,P,k,B,O){return function(x){var M=S(x),R=E(x),Y=D(x);return{x:B*M+P*R+T*Y,y:O*M+k*R+A*Y}}}function K(T,A,P,k,B,O){return function(x){var M=1-x,R=2*M*(P-T)+2*x*(B-P),Y=2*M*(k-A)+2*x*(O-k);return Math.atan2(Y,R)}}function tt(T,A,P){var k={x:A,y:P},B,O=0,x;for(x=1;x<=100;x+=1)B=T(x/100),O+=s(k.x,k.y,B.x,B.y),k=B;return O}function N(T,A){for(var P=0,k=0,B=T.iterator,O={x:T.x,y:T.y},x,M,R=.01,Y=T.angleFinder,j;k<A&&R>1e-4;)x=B(P),j=P,M=s(O.x,O.y,x.x,x.y),M+k>A?(P-=R,R/=2):(O=x,P+=R,k+=M);return x.angle=Y(j),x}function J(T){for(var A=0,P=T.length,k,B=0,O=0,x=0,M=0,R=[],Y,j,G,F=0;F<P;F++){switch(k=T[F],j={x:B,y:O,command:k[0]},k[0]){case"M":j.length=0,x=B=k[1],M=O=k[2];break;case"L":j.length=s(B,O,k[1],k[2]),B=k[1],O=k[2];break;case"C":Y=y(B,O,k[1],k[2],k[3],k[4],k[5],k[6]),G=w(B,O,k[1],k[2],k[3],k[4],k[5],k[6]),j.iterator=Y,j.angleFinder=G,j.length=tt(Y,B,O),B=k[5],O=k[6];break;case"Q":Y=W(B,O,k[1],k[2],k[3],k[4]),G=K(B,O,k[1],k[2],k[3],k[4]),j.iterator=Y,j.angleFinder=G,j.length=tt(Y,B,O),B=k[3],O=k[4];break;case"Z":case"z":j.destX=x,j.destY=M,j.length=s(B,O,x,M),B=x,O=M;break}A+=j.length,R.push(j)}return R.push({length:A,x:B,y:O}),R}function $(T,A,P){P||(P=J(T));for(var k=0;A-P[k].length>0&&k<P.length-2;)A-=P[k].length,k++;var B=P[k],O=A/B.length,x=B.command,M=T[k],R;switch(x){case"M":return{x:B.x,y:B.y,angle:0};case"Z":case"z":return R=new t.Point(B.x,B.y).lerp(new t.Point(B.destX,B.destY),O),R.angle=Math.atan2(B.destY-B.y,B.destX-B.x),R;case"L":return R=new t.Point(B.x,B.y).lerp(new t.Point(M[1],M[2]),O),R.angle=Math.atan2(M[2]-B.y,M[1]-B.x),R;case"C":return N(B,A);case"Q":return N(B,A)}}function Z(T){var A=[],P=[],k,B,O=t.rePathCommand,x="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",M="("+x+")"+t.commaWsp,R="([01])"+t.commaWsp+"?",Y=M+"?"+M+"?"+M+R+R+M+"?("+x+")",j=new RegExp(Y,"g"),G,F,it;if(!T||!T.match)return A;it=T.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var X=0,L,U=it.length;X<U;X++){k=it[X],F=k.slice(1).trim(),P.length=0;var V=k.charAt(0);if(L=[V],V.toLowerCase()==="a")for(var H;H=j.exec(F);)for(var q=1;q<H.length;q++)P.push(H[q]);else for(;G=O.exec(F);)P.push(G[0]);for(var q=0,nt=P.length;q<nt;q++)B=parseFloat(P[q]),isNaN(B)||L.push(B);var dt=i[V.toLowerCase()],lt=l[V]||V;if(L.length-1>dt)for(var z=1,ct=L.length;z<ct;z+=dt)A.push([V].concat(L.slice(z,z+dt))),V=lt;else A.push(L)}return A}function rt(T,A){var P=[],k,B=new t.Point(T[0].x,T[0].y),O=new t.Point(T[1].x,T[1].y),x=T.length,M=1,R=0,Y=x>2;for(A=A||0,Y&&(M=T[2].x<O.x?-1:T[2].x===O.x?0:1,R=T[2].y<O.y?-1:T[2].y===O.y?0:1),P.push(["M",B.x-M*A,B.y-R*A]),k=1;k<x;k++){if(!B.eq(O)){var j=B.midPointFrom(O);P.push(["Q",B.x,B.y,j.x,j.y])}B=T[k],k+1<T.length&&(O=T[k+1])}return Y&&(M=B.x>T[k-2].x?1:B.x===T[k-2].x?0:-1,R=B.y>T[k-2].y?1:B.y===T[k-2].y?0:-1),P.push(["L",B.x+M*A,B.y+R*A]),P}function st(T,A,P){return P&&(A=t.util.multiplyTransformMatrices(A,[1,0,0,1,-P.x,-P.y])),T.map(function(k){for(var B=k.slice(0),O={},x=1;x<k.length-1;x+=2)O.x=k[x],O.y=k[x+1],O=t.util.transformPoint(O,A),B[x]=O.x,B[x+1]=O.y;return B})}t.util.joinPath=function(T){return T.map(function(A){return A.join(" ")}).join(" ")},t.util.parsePath=Z,t.util.makePathSimpler=h,t.util.getSmoothPathFromPoints=rt,t.util.getPathSegmentsInfo=J,t.util.getBoundsOfCurve=e,t.util.getPointOnPath=$,t.util.transformPath=st}(),function(){var c=Array.prototype.slice;function i(e,a){for(var h=c.call(arguments,2),s=[],u=0,d=e.length;u<d;u++)s[u]=h.length?e[u][a].apply(e[u],h):e[u][a].call(e[u]);return s}function l(e,a){return n(e,a,function(h,s){return h>=s})}function o(e,a){return n(e,a,function(h,s){return h<s})}function r(e,a){for(var h=e.length;h--;)e[h]=a;return e}function n(e,a,h){if(!(!e||e.length===0)){var s=e.length-1,u=a?e[s][a]:e[s];if(a)for(;s--;)h(e[s][a],u)&&(u=e[s][a]);else for(;s--;)h(e[s],u)&&(u=e[s]);return u}}t.util.array={fill:r,invoke:i,min:o,max:l}}(),function(){function c(l,o,r){if(r)if(!t.isLikelyNode&&o instanceof Element)l=o;else if(o instanceof Array){l=[];for(var n=0,e=o.length;n<e;n++)l[n]=c({},o[n],r)}else if(o&&typeof o=="object")for(var a in o)a==="canvas"||a==="group"?l[a]=null:o.hasOwnProperty(a)&&(l[a]=c({},o[a],r));else l=o;else for(var a in o)l[a]=o[a];return l}function i(l,o){return c({},l,o)}t.util.object={extend:c,clone:i},t.util.object.extend(t.util,t.Observable)}(),function(){function c(n){return n.replace(/-+(.)?/g,function(e,a){return a?a.toUpperCase():""})}function i(n,e){return n.charAt(0).toUpperCase()+(e?n.slice(1):n.slice(1).toLowerCase())}function l(n){return n.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function o(n){var e=0,a,h=[];for(e=0,a;e<n.length;e++)(a=r(n,e))!==!1&&h.push(a);return h}function r(n,e){var a=n.charCodeAt(e);if(isNaN(a))return"";if(a<55296||a>57343)return n.charAt(e);if(55296<=a&&a<=56319){if(n.length<=e+1)throw"High surrogate without following low surrogate";var h=n.charCodeAt(e+1);if(56320>h||h>57343)throw"High surrogate without following low surrogate";return n.charAt(e)+n.charAt(e+1)}if(e===0)throw"Low surrogate without preceding high surrogate";var s=n.charCodeAt(e-1);if(55296>s||s>56319)throw"Low surrogate without preceding high surrogate";return!1}t.util.string={camelize:c,capitalize:i,escapeXml:l,graphemeSplit:o}}(),function(){var c=Array.prototype.slice,i=function(){},l=function(){for(var a in{toString:1})if(a==="toString")return!1;return!0}(),o=function(a,h,s){for(var u in h)u in a.prototype&&typeof a.prototype[u]=="function"&&(h[u]+"").indexOf("callSuper")>-1?a.prototype[u]=function(d){return function(){var m=this.constructor.superclass;this.constructor.superclass=s;var p=h[d].apply(this,arguments);if(this.constructor.superclass=m,d!=="initialize")return p}}(u):a.prototype[u]=h[u],l&&(h.toString!==Object.prototype.toString&&(a.prototype.toString=h.toString),h.valueOf!==Object.prototype.valueOf&&(a.prototype.valueOf=h.valueOf))};function r(){}function n(a){for(var h=null,s=this;s.constructor.superclass;){var u=s.constructor.superclass.prototype[a];if(s[a]!==u){h=u;break}s=s.constructor.superclass.prototype}return h?arguments.length>1?h.apply(this,c.call(arguments,1)):h.call(this):console.log("tried to callSuper "+a+", method not found in prototype chain",this)}function e(){var a=null,h=c.call(arguments,0);typeof h[0]=="function"&&(a=h.shift());function s(){this.initialize.apply(this,arguments)}s.superclass=a,s.subclasses=[],a&&(r.prototype=a.prototype,s.prototype=new r,a.subclasses.push(s));for(var u=0,d=h.length;u<d;u++)o(s,h[u],a);return s.prototype.initialize||(s.prototype.initialize=i),s.prototype.constructor=s,s.prototype.callSuper=n,s}t.util.createClass=e}(),function(){var c=!!t.document.createElement("div").attachEvent,i=["touchstart","touchmove","touchend"];t.util.addListener=function(o,r,n,e){o&&o.addEventListener(r,n,c?!1:e)},t.util.removeListener=function(o,r,n,e){o&&o.removeEventListener(r,n,c?!1:e)};function l(o){var r=o.changedTouches;return r&&r[0]?r[0]:o}t.util.getPointer=function(o){var r=o.target,n=t.util.getScrollLeftTop(r),e=l(o);return{x:e.clientX+n.left,y:e.clientY+n.top}},t.util.isTouchEvent=function(o){return i.indexOf(o.type)>-1||o.pointerType==="touch"}}(),function(){function c(e,a){var h=e.style;if(!h)return e;if(typeof a=="string")return e.style.cssText+=";"+a,a.indexOf("opacity")>-1?n(e,a.match(/opacity:\s*(\d?\.?\d*)/)[1]):e;for(var s in a)if(s==="opacity")n(e,a[s]);else{var u=s==="float"||s==="cssFloat"?typeof h.styleFloat>"u"?"cssFloat":"styleFloat":s;h.setProperty(u,a[s])}return e}var i=t.document.createElement("div"),l=typeof i.style.opacity=="string",o=typeof i.style.filter=="string",r=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,n=function(e){return e};l?n=function(e,a){return e.style.opacity=a,e}:o&&(n=function(e,a){var h=e.style;return e.currentStyle&&!e.currentStyle.hasLayout&&(h.zoom=1),r.test(h.filter)?(a=a>=.9999?"":"alpha(opacity="+a*100+")",h.filter=h.filter.replace(r,a)):h.filter+=" alpha(opacity="+a*100+")",e}),t.util.setStyle=c}(),function(){var c=Array.prototype.slice;function i(p){return typeof p=="string"?t.document.getElementById(p):p}var l,o=function(p){return c.call(p,0)};try{l=o(t.document.childNodes)instanceof Array}catch{}l||(o=function(p){for(var y=new Array(p.length),w=p.length;w--;)y[w]=p[w];return y});function r(p,y){var w=t.document.createElement(p);for(var S in y)S==="class"?w.className=y[S]:S==="for"?w.htmlFor=y[S]:w.setAttribute(S,y[S]);return w}function n(p,y){p&&(" "+p.className+" ").indexOf(" "+y+" ")===-1&&(p.className+=(p.className?" ":"")+y)}function e(p,y,w){return typeof y=="string"&&(y=r(y,w)),p.parentNode&&p.parentNode.replaceChild(y,p),y.appendChild(p),y}function a(p){for(var y=0,w=0,S=t.document.documentElement,E=t.document.body||{scrollLeft:0,scrollTop:0};p&&(p.parentNode||p.host)&&(p=p.parentNode||p.host,p===t.document?(y=E.scrollLeft||S.scrollLeft||0,w=E.scrollTop||S.scrollTop||0):(y+=p.scrollLeft||0,w+=p.scrollTop||0),!(p.nodeType===1&&p.style.position==="fixed")););return{left:y,top:w}}function h(p){var y,w=p&&p.ownerDocument,S={left:0,top:0},E={left:0,top:0},D,W={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!w)return E;for(var K in W)E[W[K]]+=parseInt(s(p,K),10)||0;return y=w.documentElement,typeof p.getBoundingClientRect<"u"&&(S=p.getBoundingClientRect()),D=a(p),{left:S.left+D.left-(y.clientLeft||0)+E.left,top:S.top+D.top-(y.clientTop||0)+E.top}}var s;t.document.defaultView&&t.document.defaultView.getComputedStyle?s=function(p,y){var w=t.document.defaultView.getComputedStyle(p,null);return w?w[y]:void 0}:s=function(p,y){var w=p.style[y];return!w&&p.currentStyle&&(w=p.currentStyle[y]),w},function(){var p=t.document.documentElement.style,y="userSelect"in p?"userSelect":"MozUserSelect"in p?"MozUserSelect":"WebkitUserSelect"in p?"WebkitUserSelect":"KhtmlUserSelect"in p?"KhtmlUserSelect":"";function w(E){return typeof E.onselectstart<"u"&&(E.onselectstart=t.util.falseFunction),y?E.style[y]="none":typeof E.unselectable=="string"&&(E.unselectable="on"),E}function S(E){return typeof E.onselectstart<"u"&&(E.onselectstart=null),y?E.style[y]="":typeof E.unselectable=="string"&&(E.unselectable=""),E}t.util.makeElementUnselectable=w,t.util.makeElementSelectable=S}();function u(p){var y=t.jsdomImplForWrapper(p);return y._canvas||y._image}function d(p){if(t.isLikelyNode){var y=t.jsdomImplForWrapper(p);y&&(y._image=null,y._canvas=null,y._currentSrc=null,y._attributes=null,y._classList=null)}}function m(p,y){p.imageSmoothingEnabled=p.imageSmoothingEnabled||p.webkitImageSmoothingEnabled||p.mozImageSmoothingEnabled||p.msImageSmoothingEnabled||p.oImageSmoothingEnabled,p.imageSmoothingEnabled=y}t.util.setImageSmoothing=m,t.util.getById=i,t.util.toArray=o,t.util.addClass=n,t.util.makeElement=r,t.util.wrapElement=e,t.util.getScrollLeftTop=a,t.util.getElementOffset=h,t.util.getNodeCanvas=u,t.util.cleanUpJsdomNode=d}(),function(){function c(o,r){return o+(/\?/.test(o)?"&":"?")+r}function i(){}function l(o,r){r||(r={});var n=r.method?r.method.toUpperCase():"GET",e=r.onComplete||function(){},a=new t.window.XMLHttpRequest,h=r.body||r.parameters;return a.onreadystatechange=function(){a.readyState===4&&(e(a),a.onreadystatechange=i)},n==="GET"&&(h=null,typeof r.parameters=="string"&&(o=c(o,r.parameters))),a.open(n,o,!0),(n==="POST"||n==="PUT")&&a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(h),a}t.util.request=l}(),t.log=console.log,t.warn=console.warn,function(){var c=t.util.object.extend,i=t.util.object.clone,l=[];t.util.object.extend(l,{cancelAll:function(){var u=this.splice(0);return u.forEach(function(d){d.cancel()}),u},cancelByCanvas:function(u){if(!u)return[];var d=this.filter(function(m){return typeof m.target=="object"&&m.target.canvas===u});return d.forEach(function(m){m.cancel()}),d},cancelByTarget:function(u){var d=this.findAnimationsByTarget(u);return d.forEach(function(m){m.cancel()}),d},findAnimationIndex:function(u){return this.indexOf(this.findAnimation(u))},findAnimation:function(u){return this.find(function(d){return d.cancel===u})},findAnimationsByTarget:function(u){return u?this.filter(function(d){return d.target===u}):[]}});function o(){return!1}function r(u,d,m,p){return-m*Math.cos(u/p*(Math.PI/2))+m+d}function n(u){u||(u={});var d=!1,m,p=function(){var y=t.runningAnimations.indexOf(m);return y>-1&&t.runningAnimations.splice(y,1)[0]};return m=c(i(u),{cancel:function(){return d=!0,p()},currentValue:"startValue"in u?u.startValue:0,completionRate:0,durationRate:0}),t.runningAnimations.push(m),h(function(y){var w=y||+new Date,S=u.duration||500,E=w+S,D,W=u.onChange||o,K=u.abort||o,tt=u.onComplete||o,N=u.easing||r,J="startValue"in u?u.startValue.length>0:!1,$="startValue"in u?u.startValue:0,Z="endValue"in u?u.endValue:100,rt=u.byValue||(J?$.map(function(st,T){return Z[T]-$[T]}):Z-$);u.onStart&&u.onStart(),function st(T){D=T||+new Date;var A=D>E?S:D-w,P=A/S,k=J?$.map(function(O,x){return N(A,$[x],rt[x],S)}):N(A,$,rt,S),B=Math.abs(J?(k[0]-$[0])/rt[0]:(k-$)/rt);if(m.currentValue=J?k.slice():k,m.completionRate=B,m.durationRate=P,!d){if(K(k,B,P)){p();return}if(D>E){m.currentValue=J?Z.slice():Z,m.completionRate=1,m.durationRate=1,W(J?Z.slice():Z,1,1),tt(Z,1,1),p();return}else W(k,B,P),h(st)}}(w)}),m.cancel}var e=t.window.requestAnimationFrame||t.window.webkitRequestAnimationFrame||t.window.mozRequestAnimationFrame||t.window.oRequestAnimationFrame||t.window.msRequestAnimationFrame||function(u){return t.window.setTimeout(u,1e3/60)},a=t.window.cancelAnimationFrame||t.window.clearTimeout;function h(){return e.apply(t.window,arguments)}function s(){return a.apply(t.window,arguments)}t.util.animate=n,t.util.requestAnimFrame=h,t.util.cancelAnimFrame=s,t.runningAnimations=l}(),function(){function c(l,o,r){var n="rgba("+parseInt(l[0]+r*(o[0]-l[0]),10)+","+parseInt(l[1]+r*(o[1]-l[1]),10)+","+parseInt(l[2]+r*(o[2]-l[2]),10);return n+=","+(l&&o?parseFloat(l[3]+r*(o[3]-l[3])):1),n+=")",n}function i(l,o,r,n){var e=new t.Color(l).getSource(),a=new t.Color(o).getSource(),h=n.onComplete,s=n.onChange;return n=n||{},t.util.animate(t.util.object.extend(n,{duration:r||500,startValue:e,endValue:a,byValue:a,easing:function(u,d,m,p){var y=n.colorEasing?n.colorEasing(u,p):1-Math.cos(u/p*(Math.PI/2));return c(d,m,y)},onComplete:function(u,d,m){if(h)return h(c(a,a,0),d,m)},onChange:function(u,d,m){if(s){if(Array.isArray(u))return s(c(u,u,0),d,m);s(u,d,m)}}}))}t.util.animateColor=i}(),function(){function c(T,A,P,k){return T<Math.abs(A)?(T=A,k=P/4):A===0&&T===0?k=P/(2*Math.PI)*Math.asin(1):k=P/(2*Math.PI)*Math.asin(A/T),{a:T,c:A,p:P,s:k}}function i(T,A,P){return T.a*Math.pow(2,10*(A-=1))*Math.sin((A*P-T.s)*(2*Math.PI)/T.p)}function l(T,A,P,k){return P*((T=T/k-1)*T*T+1)+A}function o(T,A,P,k){return T/=k/2,T<1?P/2*T*T*T+A:P/2*((T-=2)*T*T+2)+A}function r(T,A,P,k){return P*(T/=k)*T*T*T+A}function n(T,A,P,k){return-P*((T=T/k-1)*T*T*T-1)+A}function e(T,A,P,k){return T/=k/2,T<1?P/2*T*T*T*T+A:-P/2*((T-=2)*T*T*T-2)+A}function a(T,A,P,k){return P*(T/=k)*T*T*T*T+A}function h(T,A,P,k){return P*((T=T/k-1)*T*T*T*T+1)+A}function s(T,A,P,k){return T/=k/2,T<1?P/2*T*T*T*T*T+A:P/2*((T-=2)*T*T*T*T+2)+A}function u(T,A,P,k){return-P*Math.cos(T/k*(Math.PI/2))+P+A}function d(T,A,P,k){return P*Math.sin(T/k*(Math.PI/2))+A}function m(T,A,P,k){return-P/2*(Math.cos(Math.PI*T/k)-1)+A}function p(T,A,P,k){return T===0?A:P*Math.pow(2,10*(T/k-1))+A}function y(T,A,P,k){return T===k?A+P:P*(-Math.pow(2,-10*T/k)+1)+A}function w(T,A,P,k){return T===0?A:T===k?A+P:(T/=k/2,T<1?P/2*Math.pow(2,10*(T-1))+A:P/2*(-Math.pow(2,-10*--T)+2)+A)}function S(T,A,P,k){return-P*(Math.sqrt(1-(T/=k)*T)-1)+A}function E(T,A,P,k){return P*Math.sqrt(1-(T=T/k-1)*T)+A}function D(T,A,P,k){return T/=k/2,T<1?-P/2*(Math.sqrt(1-T*T)-1)+A:P/2*(Math.sqrt(1-(T-=2)*T)+1)+A}function W(T,A,P,k){var B=1.70158,O=0,x=P;if(T===0)return A;if(T/=k,T===1)return A+P;O||(O=k*.3);var M=c(x,P,O,B);return-i(M,T,k)+A}function K(T,A,P,k){var B=1.70158,O=0,x=P;if(T===0)return A;if(T/=k,T===1)return A+P;O||(O=k*.3);var M=c(x,P,O,B);return M.a*Math.pow(2,-10*T)*Math.sin((T*k-M.s)*(2*Math.PI)/M.p)+M.c+A}function tt(T,A,P,k){var B=1.70158,O=0,x=P;if(T===0)return A;if(T/=k/2,T===2)return A+P;O||(O=k*(.3*1.5));var M=c(x,P,O,B);return T<1?-.5*i(M,T,k)+A:M.a*Math.pow(2,-10*(T-=1))*Math.sin((T*k-M.s)*(2*Math.PI)/M.p)*.5+M.c+A}function N(T,A,P,k,B){return B===void 0&&(B=1.70158),P*(T/=k)*T*((B+1)*T-B)+A}function J(T,A,P,k,B){return B===void 0&&(B=1.70158),P*((T=T/k-1)*T*((B+1)*T+B)+1)+A}function $(T,A,P,k,B){return B===void 0&&(B=1.70158),T/=k/2,T<1?P/2*(T*T*(((B*=1.525)+1)*T-B))+A:P/2*((T-=2)*T*(((B*=1.525)+1)*T+B)+2)+A}function Z(T,A,P,k){return P-rt(k-T,0,P,k)+A}function rt(T,A,P,k){return(T/=k)<1/2.75?P*(7.5625*T*T)+A:T<2/2.75?P*(7.5625*(T-=1.5/2.75)*T+.75)+A:T<2.5/2.75?P*(7.5625*(T-=2.25/2.75)*T+.9375)+A:P*(7.5625*(T-=2.625/2.75)*T+.984375)+A}function st(T,A,P,k){return T<k/2?Z(T*2,0,P,k)*.5+A:rt(T*2-k,0,P,k)*.5+P*.5+A}t.util.ease={easeInQuad:function(T,A,P,k){return P*(T/=k)*T+A},easeOutQuad:function(T,A,P,k){return-P*(T/=k)*(T-2)+A},easeInOutQuad:function(T,A,P,k){return T/=k/2,T<1?P/2*T*T+A:-P/2*(--T*(T-2)-1)+A},easeInCubic:function(T,A,P,k){return P*(T/=k)*T*T+A},easeOutCubic:l,easeInOutCubic:o,easeInQuart:r,easeOutQuart:n,easeInOutQuart:e,easeInQuint:a,easeOutQuint:h,easeInOutQuint:s,easeInSine:u,easeOutSine:d,easeInOutSine:m,easeInExpo:p,easeOutExpo:y,easeInOutExpo:w,easeInCirc:S,easeOutCirc:E,easeInOutCirc:D,easeInElastic:W,easeOutElastic:K,easeInOutElastic:tt,easeInBack:N,easeOutBack:J,easeInOutBack:$,easeInBounce:Z,easeOutBounce:rt,easeInOutBounce:st}}(),function(c){var i=c.fabric||(c.fabric={}),l=i.util.object.extend,o=i.util.object.clone,r=i.util.toFixed,n=i.util.parseUnit,e=i.util.multiplyTransformMatrices,a=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],h=["symbol","image","marker","pattern","view","svg"],s=["pattern","defs","symbol","metadata","clipPath","mask","desc"],u=["symbol","g","a","svg","clipPath","defs"],d={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},m={stroke:"strokeOpacity",fill:"fillOpacity"},p="font-size",y="clip-path";i.svgValidTagNamesRegEx=E(a),i.svgViewBoxElementsRegEx=E(h),i.svgInvalidAncestorsRegEx=E(s),i.svgValidParentsRegEx=E(u),i.cssRules={},i.gradientDefs={},i.clipPaths={};function w(O){return O in d?d[O]:O}function S(O,x,M,R){var Y=Array.isArray(x),j;if((O==="fill"||O==="stroke")&&x==="none")x="";else{if(O==="strokeUniform")return x==="non-scaling-stroke";if(O==="strokeDashArray")x==="none"?x=null:x=x.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(O==="transformMatrix")M&&M.transformMatrix?x=e(M.transformMatrix,i.parseTransformAttribute(x)):x=i.parseTransformAttribute(x);else if(O==="visible")x=x!=="none"&&x!=="hidden",M&&M.visible===!1&&(x=!1);else if(O==="opacity")x=parseFloat(x),M&&typeof M.opacity<"u"&&(x*=M.opacity);else if(O==="textAnchor")x=x==="start"?"left":x==="end"?"right":"center";else if(O==="charSpacing")j=n(x,R)/R*1e3;else if(O==="paintFirst"){var G=x.indexOf("fill"),F=x.indexOf("stroke"),x="fill";(G>-1&&F>-1&&F<G||G===-1&&F>-1)&&(x="stroke")}else{if(O==="href"||O==="xlink:href"||O==="font")return x;if(O==="imageSmoothing")return x==="optimizeQuality";j=Y?x.map(n):n(x,R)}}return!Y&&isNaN(j)?x:j}function E(O){return new RegExp("^("+O.join("|")+")\\b","i")}function D(O){for(var x in m)if(!(typeof O[m[x]]>"u"||O[x]==="")){if(typeof O[x]>"u"){if(!i.Object.prototype[x])continue;O[x]=i.Object.prototype[x]}if(O[x].indexOf("url(")!==0){var M=new i.Color(O[x]);O[x]=M.setAlpha(r(M.getAlpha()*O[m[x]],2)).toRgba()}}return O}function W(O,x){var M,R=[],Y,j,G;for(j=0,G=x.length;j<G;j++)M=x[j],Y=O.getElementsByTagName(M),R=R.concat(Array.prototype.slice.call(Y));return R}i.parseTransformAttribute=function(){function O(z,ct){var mt=i.util.cos(ct[0]),_t=i.util.sin(ct[0]),xt=0,wt=0;ct.length===3&&(xt=ct[1],wt=ct[2]),z[0]=mt,z[1]=_t,z[2]=-_t,z[3]=mt,z[4]=xt-(mt*xt-_t*wt),z[5]=wt-(_t*xt+mt*wt)}function x(z,ct){var mt=ct[0],_t=ct.length===2?ct[1]:ct[0];z[0]=mt,z[3]=_t}function M(z,ct,mt){z[mt]=Math.tan(i.util.degreesToRadians(ct[0]))}function R(z,ct){z[4]=ct[0],ct.length===2&&(z[5]=ct[1])}var Y=i.iMatrix,j=i.reNum,G=i.commaWsp,F="(?:(skewX)\\s*\\(\\s*("+j+")\\s*\\))",it="(?:(skewY)\\s*\\(\\s*("+j+")\\s*\\))",X="(?:(rotate)\\s*\\(\\s*("+j+")(?:"+G+"("+j+")"+G+"("+j+"))?\\s*\\))",L="(?:(scale)\\s*\\(\\s*("+j+")(?:"+G+"("+j+"))?\\s*\\))",U="(?:(translate)\\s*\\(\\s*("+j+")(?:"+G+"("+j+"))?\\s*\\))",V="(?:(matrix)\\s*\\(\\s*("+j+")"+G+"("+j+")"+G+"("+j+")"+G+"("+j+")"+G+"("+j+")"+G+"("+j+")\\s*\\))",H="(?:"+V+"|"+U+"|"+L+"|"+X+"|"+F+"|"+it+")",q="(?:"+H+"(?:"+G+"*"+H+")*)",nt="^\\s*(?:"+q+"?)\\s*$",dt=new RegExp(nt),lt=new RegExp(H,"g");return function(z){var ct=Y.concat(),mt=[];if(!z||z&&!dt.test(z))return ct;z.replace(lt,function(xt){var wt=new RegExp(H).exec(xt).filter(function(Zt){return!!Zt}),Bt=wt[1],At=wt.slice(2).map(parseFloat);switch(Bt){case"translate":R(ct,At);break;case"rotate":At[0]=i.util.degreesToRadians(At[0]),O(ct,At);break;case"scale":x(ct,At);break;case"skewX":M(ct,At,2);break;case"skewY":M(ct,At,1);break;case"matrix":ct=At;break}mt.push(ct.concat()),ct=Y.concat()});for(var _t=mt[0];mt.length>1;)mt.shift(),_t=i.util.multiplyTransformMatrices(_t,mt[0]);return _t}}();function K(O,x){var M,R;O.replace(/;\s*$/,"").split(";").forEach(function(Y){var j=Y.split(":");M=j[0].trim().toLowerCase(),R=j[1].trim(),x[M]=R})}function tt(O,x){var M,R;for(var Y in O)typeof O[Y]>"u"||(M=Y.toLowerCase(),R=O[Y],x[M]=R)}function N(O,x){var M={};for(var R in i.cssRules[x])if(J(O,R.split(" ")))for(var Y in i.cssRules[x][R])M[Y]=i.cssRules[x][R][Y];return M}function J(O,x){var M,R=!0;return M=Z(O,x.pop()),M&&x.length&&(R=$(O,x)),M&&R&&x.length===0}function $(O,x){for(var M,R=!0;O.parentNode&&O.parentNode.nodeType===1&&x.length;)R&&(M=x.pop()),O=O.parentNode,R=Z(O,M);return x.length===0}function Z(O,x){var M=O.nodeName,R=O.getAttribute("class"),Y=O.getAttribute("id"),j,G;if(j=new RegExp("^"+M,"i"),x=x.replace(j,""),Y&&x.length&&(j=new RegExp("#"+Y+"(?![a-zA-Z\\-]+)","i"),x=x.replace(j,"")),R&&x.length)for(R=R.split(" "),G=R.length;G--;)j=new RegExp("\\."+R[G]+"(?![a-zA-Z\\-]+)","i"),x=x.replace(j,"");return x.length===0}function rt(O,x){var M;if(O.getElementById&&(M=O.getElementById(x)),M)return M;var R,Y,j,G=O.getElementsByTagName("*");for(Y=0,j=G.length;Y<j;Y++)if(R=G[Y],x===R.getAttribute("id"))return R}function st(O){for(var x=W(O,["use","svg:use"]),M=0;x.length&&M<x.length;){var R=x[M],Y=R.getAttribute("xlink:href")||R.getAttribute("href");if(Y===null)return;var j=Y.slice(1),G=R.getAttribute("x")||0,F=R.getAttribute("y")||0,it=rt(O,j).cloneNode(!0),X=(it.getAttribute("transform")||"")+" translate("+G+", "+F+")",L,U=x.length,V,H,q,nt,dt=i.svgNS;if(A(it),/^svg$/i.test(it.nodeName)){var lt=it.ownerDocument.createElementNS(dt,"g");for(H=0,q=it.attributes,nt=q.length;H<nt;H++)V=q.item(H),lt.setAttributeNS(dt,V.nodeName,V.nodeValue);for(;it.firstChild;)lt.appendChild(it.firstChild);it=lt}for(H=0,q=R.attributes,nt=q.length;H<nt;H++)V=q.item(H),!(V.nodeName==="x"||V.nodeName==="y"||V.nodeName==="xlink:href"||V.nodeName==="href")&&(V.nodeName==="transform"?X=V.nodeValue+" "+X:it.setAttribute(V.nodeName,V.nodeValue));it.setAttribute("transform",X),it.setAttribute("instantiated_by_use","1"),it.removeAttribute("id"),L=R.parentNode,L.replaceChild(it,R),x.length===U&&M++}}var T=new RegExp("^\\s*("+i.reNum+"+)\\s*,?\\s*("+i.reNum+"+)\\s*,?\\s*("+i.reNum+"+)\\s*,?\\s*("+i.reNum+"+)\\s*$");function A(O){if(!i.svgViewBoxElementsRegEx.test(O.nodeName))return{};var x=O.getAttribute("viewBox"),M=1,R=1,Y=0,j=0,G,F,it,X,L=O.getAttribute("width"),U=O.getAttribute("height"),V=O.getAttribute("x")||0,H=O.getAttribute("y")||0,q=O.getAttribute("preserveAspectRatio")||"",nt=!x||!(x=x.match(T)),dt=!L||!U||L==="100%"||U==="100%",lt=nt&&dt,z={},ct="",mt=0,_t=0;if(z.width=0,z.height=0,z.toBeParsed=lt,nt&&(V||H)&&O.parentNode&&O.parentNode.nodeName!=="#document"&&(ct=" translate("+n(V)+" "+n(H)+") ",it=(O.getAttribute("transform")||"")+ct,O.setAttribute("transform",it),O.removeAttribute("x"),O.removeAttribute("y")),lt)return z;if(nt)return z.width=n(L),z.height=n(U),z;if(Y=-parseFloat(x[1]),j=-parseFloat(x[2]),G=parseFloat(x[3]),F=parseFloat(x[4]),z.minX=Y,z.minY=j,z.viewBoxWidth=G,z.viewBoxHeight=F,dt?(z.width=G,z.height=F):(z.width=n(L),z.height=n(U),M=z.width/G,R=z.height/F),q=i.util.parsePreserveAspectRatioAttribute(q),q.alignX!=="none"&&(q.meetOrSlice==="meet"&&(R=M=M>R?R:M),q.meetOrSlice==="slice"&&(R=M=M>R?M:R),mt=z.width-G*M,_t=z.height-F*M,q.alignX==="Mid"&&(mt/=2),q.alignY==="Mid"&&(_t/=2),q.alignX==="Min"&&(mt=0),q.alignY==="Min"&&(_t=0)),M===1&&R===1&&Y===0&&j===0&&V===0&&H===0)return z;if((V||H)&&O.parentNode.nodeName!=="#document"&&(ct=" translate("+n(V)+" "+n(H)+") "),it=ct+" matrix("+M+" 0 0 "+R+" "+(Y*M+mt)+" "+(j*R+_t)+") ",O.nodeName==="svg"){for(X=O.ownerDocument.createElementNS(i.svgNS,"g");O.firstChild;)X.appendChild(O.firstChild);O.appendChild(X)}else X=O,X.removeAttribute("x"),X.removeAttribute("y"),it=X.getAttribute("transform")+it;return X.setAttribute("transform",it),z}function P(O,x){for(;O&&(O=O.parentNode);)if(O.nodeName&&x.test(O.nodeName.replace("svg:",""))&&!O.getAttribute("instantiated_by_use"))return!0;return!1}i.parseSVGDocument=function(O,x,M,R){if(O){st(O);var Y=i.Object.__uid++,j,G,F=A(O),it=i.util.toArray(O.getElementsByTagName("*"));if(F.crossOrigin=R&&R.crossOrigin,F.svgUid=Y,it.length===0&&i.isLikelyNode){it=O.selectNodes('//*[name(.)!="svg"]');var X=[];for(j=0,G=it.length;j<G;j++)X[j]=it[j];it=X}var L=it.filter(function(V){return A(V),i.svgValidTagNamesRegEx.test(V.nodeName.replace("svg:",""))&&!P(V,i.svgInvalidAncestorsRegEx)});if(!L||L&&!L.length){x&&x([],{});return}var U={};it.filter(function(V){return V.nodeName.replace("svg:","")==="clipPath"}).forEach(function(V){var H=V.getAttribute("id");U[H]=i.util.toArray(V.getElementsByTagName("*")).filter(function(q){return i.svgValidTagNamesRegEx.test(q.nodeName.replace("svg:",""))})}),i.gradientDefs[Y]=i.getGradientDefs(O),i.cssRules[Y]=i.getCSSRules(O),i.clipPaths[Y]=U,i.parseElements(L,function(V,H){x&&(x(V,F,H,it),delete i.gradientDefs[Y],delete i.cssRules[Y],delete i.clipPaths[Y])},o(F),M,R)}};function k(O,x){var M=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],R="xlink:href",Y=x.getAttribute(R).slice(1),j=rt(O,Y);if(j&&j.getAttribute(R)&&k(O,j),M.forEach(function(F){j&&!x.hasAttribute(F)&&j.hasAttribute(F)&&x.setAttribute(F,j.getAttribute(F))}),!x.children.length)for(var G=j.cloneNode(!0);G.firstChild;)x.appendChild(G.firstChild);x.removeAttribute(R)}var B=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+i.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+i.reNum+"))?\\s+(.*)");l(i,{parseFontDeclaration:function(O,x){var M=O.match(B);if(M){var R=M[1],Y=M[3],j=M[4],G=M[5],F=M[6];R&&(x.fontStyle=R),Y&&(x.fontWeight=isNaN(parseFloat(Y))?Y:parseFloat(Y)),j&&(x.fontSize=n(j)),F&&(x.fontFamily=F),G&&(x.lineHeight=G==="normal"?1:G)}},getGradientDefs:function(O){var x=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],M=W(O,x),R,Y=0,j={};for(Y=M.length;Y--;)R=M[Y],R.getAttribute("xlink:href")&&k(O,R),j[R.getAttribute("id")]=R;return j},parseAttributes:function(O,x,M){if(O){var R,Y={},j,G;typeof M>"u"&&(M=O.getAttribute("svgUid")),O.parentNode&&i.svgValidParentsRegEx.test(O.parentNode.nodeName)&&(Y=i.parseAttributes(O.parentNode,x,M));var F=x.reduce(function(q,nt){return R=O.getAttribute(nt),R&&(q[nt]=R),q},{}),it=l(N(O,M),i.parseStyleAttribute(O));F=l(F,it),it[y]&&O.setAttribute(y,it[y]),j=G=Y.fontSize||i.Text.DEFAULT_SVG_FONT_SIZE,F[p]&&(F[p]=j=n(F[p],G));var X,L,U={};for(var V in F)X=w(V),L=S(X,F[V],Y,j),U[X]=L;U&&U.font&&i.parseFontDeclaration(U.font,U);var H=l(Y,U);return i.svgValidParentsRegEx.test(O.nodeName)?H:D(H)}},parseElements:function(O,x,M,R,Y){new i.ElementsParser(O,x,M,R,Y).parse()},parseStyleAttribute:function(O){var x={},M=O.getAttribute("style");return M&&(typeof M=="string"?K(M,x):tt(M,x)),x},parsePointsAttribute:function(O){if(!O)return null;O=O.replace(/,/g," ").trim(),O=O.split(/\s+/);var x=[],M,R;for(M=0,R=O.length;M<R;M+=2)x.push({x:parseFloat(O[M]),y:parseFloat(O[M+1])});return x},getCSSRules:function(O){var x=O.getElementsByTagName("style"),M,R,Y={},j;for(M=0,R=x.length;M<R;M++){var G=x[M].textContent;G=G.replace(/\/\*[\s\S]*?\*\//g,""),G.trim()!==""&&(j=G.split("}"),j=j.filter(function(F){return F.trim()}),j.forEach(function(F){var it=F.split("{"),X={},L=it[1].trim(),U=L.split(";").filter(function(nt){return nt.trim()});for(M=0,R=U.length;M<R;M++){var V=U[M].split(":"),H=V[0].trim(),q=V[1].trim();X[H]=q}F=it[0].trim(),F.split(",").forEach(function(nt){nt=nt.replace(/^svg/i,"").trim(),nt!==""&&(Y[nt]?i.util.object.extend(Y[nt],X):Y[nt]=i.util.object.clone(X))})}))}return Y},loadSVGFromURL:function(O,x,M,R){O=O.replace(/^\n\s*/,"").trim(),new i.util.request(O,{method:"get",onComplete:Y});function Y(j){var G=j.responseXML;if(!G||!G.documentElement)return x&&x(null),!1;i.parseSVGDocument(G.documentElement,function(F,it,X,L){x&&x(F,it,X,L)},M,R)}},loadSVGFromString:function(O,x,M,R){var Y=new i.window.DOMParser,j=Y.parseFromString(O.trim(),"text/xml");i.parseSVGDocument(j.documentElement,function(G,F,it,X){x(G,F,it,X)},M,R)}})}(f),t.ElementsParser=function(c,i,l,o,r,n){this.elements=c,this.callback=i,this.options=l,this.reviver=o,this.svgUid=l&&l.svgUid||0,this.parsingOptions=r,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=n},function(c){c.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},c.createObjects=function(){var i=this;this.elements.forEach(function(l,o){l.setAttribute("svgUid",i.svgUid),i.createObject(l,o)})},c.findTag=function(i){return t[t.util.string.capitalize(i.tagName.replace("svg:",""))]},c.createObject=function(i,l){var o=this.findTag(i);if(o&&o.fromElement)try{o.fromElement(i,this.createCallback(l,i),this.options)}catch(r){t.log(r)}else this.checkIfDone()},c.createCallback=function(i,l){var o=this;return function(r){var n;o.resolveGradient(r,l,"fill"),o.resolveGradient(r,l,"stroke"),r instanceof t.Image&&r._originalElement&&(n=r.parsePreserveAspectRatioAttribute(l)),r._removeTransformMatrix(n),o.resolveClipPath(r,l),o.reviver&&o.reviver(l,r),o.instances[i]=r,o.checkIfDone()}},c.extractPropertyDefinition=function(i,l,o){var r=i[l],n=this.regexUrl;if(n.test(r)){n.lastIndex=0;var e=n.exec(r)[1];return n.lastIndex=0,t[o][this.svgUid][e]}},c.resolveGradient=function(i,l,o){var r=this.extractPropertyDefinition(i,o,"gradientDefs");if(r){var n=l.getAttribute(o+"-opacity"),e=t.Gradient.fromElement(r,i,n,this.options);i.set(o,e)}},c.createClipPathCallback=function(i,l){return function(o){o._removeTransformMatrix(),o.fillRule=o.clipRule,l.push(o)}},c.resolveClipPath=function(i,l){var o=this.extractPropertyDefinition(i,"clipPath","clipPaths"),r,n,e,a,h,s;if(o){a=[],e=t.util.invertTransform(i.calcTransformMatrix());for(var u=o[0].parentNode,d=l;d.parentNode&&d.getAttribute("clip-path")!==i.clipPath;)d=d.parentNode;d.parentNode.appendChild(u);for(var m=0;m<o.length;m++)r=o[m],n=this.findTag(r),n.fromElement(r,this.createClipPathCallback(i,a),this.options);a.length===1?o=a[0]:o=new t.Group(a),h=t.util.multiplyTransformMatrices(e,o.calcTransformMatrix()),o.clipPath&&this.resolveClipPath(o,d);var s=t.util.qrDecompose(h);o.flipX=!1,o.flipY=!1,o.set("scaleX",s.scaleX),o.set("scaleY",s.scaleY),o.angle=s.angle,o.skewX=s.skewX,o.skewY=0,o.setPositionByOrigin({x:s.translateX,y:s.translateY},"center","center"),i.clipPath=o}else delete i.clipPath},c.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(i){return i!=null}),this.callback(this.instances,this.elements))}}(t.ElementsParser.prototype),function(c){var i=c.fabric||(c.fabric={});if(i.Point){i.warn("fabric.Point is already defined");return}i.Point=l;function l(o,r){this.x=o,this.y=r}l.prototype={type:"point",constructor:l,add:function(o){return new l(this.x+o.x,this.y+o.y)},addEquals:function(o){return this.x+=o.x,this.y+=o.y,this},scalarAdd:function(o){return new l(this.x+o,this.y+o)},scalarAddEquals:function(o){return this.x+=o,this.y+=o,this},subtract:function(o){return new l(this.x-o.x,this.y-o.y)},subtractEquals:function(o){return this.x-=o.x,this.y-=o.y,this},scalarSubtract:function(o){return new l(this.x-o,this.y-o)},scalarSubtractEquals:function(o){return this.x-=o,this.y-=o,this},multiply:function(o){return new l(this.x*o,this.y*o)},multiplyEquals:function(o){return this.x*=o,this.y*=o,this},divide:function(o){return new l(this.x/o,this.y/o)},divideEquals:function(o){return this.x/=o,this.y/=o,this},eq:function(o){return this.x===o.x&&this.y===o.y},lt:function(o){return this.x<o.x&&this.y<o.y},lte:function(o){return this.x<=o.x&&this.y<=o.y},gt:function(o){return this.x>o.x&&this.y>o.y},gte:function(o){return this.x>=o.x&&this.y>=o.y},lerp:function(o,r){return typeof r>"u"&&(r=.5),r=Math.max(Math.min(1,r),0),new l(this.x+(o.x-this.x)*r,this.y+(o.y-this.y)*r)},distanceFrom:function(o){var r=this.x-o.x,n=this.y-o.y;return Math.sqrt(r*r+n*n)},midPointFrom:function(o){return this.lerp(o)},min:function(o){return new l(Math.min(this.x,o.x),Math.min(this.y,o.y))},max:function(o){return new l(Math.max(this.x,o.x),Math.max(this.y,o.y))},toString:function(){return this.x+","+this.y},setXY:function(o,r){return this.x=o,this.y=r,this},setX:function(o){return this.x=o,this},setY:function(o){return this.y=o,this},setFromPoint:function(o){return this.x=o.x,this.y=o.y,this},swap:function(o){var r=this.x,n=this.y;this.x=o.x,this.y=o.y,o.x=r,o.y=n},clone:function(){return new l(this.x,this.y)}}}(f),function(c){var i=c.fabric||(c.fabric={});if(i.Intersection){i.warn("fabric.Intersection is already defined");return}function l(o){this.status=o,this.points=[]}i.Intersection=l,i.Intersection.prototype={constructor:l,appendPoint:function(o){return this.points.push(o),this},appendPoints:function(o){return this.points=this.points.concat(o),this}},i.Intersection.intersectLineLine=function(o,r,n,e){var a,h=(e.x-n.x)*(o.y-n.y)-(e.y-n.y)*(o.x-n.x),s=(r.x-o.x)*(o.y-n.y)-(r.y-o.y)*(o.x-n.x),u=(e.y-n.y)*(r.x-o.x)-(e.x-n.x)*(r.y-o.y);if(u!==0){var d=h/u,m=s/u;0<=d&&d<=1&&0<=m&&m<=1?(a=new l("Intersection"),a.appendPoint(new i.Point(o.x+d*(r.x-o.x),o.y+d*(r.y-o.y)))):a=new l}else h===0||s===0?a=new l("Coincident"):a=new l("Parallel");return a},i.Intersection.intersectLinePolygon=function(o,r,n){var e=new l,a=n.length,h,s,u,d;for(d=0;d<a;d++)h=n[d],s=n[(d+1)%a],u=l.intersectLineLine(o,r,h,s),e.appendPoints(u.points);return e.points.length>0&&(e.status="Intersection"),e},i.Intersection.intersectPolygonPolygon=function(o,r){var n=new l,e=o.length,a;for(a=0;a<e;a++){var h=o[a],s=o[(a+1)%e],u=l.intersectLinePolygon(h,s,r);n.appendPoints(u.points)}return n.points.length>0&&(n.status="Intersection"),n},i.Intersection.intersectPolygonRectangle=function(o,r,n){var e=r.min(n),a=r.max(n),h=new i.Point(a.x,e.y),s=new i.Point(e.x,a.y),u=l.intersectLinePolygon(e,h,o),d=l.intersectLinePolygon(h,a,o),m=l.intersectLinePolygon(a,s,o),p=l.intersectLinePolygon(s,e,o),y=new l;return y.appendPoints(u.points),y.appendPoints(d.points),y.appendPoints(m.points),y.appendPoints(p.points),y.points.length>0&&(y.status="Intersection"),y}}(f),function(c){var i=c.fabric||(c.fabric={});if(i.Color){i.warn("fabric.Color is already defined.");return}function l(r){r?this._tryParsingColor(r):this.setSource([0,0,0,1])}i.Color=l,i.Color.prototype={_tryParsingColor:function(r){var n;r in l.colorNameMap&&(r=l.colorNameMap[r]),r==="transparent"&&(n=[255,255,255,0]),n||(n=l.sourceFromHex(r)),n||(n=l.sourceFromRgb(r)),n||(n=l.sourceFromHsl(r)),n||(n=[0,0,0,1]),n&&this.setSource(n)},_rgbToHsl:function(r,n,e){r/=255,n/=255,e/=255;var a,h,s,u=i.util.array.max([r,n,e]),d=i.util.array.min([r,n,e]);if(s=(u+d)/2,u===d)a=h=0;else{var m=u-d;switch(h=s>.5?m/(2-u-d):m/(u+d),u){case r:a=(n-e)/m+(n<e?6:0);break;case n:a=(e-r)/m+2;break;case e:a=(r-n)/m+4;break}a/=6}return[Math.round(a*360),Math.round(h*100),Math.round(s*100)]},getSource:function(){return this._source},setSource:function(r){this._source=r},toRgb:function(){var r=this.getSource();return"rgb("+r[0]+","+r[1]+","+r[2]+")"},toRgba:function(){var r=this.getSource();return"rgba("+r[0]+","+r[1]+","+r[2]+","+r[3]+")"},toHsl:function(){var r=this.getSource(),n=this._rgbToHsl(r[0],r[1],r[2]);return"hsl("+n[0]+","+n[1]+"%,"+n[2]+"%)"},toHsla:function(){var r=this.getSource(),n=this._rgbToHsl(r[0],r[1],r[2]);return"hsla("+n[0]+","+n[1]+"%,"+n[2]+"%,"+r[3]+")"},toHex:function(){var r=this.getSource(),n,e,a;return n=r[0].toString(16),n=n.length===1?"0"+n:n,e=r[1].toString(16),e=e.length===1?"0"+e:e,a=r[2].toString(16),a=a.length===1?"0"+a:a,n.toUpperCase()+e.toUpperCase()+a.toUpperCase()},toHexa:function(){var r=this.getSource(),n;return n=Math.round(r[3]*255),n=n.toString(16),n=n.length===1?"0"+n:n,this.toHex()+n.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(r){var n=this.getSource();return n[3]=r,this.setSource(n),this},toGrayscale:function(){var r=this.getSource(),n=parseInt((r[0]*.3+r[1]*.59+r[2]*.11).toFixed(0),10),e=r[3];return this.setSource([n,n,n,e]),this},toBlackWhite:function(r){var n=this.getSource(),e=(n[0]*.3+n[1]*.59+n[2]*.11).toFixed(0),a=n[3];return r=r||127,e=Number(e)<Number(r)?0:255,this.setSource([e,e,e,a]),this},overlayWith:function(r){r instanceof l||(r=new l(r));var n=[],e=this.getAlpha(),a=.5,h=this.getSource(),s=r.getSource(),u;for(u=0;u<3;u++)n.push(Math.round(h[u]*(1-a)+s[u]*a));return n[3]=e,this.setSource(n),this}},i.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,i.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,i.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,i.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function o(r,n,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?r+(n-r)*6*e:e<1/2?n:e<2/3?r+(n-r)*(2/3-e)*6:r}i.Color.fromRgb=function(r){return l.fromSource(l.sourceFromRgb(r))},i.Color.sourceFromRgb=function(r){var n=r.match(l.reRGBa);if(n){var e=parseInt(n[1],10)/(/%$/.test(n[1])?100:1)*(/%$/.test(n[1])?255:1),a=parseInt(n[2],10)/(/%$/.test(n[2])?100:1)*(/%$/.test(n[2])?255:1),h=parseInt(n[3],10)/(/%$/.test(n[3])?100:1)*(/%$/.test(n[3])?255:1);return[parseInt(e,10),parseInt(a,10),parseInt(h,10),n[4]?parseFloat(n[4]):1]}},i.Color.fromRgba=l.fromRgb,i.Color.fromHsl=function(r){return l.fromSource(l.sourceFromHsl(r))},i.Color.sourceFromHsl=function(r){var n=r.match(l.reHSLa);if(n){var e=(parseFloat(n[1])%360+360)%360/360,a=parseFloat(n[2])/(/%$/.test(n[2])?100:1),h=parseFloat(n[3])/(/%$/.test(n[3])?100:1),s,u,d;if(a===0)s=u=d=h;else{var m=h<=.5?h*(a+1):h+a-h*a,p=h*2-m;s=o(p,m,e+1/3),u=o(p,m,e),d=o(p,m,e-1/3)}return[Math.round(s*255),Math.round(u*255),Math.round(d*255),n[4]?parseFloat(n[4]):1]}},i.Color.fromHsla=l.fromHsl,i.Color.fromHex=function(r){return l.fromSource(l.sourceFromHex(r))},i.Color.sourceFromHex=function(r){if(r.match(l.reHex)){var n=r.slice(r.indexOf("#")+1),e=n.length===3||n.length===4,a=n.length===8||n.length===4,h=e?n.charAt(0)+n.charAt(0):n.substring(0,2),s=e?n.charAt(1)+n.charAt(1):n.substring(2,4),u=e?n.charAt(2)+n.charAt(2):n.substring(4,6),d=a?e?n.charAt(3)+n.charAt(3):n.substring(6,8):"FF";return[parseInt(h,16),parseInt(s,16),parseInt(u,16),parseFloat((parseInt(d,16)/255).toFixed(2))]}},i.Color.fromSource=function(r){var n=new l;return n.setSource(r),n}}(f),function(c){var i=c.fabric||(c.fabric={}),l=["e","se","s","sw","w","nw","n","ne","e"],o=["ns","nesw","ew","nwse"],r={},n="left",e="top",a="right",h="bottom",s="center",u={top:h,bottom:e,left:a,right:n,center:s},d=i.util.radiansToDegrees,m=Math.sign||function(X){return(X>0)-(X<0)||+X};function p(X,L){var U=X.angle+d(Math.atan2(L.y,L.x))+360;return Math.round(U%360/45)}function y(X,L){var U=L.transform.target,V=U.canvas,H=i.util.object.clone(L);H.target=U,V&&V.fire("object:"+X,H),U.fire(X,L)}function w(X,L){var U=L.canvas,V=U.uniScaleKey,H=X[V];return U.uniformScaling&&!H||!U.uniformScaling&&H}function S(X){return X.originX===s&&X.originY===s}function E(X,L,U){var V=X.lockScalingX,H=X.lockScalingY;return!!(V&&H||!L&&(V||H)&&U||V&&L==="x"||H&&L==="y")}function D(X,L,U){var V="not-allowed",H=w(X,U),q="";if(L.x!==0&&L.y===0?q="x":L.x===0&&L.y!==0&&(q="y"),E(U,q,H))return V;var nt=p(U,L);return l[nt]+"-resize"}function W(X,L,U){var V="not-allowed";if(L.x!==0&&U.lockSkewingY||L.y!==0&&U.lockSkewingX)return V;var H=p(U,L)%4;return o[H]+"-resize"}function K(X,L,U){return X[U.canvas.altActionKey]?r.skewCursorStyleHandler(X,L,U):r.scaleCursorStyleHandler(X,L,U)}function tt(X,L,U){var V=X[U.canvas.altActionKey];if(L.x===0)return V?"skewX":"scaleY";if(L.y===0)return V?"skewY":"scaleX"}function N(X,L,U){return U.lockRotation?"not-allowed":L.cursorStyle}function J(X,L,U,V){return{e:X,transform:L,pointer:{x:U,y:V}}}function $(X){return function(L,U,V,H){var q=U.target,nt=q.getCenterPoint(),dt=q.translateToOriginPoint(nt,U.originX,U.originY),lt=X(L,U,V,H);return q.setPositionByOrigin(dt,U.originX,U.originY),lt}}function Z(X,L){return function(U,V,H,q){var nt=L(U,V,H,q);return nt&&y(X,J(U,V,H,q)),nt}}function rt(X,L,U,V,H){var q=X.target,nt=q.controls[X.corner],dt=q.canvas.getZoom(),lt=q.padding/dt,z=q.toLocalPoint(new i.Point(V,H),L,U);return z.x>=lt&&(z.x-=lt),z.x<=-lt&&(z.x+=lt),z.y>=lt&&(z.y-=lt),z.y<=lt&&(z.y+=lt),z.x-=nt.offsetX,z.y-=nt.offsetY,z}function st(X){return X.flipX!==X.flipY}function T(X,L,U,V,H){if(X[L]!==0){var q=X._getTransformedDimensions()[V],nt=H/q*X[U];X.set(U,nt)}}function A(X,L,U,V){var H=L.target,q=H._getTransformedDimensions(0,H.skewY),nt=rt(L,L.originX,L.originY,U,V),dt=Math.abs(nt.x*2)-q.x,lt=H.skewX,z;dt<2?z=0:(z=d(Math.atan2(dt/H.scaleX,q.y/H.scaleY)),L.originX===n&&L.originY===h&&(z=-z),L.originX===a&&L.originY===e&&(z=-z),st(H)&&(z=-z));var ct=lt!==z;if(ct){var mt=H._getTransformedDimensions().y;H.set("skewX",z),T(H,"skewY","scaleY","y",mt)}return ct}function P(X,L,U,V){var H=L.target,q=H._getTransformedDimensions(H.skewX,0),nt=rt(L,L.originX,L.originY,U,V),dt=Math.abs(nt.y*2)-q.y,lt=H.skewY,z;dt<2?z=0:(z=d(Math.atan2(dt/H.scaleY,q.x/H.scaleX)),L.originX===n&&L.originY===h&&(z=-z),L.originX===a&&L.originY===e&&(z=-z),st(H)&&(z=-z));var ct=lt!==z;if(ct){var mt=H._getTransformedDimensions().x;H.set("skewY",z),T(H,"skewX","scaleX","x",mt)}return ct}function k(X,L,U,V){var H=L.target,q=H.skewX,nt,dt=L.originY;if(H.lockSkewingX)return!1;if(q===0){var lt=rt(L,s,s,U,V);lt.x>0?nt=n:nt=a}else q>0&&(nt=dt===e?n:a),q<0&&(nt=dt===e?a:n),st(H)&&(nt=nt===n?a:n);L.originX=nt;var z=Z("skewing",$(A));return z(X,L,U,V)}function B(X,L,U,V){var H=L.target,q=H.skewY,nt,dt=L.originX;if(H.lockSkewingY)return!1;if(q===0){var lt=rt(L,s,s,U,V);lt.y>0?nt=e:nt=h}else q>0&&(nt=dt===n?e:h),q<0&&(nt=dt===n?h:e),st(H)&&(nt=nt===e?h:e);L.originY=nt;var z=Z("skewing",$(P));return z(X,L,U,V)}function O(X,L,U,V){var H=L,q=H.target,nt=q.translateToOriginPoint(q.getCenterPoint(),H.originX,H.originY);if(q.lockRotation)return!1;var dt=Math.atan2(H.ey-nt.y,H.ex-nt.x),lt=Math.atan2(V-nt.y,U-nt.x),z=d(lt-dt+H.theta),ct=!0;if(q.snapAngle>0){var mt=q.snapAngle,_t=q.snapThreshold||mt,xt=Math.ceil(z/mt)*mt,wt=Math.floor(z/mt)*mt;Math.abs(z-wt)<_t?z=wt:Math.abs(z-xt)<_t&&(z=xt)}return z<0&&(z=360+z),z%=360,ct=q.angle!==z,q.angle=z,ct}function x(X,L,U,V,H){H=H||{};var q=L.target,nt=q.lockScalingX,dt=q.lockScalingY,lt=H.by,z,ct,mt,_t,xt=w(X,q),wt=E(q,lt,xt),Bt,At,Zt=L.gestureScale;if(wt)return!1;if(Zt)ct=L.scaleX*Zt,mt=L.scaleY*Zt;else{if(z=rt(L,L.originX,L.originY,U,V),Bt=lt!=="y"?m(z.x):1,At=lt!=="x"?m(z.y):1,L.signX||(L.signX=Bt),L.signY||(L.signY=At),q.lockScalingFlip&&(L.signX!==Bt||L.signY!==At))return!1;if(_t=q._getTransformedDimensions(),xt&&!lt){var ce=Math.abs(z.x)+Math.abs(z.y),Yt=L.original,cn=Math.abs(_t.x*Yt.scaleX/q.scaleX)+Math.abs(_t.y*Yt.scaleY/q.scaleY),ai=ce/cn;ct=Yt.scaleX*ai,mt=Yt.scaleY*ai}else ct=Math.abs(z.x*q.scaleX/_t.x),mt=Math.abs(z.y*q.scaleY/_t.y);S(L)&&(ct*=2,mt*=2),L.signX!==Bt&&lt!=="y"&&(L.originX=u[L.originX],ct*=-1,L.signX=Bt),L.signY!==At&&lt!=="x"&&(L.originY=u[L.originY],mt*=-1,L.signY=At)}var un=q.scaleX,fn=q.scaleY;return lt?(lt==="x"&&q.set("scaleX",ct),lt==="y"&&q.set("scaleY",mt)):(!nt&&q.set("scaleX",ct),!dt&&q.set("scaleY",mt)),un!==q.scaleX||fn!==q.scaleY}function M(X,L,U,V){return x(X,L,U,V)}function R(X,L,U,V){return x(X,L,U,V,{by:"x"})}function Y(X,L,U,V){return x(X,L,U,V,{by:"y"})}function j(X,L,U,V){return X[L.target.canvas.altActionKey]?r.skewHandlerX(X,L,U,V):r.scalingY(X,L,U,V)}function G(X,L,U,V){return X[L.target.canvas.altActionKey]?r.skewHandlerY(X,L,U,V):r.scalingX(X,L,U,V)}function F(X,L,U,V){var H=L.target,q=rt(L,L.originX,L.originY,U,V),nt=H.strokeWidth/(H.strokeUniform?H.scaleX:1),dt=S(L)?2:1,lt=H.width,z=Math.abs(q.x*dt/H.scaleX)-nt;return H.set("width",Math.max(z,0)),lt!==z}function it(X,L,U,V){var H=L.target,q=U-L.offsetX,nt=V-L.offsetY,dt=!H.get("lockMovementX")&&H.left!==q,lt=!H.get("lockMovementY")&&H.top!==nt;return dt&&H.set("left",q),lt&&H.set("top",nt),(dt||lt)&&y("moving",J(X,L,U,V)),dt||lt}r.scaleCursorStyleHandler=D,r.skewCursorStyleHandler=W,r.scaleSkewCursorStyleHandler=K,r.rotationWithSnapping=Z("rotating",$(O)),r.scalingEqually=Z("scaling",$(M)),r.scalingX=Z("scaling",$(R)),r.scalingY=Z("scaling",$(Y)),r.scalingYOrSkewingX=j,r.scalingXOrSkewingY=G,r.changeWidth=Z("resizing",$(F)),r.skewHandlerX=k,r.skewHandlerY=B,r.dragHandler=it,r.scaleOrSkewActionName=tt,r.rotationStyleHandler=N,r.fireEvent=y,r.wrapWithFixedAnchor=$,r.wrapWithFireEvent=Z,r.getLocalPoint=rt,i.controlsUtils=r}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.util.degreesToRadians,o=i.controlsUtils;function r(e,a,h,s,u){s=s||{};var d=this.sizeX||s.cornerSize||u.cornerSize,m=this.sizeY||s.cornerSize||u.cornerSize,p=typeof s.transparentCorners<"u"?s.transparentCorners:u.transparentCorners,y=p?"stroke":"fill",w=!p&&(s.cornerStrokeColor||u.cornerStrokeColor),S=a,E=h,D;e.save(),e.fillStyle=s.cornerColor||u.cornerColor,e.strokeStyle=s.cornerStrokeColor||u.cornerStrokeColor,d>m?(D=d,e.scale(1,m/d),E=h*d/m):m>d?(D=m,e.scale(d/m,1),S=a*m/d):D=d,e.lineWidth=1,e.beginPath(),e.arc(S,E,D/2,0,2*Math.PI,!1),e[y](),w&&e.stroke(),e.restore()}function n(e,a,h,s,u){s=s||{};var d=this.sizeX||s.cornerSize||u.cornerSize,m=this.sizeY||s.cornerSize||u.cornerSize,p=typeof s.transparentCorners<"u"?s.transparentCorners:u.transparentCorners,y=p?"stroke":"fill",w=!p&&(s.cornerStrokeColor||u.cornerStrokeColor),S=d/2,E=m/2;e.save(),e.fillStyle=s.cornerColor||u.cornerColor,e.strokeStyle=s.cornerStrokeColor||u.cornerStrokeColor,e.lineWidth=1,e.translate(a,h),e.rotate(l(u.angle)),e[y+"Rect"](-S,-E,d,m),w&&e.strokeRect(-S,-E,d,m),e.restore()}o.renderCircleControl=r,o.renderSquareControl=n}(f),function(c){var i=c.fabric||(c.fabric={});function l(o){for(var r in o)this[r]=o[r]}i.Control=l,i.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(o,r){return r.cursorStyle},getActionName:function(o,r){return r.actionName},getVisibility:function(o,r){var n=o._controlsVisibility;return n&&typeof n[r]<"u"?n[r]:this.visible},setVisibility:function(o){this.visible=o},positionHandler:function(o,r){var n=i.util.transformPoint({x:this.x*o.x+this.offsetX,y:this.y*o.y+this.offsetY},r);return n},calcCornerCoords:function(o,r,n,e,a){var h,s,u,d,m=a?this.touchSizeX:this.sizeX,p=a?this.touchSizeY:this.sizeY;if(m&&p&&m!==p){var y=Math.atan2(p,m),w=Math.sqrt(m*m+p*p)/2,S=y-i.util.degreesToRadians(o),E=Math.PI/2-y-i.util.degreesToRadians(o);h=w*i.util.cos(S),s=w*i.util.sin(S),u=w*i.util.cos(E),d=w*i.util.sin(E)}else{var D=m&&p?m:r;w=D*.7071067812;var S=i.util.degreesToRadians(45-o);h=u=w*i.util.cos(S),s=d=w*i.util.sin(S)}return{tl:{x:n-d,y:e-u},tr:{x:n+h,y:e-s},bl:{x:n-h,y:e+s},br:{x:n+d,y:e+u}}},render:function(o,r,n,e,a){switch(e=e||{},e.cornerStyle||a.cornerStyle){case"circle":i.controlsUtils.renderCircleControl.call(this,o,r,n,e,a);break;default:i.controlsUtils.renderSquareControl.call(this,o,r,n,e,a)}}}}(f),function(){function c(n,e){var a=n.getAttribute("style"),h=n.getAttribute("offset")||0,s,u,d,m;if(h=parseFloat(h)/(/%$/.test(h)?100:1),h=h<0?0:h>1?1:h,a){var p=a.split(/\s*;\s*/);for(p[p.length-1]===""&&p.pop(),m=p.length;m--;){var y=p[m].split(/\s*:\s*/),w=y[0].trim(),S=y[1].trim();w==="stop-color"?s=S:w==="stop-opacity"&&(d=S)}}return s||(s=n.getAttribute("stop-color")||"rgb(0,0,0)"),d||(d=n.getAttribute("stop-opacity")),s=new t.Color(s),u=s.getAlpha(),d=isNaN(parseFloat(d))?1:parseFloat(d),d*=u*e,{offset:h,color:s.toRgb(),opacity:d}}function i(n){return{x1:n.getAttribute("x1")||0,y1:n.getAttribute("y1")||0,x2:n.getAttribute("x2")||"100%",y2:n.getAttribute("y2")||0}}function l(n){return{x1:n.getAttribute("fx")||n.getAttribute("cx")||"50%",y1:n.getAttribute("fy")||n.getAttribute("cy")||"50%",r1:0,x2:n.getAttribute("cx")||"50%",y2:n.getAttribute("cy")||"50%",r2:n.getAttribute("r")||"50%"}}var o=t.util.object.clone;t.Gradient=t.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(n){n||(n={}),n.coords||(n.coords={});var e,a=this;Object.keys(n).forEach(function(h){a[h]=n[h]}),this.id?this.id+="_"+t.Object.__uid++:this.id=t.Object.__uid++,e={x1:n.coords.x1||0,y1:n.coords.y1||0,x2:n.coords.x2||0,y2:n.coords.y2||0},this.type==="radial"&&(e.r1=n.coords.r1||0,e.r2=n.coords.r2||0),this.coords=e,this.colorStops=n.colorStops.slice()},addColorStop:function(n){for(var e in n){var a=new t.Color(n[e]);this.colorStops.push({offset:parseFloat(e),color:a.toRgb(),opacity:a.getAlpha()})}return this},toObject:function(n){var e={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return t.util.populateWithProperties(this,e,n),e},toSVG:function(n,u){var a=o(this.coords,!0),h,s,u=u||{},d,m,p=o(this.colorStops,!0),y=a.r1>a.r2,w=this.gradientTransform?this.gradientTransform.concat():t.iMatrix.concat(),S=-this.offsetX,E=-this.offsetY,D=!!u.additionalTransform,W=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(p.sort(function($,Z){return $.offset-Z.offset}),W==="objectBoundingBox"?(S/=n.width,E/=n.height):(S+=n.width/2,E+=n.height/2),n.type==="path"&&this.gradientUnits!=="percentage"&&(S-=n.pathOffset.x,E-=n.pathOffset.y),w[4]-=S,w[5]-=E,m='id="SVGID_'+this.id+'" gradientUnits="'+W+'"',m+=' gradientTransform="'+(D?u.additionalTransform+" ":"")+t.util.matrixToSVG(w)+'" ',this.type==="linear"?d=["<linearGradient ",m,' x1="',a.x1,'" y1="',a.y1,'" x2="',a.x2,'" y2="',a.y2,`">
`]:this.type==="radial"&&(d=["<radialGradient ",m,' cx="',y?a.x1:a.x2,'" cy="',y?a.y1:a.y2,'" r="',y?a.r1:a.r2,'" fx="',y?a.x2:a.x1,'" fy="',y?a.y2:a.y1,`">
`]),this.type==="radial"){if(y)for(p=p.concat(),p.reverse(),h=0,s=p.length;h<s;h++)p[h].offset=1-p[h].offset;var K=Math.min(a.r1,a.r2);if(K>0){var tt=Math.max(a.r1,a.r2),N=K/tt;for(h=0,s=p.length;h<s;h++)p[h].offset+=N*(1-p[h].offset)}}for(h=0,s=p.length;h<s;h++){var J=p[h];d.push("<stop ",'offset="',J.offset*100+"%",'" style="stop-color:',J.color,typeof J.opacity<"u"?";stop-opacity: "+J.opacity:";",`"/>
`)}return d.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),d.join("")},toLive:function(n){var e,a=t.util.object.clone(this.coords),h,s;if(this.type){for(this.type==="linear"?e=n.createLinearGradient(a.x1,a.y1,a.x2,a.y2):this.type==="radial"&&(e=n.createRadialGradient(a.x1,a.y1,a.r1,a.x2,a.y2,a.r2)),h=0,s=this.colorStops.length;h<s;h++){var u=this.colorStops[h].color,d=this.colorStops[h].opacity,m=this.colorStops[h].offset;typeof d<"u"&&(u=new t.Color(u).setAlpha(d).toRgba()),e.addColorStop(m,u)}return e}}}),t.util.object.extend(t.Gradient,{fromElement:function(n,e,a,h){var s=parseFloat(a)/(/%$/.test(a)?100:1);s=s<0?0:s>1?1:s,isNaN(s)&&(s=1);var u=n.getElementsByTagName("stop"),d,m=n.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",p=n.getAttribute("gradientTransform")||"",y=[],w,S,E=0,D=0,W;for(n.nodeName==="linearGradient"||n.nodeName==="LINEARGRADIENT"?(d="linear",w=i(n)):(d="radial",w=l(n)),S=u.length;S--;)y.push(c(u[S],s));W=t.parseTransformAttribute(p),r(e,w,h,m),m==="pixels"&&(E=-e.left,D=-e.top);var K=new t.Gradient({id:n.getAttribute("id"),type:d,coords:w,colorStops:y,gradientUnits:m,gradientTransform:W,offsetX:E,offsetY:D});return K}});function r(n,e,a,h){var s,u;Object.keys(e).forEach(function(d){s=e[d],s==="Infinity"?u=1:s==="-Infinity"?u=0:(u=parseFloat(e[d],10),typeof s=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(s)&&(u*=.01,h==="pixels"&&((d==="x1"||d==="x2"||d==="r2")&&(u*=a.viewBoxWidth||a.width),(d==="y1"||d==="y2")&&(u*=a.viewBoxHeight||a.height)))),e[d]=u})}}(),function(){var c=t.util.toFixed;t.Pattern=t.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(i,l){if(i||(i={}),this.id=t.Object.__uid++,this.setOptions(i),!i.source||i.source&&typeof i.source!="string"){l&&l(this);return}else{var o=this;this.source=t.util.createImage(),t.util.loadImage(i.source,function(r,n){o.source=r,l&&l(o,n)},null,this.crossOrigin)}},toObject:function(i){var l=t.Object.NUM_FRACTION_DIGITS,o,r;return typeof this.source.src=="string"?o=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(o=this.source.toDataURL()),r={type:"pattern",source:o,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:c(this.offsetX,l),offsetY:c(this.offsetY,l),patternTransform:this.patternTransform?this.patternTransform.concat():null},t.util.populateWithProperties(this,r,i),r},toSVG:function(i){var l=typeof this.source=="function"?this.source():this.source,o=l.width/i.width,r=l.height/i.height,n=this.offsetX/i.width,e=this.offsetY/i.height,a="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(r=1,e&&(r+=Math.abs(e))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(o=1,n&&(o+=Math.abs(n))),l.src?a=l.src:l.toDataURL&&(a=l.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+n+'" y="'+e+'" width="'+o+'" height="'+r+`">
<image x="0" y="0" width="`+l.width+'" height="'+l.height+'" xlink:href="'+a+`"></image>
</pattern>
`},setOptions:function(i){for(var l in i)this[l]=i[l]},toLive:function(i){var l=this.source;return!l||typeof l.src<"u"&&(!l.complete||l.naturalWidth===0||l.naturalHeight===0)?"":i.createPattern(l,this.repeat)}})}(),function(c){var i=c.fabric||(c.fabric={}),l=i.util.toFixed;if(i.Shadow){i.warn("fabric.Shadow is already defined.");return}i.Shadow=i.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(o){typeof o=="string"&&(o=this._parseShadow(o));for(var r in o)this[r]=o[r];this.id=i.Object.__uid++},_parseShadow:function(o){var r=o.trim(),n=i.Shadow.reOffsetsAndBlur.exec(r)||[],e=r.replace(i.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:e.trim(),offsetX:parseFloat(n[1],10)||0,offsetY:parseFloat(n[2],10)||0,blur:parseFloat(n[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(o){var r=40,n=40,e=i.Object.NUM_FRACTION_DIGITS,a=i.util.rotateVector({x:this.offsetX,y:this.offsetY},i.util.degreesToRadians(-o.angle)),h=20,s=new i.Color(this.color);return o.width&&o.height&&(r=l((Math.abs(a.x)+this.blur)/o.width,e)*100+h,n=l((Math.abs(a.y)+this.blur)/o.height,e)*100+h),o.flipX&&(a.x*=-1),o.flipY&&(a.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+n+'%" height="'+(100+2*n)+'%" x="-'+r+'%" width="'+(100+2*r)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+l(this.blur?this.blur/2:0,e)+`"></feGaussianBlur>
	<feOffset dx="`+l(a.x,e)+'" dy="'+l(a.y,e)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+s.toRgb()+'" flood-opacity="'+s.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var o={},r=i.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(n){this[n]!==r[n]&&(o[n]=this[n])},this),o}}),i.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}(f),function(){if(t.StaticCanvas){t.warn("fabric.StaticCanvas is already defined.");return}var c=t.util.object.extend,i=t.util.getElementOffset,l=t.util.removeFromArray,o=t.util.toFixed,r=t.util.transformPoint,n=t.util.invertTransform,e=t.util.getNodeCanvas,a=t.util.createCanvasElement,h=new Error("Could not initialize `canvas` element");t.StaticCanvas=t.util.createClass(t.CommonMethods,{initialize:function(s,u){u||(u={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(s,u)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:t.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(s,u){var d=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(s),this._initOptions(u),this.interactive||this._initRetinaScaling(),u.overlayImage&&this.setOverlayImage(u.overlayImage,d),u.backgroundImage&&this.setBackgroundImage(u.backgroundImage,d),u.backgroundColor&&this.setBackgroundColor(u.backgroundColor,d),u.overlayColor&&this.setOverlayColor(u.overlayColor,d),this.calcOffset()},_isRetinaScaling:function(){return t.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,t.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var s=t.devicePixelRatio;this.__initRetinaScaling(s,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(s,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(s,u,d){u.setAttribute("width",this.width*s),u.setAttribute("height",this.height*s),d.scale(s,s)},calcOffset:function(){return this._offset=i(this.lowerCanvasEl),this},setOverlayImage:function(s,u,d){return this.__setBgOverlayImage("overlayImage",s,u,d)},setBackgroundImage:function(s,u,d){return this.__setBgOverlayImage("backgroundImage",s,u,d)},setOverlayColor:function(s,u){return this.__setBgOverlayColor("overlayColor",s,u)},setBackgroundColor:function(s,u){return this.__setBgOverlayColor("backgroundColor",s,u)},__setBgOverlayImage:function(s,u,d,m){return typeof u=="string"?t.util.loadImage(u,function(p,y){if(p){var w=new t.Image(p,m);this[s]=w,w.canvas=this}d&&d(p,y)},this,m&&m.crossOrigin):(m&&u.setOptions(m),this[s]=u,u&&(u.canvas=this),d&&d(u,!1)),this},__setBgOverlayColor:function(s,u,d){return this[s]=u,this._initGradient(u,s),this._initPattern(u,s,d),this},_createCanvasElement:function(){var s=a();if(!s||(s.style||(s.style={}),typeof s.getContext>"u"))throw h;return s},_initOptions:function(s){var u=this.lowerCanvasEl;this._setOptions(s),this.width=this.width||parseInt(u.width,10)||0,this.height=this.height||parseInt(u.height,10)||0,this.lowerCanvasEl.style&&(u.width=this.width,u.height=this.height,u.style.width=this.width+"px",u.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(s){s&&s.getContext?this.lowerCanvasEl=s:this.lowerCanvasEl=t.util.getById(s)||this._createCanvasElement(),t.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(s,u){return this.setDimensions({width:s},u)},setHeight:function(s,u){return this.setDimensions({height:s},u)},setDimensions:function(s,u){var d;u=u||{};for(var m in s)d=s[m],u.cssOnly||(this._setBackstoreDimension(m,s[m]),d+="px",this.hasLostContext=!0),u.backstoreOnly||this._setCssDimension(m,d);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),u.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(s,u){return this.lowerCanvasEl[s]=u,this.upperCanvasEl&&(this.upperCanvasEl[s]=u),this.cacheCanvasEl&&(this.cacheCanvasEl[s]=u),this[s]=u,this},_setCssDimension:function(s,u){return this.lowerCanvasEl.style[s]=u,this.upperCanvasEl&&(this.upperCanvasEl.style[s]=u),this.wrapperEl&&(this.wrapperEl.style[s]=u),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(s){var u=this._activeObject,d=this.backgroundImage,m=this.overlayImage,p,y,w;for(this.viewportTransform=s,y=0,w=this._objects.length;y<w;y++)p=this._objects[y],p.group||p.setCoords(!0);return u&&u.setCoords(),d&&d.setCoords(!0),m&&m.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(s,u){var d=s,m=this.viewportTransform.slice(0);s=r(s,n(this.viewportTransform)),m[0]=u,m[3]=u;var p=r(s,m);return m[4]+=d.x-p.x,m[5]+=d.y-p.y,this.setViewportTransform(m)},setZoom:function(s){return this.zoomToPoint(new t.Point(0,0),s),this},absolutePan:function(s){var u=this.viewportTransform.slice(0);return u[4]=-s.x,u[5]=-s.y,this.setViewportTransform(u)},relativePan:function(s){return this.absolutePan(new t.Point(-s.x-this.viewportTransform[4],-s.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(s){this.stateful&&s.setupState(),s._set("canvas",this),s.setCoords(),this.fire("object:added",{target:s}),s.fire("added")},_onObjectRemoved:function(s){this.fire("object:removed",{target:s}),s.fire("removed"),delete s.canvas},clearContext:function(s){return s.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var s=this.contextContainer;return this.renderCanvas(s,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=t.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var s={},u=this.width,d=this.height,m=n(this.viewportTransform);return s.tl=r({x:0,y:0},m),s.br=r({x:u,y:d},m),s.tr=new t.Point(s.br.x,s.tl.y),s.bl=new t.Point(s.tl.x,s.br.y),this.vptCoords=s,s},cancelRequestedRender:function(){this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(s,u){var d=this.viewportTransform,m=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(s),t.util.setImageSmoothing(s,this.imageSmoothingEnabled),this.fire("before:render",{ctx:s}),this._renderBackground(s),s.save(),s.transform(d[0],d[1],d[2],d[3],d[4],d[5]),this._renderObjects(s,u),s.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(s),m&&(m.canvas=this,m.shouldCache(),m._transformDone=!0,m.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(s)),this._renderOverlay(s),this.controlsAboveOverlay&&this.interactive&&this.drawControls(s),this.fire("after:render",{ctx:s})},drawClipPathOnCanvas:function(s){var u=this.viewportTransform,d=this.clipPath;s.save(),s.transform(u[0],u[1],u[2],u[3],u[4],u[5]),s.globalCompositeOperation="destination-in",d.transform(s),s.scale(1/d.zoomX,1/d.zoomY),s.drawImage(d._cacheCanvas,-d.cacheTranslationX,-d.cacheTranslationY),s.restore()},_renderObjects:function(s,u){var d,m;for(d=0,m=u.length;d<m;++d)u[d]&&u[d].render(s)},_renderBackgroundOrOverlay:function(s,u){var d=this[u+"Color"],m=this[u+"Image"],p=this.viewportTransform,y=this[u+"Vpt"];if(!(!d&&!m)){if(d){s.save(),s.beginPath(),s.moveTo(0,0),s.lineTo(this.width,0),s.lineTo(this.width,this.height),s.lineTo(0,this.height),s.closePath(),s.fillStyle=d.toLive?d.toLive(s,this):d,y&&s.transform(p[0],p[1],p[2],p[3],p[4],p[5]),s.transform(1,0,0,1,d.offsetX||0,d.offsetY||0);var w=d.gradientTransform||d.patternTransform;w&&s.transform(w[0],w[1],w[2],w[3],w[4],w[5]),s.fill(),s.restore()}m&&(s.save(),y&&s.transform(p[0],p[1],p[2],p[3],p[4],p[5]),m.render(s),s.restore())}},_renderBackground:function(s){this._renderBackgroundOrOverlay(s,"background")},_renderOverlay:function(s){this._renderBackgroundOrOverlay(s,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new t.Point(this.width/2,this.height/2)},centerObjectH:function(s){return this._centerObject(s,new t.Point(this.getCenterPoint().x,s.getCenterPoint().y))},centerObjectV:function(s){return this._centerObject(s,new t.Point(s.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(s){var u=this.getCenterPoint();return this._centerObject(s,u)},viewportCenterObject:function(s){var u=this.getVpCenter();return this._centerObject(s,u)},viewportCenterObjectH:function(s){var u=this.getVpCenter();return this._centerObject(s,new t.Point(u.x,s.getCenterPoint().y)),this},viewportCenterObjectV:function(s){var u=this.getVpCenter();return this._centerObject(s,new t.Point(s.getCenterPoint().x,u.y))},getVpCenter:function(){var s=this.getCenterPoint(),u=n(this.viewportTransform);return r(s,u)},_centerObject:function(s,u){return s.setPositionByOrigin(u,"center","center"),s.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(s){return this.toDatalessObject(s)},toObject:function(s){return this._toObjectMethod("toObject",s)},toDatalessObject:function(s){return this._toObjectMethod("toDatalessObject",s)},_toObjectMethod:function(s,u){var d=this.clipPath,m={version:t.version,objects:this._toObjects(s,u)};return d&&!d.excludeFromExport&&(m.clipPath=this._toObject(this.clipPath,s,u)),c(m,this.__serializeBgOverlay(s,u)),t.util.populateWithProperties(this,m,u),m},_toObjects:function(s,u){return this._objects.filter(function(d){return!d.excludeFromExport}).map(function(d){return this._toObject(d,s,u)},this)},_toObject:function(s,u,d){var m;this.includeDefaultValues||(m=s.includeDefaultValues,s.includeDefaultValues=!1);var p=s[u](d);return this.includeDefaultValues||(s.includeDefaultValues=m),p},__serializeBgOverlay:function(s,u){var d={},m=this.backgroundImage,p=this.overlayImage,y=this.backgroundColor,w=this.overlayColor;return y&&y.toObject?y.excludeFromExport||(d.background=y.toObject(u)):y&&(d.background=y),w&&w.toObject?w.excludeFromExport||(d.overlay=w.toObject(u)):w&&(d.overlay=w),m&&!m.excludeFromExport&&(d.backgroundImage=this._toObject(m,s,u)),p&&!p.excludeFromExport&&(d.overlayImage=this._toObject(p,s,u)),d},svgViewportTransformation:!0,toSVG:function(s,u){s||(s={}),s.reviver=u;var d=[];return this._setSVGPreamble(d,s),this._setSVGHeader(d,s),this.clipPath&&d.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(d,"background"),this._setSVGBgOverlayImage(d,"backgroundImage",u),this._setSVGObjects(d,u),this.clipPath&&d.push(`</g>
`),this._setSVGBgOverlayColor(d,"overlay"),this._setSVGBgOverlayImage(d,"overlayImage",u),d.push("</svg>"),d.join("")},_setSVGPreamble:function(s,u){u.suppressPreamble||s.push('<?xml version="1.0" encoding="',u.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(s,u){var d=u.width||this.width,m=u.height||this.height,p,y='viewBox="0 0 '+this.width+" "+this.height+'" ',w=t.Object.NUM_FRACTION_DIGITS;u.viewBox?y='viewBox="'+u.viewBox.x+" "+u.viewBox.y+" "+u.viewBox.width+" "+u.viewBox.height+'" ':this.svgViewportTransformation&&(p=this.viewportTransform,y='viewBox="'+o(-p[4]/p[0],w)+" "+o(-p[5]/p[3],w)+" "+o(this.width/p[0],w)+" "+o(this.height/p[3],w)+'" '),s.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',d,'" ','height="',m,'" ',y,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",t.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(u),`</defs>
`)},createSVGClipPathMarkup:function(s){var u=this.clipPath;return u?(u.clipPathId="CLIPPATH_"+t.Object.__uid++,'<clipPath id="'+u.clipPathId+`" >
`+this.clipPath.toClipPathSVG(s.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var s=this,u=["background","overlay"].map(function(d){var m=s[d+"Color"];if(m&&m.toLive){var p=s[d+"Vpt"],y=s.viewportTransform,w={width:s.width/(p?y[0]:1),height:s.height/(p?y[3]:1)};return m.toSVG(w,{additionalTransform:p?t.util.matrixToSVG(y):""})}});return u.join("")},createSVGFontFacesMarkup:function(){var s="",u={},d,m,p,y,w,S,E,D,W,K=t.fontPaths,tt=[];for(this._objects.forEach(function J($){tt.push($),$._objects&&$._objects.forEach(J)}),D=0,W=tt.length;D<W;D++)if(d=tt[D],m=d.fontFamily,!(d.type.indexOf("text")===-1||u[m]||!K[m])&&(u[m]=!0,!!d.styles)){p=d.styles;for(w in p){y=p[w];for(E in y)S=y[E],m=S.fontFamily,!u[m]&&K[m]&&(u[m]=!0)}}for(var N in u)s+=[`		@font-face {
`,"			font-family: '",N,`';
`,"			src: url('",K[N],`');
`,`		}
`].join("");return s&&(s=['	<style type="text/css">',`<![CDATA[
`,s,"]]>",`</style>
`].join("")),s},_setSVGObjects:function(s,u){var d,m,p,y=this._objects;for(m=0,p=y.length;m<p;m++)d=y[m],!d.excludeFromExport&&this._setSVGObject(s,d,u)},_setSVGObject:function(s,u,d){s.push(u.toSVG(d))},_setSVGBgOverlayImage:function(s,u,d){this[u]&&!this[u].excludeFromExport&&this[u].toSVG&&s.push(this[u].toSVG(d))},_setSVGBgOverlayColor:function(s,u){var d=this[u+"Color"],m=this.viewportTransform,p=this.width,y=this.height;if(d)if(d.toLive){var w=d.repeat,S=t.util.invertTransform(m),E=this[u+"Vpt"],D=E?t.util.matrixToSVG(S):"";s.push('<rect transform="'+D+" translate(",p/2,",",y/2,')"',' x="',d.offsetX-p/2,'" y="',d.offsetY-y/2,'" ','width="',w==="repeat-y"||w==="no-repeat"?d.source.width:p,'" height="',w==="repeat-x"||w==="no-repeat"?d.source.height:y,'" fill="url(#SVGID_'+d.id+')"',`></rect>
`)}else s.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',d,'"',`></rect>
`)},sendToBack:function(s){if(!s)return this;var u=this._activeObject,d,m,p;if(s===u&&s.type==="activeSelection")for(p=u._objects,d=p.length;d--;)m=p[d],l(this._objects,m),this._objects.unshift(m);else l(this._objects,s),this._objects.unshift(s);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(s){if(!s)return this;var u=this._activeObject,d,m,p;if(s===u&&s.type==="activeSelection")for(p=u._objects,d=0;d<p.length;d++)m=p[d],l(this._objects,m),this._objects.push(m);else l(this._objects,s),this._objects.push(s);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(s,u){if(!s)return this;var d=this._activeObject,m,p,y,w,S,E=0;if(s===d&&s.type==="activeSelection")for(S=d._objects,m=0;m<S.length;m++)p=S[m],y=this._objects.indexOf(p),y>0+E&&(w=y-1,l(this._objects,p),this._objects.splice(w,0,p)),E++;else y=this._objects.indexOf(s),y!==0&&(w=this._findNewLowerIndex(s,y,u),l(this._objects,s),this._objects.splice(w,0,s));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(s,u,d){var m,p;if(d)for(m=u,p=u-1;p>=0;--p){var y=s.intersectsWithObject(this._objects[p])||s.isContainedWithinObject(this._objects[p])||this._objects[p].isContainedWithinObject(s);if(y){m=p;break}}else m=u-1;return m},bringForward:function(s,u){if(!s)return this;var d=this._activeObject,m,p,y,w,S,E=0;if(s===d&&s.type==="activeSelection")for(S=d._objects,m=S.length;m--;)p=S[m],y=this._objects.indexOf(p),y<this._objects.length-1-E&&(w=y+1,l(this._objects,p),this._objects.splice(w,0,p)),E++;else y=this._objects.indexOf(s),y!==this._objects.length-1&&(w=this._findNewUpperIndex(s,y,u),l(this._objects,s),this._objects.splice(w,0,s));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(s,u,d){var m,p,y;if(d)for(m=u,p=u+1,y=this._objects.length;p<y;++p){var w=s.intersectsWithObject(this._objects[p])||s.isContainedWithinObject(this._objects[p])||this._objects[p].isContainedWithinObject(s);if(w){m=p;break}}else m=u+1;return m},moveTo:function(s,u){return l(this._objects,s),this._objects.splice(u,0,s),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(s){s.dispose&&s.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),t.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),t.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),c(t.StaticCanvas.prototype,t.Observable),c(t.StaticCanvas.prototype,t.Collection),c(t.StaticCanvas.prototype,t.DataURLExporter),c(t.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(s){var u=a();if(!u||!u.getContext)return null;var d=u.getContext("2d");if(!d)return null;switch(s){case"setLineDash":return typeof d.setLineDash<"u";default:return null}}}),t.StaticCanvas.prototype.toJSON=t.StaticCanvas.prototype.toObject,t.isLikelyNode&&(t.StaticCanvas.prototype.createPNGStream=function(){var s=e(this.lowerCanvasEl);return s&&s.createPNGStream()},t.StaticCanvas.prototype.createJPEGStream=function(s){var u=e(this.lowerCanvasEl);return u&&u.createJPEGStream(s)})}(),t.BaseBrush=t.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(c){c.strokeStyle=this.color,c.lineWidth=this.width,c.lineCap=this.strokeLineCap,c.miterLimit=this.strokeMiterLimit,c.lineJoin=this.strokeLineJoin,c.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(c){var i=this.canvas.viewportTransform;c.save(),c.transform(i[0],i[1],i[2],i[3],i[4],i[5])},_setShadow:function(){if(this.shadow){var c=this.canvas,i=this.shadow,l=c.contextTop,o=c.getZoom();c&&c._isRetinaScaling()&&(o*=t.devicePixelRatio),l.shadowColor=i.color,l.shadowBlur=i.blur*o,l.shadowOffsetX=i.offsetX*o,l.shadowOffsetY=i.offsetY*o}},needsFullRender:function(){var c=new t.Color(this.color);return c.getAlpha()<1||!!this.shadow},_resetShadow:function(){var c=this.canvas.contextTop;c.shadowColor="",c.shadowBlur=c.shadowOffsetX=c.shadowOffsetY=0},_isOutSideCanvas:function(c){return c.x<0||c.x>this.canvas.getWidth()||c.y<0||c.y>this.canvas.getHeight()}}),function(){t.PencilBrush=t.util.createClass(t.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(c){this.canvas=c,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(c,i,l){var o=i.midPointFrom(l);return c.quadraticCurveTo(i.x,i.y,o.x,o.y),o},onMouseDown:function(c,i){this.canvas._isMainEvent(i.e)&&(this.drawStraightLine=i.e[this.straightLineKey],this._prepareForDrawing(c),this._captureDrawingPath(c),this._render())},onMouseMove:function(c,i){if(this.canvas._isMainEvent(i.e)&&(this.drawStraightLine=i.e[this.straightLineKey],!(this.limitedToCanvasSize===!0&&this._isOutSideCanvas(c))&&this._captureDrawingPath(c)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var l=this._points,o=l.length,r=this.canvas.contextTop;this._saveAndTransform(r),this.oldEnd&&(r.beginPath(),r.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(r,l[o-2],l[o-1],!0),r.stroke(),r.restore()}},onMouseUp:function(c){return this.canvas._isMainEvent(c.e)?(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(c){var i=new t.Point(c.x,c.y);this._reset(),this._addPoint(i),this.canvas.contextTop.moveTo(i.x,i.y)},_addPoint:function(c){return this._points.length>1&&c.eq(this._points[this._points.length-1])?!1:(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(c),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(c){var i=new t.Point(c.x,c.y);return this._addPoint(i)},_render:function(c){var i,l,o=this._points[0],r=this._points[1];if(c=c||this.canvas.contextTop,this._saveAndTransform(c),c.beginPath(),this._points.length===2&&o.x===r.x&&o.y===r.y){var n=this.width/1e3;o=new t.Point(o.x,o.y),r=new t.Point(r.x,r.y),o.x-=n,r.x+=n}for(c.moveTo(o.x,o.y),i=1,l=this._points.length;i<l;i++)this._drawSegment(c,o,r),o=this._points[i],r=this._points[i+1];c.lineTo(o.x,o.y),c.stroke(),c.restore()},convertPointsToSVGPath:function(c){var i=this.width/1e3;return t.util.getSmoothPathFromPoints(c,i)},_isEmptySVGPath:function(c){var i=t.util.joinPath(c);return i==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(c){var i=new t.Path(c,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,i.shadow=new t.Shadow(this.shadow)),i},decimatePoints:function(c,i){if(c.length<=2)return c;var l=this.canvas.getZoom(),o=Math.pow(i/l,2),r,n=c.length-1,e=c[0],a=[e],h;for(r=1;r<n-1;r++)h=Math.pow(e.x-c[r].x,2)+Math.pow(e.y-c[r].y,2),h>=o&&(e=c[r],a.push(e));return a.push(c[n]),a},_finalizeAndAddPath:function(){var c=this.canvas.contextTop;c.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var i=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(i)){this.canvas.requestRenderAll();return}var l=this.createPath(i);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:l}),this.canvas.add(l),this.canvas.requestRenderAll(),l.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:l})}})}(),t.CircleBrush=t.util.createClass(t.BaseBrush,{width:10,initialize:function(c){this.canvas=c,this.points=[]},drawDot:function(c){var i=this.addPoint(c),l=this.canvas.contextTop;this._saveAndTransform(l),this.dot(l,i),l.restore()},dot:function(c,i){c.fillStyle=i.fill,c.beginPath(),c.arc(i.x,i.y,i.radius,0,Math.PI*2,!1),c.closePath(),c.fill()},onMouseDown:function(c){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(c)},_render:function(){var c=this.canvas.contextTop,i,l,o=this.points;for(this._saveAndTransform(c),i=0,l=o.length;i<l;i++)this.dot(c,o[i]);c.restore()},onMouseMove:function(c){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(c)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(c),this._render()):this.drawDot(c))},onMouseUp:function(){var c=this.canvas.renderOnAddRemove,i,l;this.canvas.renderOnAddRemove=!1;var o=[];for(i=0,l=this.points.length;i<l;i++){var r=this.points[i],n=new t.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&(n.shadow=new t.Shadow(this.shadow)),o.push(n)}var e=new t.Group(o);e.canvas=this.canvas,this.canvas.fire("before:path:created",{path:e}),this.canvas.add(e),this.canvas.fire("path:created",{path:e}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=c,this.canvas.requestRenderAll()},addPoint:function(c){var i=new t.Point(c.x,c.y),l=t.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,o=new t.Color(this.color).setAlpha(t.util.getRandomInt(0,100)/100).toRgba();return i.radius=l,i.fill=o,this.points.push(i),i}}),t.SprayBrush=t.util.createClass(t.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(c){this.canvas=c,this.sprayChunks=[]},onMouseDown:function(c){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(c),this.render(this.sprayChunkPoints)},onMouseMove:function(c){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(c)||(this.addSprayChunk(c),this.render(this.sprayChunkPoints))},onMouseUp:function(){var c=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var i=[],l=0,o=this.sprayChunks.length;l<o;l++)for(var r=this.sprayChunks[l],n=0,e=r.length;n<e;n++){var a=new t.Rect({width:r[n].width,height:r[n].width,left:r[n].x+1,top:r[n].y+1,originX:"center",originY:"center",fill:this.color});i.push(a)}this.optimizeOverlapping&&(i=this._getOptimizedRects(i));var h=new t.Group(i);this.shadow&&h.set("shadow",new t.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:h}),this.canvas.add(h),this.canvas.fire("path:created",{path:h}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=c,this.canvas.requestRenderAll()},_getOptimizedRects:function(c){var i={},l,o,r;for(o=0,r=c.length;o<r;o++)l=c[o].left+""+c[o].top,i[l]||(i[l]=c[o]);var n=[];for(l in i)n.push(i[l]);return n},render:function(c){var i=this.canvas.contextTop,l,o;for(i.fillStyle=this.color,this._saveAndTransform(i),l=0,o=c.length;l<o;l++){var r=c[l];typeof r.opacity<"u"&&(i.globalAlpha=r.opacity),i.fillRect(r.x,r.y,r.width,r.width)}i.restore()},_render:function(){var c=this.canvas.contextTop,i,l;for(c.fillStyle=this.color,this._saveAndTransform(c),i=0,l=this.sprayChunks.length;i<l;i++)this.render(this.sprayChunks[i]);c.restore()},addSprayChunk:function(c){this.sprayChunkPoints=[];var i,l,o,r=this.width/2,n;for(n=0;n<this.density;n++){i=t.util.getRandomInt(c.x-r,c.x+r),l=t.util.getRandomInt(c.y-r,c.y+r),this.dotWidthVariance?o=t.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):o=this.dotWidth;var e=new t.Point(i,l);e.width=o,this.randomOpacity&&(e.opacity=t.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(e)}this.sprayChunks.push(this.sprayChunkPoints)}}),t.PatternBrush=t.util.createClass(t.PencilBrush,{getPatternSrc:function(){var c=20,i=5,l=t.util.createCanvasElement(),o=l.getContext("2d");return l.width=l.height=c+i,o.fillStyle=this.color,o.beginPath(),o.arc(c/2,c/2,c/2,0,Math.PI*2,!1),o.closePath(),o.fill(),l},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(c){return c.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(c){this.callSuper("_setBrushStyles",c),c.strokeStyle=this.getPattern(c)},createPath:function(c){var i=this.callSuper("createPath",c),l=i._getLeftTopCoords().scalarAdd(i.strokeWidth/2);return i.stroke=new t.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-l.x,offsetY:-l.y}),i}}),function(){var c=t.util.getPointer,i=t.util.degreesToRadians,l=t.util.isTouchEvent;t.Canvas=t.util.createClass(t.StaticCanvas,{initialize:function(r,n){n||(n={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(r,n),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=t.PencilBrush&&new t.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var r=this.getActiveObjects(),n,e,a;if(r.length>0&&!this.preserveObjectStacking){e=[],a=[];for(var h=0,s=this._objects.length;h<s;h++)n=this._objects[h],r.indexOf(n)===-1?e.push(n):a.push(n);r.length>1&&(this._activeObject._objects=a),e.push.apply(e,a)}else e=this._objects;return e},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var r=this.contextContainer;return this.renderCanvas(r,this._chooseObjectsToRender()),this},renderTopLayer:function(r){r.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(r),this.contextTopDirty=!0),r.restore()},renderTop:function(){var r=this.contextTop;return this.clearContext(r),this.renderTopLayer(r),this.fire("after:render"),this},_normalizePointer:function(r,n){var e=r.calcTransformMatrix(),a=t.util.invertTransform(e),h=this.restorePointerVpt(n);return t.util.transformPoint(h,a)},isTargetTransparent:function(r,n,e){if(r.shouldCache()&&r._cacheCanvas&&r!==this._activeObject){var a=this._normalizePointer(r,{x:n,y:e}),h=Math.max(r.cacheTranslationX+a.x*r.zoomX,0),s=Math.max(r.cacheTranslationY+a.y*r.zoomY,0),p=t.util.isTransparent(r._cacheContext,Math.round(h),Math.round(s),this.targetFindTolerance);return p}var u=this.contextCache,d=r.selectionBackgroundColor,m=this.viewportTransform;r.selectionBackgroundColor="",this.clearContext(u),u.save(),u.transform(m[0],m[1],m[2],m[3],m[4],m[5]),r.render(u),u.restore(),r.selectionBackgroundColor=d;var p=t.util.isTransparent(u,n,e,this.targetFindTolerance);return p},_isSelectionKeyPressed:function(r){var n=!1;return Array.isArray(this.selectionKey)?n=!!this.selectionKey.find(function(e){return r[e]===!0}):n=r[this.selectionKey],n},_shouldClearSelection:function(r,n){var e=this.getActiveObjects(),a=this._activeObject;return!n||n&&a&&e.length>1&&e.indexOf(n)===-1&&a!==n&&!this._isSelectionKeyPressed(r)||n&&!n.evented||n&&!n.selectable&&a&&a!==n},_shouldCenterTransform:function(r,n,e){if(r){var a;return n==="scale"||n==="scaleX"||n==="scaleY"||n==="resizing"?a=this.centeredScaling||r.centeredScaling:n==="rotate"&&(a=this.centeredRotation||r.centeredRotation),a?!e:e}},_getOriginFromCorner:function(r,n){var e={x:r.originX,y:r.originY};return n==="ml"||n==="tl"||n==="bl"?e.x="right":(n==="mr"||n==="tr"||n==="br")&&(e.x="left"),n==="tl"||n==="mt"||n==="tr"?e.y="bottom":(n==="bl"||n==="mb"||n==="br")&&(e.y="top"),e},_getActionFromCorner:function(r,n,e,a){if(!n||!r)return"drag";var h=a.controls[n];return h.getActionName(e,h,a)},_setupCurrentTransform:function(r,n,e){if(n){var a=this.getPointer(r),h=n.__corner,s=n.controls[h],u=e&&h?s.getActionHandler(r,n,s):t.controlsUtils.dragHandler,d=this._getActionFromCorner(e,h,r,n),m=this._getOriginFromCorner(n,h),p=r[this.centeredKey],y={target:n,action:d,actionHandler:u,corner:h,scaleX:n.scaleX,scaleY:n.scaleY,skewX:n.skewX,skewY:n.skewY,offsetX:a.x-n.left,offsetY:a.y-n.top,originX:m.x,originY:m.y,ex:a.x,ey:a.y,lastX:a.x,lastY:a.y,theta:i(n.angle),width:n.width*n.scaleX,shiftKey:r.shiftKey,altKey:p,original:t.util.saveObjectTransform(n)};this._shouldCenterTransform(n,d,p)&&(y.originX="center",y.originY="center"),y.original.originX=m.x,y.original.originY=m.y,this._currentTransform=y,this._beforeTransform(r)}},setCursor:function(r){this.upperCanvasEl.style.cursor=r},_drawSelection:function(r){var n=this._groupSelector,e=new t.Point(n.ex,n.ey),a=t.util.transformPoint(e,this.viewportTransform),h=new t.Point(n.ex+n.left,n.ey+n.top),s=t.util.transformPoint(h,this.viewportTransform),u=Math.min(a.x,s.x),d=Math.min(a.y,s.y),m=Math.max(a.x,s.x),p=Math.max(a.y,s.y),y=this.selectionLineWidth/2;this.selectionColor&&(r.fillStyle=this.selectionColor,r.fillRect(u,d,m-u,p-d)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(r.lineWidth=this.selectionLineWidth,r.strokeStyle=this.selectionBorderColor,u+=y,d+=y,m-=y,p-=y,t.Object.prototype._setLineDash.call(this,r,this.selectionDashArray),r.strokeRect(u,d,m-u,p-d))},findTarget:function(r,n){if(!this.skipTargetFind){var e=!0,a=this.getPointer(r,e),h=this._activeObject,s=this.getActiveObjects(),u,d,m=l(r),p=s.length>1&&!n||s.length===1;if(this.targets=[],p&&h._findTargetCorner(a,m)||s.length>1&&!n&&h===this._searchPossibleTargets([h],a))return h;if(s.length===1&&h===this._searchPossibleTargets([h],a))if(this.preserveObjectStacking)u=h,d=this.targets,this.targets=[];else return h;var y=this._searchPossibleTargets(this._objects,a);return r[this.altSelectionKey]&&y&&u&&y!==u&&(y=u,this.targets=d),y}},_checkTarget:function(r,n,e){if(n&&n.visible&&n.evented&&n.containsPoint(r))if((this.perPixelTargetFind||n.perPixelTargetFind)&&!n.isEditing){var a=this.isTargetTransparent(n,e.x,e.y);if(!a)return!0}else return!0},_searchPossibleTargets:function(r,n){for(var e,a=r.length,h;a--;){var s=r[a],u=s.group?this._normalizePointer(s.group,n):n;if(this._checkTarget(u,s,n)){e=r[a],e.subTargetCheck&&e instanceof t.Group&&(h=this._searchPossibleTargets(e._objects,n),h&&this.targets.push(h));break}}return e},restorePointerVpt:function(r){return t.util.transformPoint(r,t.util.invertTransform(this.viewportTransform))},getPointer:function(r,n){if(this._absolutePointer&&!n)return this._absolutePointer;if(this._pointer&&n)return this._pointer;var e=c(r),a=this.upperCanvasEl,h=a.getBoundingClientRect(),s=h.width||0,u=h.height||0,d;(!s||!u)&&("top"in h&&"bottom"in h&&(u=Math.abs(h.top-h.bottom)),"right"in h&&"left"in h&&(s=Math.abs(h.right-h.left))),this.calcOffset(),e.x=e.x-this._offset.left,e.y=e.y-this._offset.top,n||(e=this.restorePointerVpt(e));var m=this.getRetinaScaling();return m!==1&&(e.x/=m,e.y/=m),s===0||u===0?d={width:1,height:1}:d={width:a.width/s,height:a.height/u},{x:e.x*d.width,y:e.y*d.height}},_createUpperCanvas:function(){var r=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),n=this.lowerCanvasEl,e=this.upperCanvasEl;e?e.className="":(e=this._createCanvasElement(),this.upperCanvasEl=e),t.util.addClass(e,"upper-canvas "+r),this.wrapperEl.appendChild(e),this._copyCanvasStyle(n,e),this._applyCanvasStyle(e),this.contextTop=e.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=t.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),t.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),t.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(r){var n=this.width||r.width,e=this.height||r.height;t.util.setStyle(r,{position:"absolute",width:n+"px",height:e+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),r.width=n,r.height=e,t.util.makeElementUnselectable(r)},_copyCanvasStyle:function(r,n){n.style.cssText=r.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var r=this._activeObject;return r?r.type==="activeSelection"&&r._objects?r._objects.slice(0):[r]:[]},_onObjectRemoved:function(r){r===this._activeObject&&(this.fire("before:selection:cleared",{target:r}),this._discardActiveObject(),this.fire("selection:cleared",{target:r}),r.fire("deselected")),r===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",r)},_fireSelectionEvents:function(r,n){var e=!1,a=this.getActiveObjects(),h=[],s=[];r.forEach(function(u){a.indexOf(u)===-1&&(e=!0,u.fire("deselected",{e:n,target:u}),s.push(u))}),a.forEach(function(u){r.indexOf(u)===-1&&(e=!0,u.fire("selected",{e:n,target:u}),h.push(u))}),r.length>0&&a.length>0?e&&this.fire("selection:updated",{e:n,selected:h,deselected:s}):a.length>0?this.fire("selection:created",{e:n,selected:h}):r.length>0&&this.fire("selection:cleared",{e:n,deselected:s})},setActiveObject:function(r,n){var e=this.getActiveObjects();return this._setActiveObject(r,n),this._fireSelectionEvents(e,n),this},_setActiveObject:function(r,n){return this._activeObject===r||!this._discardActiveObject(n,r)||r.onSelect({e:n})?!1:(this._activeObject=r,!0)},_discardActiveObject:function(r,n){var e=this._activeObject;if(e){if(e.onDeselect({e:r,object:n}))return!1;this._activeObject=null}return!0},discardActiveObject:function(r){var n=this.getActiveObjects(),e=this.getActiveObject();return n.length&&this.fire("before:selection:cleared",{target:e,e:r}),this._discardActiveObject(r),this._fireSelectionEvents(n,r),this},dispose:function(){var r=this.wrapperEl;return this.removeListeners(),r.removeChild(this.upperCanvasEl),r.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(n){t.util.cleanUpJsdomNode(this[n]),this[n]=void 0}.bind(this)),r.parentNode&&r.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,t.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(r){var n=this._activeObject;n&&n._renderControls(r)},_toObject:function(r,n,e){var a=this._realizeGroupTransformOnObject(r),h=this.callSuper("_toObject",r,n,e);return this._unwindGroupTransformOnObject(r,a),h},_realizeGroupTransformOnObject:function(r){if(r.group&&r.group.type==="activeSelection"&&this._activeObject===r.group){var n=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],e={};return n.forEach(function(a){e[a]=r[a]}),t.util.addTransformToObject(r,this._activeObject.calcOwnMatrix()),e}else return null},_unwindGroupTransformOnObject:function(r,n){n&&r.set(n)},_setSVGObject:function(r,n,e){var a=this._realizeGroupTransformOnObject(n);this.callSuper("_setSVGObject",r,n,e),this._unwindGroupTransformOnObject(n,a)},setViewportTransform:function(r){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),t.StaticCanvas.prototype.setViewportTransform.call(this,r)}});for(var o in t.StaticCanvas)o!=="prototype"&&(t.Canvas[o]=t.StaticCanvas[o])}(),function(){var c=t.util.addListener,i=t.util.removeListener,l=3,o=2,r=1,n={passive:!1};function e(a,h){return a.button&&a.button===h-1}t.util.object.extend(t.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(c,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(a,h){var s=this.upperCanvasEl,u=this._getEventPrefix();a(t.window,"resize",this._onResize),a(s,u+"down",this._onMouseDown),a(s,u+"move",this._onMouseMove,n),a(s,u+"out",this._onMouseOut),a(s,u+"enter",this._onMouseEnter),a(s,"wheel",this._onMouseWheel),a(s,"contextmenu",this._onContextMenu),a(s,"dblclick",this._onDoubleClick),a(s,"dragover",this._onDragOver),a(s,"dragenter",this._onDragEnter),a(s,"dragleave",this._onDragLeave),a(s,"drop",this._onDrop),this.enablePointerEvents||a(s,"touchstart",this._onTouchStart,n),typeof eventjs<"u"&&h in eventjs&&(eventjs[h](s,"gesture",this._onGesture),eventjs[h](s,"drag",this._onDrag),eventjs[h](s,"orientation",this._onOrientationChange),eventjs[h](s,"shake",this._onShake),eventjs[h](s,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(i,"remove");var a=this._getEventPrefix();i(t.document,a+"up",this._onMouseUp),i(t.document,"touchend",this._onTouchEnd,n),i(t.document,a+"move",this._onMouseMove,n),i(t.document,"touchmove",this._onMouseMove,n)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(a,h){this.__onTransformGesture&&this.__onTransformGesture(a,h)},_onDrag:function(a,h){this.__onDrag&&this.__onDrag(a,h)},_onMouseWheel:function(a){this.__onMouseWheel(a)},_onMouseOut:function(a){var h=this._hoveredTarget;this.fire("mouse:out",{target:h,e:a}),this._hoveredTarget=null,h&&h.fire("mouseout",{e:a});var s=this;this._hoveredTargets.forEach(function(u){s.fire("mouse:out",{target:h,e:a}),u&&h.fire("mouseout",{e:a})}),this._hoveredTargets=[]},_onMouseEnter:function(a){!this._currentTransform&&!this.findTarget(a)&&(this.fire("mouse:over",{target:null,e:a}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(a,h){this.__onOrientationChange&&this.__onOrientationChange(a,h)},_onShake:function(a,h){this.__onShake&&this.__onShake(a,h)},_onLongPress:function(a,h){this.__onLongPress&&this.__onLongPress(a,h)},_onDragOver:function(a){a.preventDefault();var h=this._simpleEventHandler("dragover",a);this._fireEnterLeaveEvents(h,a)},_onDrop:function(a){return this._simpleEventHandler("drop:before",a),this._simpleEventHandler("drop",a)},_onContextMenu:function(a){return this.stopContextMenu&&(a.stopPropagation(),a.preventDefault()),!1},_onDoubleClick:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"dblclick"),this._resetTransformEventData(a)},getPointerId:function(a){var h=a.changedTouches;return h?h[0]&&h[0].identifier:this.enablePointerEvents?a.pointerId:-1},_isMainEvent:function(a){return a.isPrimary===!0?!0:a.isPrimary===!1?!1:a.type==="touchend"&&a.touches.length===0?!0:a.changedTouches?a.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(a){a.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(a)),this.__onMouseDown(a),this._resetTransformEventData();var h=this.upperCanvasEl,s=this._getEventPrefix();c(t.document,"touchend",this._onTouchEnd,n),c(t.document,"touchmove",this._onMouseMove,n),i(h,s+"down",this._onMouseDown)},_onMouseDown:function(a){this.__onMouseDown(a),this._resetTransformEventData();var h=this.upperCanvasEl,s=this._getEventPrefix();i(h,s+"move",this._onMouseMove,n),c(t.document,s+"up",this._onMouseUp),c(t.document,s+"move",this._onMouseMove,n)},_onTouchEnd:function(a){if(!(a.touches.length>0)){this.__onMouseUp(a),this._resetTransformEventData(),this.mainTouchId=null;var h=this._getEventPrefix();i(t.document,"touchend",this._onTouchEnd,n),i(t.document,"touchmove",this._onMouseMove,n);var s=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){c(s.upperCanvasEl,h+"down",s._onMouseDown),s._willAddMouseDown=0},400)}},_onMouseUp:function(a){this.__onMouseUp(a),this._resetTransformEventData();var h=this.upperCanvasEl,s=this._getEventPrefix();this._isMainEvent(a)&&(i(t.document,s+"up",this._onMouseUp),i(t.document,s+"move",this._onMouseMove,n),c(h,s+"move",this._onMouseMove,n))},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault(),this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a){var h=this._activeObject;return!!h!=!!a||h&&a&&h!==a?!0:(h&&h.isEditing,!1)},__onMouseUp:function(a){var h,s=this._currentTransform,u=this._groupSelector,d=!1,m=!u||u.left===0&&u.top===0;if(this._cacheTransformEventData(a),h=this._target,this._handleEvent(a,"up:before"),e(a,l)){this.fireRightClick&&this._handleEvent(a,"up",l,m);return}if(e(a,o)){this.fireMiddleClick&&this._handleEvent(a,"up",o,m),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(a);return}if(this._isMainEvent(a)){if(s&&(this._finalizeCurrentTransform(a),d=s.actionPerformed),!m){var p=h===this._activeObject;this._maybeGroupObjects(a),d||(d=this._shouldRender(h)||!p&&h===this._activeObject)}var y,w;if(h){if(y=h._findTargetCorner(this.getPointer(a,!0),t.util.isTouchEvent(a)),h.selectable&&h!==this._activeObject&&h.activeOn==="up")this.setActiveObject(h,a),d=!0;else{var S=h.controls[y],E=S&&S.getMouseUpHandler(a,h,S);E&&(w=this.getPointer(a),E(a,s,w.x,w.y))}h.isMoving=!1}if(s&&(s.target!==h||s.corner!==y)){var D=s.target&&s.target.controls[s.corner],W=D&&D.getMouseUpHandler(a,h,S);w=w||this.getPointer(a),W&&W(a,s,w.x,w.y)}this._setCursorFromEvent(a,h),this._handleEvent(a,"up",r,m),this._groupSelector=null,this._currentTransform=null,h&&(h.__corner=0),d?this.requestRenderAll():m||this.renderTop()}},_simpleEventHandler:function(a,h){var s=this.findTarget(h),u=this.targets,d={e:h,target:s,subTargets:u};if(this.fire(a,d),s&&s.fire(a,d),!u)return s;for(var m=0;m<u.length;m++)u[m].fire(a,d);return s},_handleEvent:function(a,h,s,u){var d=this._target,m=this.targets||[],p={e:a,target:d,subTargets:m,button:s||r,isClick:u||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};h==="up"&&(p.currentTarget=this.findTarget(a),p.currentSubTargets=this.targets),this.fire("mouse:"+h,p),d&&d.fire("mouse"+h,p);for(var y=0;y<m.length;y++)m[y].fire("mouse"+h,p)},_finalizeCurrentTransform:function(a){var h=this._currentTransform,s=h.target,u={e:a,target:s,transform:h,action:h.action};s._scaling&&(s._scaling=!1),s.setCoords(),(h.actionPerformed||this.stateful&&s.hasStateChanged())&&this._fire("modified",u)},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(a).requestRenderAll();var h=this.getPointer(a);this.freeDrawingBrush.onMouseDown(h,{e:a,pointer:h}),this._handleEvent(a,"down")},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var h=this.getPointer(a);this.freeDrawingBrush.onMouseMove(h,{e:a,pointer:h})}this.setCursor(this.freeDrawingCursor),this._handleEvent(a,"move")},_onMouseUpInDrawingMode:function(a){var h=this.getPointer(a);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:a,pointer:h}),this._handleEvent(a,"up")},__onMouseDown:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"down:before");var h=this._target;if(e(a,l)){this.fireRightClick&&this._handleEvent(a,"down",l);return}if(e(a,o)){this.fireMiddleClick&&this._handleEvent(a,"down",o);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(a);return}if(this._isMainEvent(a)&&!this._currentTransform){var s=this._pointer;this._previousPointer=s;var u=this._shouldRender(h),d=this._shouldGroup(a,h);if(this._shouldClearSelection(a,h)?this.discardActiveObject(a):d&&(this._handleGrouping(a,h),h=this._activeObject),this.selection&&(!h||!h.selectable&&!h.isEditing&&h!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),h){var m=h===this._activeObject;h.selectable&&h.activeOn==="down"&&this.setActiveObject(h,a);var p=h._findTargetCorner(this.getPointer(a,!0),t.util.isTouchEvent(a));if(h.__corner=p,h===this._activeObject&&(p||!d)){this._setupCurrentTransform(a,h,m);var y=h.controls[p],s=this.getPointer(a),w=y&&y.getMouseDownHandler(a,h,y);w&&w(a,this._currentTransform,s.x,s.y)}}this._handleEvent(a,"down"),(u||d)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(a){this._resetTransformEventData(),this._pointer=this.getPointer(a,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(a)||null},_beforeTransform:function(a){var h=this._currentTransform;this.stateful&&h.target.saveState(),this.fire("before:transform",{e:a,transform:h})},__onMouseMove:function(a){this._handleEvent(a,"move:before"),this._cacheTransformEventData(a);var h,s;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(a);return}if(this._isMainEvent(a)){var u=this._groupSelector;u?(s=this._absolutePointer,u.left=s.x-u.ex,u.top=s.y-u.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(h=this.findTarget(a)||null,this._setCursorFromEvent(a,h),this._fireOverOutEvents(h,a)),this._handleEvent(a,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(a,h){var s=this._hoveredTarget,u=this._hoveredTargets,d=this.targets,m=Math.max(u.length,d.length);this.fireSyntheticInOutEvents(a,h,{oldTarget:s,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var p=0;p<m;p++)this.fireSyntheticInOutEvents(d[p],h,{oldTarget:u[p],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=a,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(a,h){var s=this._draggedoverTarget,u=this._hoveredTargets,d=this.targets,m=Math.max(u.length,d.length);this.fireSyntheticInOutEvents(a,h,{oldTarget:s,evtOut:"dragleave",evtIn:"dragenter"});for(var p=0;p<m;p++)this.fireSyntheticInOutEvents(d[p],h,{oldTarget:u[p],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=a},fireSyntheticInOutEvents:function(a,h,s){var u,d,m=s.oldTarget,p,y,w=m!==a,S=s.canvasEvtIn,E=s.canvasEvtOut;w&&(u={e:h,target:a,previousTarget:m},d={e:h,target:m,nextTarget:a}),y=a&&w,p=m&&w,p&&(E&&this.fire(E,d),m.fire(s.evtOut,d)),y&&(S&&this.fire(S,u),a.fire(s.evtIn,u))},__onMouseWheel:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"wheel"),this._resetTransformEventData()},_transformObject:function(a){var h=this.getPointer(a),s=this._currentTransform;s.reset=!1,s.shiftKey=a.shiftKey,s.altKey=a[this.centeredKey],this._performTransformAction(a,s,h),s.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(a,h,s){var u=s.x,d=s.y,m=h.action,p=!1,y=h.actionHandler;y&&(p=y(a,h,u,d)),m==="drag"&&p&&(h.target.isMoving=!0,this.setCursor(h.target.moveCursor||this.moveCursor)),h.actionPerformed=h.actionPerformed||p},_fire:t.controlsUtils.fireEvent,_setCursorFromEvent:function(a,h){if(!h)return this.setCursor(this.defaultCursor),!1;var s=h.hoverCursor||this.hoverCursor,u=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,d=(!u||!u.contains(h))&&h._findTargetCorner(this.getPointer(a,!0));d?this.setCursor(this.getCornerCursor(d,h,a)):(h.subTargetCheck&&this.targets.concat().reverse().map(function(m){s=m.hoverCursor||s}),this.setCursor(s))},getCornerCursor:function(a,h,s){var u=h.controls[a];return u.cursorStyleHandler(s,u,h)}})}(),function(){var c=Math.min,i=Math.max;t.util.object.extend(t.Canvas.prototype,{_shouldGroup:function(l,o){var r=this._activeObject;return r&&this._isSelectionKeyPressed(l)&&o&&o.selectable&&this.selection&&(r!==o||r.type==="activeSelection")&&!o.onSelect({e:l})},_handleGrouping:function(l,o){var r=this._activeObject;r.__corner||o===r&&(o=this.findTarget(l,!0),!o||!o.selectable)||(r&&r.type==="activeSelection"?this._updateActiveSelection(o,l):this._createActiveSelection(o,l))},_updateActiveSelection:function(l,o){var r=this._activeObject,n=r._objects.slice(0);r.contains(l)?(r.removeWithUpdate(l),this._hoveredTarget=l,this._hoveredTargets=this.targets.concat(),r.size()===1&&this._setActiveObject(r.item(0),o)):(r.addWithUpdate(l),this._hoveredTarget=r,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(n,o)},_createActiveSelection:function(l,o){var r=this.getActiveObjects(),n=this._createGroup(l);this._hoveredTarget=n,this._setActiveObject(n,o),this._fireSelectionEvents(r,o)},_createGroup:function(l){var o=this._objects,r=o.indexOf(this._activeObject)<o.indexOf(l),n=r?[this._activeObject,l]:[l,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new t.ActiveSelection(n,{canvas:this})},_groupSelectedObjects:function(l){var o=this._collectObjects(l),r;o.length===1?this.setActiveObject(o[0],l):o.length>1&&(r=new t.ActiveSelection(o.reverse(),{canvas:this}),this.setActiveObject(r,l))},_collectObjects:function(l){for(var o=[],r,n=this._groupSelector.ex,e=this._groupSelector.ey,a=n+this._groupSelector.left,h=e+this._groupSelector.top,s=new t.Point(c(n,a),c(e,h)),u=new t.Point(i(n,a),i(e,h)),d=!this.selectionFullyContained,m=n===a&&e===h,p=this._objects.length;p--&&(r=this._objects[p],!(!(!r||!r.selectable||!r.visible)&&(d&&r.intersectsWithRect(s,u,!0)||r.isContainedWithinRect(s,u,!0)||d&&r.containsPoint(s,null,!0)||d&&r.containsPoint(u,null,!0))&&(o.push(r),m))););return o.length>1&&(o=o.filter(function(y){return!y.onSelect({e:l})})),o},_maybeGroupObjects:function(l){this.selection&&this._groupSelector&&this._groupSelectedObjects(l),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){t.util.object.extend(t.StaticCanvas.prototype,{toDataURL:function(c){c||(c={});var i=c.format||"png",l=c.quality||1,o=(c.multiplier||1)*(c.enableRetinaScaling?this.getRetinaScaling():1),r=this.toCanvasElement(o,c);return t.util.toDataURL(r,i,l)},toCanvasElement:function(c,i){c=c||1,i=i||{};var l=(i.width||this.width)*c,o=(i.height||this.height)*c,r=this.getZoom(),n=this.width,e=this.height,a=r*c,h=this.viewportTransform,s=(h[4]-(i.left||0))*c,u=(h[5]-(i.top||0))*c,d=this.interactive,m=[a,0,0,a,s,u],p=this.enableRetinaScaling,y=t.util.createCanvasElement(),w=this.contextTop;return y.width=l,y.height=o,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=m,this.width=l,this.height=o,this.calcViewportBoundaries(),this.renderCanvas(y.getContext("2d"),this._objects),this.viewportTransform=h,this.width=n,this.height=e,this.calcViewportBoundaries(),this.interactive=d,this.enableRetinaScaling=p,this.contextTop=w,y}})}(),t.util.object.extend(t.StaticCanvas.prototype,{loadFromJSON:function(c,i,l){if(c){var o=typeof c=="string"?JSON.parse(c):t.util.object.clone(c),r=this,n=o.clipPath,e=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete o.clipPath,this._enlivenObjects(o.objects,function(a){r.clear(),r._setBgOverlay(o,function(){n?r._enlivenObjects([n],function(h){r.clipPath=h[0],r.__setupCanvas.call(r,o,a,e,i)}):r.__setupCanvas.call(r,o,a,e,i)})},l),this}},__setupCanvas:function(c,i,l,o){var r=this;i.forEach(function(n,e){r.insertAt(n,e)}),this.renderOnAddRemove=l,delete c.objects,delete c.backgroundImage,delete c.overlayImage,delete c.background,delete c.overlay,this._setOptions(c),this.renderAll(),o&&o()},_setBgOverlay:function(c,i){var l={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!c.backgroundImage&&!c.overlayImage&&!c.background&&!c.overlay){i&&i();return}var o=function(){l.backgroundImage&&l.overlayImage&&l.backgroundColor&&l.overlayColor&&i&&i()};this.__setBgOverlay("backgroundImage",c.backgroundImage,l,o),this.__setBgOverlay("overlayImage",c.overlayImage,l,o),this.__setBgOverlay("backgroundColor",c.background,l,o),this.__setBgOverlay("overlayColor",c.overlay,l,o)},__setBgOverlay:function(c,i,l,o){var r=this;if(!i){l[c]=!0,o&&o();return}c==="backgroundImage"||c==="overlayImage"?t.util.enlivenObjects([i],function(n){r[c]=n[0],l[c]=!0,o&&o()}):this["set"+t.util.string.capitalize(c,!0)](i,function(){l[c]=!0,o&&o()})},_enlivenObjects:function(c,i,l){if(!c||c.length===0){i&&i([]);return}t.util.enlivenObjects(c,function(o){i&&i(o)},null,l)},_toDataURL:function(c,i){this.clone(function(l){i(l.toDataURL(c))})},_toDataURLWithMultiplier:function(c,i,l){this.clone(function(o){l(o.toDataURLWithMultiplier(c,i))})},clone:function(c,i){var l=JSON.stringify(this.toJSON(i));this.cloneWithoutData(function(o){o.loadFromJSON(l,function(){c&&c(o)})})},cloneWithoutData:function(c){var i=t.util.createCanvasElement();i.width=this.width,i.height=this.height;var l=new t.Canvas(i);this.backgroundImage?(l.setBackgroundImage(this.backgroundImage.src,function(){l.renderAll(),c&&c(l)}),l.backgroundImageOpacity=this.backgroundImageOpacity,l.backgroundImageStretch=this.backgroundImageStretch):c&&c(l)}}),function(c){var i=c.fabric||(c.fabric={}),l=i.util.object.extend,o=i.util.object.clone,r=i.util.toFixed,n=i.util.string.capitalize,e=i.util.degreesToRadians,a=!i.isLikelyNode,h=2;i.Object||(i.Object=i.util.createClass(i.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:a,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(s){s&&this.setOptions(s)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=i.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(s){var u=i.perfLimitSizeTotal,d=s.width,m=s.height,p=i.maxCacheSideLimit,y=i.minCacheSideLimit;if(d<=p&&m<=p&&d*m<=u)return d<y&&(s.width=y),m<y&&(s.height=y),s;var w=d/m,S=i.util.limitDimsByArea(w,u),E=i.util.capValue,D=E(y,S.x,p),W=E(y,S.y,p);return d>D&&(s.zoomX/=d/D,s.width=D,s.capped=!0),m>W&&(s.zoomY/=m/W,s.height=W,s.capped=!0),s},_getCacheCanvasDimensions:function(){var s=this.getTotalObjectScaling(),u=this._getTransformedDimensions(0,0),d=u.x*s.scaleX/this.scaleX,m=u.y*s.scaleY/this.scaleY;return{width:d+h,height:m+h,zoomX:s.scaleX,zoomY:s.scaleY,x:d,y:m}},_updateCacheCanvas:function(){var s=this.canvas;if(this.noScaleCache&&s&&s._currentTransform){var u=s._currentTransform.target,d=s._currentTransform.action;if(this===u&&d.slice&&d.slice(0,5)==="scale")return!1}var m=this._cacheCanvas,p=this._limitCacheSize(this._getCacheCanvasDimensions()),y=i.minCacheSideLimit,w=p.width,S=p.height,E,D,W=p.zoomX,K=p.zoomY,tt=w!==this.cacheWidth||S!==this.cacheHeight,N=this.zoomX!==W||this.zoomY!==K,J=tt||N,$=0,Z=0,rt=!1;if(tt){var st=this._cacheCanvas.width,T=this._cacheCanvas.height,A=w>st||S>T,P=(w<st*.9||S<T*.9)&&st>y&&T>y;rt=A||P,A&&!p.capped&&(w>y||S>y)&&($=w*.1,Z=S*.1)}return this instanceof i.Text&&this.path&&(J=!0,rt=!0,$+=this.getHeightOfLine(0)*this.zoomX,Z+=this.getHeightOfLine(0)*this.zoomY),J?(rt?(m.width=Math.ceil(w+$),m.height=Math.ceil(S+Z)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,m.width,m.height)),E=p.x/2,D=p.y/2,this.cacheTranslationX=Math.round(m.width/2-E)+E,this.cacheTranslationY=Math.round(m.height/2-D)+D,this.cacheWidth=w,this.cacheHeight=S,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(W,K),this.zoomX=W,this.zoomY=K,!0):!1},setOptions:function(s){this._setOptions(s),this._initGradient(s.fill,"fill"),this._initGradient(s.stroke,"stroke"),this._initPattern(s.fill,"fill"),this._initPattern(s.stroke,"stroke")},transform:function(s){var u=this.group&&!this.group._transformDone||this.group&&this.canvas&&s===this.canvas.contextTop,d=this.calcTransformMatrix(!u);s.transform(d[0],d[1],d[2],d[3],d[4],d[5])},toObject:function(s){var u=i.Object.NUM_FRACTION_DIGITS,d={type:this.type,version:i.version,originX:this.originX,originY:this.originY,left:r(this.left,u),top:r(this.top,u),width:r(this.width,u),height:r(this.height,u),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,u),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:r(this.strokeMiterLimit,u),scaleX:r(this.scaleX,u),scaleY:r(this.scaleY,u),angle:r(this.angle,u),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,u),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:r(this.skewX,u),skewY:r(this.skewY,u)};return this.clipPath&&!this.clipPath.excludeFromExport&&(d.clipPath=this.clipPath.toObject(s),d.clipPath.inverted=this.clipPath.inverted,d.clipPath.absolutePositioned=this.clipPath.absolutePositioned),i.util.populateWithProperties(this,d,s),this.includeDefaultValues||(d=this._removeDefaultValues(d)),d},toDatalessObject:function(s){return this.toObject(s)},_removeDefaultValues:function(s){var u=i.util.getKlass(s.type).prototype,d=u.stateProperties;return d.forEach(function(m){m==="left"||m==="top"||(s[m]===u[m]&&delete s[m],Array.isArray(s[m])&&Array.isArray(u[m])&&s[m].length===0&&u[m].length===0&&delete s[m])}),s},toString:function(){return"#<fabric."+n(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var s=i.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(s.scaleX),scaleY:Math.abs(s.scaleY)}},getTotalObjectScaling:function(){var s=this.getObjectScaling(),u=s.scaleX,d=s.scaleY;if(this.canvas){var m=this.canvas.getZoom(),p=this.canvas.getRetinaScaling();u*=m*p,d*=m*p}return{scaleX:u,scaleY:d}},getObjectOpacity:function(){var s=this.opacity;return this.group&&(s*=this.group.getObjectOpacity()),s},_set:function(s,u){var d=s==="scaleX"||s==="scaleY",m=this[s]!==u,p=!1;return d&&(u=this._constrainScale(u)),s==="scaleX"&&u<0?(this.flipX=!this.flipX,u*=-1):s==="scaleY"&&u<0?(this.flipY=!this.flipY,u*=-1):s==="shadow"&&u&&!(u instanceof i.Shadow)?u=new i.Shadow(u):s==="dirty"&&this.group&&this.group.set("dirty",u),this[s]=u,m&&(p=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(s)>-1?(this.dirty=!0,p&&this.group.set("dirty",!0)):p&&this.stateProperties.indexOf(s)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:i.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(s){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(s.save(),this._setupCompositeOperation(s),this.drawSelectionBackground(s),this.transform(s),this._setOpacity(s),this._setShadow(s,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(s)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(s),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),s.restore())},renderCache:function(s){s=s||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,s.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(s,u){if(s.save(),u.inverted?s.globalCompositeOperation="destination-out":s.globalCompositeOperation="destination-in",u.absolutePositioned){var d=i.util.invertTransform(this.calcTransformMatrix());s.transform(d[0],d[1],d[2],d[3],d[4],d[5])}u.transform(s),s.scale(1/u.zoomX,1/u.zoomY),s.drawImage(u._cacheCanvas,-u.cacheTranslationX,-u.cacheTranslationY),s.restore()},drawObject:function(s,u){var d=this.fill,m=this.stroke;u?(this.fill="black",this.stroke="",this._setClippingProperties(s)):this._renderBackground(s),this._render(s),this._drawClipPath(s,this.clipPath),this.fill=d,this.stroke=m},_drawClipPath:function(s,u){u&&(u.canvas=this.canvas,u.shouldCache(),u._transformDone=!0,u.renderCache({forClipping:!0}),this.drawClipPathOnCache(s,u))},drawCacheOnCanvas:function(s){s.scale(1/this.zoomX,1/this.zoomY),s.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(s){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!s&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!s){var u=this.cacheWidth/this.zoomX,d=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-u/2,-d/2,u,d)}return!0}return!1},_renderBackground:function(s){if(this.backgroundColor){var u=this._getNonTransformedDimensions();s.fillStyle=this.backgroundColor,s.fillRect(-u.x/2,-u.y/2,u.x,u.y),this._removeShadow(s)}},_setOpacity:function(s){this.group&&!this.group._transformDone?s.globalAlpha=this.getObjectOpacity():s.globalAlpha*=this.opacity},_setStrokeStyles:function(s,u){var d=u.stroke;d&&(s.lineWidth=u.strokeWidth,s.lineCap=u.strokeLineCap,s.lineDashOffset=u.strokeDashOffset,s.lineJoin=u.strokeLineJoin,s.miterLimit=u.strokeMiterLimit,d.toLive?d.gradientUnits==="percentage"||d.gradientTransform||d.patternTransform?this._applyPatternForTransformedGradient(s,d):(s.strokeStyle=d.toLive(s,this),this._applyPatternGradientTransform(s,d)):s.strokeStyle=u.stroke)},_setFillStyles:function(s,u){var d=u.fill;d&&(d.toLive?(s.fillStyle=d.toLive(s,this),this._applyPatternGradientTransform(s,u.fill)):s.fillStyle=d)},_setClippingProperties:function(s){s.globalAlpha=1,s.strokeStyle="transparent",s.fillStyle="#000000"},_setLineDash:function(s,u){!u||u.length===0||(1&u.length&&u.push.apply(u,u),s.setLineDash(u))},_renderControls:function(s,u){var d=this.getViewportTransform(),m=this.calcTransformMatrix(),p,y,w;u=u||{},y=typeof u.hasBorders<"u"?u.hasBorders:this.hasBorders,w=typeof u.hasControls<"u"?u.hasControls:this.hasControls,m=i.util.multiplyTransformMatrices(d,m),p=i.util.qrDecompose(m),s.save(),s.translate(p.translateX,p.translateY),s.lineWidth=1*this.borderScaleFactor,this.group||(s.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(p.angle-=180),s.rotate(e(this.group?p.angle:this.angle)),u.forActiveSelection||this.group?y&&this.drawBordersInGroup(s,p,u):y&&this.drawBorders(s,u),w&&this.drawControls(s,u),s.restore()},_setShadow:function(s){if(this.shadow){var u=this.shadow,d=this.canvas,m,p=d&&d.viewportTransform[0]||1,y=d&&d.viewportTransform[3]||1;u.nonScaling?m={scaleX:1,scaleY:1}:m=this.getObjectScaling(),d&&d._isRetinaScaling()&&(p*=i.devicePixelRatio,y*=i.devicePixelRatio),s.shadowColor=u.color,s.shadowBlur=u.blur*i.browserShadowBlurConstant*(p+y)*(m.scaleX+m.scaleY)/4,s.shadowOffsetX=u.offsetX*p*m.scaleX,s.shadowOffsetY=u.offsetY*y*m.scaleY}},_removeShadow:function(s){this.shadow&&(s.shadowColor="",s.shadowBlur=s.shadowOffsetX=s.shadowOffsetY=0)},_applyPatternGradientTransform:function(s,u){if(!u||!u.toLive)return{offsetX:0,offsetY:0};var d=u.gradientTransform||u.patternTransform,m=-this.width/2+u.offsetX||0,p=-this.height/2+u.offsetY||0;return u.gradientUnits==="percentage"?s.transform(this.width,0,0,this.height,m,p):s.transform(1,0,0,1,m,p),d&&s.transform(d[0],d[1],d[2],d[3],d[4],d[5]),{offsetX:m,offsetY:p}},_renderPaintInOrder:function(s){this.paintFirst==="stroke"?(this._renderStroke(s),this._renderFill(s)):(this._renderFill(s),this._renderStroke(s))},_render:function(){},_renderFill:function(s){this.fill&&(s.save(),this._setFillStyles(s,this),this.fillRule==="evenodd"?s.fill("evenodd"):s.fill(),s.restore())},_renderStroke:function(s){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(s),s.save(),this.strokeUniform&&this.group){var u=this.getObjectScaling();s.scale(1/u.scaleX,1/u.scaleY)}else this.strokeUniform&&s.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(s,this.strokeDashArray),this._setStrokeStyles(s,this),s.stroke(),s.restore()}},_applyPatternForTransformedGradient:function(s,u){var d=this._limitCacheSize(this._getCacheCanvasDimensions()),m=i.util.createCanvasElement(),p,y=this.canvas.getRetinaScaling(),w=d.x/this.scaleX/y,S=d.y/this.scaleY/y;m.width=w,m.height=S,p=m.getContext("2d"),p.beginPath(),p.moveTo(0,0),p.lineTo(w,0),p.lineTo(w,S),p.lineTo(0,S),p.closePath(),p.translate(w/2,S/2),p.scale(d.zoomX/this.scaleX/y,d.zoomY/this.scaleY/y),this._applyPatternGradientTransform(p,u),p.fillStyle=u.toLive(s),p.fill(),s.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),s.scale(y*this.scaleX/d.zoomX,y*this.scaleY/d.zoomY),s.strokeStyle=p.createPattern(m,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var s=i.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",s.scaleX),this.set("scaleY",s.scaleY),this.angle=s.angle,this.skewX=s.skewX,this.skewY=0}},_removeTransformMatrix:function(s){var u=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),u=i.util.transformPoint(u,this.transformMatrix)),this.transformMatrix=null,s&&(this.scaleX*=s.scaleX,this.scaleY*=s.scaleY,this.cropX=s.cropX,this.cropY=s.cropY,u.x+=s.offsetLeft,u.y+=s.offsetTop,this.width=s.width,this.height=s.height),this.setPositionByOrigin(u,"center","center")},clone:function(s,u){var d=this.toObject(u);this.constructor.fromObject?this.constructor.fromObject(d,s):i.Object._fromObject("Object",d,s)},cloneAsImage:function(s,u){var d=this.toCanvasElement(u);return s&&s(new i.Image(d)),this},toCanvasElement:function(s){s||(s={});var u=i.util,d=u.saveObjectTransform(this),m=this.group,p=this.shadow,y=Math.abs,w=(s.multiplier||1)*(s.enableRetinaScaling?i.devicePixelRatio:1);delete this.group,s.withoutTransform&&u.resetObjectTransform(this),s.withoutShadow&&(this.shadow=null);var S=i.util.createCanvasElement(),E=this.getBoundingRect(!0,!0),D=this.shadow,W,K={x:0,y:0},tt,N,J;D&&(tt=D.blur,D.nonScaling?W={scaleX:1,scaleY:1}:W=this.getObjectScaling(),K.x=2*Math.round(y(D.offsetX)+tt)*y(W.scaleX),K.y=2*Math.round(y(D.offsetY)+tt)*y(W.scaleY)),N=E.width+K.x,J=E.height+K.y,S.width=Math.ceil(N),S.height=Math.ceil(J);var $=new i.StaticCanvas(S,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});s.format==="jpeg"&&($.backgroundColor="#fff"),this.setPositionByOrigin(new i.Point($.width/2,$.height/2),"center","center");var Z=this.canvas;$.add(this);var rt=$.toCanvasElement(w||1,s);return this.shadow=p,this.set("canvas",Z),m&&(this.group=m),this.set(d).setCoords(),$._objects=[],$.dispose(),$=null,rt},toDataURL:function(s){return s||(s={}),i.util.toDataURL(this.toCanvasElement(s),s.format||"png",s.quality||1)},isType:function(s){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===s},complexity:function(){return 1},toJSON:function(s){return this.toObject(s)},rotate:function(s){var u=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return u&&this._setOriginToCenter(),this.set("angle",s),u&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(s,u){u=u||this.canvas.getPointer(s);var d=new i.Point(u.x,u.y),m=this._getLeftTopCoords();return this.angle&&(d=i.util.rotatePoint(d,m,e(-this.angle))),{x:d.x-m.x,y:d.y-m.y}},_setupCompositeOperation:function(s){this.globalCompositeOperation&&(s.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){i.runningAnimations&&i.runningAnimations.cancelByTarget(this)}}),i.util.createAccessors&&i.util.createAccessors(i.Object),l(i.Object.prototype,i.Observable),i.Object.NUM_FRACTION_DIGITS=2,i.Object.ENLIVEN_PROPS=["clipPath"],i.Object._fromObject=function(s,u,d,m){var p=i[s];u=o(u,!0),i.util.enlivenPatterns([u.fill,u.stroke],function(y){typeof y[0]<"u"&&(u.fill=y[0]),typeof y[1]<"u"&&(u.stroke=y[1]),i.util.enlivenObjectEnlivables(u,u,function(){var w=m?new p(u[m],u):new p(u);d&&d(w)})})},i.Object.__uid=0)}(f),function(){var c=t.util.degreesToRadians,i={left:-.5,center:0,right:.5},l={top:-.5,center:0,bottom:.5};t.util.object.extend(t.Object.prototype,{translateToGivenOrigin:function(o,r,n,e,a){var h=o.x,s=o.y,u,d,m;return typeof r=="string"?r=i[r]:r-=.5,typeof e=="string"?e=i[e]:e-=.5,u=e-r,typeof n=="string"?n=l[n]:n-=.5,typeof a=="string"?a=l[a]:a-=.5,d=a-n,(u||d)&&(m=this._getTransformedDimensions(),h=o.x+u*m.x,s=o.y+d*m.y),new t.Point(h,s)},translateToCenterPoint:function(o,r,n){var e=this.translateToGivenOrigin(o,r,n,"center","center");return this.angle?t.util.rotatePoint(e,o,c(this.angle)):e},translateToOriginPoint:function(o,r,n){var e=this.translateToGivenOrigin(o,"center","center",r,n);return this.angle?t.util.rotatePoint(e,o,c(this.angle)):e},getCenterPoint:function(){var o=new t.Point(this.left,this.top);return this.translateToCenterPoint(o,this.originX,this.originY)},getPointByOrigin:function(o,r){var n=this.getCenterPoint();return this.translateToOriginPoint(n,o,r)},toLocalPoint:function(o,r,n){var e=this.getCenterPoint(),a,h;return typeof r<"u"&&typeof n<"u"?a=this.translateToGivenOrigin(e,"center","center",r,n):a=new t.Point(this.left,this.top),h=new t.Point(o.x,o.y),this.angle&&(h=t.util.rotatePoint(h,e,-c(this.angle))),h.subtractEquals(a)},setPositionByOrigin:function(o,r,n){var e=this.translateToCenterPoint(o,r,n),a=this.translateToOriginPoint(e,this.originX,this.originY);this.set("left",a.x),this.set("top",a.y)},adjustPosition:function(o){var r=c(this.angle),n=this.getScaledWidth(),e=t.util.cos(r)*n,a=t.util.sin(r)*n,h,s;typeof this.originX=="string"?h=i[this.originX]:h=this.originX-.5,typeof o=="string"?s=i[o]:s=o-.5,this.left+=e*(s-h),this.top+=a*(s-h),this.setCoords(),this.originX=o},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var o=this.getCenterPoint();this.originX="center",this.originY="center",this.left=o.x,this.top=o.y},_resetOrigin:function(){var o=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=o.x,this.top=o.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function c(n){return[new t.Point(n.tl.x,n.tl.y),new t.Point(n.tr.x,n.tr.y),new t.Point(n.br.x,n.br.y),new t.Point(n.bl.x,n.bl.y)]}var i=t.util,l=i.degreesToRadians,o=i.multiplyTransformMatrices,r=i.transformPoint;i.object.extend(t.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(n,e){return e?n?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),n?this.aCoords:this.lineCoords)},getCoords:function(n,e){return c(this._getCoords(n,e))},intersectsWithRect:function(n,e,a,h){var s=this.getCoords(a,h),u=t.Intersection.intersectPolygonRectangle(s,n,e);return u.status==="Intersection"},intersectsWithObject:function(n,e,a){var h=t.Intersection.intersectPolygonPolygon(this.getCoords(e,a),n.getCoords(e,a));return h.status==="Intersection"||n.isContainedWithinObject(this,e,a)||this.isContainedWithinObject(n,e,a)},isContainedWithinObject:function(n,e,a){for(var h=this.getCoords(e,a),s=e?n.aCoords:n.lineCoords,u=0,d=n._getImageLines(s);u<4;u++)if(!n.containsPoint(h[u],d))return!1;return!0},isContainedWithinRect:function(n,e,a,h){var s=this.getBoundingRect(a,h);return s.left>=n.x&&s.left+s.width<=e.x&&s.top>=n.y&&s.top+s.height<=e.y},containsPoint:function(n,u,a,h){var s=this._getCoords(a,h),u=u||this._getImageLines(s),d=this._findCrossPoints(n,u);return d!==0&&d%2===1},isOnScreen:function(n){if(!this.canvas)return!1;var e=this.canvas.vptCoords.tl,a=this.canvas.vptCoords.br,h=this.getCoords(!0,n);return h.some(function(s){return s.x<=a.x&&s.x>=e.x&&s.y<=a.y&&s.y>=e.y})||this.intersectsWithRect(e,a,!0,n)?!0:this._containsCenterOfCanvas(e,a,n)},_containsCenterOfCanvas:function(n,e,a){var h={x:(n.x+e.x)/2,y:(n.y+e.y)/2};return!!this.containsPoint(h,null,!0,a)},isPartiallyOnScreen:function(n){if(!this.canvas)return!1;var e=this.canvas.vptCoords.tl,a=this.canvas.vptCoords.br;if(this.intersectsWithRect(e,a,!0,n))return!0;var h=this.getCoords(!0,n).every(function(s){return(s.x>=a.x||s.x<=e.x)&&(s.y>=a.y||s.y<=e.y)});return h&&this._containsCenterOfCanvas(e,a,n)},_getImageLines:function(n){var e={topline:{o:n.tl,d:n.tr},rightline:{o:n.tr,d:n.br},bottomline:{o:n.br,d:n.bl},leftline:{o:n.bl,d:n.tl}};return e},_findCrossPoints:function(n,e){var a,h,s,u,d,m=0,p;for(var y in e)if(p=e[y],!(p.o.y<n.y&&p.d.y<n.y)&&!(p.o.y>=n.y&&p.d.y>=n.y)&&(p.o.x===p.d.x&&p.o.x>=n.x?d=p.o.x:(a=0,h=(p.d.y-p.o.y)/(p.d.x-p.o.x),s=n.y-a*n.x,u=p.o.y-h*p.o.x,d=-(s-u)/(a-h)),d>=n.x&&(m+=1),m===2))break;return m},getBoundingRect:function(n,e){var a=this.getCoords(n,e);return i.makeBoundingBoxFromPoints(a)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(n){return Math.abs(n)<this.minScaleLimit?n<0?-this.minScaleLimit:this.minScaleLimit:n===0?1e-4:n},scale:function(n){return this._set("scaleX",n),this._set("scaleY",n),this.setCoords()},scaleToWidth:function(n,e){var a=this.getBoundingRect(e).width/this.getScaledWidth();return this.scale(n/this.width/a)},scaleToHeight:function(n,e){var a=this.getBoundingRect(e).height/this.getScaledHeight();return this.scale(n/this.height/a)},calcLineCoords:function(){var n=this.getViewportTransform(),e=this.padding,a=l(this.angle),h=i.cos(a),s=i.sin(a),u=h*e,d=s*e,m=u+d,p=u-d,y=this.calcACoords(),w={tl:r(y.tl,n),tr:r(y.tr,n),bl:r(y.bl,n),br:r(y.br,n)};return e&&(w.tl.x-=p,w.tl.y-=m,w.tr.x+=m,w.tr.y-=p,w.bl.x-=m,w.bl.y+=p,w.br.x+=p,w.br.y+=m),w},calcOCoords:function(){var n=this._calcRotateMatrix(),e=this._calcTranslateMatrix(),a=this.getViewportTransform(),h=o(a,e),s=o(h,n),s=o(s,[1/a[0],0,0,1/a[3],0,0]),u=this._calculateCurrentDimensions(),d={};return this.forEachControl(function(m,p,y){d[p]=m.positionHandler(u,s,y)}),d},calcACoords:function(){var n=this._calcRotateMatrix(),e=this._calcTranslateMatrix(),a=o(e,n),h=this._getTransformedDimensions(),s=h.x/2,u=h.y/2;return{tl:r({x:-s,y:-u},a),tr:r({x:s,y:-u},a),bl:r({x:-s,y:u},a),br:r({x:s,y:u},a)}},setCoords:function(n){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),n?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return i.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var n=this.getCenterPoint();return[1,0,0,1,n.x,n.y]},transformMatrixKey:function(n){var e="_",a="";return!n&&this.group&&(a=this.group.transformMatrixKey(n)+e),a+this.top+e+this.left+e+this.scaleX+e+this.scaleY+e+this.skewX+e+this.skewY+e+this.angle+e+this.originX+e+this.originY+e+this.width+e+this.height+e+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(n){var e=this.calcOwnMatrix();if(n||!this.group)return e;var a=this.transformMatrixKey(n),h=this.matrixCache||(this.matrixCache={});return h.key===a?h.value:(this.group&&(e=o(this.group.calcTransformMatrix(!1),e)),h.key=a,h.value=e,e)},calcOwnMatrix:function(){var n=this.transformMatrixKey(!0),e=this.ownMatrixCache||(this.ownMatrixCache={});if(e.key===n)return e.value;var a=this._calcTranslateMatrix(),h={angle:this.angle,translateX:a[4],translateY:a[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return e.key=n,e.value=i.composeMatrix(h),e.value},_getNonTransformedDimensions:function(){var n=this.strokeWidth,e=this.width+n,a=this.height+n;return{x:e,y:a}},_getTransformedDimensions:function(n,e){typeof n>"u"&&(n=this.skewX),typeof e>"u"&&(e=this.skewY);var a,h,s,u=n===0&&e===0;if(this.strokeUniform?(h=this.width,s=this.height):(a=this._getNonTransformedDimensions(),h=a.x,s=a.y),u)return this._finalizeDimensions(h*this.scaleX,s*this.scaleY);var d=i.sizeAfterTransform(h,s,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:n,skewY:e});return this._finalizeDimensions(d.x,d.y)},_finalizeDimensions:function(n,e){return this.strokeUniform?{x:n+this.strokeWidth,y:e+this.strokeWidth}:{x:n,y:e}},_calculateCurrentDimensions:function(){var n=this.getViewportTransform(),e=this._getTransformedDimensions(),a=r(e,n,!0);return a.scalarAdd(2*this.padding)}})}(),t.util.object.extend(t.Object.prototype,{sendToBack:function(){return this.group?t.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?t.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(c){return this.group?t.StaticCanvas.prototype.sendBackwards.call(this.group,this,c):this.canvas&&this.canvas.sendBackwards(this,c),this},bringForward:function(c){return this.group?t.StaticCanvas.prototype.bringForward.call(this.group,this,c):this.canvas&&this.canvas.bringForward(this,c),this},moveTo:function(c){return this.group&&this.group.type!=="activeSelection"?t.StaticCanvas.prototype.moveTo.call(this.group,this,c):this.canvas&&this.canvas.moveTo(this,c),this}}),function(){function c(l,o){if(o){if(o.toLive)return l+": url(#SVGID_"+o.id+"); ";var r=new t.Color(o),n=l+": "+r.toRgb()+"; ",e=r.getAlpha();return e!==1&&(n+=l+"-opacity: "+e.toString()+"; "),n}else return l+": none; "}var i=t.util.toFixed;t.util.object.extend(t.Object.prototype,{getSvgStyles:function(l){var o=this.fillRule?this.fillRule:"nonzero",r=this.strokeWidth?this.strokeWidth:"0",n=this.strokeDashArray?this.strokeDashArray.join(" "):"none",e=this.strokeDashOffset?this.strokeDashOffset:"0",a=this.strokeLineCap?this.strokeLineCap:"butt",h=this.strokeLineJoin?this.strokeLineJoin:"miter",s=this.strokeMiterLimit?this.strokeMiterLimit:"4",u=typeof this.opacity<"u"?this.opacity:"1",d=this.visible?"":" visibility: hidden;",m=l?"":this.getSvgFilter(),p=c("fill",this.fill),y=c("stroke",this.stroke);return[y,"stroke-width: ",r,"; ","stroke-dasharray: ",n,"; ","stroke-linecap: ",a,"; ","stroke-dashoffset: ",e,"; ","stroke-linejoin: ",h,"; ","stroke-miterlimit: ",s,"; ",p,"fill-rule: ",o,"; ","opacity: ",u,";",m,d].join("")},getSvgSpanStyles:function(l,o){var r="; ",e=l.fontFamily?"font-family: "+(l.fontFamily.indexOf("'")===-1&&l.fontFamily.indexOf('"')===-1?"'"+l.fontFamily+"'":l.fontFamily)+r:"",n=l.strokeWidth?"stroke-width: "+l.strokeWidth+r:"",e=e,a=l.fontSize?"font-size: "+l.fontSize+"px"+r:"",h=l.fontStyle?"font-style: "+l.fontStyle+r:"",s=l.fontWeight?"font-weight: "+l.fontWeight+r:"",u=l.fill?c("fill",l.fill):"",d=l.stroke?c("stroke",l.stroke):"",m=this.getSvgTextDecoration(l),p=l.deltaY?"baseline-shift: "+-l.deltaY+"; ":"";return m&&(m="text-decoration: "+m+r),[d,n,e,a,h,s,m,u,p,o?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(l){return["overline","underline","line-through"].filter(function(o){return l[o.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(l,o){var r=l?this.calcTransformMatrix():this.calcOwnMatrix(),n='transform="'+t.util.matrixToSVG(r);return n+(o||"")+'" '},_setSVGBg:function(l){if(this.backgroundColor){var o=t.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',i(-this.width/2,o),'" y="',i(-this.height/2,o),'" width="',i(this.width,o),'" height="',i(this.height,o),`"></rect>
`)}},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(l),{reviver:l})},toClipPathSVG:function(l){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(l),{reviver:l})},_createBaseClipPathSVGMarkup:function(l,o){o=o||{};var r=o.reviver,n=o.additionalTransform||"",e=[this.getSvgTransform(!0,n),this.getSvgCommons()].join(""),a=l.indexOf("COMMON_PARTS");return l[a]=e,r?r(l.join("")):l.join("")},_createBaseSVGMarkup:function(l,o){o=o||{};var r=o.noStyle,n=o.reviver,e=r?"":'style="'+this.getSvgStyles()+'" ',a=o.withShadow?'style="'+this.getSvgFilter()+'" ':"",h=this.clipPath,s=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",u=h&&h.absolutePositioned,d=this.stroke,m=this.fill,p=this.shadow,y,w=[],S,E=l.indexOf("COMMON_PARTS"),D=o.additionalTransform;return h&&(h.clipPathId="CLIPPATH_"+t.Object.__uid++,S='<clipPath id="'+h.clipPathId+`" >
`+h.toClipPathSVG(n)+`</clipPath>
`),u&&w.push("<g ",a,this.getSvgCommons(),` >
`),w.push("<g ",this.getSvgTransform(!1),u?"":a+this.getSvgCommons(),` >
`),y=[e,s,r?"":this.addPaintOrder()," ",D?'transform="'+D+'" ':""].join(""),l[E]=y,m&&m.toLive&&w.push(m.toSVG(this)),d&&d.toLive&&w.push(d.toSVG(this)),p&&w.push(p.toSVG(this)),h&&w.push(S),w.push(l.join("")),w.push(`</g>
`),u&&w.push(`</g>
`),n?n(w.join("")):w.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var c=t.util.object.extend,i="stateProperties";function l(r,n,e){var a={},h=!0;e.forEach(function(s){a[s]=r[s]}),c(r[n],a,h)}function o(r,n,e){if(r===n)return!0;if(Array.isArray(r)){if(!Array.isArray(n)||r.length!==n.length)return!1;for(var a=0,h=r.length;a<h;a++)if(!o(r[a],n[a]))return!1;return!0}else if(r&&typeof r=="object"){var s=Object.keys(r),u;if(!n||typeof n!="object"||!e&&s.length!==Object.keys(n).length)return!1;for(var a=0,h=s.length;a<h;a++)if(u=s[a],!(u==="canvas"||u==="group")&&!o(r[u],n[u]))return!1;return!0}}t.util.object.extend(t.Object.prototype,{hasStateChanged:function(r){r=r||i;var n="_"+r;return Object.keys(this[n]).length<this[r].length?!0:!o(this[n],this,!0)},saveState:function(r){var n=r&&r.propertySet||i,e="_"+n;return this[e]?(l(this,e,this[n]),r&&r.stateProperties&&l(this,e,r.stateProperties),this):this.setupState(r)},setupState:function(r){r=r||{};var n=r.propertySet||i;return r.propertySet=n,this["_"+n]={},this.saveState(r),this}})}(),function(){var c=t.util.degreesToRadians;t.util.object.extend(t.Object.prototype,{_findTargetCorner:function(i,l){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var o=i.x,r=i.y,n,e,a=Object.keys(this.oCoords),h=a.length-1,s;for(this.__corner=0;h>=0;h--)if(s=a[h],!!this.isControlVisible(s)&&(e=this._getImageLines(l?this.oCoords[s].touchCorner:this.oCoords[s].corner),n=this._findCrossPoints({x:o,y:r},e),n!==0&&n%2===1))return this.__corner=s,s;return!1},forEachControl:function(i){for(var l in this.controls)i(this.controls[l],l,this)},_setCornerCoords:function(){var i=this.oCoords;for(var l in i){var o=this.controls[l];i[l].corner=o.calcCornerCoords(this.angle,this.cornerSize,i[l].x,i[l].y,!1),i[l].touchCorner=o.calcCornerCoords(this.angle,this.touchCornerSize,i[l].x,i[l].y,!0)}},drawSelectionBackground:function(i){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;i.save();var l=this.getCenterPoint(),o=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return i.translate(l.x,l.y),i.scale(1/r[0],1/r[3]),i.rotate(c(this.angle)),i.fillStyle=this.selectionBackgroundColor,i.fillRect(-o.x/2,-o.y/2,o.x,o.y),i.restore(),this},drawBorders:function(i,l){l=l||{};var o=this._calculateCurrentDimensions(),r=this.borderScaleFactor,n=o.x+r,e=o.y+r,a=typeof l.hasControls<"u"?l.hasControls:this.hasControls,h=!1;return i.save(),i.strokeStyle=l.borderColor||this.borderColor,this._setLineDash(i,l.borderDashArray||this.borderDashArray),i.strokeRect(-n/2,-e/2,n,e),a&&(i.beginPath(),this.forEachControl(function(s,u,d){s.withConnection&&s.getVisibility(d,u)&&(h=!0,i.moveTo(s.x*n,s.y*e),i.lineTo(s.x*n+s.offsetX,s.y*e+s.offsetY))}),h&&i.stroke()),i.restore(),this},drawBordersInGroup:function(i,l,o){o=o||{};var r=t.util.sizeAfterTransform(this.width,this.height,l),n=this.strokeWidth,e=this.strokeUniform,a=this.borderScaleFactor,h=r.x+n*(e?this.canvas.getZoom():l.scaleX)+a,s=r.y+n*(e?this.canvas.getZoom():l.scaleY)+a;return i.save(),this._setLineDash(i,o.borderDashArray||this.borderDashArray),i.strokeStyle=o.borderColor||this.borderColor,i.strokeRect(-h/2,-s/2,h,s),i.restore(),this},drawControls:function(i,l){l=l||{},i.save();var o=this.canvas.getRetinaScaling(),r,n;return i.setTransform(o,0,0,o,0,0),i.strokeStyle=i.fillStyle=l.cornerColor||this.cornerColor,this.transparentCorners||(i.strokeStyle=l.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(i,l.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(r=this.group.calcTransformMatrix()),this.forEachControl(function(e,a,h){n=h.oCoords[a],e.getVisibility(h,a)&&(r&&(n=t.util.transformPoint(n,r)),e.render(i,n.x,n.y,l,h))}),i.restore(),this},isControlVisible:function(i){return this.controls[i]&&this.controls[i].getVisibility(this,i)},setControlVisible:function(i,l){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[i]=l,this},setControlsVisibility:function(i){i||(i={});for(var l in i)this.setControlVisible(l,i[l]);return this},onDeselect:function(){},onSelect:function(){}})}(),t.util.object.extend(t.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(c,i){i=i||{};var l=function(){},o=i.onComplete||l,r=i.onChange||l,n=this;return t.util.animate({target:this,startValue:c.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(e){c.set("left",e),n.requestRenderAll(),r()},onComplete:function(){c.setCoords(),o()}})},fxCenterObjectV:function(c,i){i=i||{};var l=function(){},o=i.onComplete||l,r=i.onChange||l,n=this;return t.util.animate({target:this,startValue:c.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(e){c.set("top",e),n.requestRenderAll(),r()},onComplete:function(){c.setCoords(),o()}})},fxRemove:function(c,i){i=i||{};var l=function(){},o=i.onComplete||l,r=i.onChange||l,n=this;return t.util.animate({target:this,startValue:c.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(e){c.set("opacity",e),n.requestRenderAll(),r()},onComplete:function(){n.remove(c),o()}})}}),t.util.object.extend(t.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var c=[],i,l,o=[];for(i in arguments[0])c.push(i);for(var r=0,n=c.length;r<n;r++)i=c[r],l=r!==n-1,o.push(this._animate(i,arguments[0][i],arguments[1],l));return o}else return this._animate.apply(this,arguments)},_animate:function(c,i,l,o){var r=this,n;i=i.toString(),l?l=t.util.object.clone(l):l={},~c.indexOf(".")&&(n=c.split("."));var e=r.colorProperties.indexOf(c)>-1||n&&r.colorProperties.indexOf(n[1])>-1,a=n?this.get(n[0])[n[1]]:this.get(c);"from"in l||(l.from=a),e||(~i.indexOf("=")?i=a+parseFloat(i.replace("=","")):i=parseFloat(i));var h={target:this,startValue:l.from,endValue:i,byValue:l.by,easing:l.easing,duration:l.duration,abort:l.abort&&function(s,u,d){return l.abort.call(r,s,u,d)},onChange:function(s,u,d){n?r[n[0]][n[1]]=s:r.set(c,s),!o&&l.onChange&&l.onChange(s,u,d)},onComplete:function(s,u,d){o||(r.setCoords(),l.onComplete&&l.onComplete(s,u,d))}};return e?t.util.animateColor(h.startValue,h.endValue,h.duration,h):t.util.animate(h)}}),function(c){var i=c.fabric||(c.fabric={}),l=i.util.object.extend,o=i.util.object.clone,r={x1:1,x2:1,y1:1,y2:1};if(i.Line){i.warn("fabric.Line is already defined");return}i.Line=i.util.createClass(i.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:i.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(e,a){e||(e=[0,0,0,0]),this.callSuper("initialize",a),this.set("x1",e[0]),this.set("y1",e[1]),this.set("x2",e[2]),this.set("y2",e[3]),this._setWidthHeight(a)},_setWidthHeight:function(e){e||(e={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in e?e.left:this._getLeftToOriginX(),this.top="top"in e?e.top:this._getTopToOriginY()},_set:function(e,a){return this.callSuper("_set",e,a),typeof r[e]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:n({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:n({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(e){e.beginPath();var a=this.calcLinePoints();e.moveTo(a.x1,a.y1),e.lineTo(a.x2,a.y2),e.lineWidth=this.strokeWidth;var h=e.strokeStyle;e.strokeStyle=this.stroke||e.fillStyle,this.stroke&&this._renderStroke(e),e.strokeStyle=h},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(e){return l(this.callSuper("toObject",e),this.calcLinePoints())},_getNonTransformedDimensions:function(){var e=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(e.y-=this.strokeWidth),this.height===0&&(e.x-=this.strokeWidth)),e},calcLinePoints:function(){var e=this.x1<=this.x2?-1:1,a=this.y1<=this.y2?-1:1,h=e*this.width*.5,s=a*this.height*.5,u=e*this.width*-.5,d=a*this.height*-.5;return{x1:h,x2:u,y1:s,y2:d}},_toSVG:function(){var e=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',e.x1,'" y1="',e.y1,'" x2="',e.x2,'" y2="',e.y2,`" />
`]}}),i.Line.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),i.Line.fromElement=function(e,a,h){h=h||{};var s=i.parseAttributes(e,i.Line.ATTRIBUTE_NAMES),u=[s.x1||0,s.y1||0,s.x2||0,s.y2||0];a(new i.Line(u,l(s,h)))},i.Line.fromObject=function(e,a){function h(u){delete u.points,a&&a(u)}var s=o(e,!0);s.points=[e.x1,e.y1,e.x2,e.y2],i.Object._fromObject("Line",s,h,"points")};function n(e,a){var h=e.origin,s=e.axis1,u=e.axis2,d=e.dimension,m=a.nearest,p=a.center,y=a.farthest;return function(){switch(this.get(h)){case m:return Math.min(this.get(s),this.get(u));case p:return Math.min(this.get(s),this.get(u))+.5*this.get(d);case y:return Math.max(this.get(s),this.get(u))}}}}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.util.degreesToRadians;if(i.Circle){i.warn("fabric.Circle is already defined.");return}i.Circle=i.util.createClass(i.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:i.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(r,n){return this.callSuper("_set",r,n),r==="radius"&&this.setRadius(n),this},toObject:function(r){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(r))},_toSVG:function(){var r,n=0,e=0,a=(this.endAngle-this.startAngle)%360;if(a===0)r=["<circle ","COMMON_PARTS",'cx="'+n+'" cy="'+e+'" ','r="',this.radius,`" />
`];else{var h=l(this.startAngle),s=l(this.endAngle),u=this.radius,d=i.util.cos(h)*u,m=i.util.sin(h)*u,p=i.util.cos(s)*u,y=i.util.sin(s)*u,w=a>180?"1":"0";r=['<path d="M '+d+" "+m," A "+u+" "+u," 0 ",+w+" 1"," "+p+" "+y,'" ',"COMMON_PARTS",` />
`]}return r},_render:function(r){r.beginPath(),r.arc(0,0,this.radius,l(this.startAngle),l(this.endAngle),!1),this._renderPaintInOrder(r)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(r){return this.radius=r,this.set("width",r*2).set("height",r*2)}}),i.Circle.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),i.Circle.fromElement=function(r,n){var e=i.parseAttributes(r,i.Circle.ATTRIBUTE_NAMES);if(!o(e))throw new Error("value of `r` attribute is required and can not be negative");e.left=(e.left||0)-e.radius,e.top=(e.top||0)-e.radius,n(new i.Circle(e))};function o(r){return"radius"in r&&r.radius>=0}i.Circle.fromObject=function(r,n){i.Object._fromObject("Circle",r,n)}}(f),function(c){var i=c.fabric||(c.fabric={});if(i.Triangle){i.warn("fabric.Triangle is already defined");return}i.Triangle=i.util.createClass(i.Object,{type:"triangle",width:100,height:100,_render:function(l){var o=this.width/2,r=this.height/2;l.beginPath(),l.moveTo(-o,r),l.lineTo(0,-r),l.lineTo(o,r),l.closePath(),this._renderPaintInOrder(l)},_toSVG:function(){var l=this.width/2,o=this.height/2,r=[-l+" "+o,"0 "+-o,l+" "+o].join(",");return["<polygon ","COMMON_PARTS",'points="',r,'" />']}}),i.Triangle.fromObject=function(l,o){return i.Object._fromObject("Triangle",l,o)}}(f),function(c){var i=c.fabric||(c.fabric={}),l=Math.PI*2;if(i.Ellipse){i.warn("fabric.Ellipse is already defined.");return}i.Ellipse=i.util.createClass(i.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:i.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(o){this.callSuper("initialize",o),this.set("rx",o&&o.rx||0),this.set("ry",o&&o.ry||0)},_set:function(o,r){switch(this.callSuper("_set",o,r),o){case"rx":this.rx=r,this.set("width",r*2);break;case"ry":this.ry=r,this.set("height",r*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(o){return this.callSuper("toObject",["rx","ry"].concat(o))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(o){o.beginPath(),o.save(),o.transform(1,0,0,this.ry/this.rx,0,0),o.arc(0,0,this.rx,0,l,!1),o.restore(),this._renderPaintInOrder(o)}}),i.Ellipse.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),i.Ellipse.fromElement=function(o,r){var n=i.parseAttributes(o,i.Ellipse.ATTRIBUTE_NAMES);n.left=(n.left||0)-n.rx,n.top=(n.top||0)-n.ry,r(new i.Ellipse(n))},i.Ellipse.fromObject=function(o,r){i.Object._fromObject("Ellipse",o,r)}}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.util.object.extend;if(i.Rect){i.warn("fabric.Rect is already defined");return}i.Rect=i.util.createClass(i.Object,{stateProperties:i.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:i.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(o){this.callSuper("initialize",o),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(o){var r=this.rx?Math.min(this.rx,this.width/2):0,n=this.ry?Math.min(this.ry,this.height/2):0,e=this.width,a=this.height,h=-this.width/2,s=-this.height/2,u=r!==0||n!==0,d=1-.5522847498;o.beginPath(),o.moveTo(h+r,s),o.lineTo(h+e-r,s),u&&o.bezierCurveTo(h+e-d*r,s,h+e,s+d*n,h+e,s+n),o.lineTo(h+e,s+a-n),u&&o.bezierCurveTo(h+e,s+a-d*n,h+e-d*r,s+a,h+e-r,s+a),o.lineTo(h+r,s+a),u&&o.bezierCurveTo(h+d*r,s+a,h,s+a-d*n,h,s+a-n),o.lineTo(h,s+n),u&&o.bezierCurveTo(h,s+d*n,h+d*r,s,h+r,s),o.closePath(),this._renderPaintInOrder(o)},toObject:function(o){return this.callSuper("toObject",["rx","ry"].concat(o))},_toSVG:function(){var o=-this.width/2,r=-this.height/2;return["<rect ","COMMON_PARTS",'x="',o,'" y="',r,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),i.Rect.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),i.Rect.fromElement=function(o,r,n){if(!o)return r(null);n=n||{};var e=i.parseAttributes(o,i.Rect.ATTRIBUTE_NAMES);e.left=e.left||0,e.top=e.top||0,e.height=e.height||0,e.width=e.width||0;var a=new i.Rect(l(n?i.util.object.clone(n):{},e));a.visible=a.visible&&a.width>0&&a.height>0,r(a)},i.Rect.fromObject=function(o,r){return i.Object._fromObject("Rect",o,r)}}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.util.object.extend,o=i.util.array.min,r=i.util.array.max,n=i.util.toFixed,e=i.util.projectStrokeOnPoints;if(i.Polyline){i.warn("fabric.Polyline is already defined");return}i.Polyline=i.util.createClass(i.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:i.Object.prototype.cacheProperties.concat("points"),initialize:function(a,h){h=h||{},this.points=a||[],this.callSuper("initialize",h),this._setPositionDimensions(h)},_projectStrokeOnPoints:function(){return e(this.points,this,!0)},_setPositionDimensions:function(a){var h=this._calcDimensions(a),s,u=this.exactBoundingBox?this.strokeWidth:0;this.width=h.width-u,this.height=h.height-u,a.fromSVG||(s=this.translateToGivenOrigin({x:h.left-this.strokeWidth/2+u/2,y:h.top-this.strokeWidth/2+u/2},"left","top",this.originX,this.originY)),typeof a.left>"u"&&(this.left=a.fromSVG?h.left:s.x),typeof a.top>"u"&&(this.top=a.fromSVG?h.top:s.y),this.pathOffset={x:h.left+this.width/2+u/2,y:h.top+this.height/2+u/2}},_calcDimensions:function(){var a=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,h=o(a,"x")||0,s=o(a,"y")||0,u=r(a,"x")||0,d=r(a,"y")||0,m=u-h,p=d-s;return{left:h,top:s,width:m,height:p}},toObject:function(a){return l(this.callSuper("toObject",a),{points:this.points.concat()})},_toSVG:function(){for(var a=[],h=this.pathOffset.x,s=this.pathOffset.y,u=i.Object.NUM_FRACTION_DIGITS,d=0,m=this.points.length;d<m;d++)a.push(n(this.points[d].x-h,u),",",n(this.points[d].y-s,u)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',a.join(""),`" />
`]},commonRender:function(a){var h,s=this.points.length,u=this.pathOffset.x,d=this.pathOffset.y;if(!s||isNaN(this.points[s-1].y))return!1;a.beginPath(),a.moveTo(this.points[0].x-u,this.points[0].y-d);for(var m=0;m<s;m++)h=this.points[m],a.lineTo(h.x-u,h.y-d);return!0},_render:function(a){this.commonRender(a)&&this._renderPaintInOrder(a)},complexity:function(){return this.get("points").length}}),i.Polyline.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat(),i.Polyline.fromElementGenerator=function(a){return function(h,s,u){if(!h)return s(null);u||(u={});var d=i.parsePointsAttribute(h.getAttribute("points")),m=i.parseAttributes(h,i[a].ATTRIBUTE_NAMES);m.fromSVG=!0,s(new i[a](d,l(m,u)))}},i.Polyline.fromElement=i.Polyline.fromElementGenerator("Polyline"),i.Polyline.fromObject=function(a,h){return i.Object._fromObject("Polyline",a,h,"points")}}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.util.projectStrokeOnPoints;if(i.Polygon){i.warn("fabric.Polygon is already defined");return}i.Polygon=i.util.createClass(i.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return l(this.points,this)},_render:function(o){this.commonRender(o)&&(o.closePath(),this._renderPaintInOrder(o))}}),i.Polygon.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat(),i.Polygon.fromElement=i.Polyline.fromElementGenerator("Polygon"),i.Polygon.fromObject=function(o,r){i.Object._fromObject("Polygon",o,r,"points")}}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.util.array.min,o=i.util.array.max,r=i.util.object.extend,n=i.util.object.clone,e=i.util.toFixed;if(i.Path){i.warn("fabric.Path is already defined");return}i.Path=i.util.createClass(i.Object,{type:"path",path:null,cacheProperties:i.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:i.Object.prototype.stateProperties.concat("path"),initialize:function(a,h){h=n(h||{}),delete h.path,this.callSuper("initialize",h),this._setPath(a||[],h)},_setPath:function(a,h){this.path=i.util.makePathSimpler(Array.isArray(a)?a:i.util.parsePath(a)),i.Polyline.prototype._setPositionDimensions.call(this,h||{})},_renderPathCommands:function(a){var h,s=0,u=0,d=0,m=0,p=0,y=0,w=-this.pathOffset.x,S=-this.pathOffset.y;a.beginPath();for(var E=0,D=this.path.length;E<D;++E)switch(h=this.path[E],h[0]){case"L":d=h[1],m=h[2],a.lineTo(d+w,m+S);break;case"M":d=h[1],m=h[2],s=d,u=m,a.moveTo(d+w,m+S);break;case"C":d=h[5],m=h[6],p=h[3],y=h[4],a.bezierCurveTo(h[1]+w,h[2]+S,p+w,y+S,d+w,m+S);break;case"Q":a.quadraticCurveTo(h[1]+w,h[2]+S,h[3]+w,h[4]+S),d=h[3],m=h[4],p=h[1],y=h[2];break;case"z":case"Z":d=s,m=u,a.closePath();break}},_render:function(a){this._renderPathCommands(a),this._renderPaintInOrder(a)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){return r(this.callSuper("toObject",a),{path:this.path.map(function(h){return h.slice()})})},toDatalessObject:function(a){var h=this.toObject(["sourcePath"].concat(a));return h.sourcePath&&delete h.path,h},_toSVG:function(){var a=i.util.joinPath(this.path);return["<path ","COMMON_PARTS",'d="',a,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var a=i.Object.NUM_FRACTION_DIGITS;return" translate("+e(-this.pathOffset.x,a)+", "+e(-this.pathOffset.y,a)+")"},toClipPathSVG:function(a){var h=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:a,additionalTransform:h})},toSVG:function(a){var h=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:a,additionalTransform:h})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var a=[],h=[],s,u=0,d=0,m=0,p=0,y,w=0,S=this.path.length;w<S;++w){switch(s=this.path[w],s[0]){case"L":m=s[1],p=s[2],y=[];break;case"M":m=s[1],p=s[2],u=m,d=p,y=[];break;case"C":y=i.util.getBoundsOfCurve(m,p,s[1],s[2],s[3],s[4],s[5],s[6]),m=s[5],p=s[6];break;case"Q":y=i.util.getBoundsOfCurve(m,p,s[1],s[2],s[1],s[2],s[3],s[4]),m=s[3],p=s[4];break;case"z":case"Z":m=u,p=d;break}y.forEach(function(J){a.push(J.x),h.push(J.y)}),a.push(m),h.push(p)}var E=l(a)||0,D=l(h)||0,W=o(a)||0,K=o(h)||0,tt=W-E,N=K-D;return{left:E,top:D,width:tt,height:N}}}),i.Path.fromObject=function(a,h){if(typeof a.sourcePath=="string"){var s=a.sourcePath;i.loadSVGFromURL(s,function(u){var d=u[0];d.setOptions(a),a.clipPath?i.util.enlivenObjects([a.clipPath],function(m){d.clipPath=m[0],h&&h(d)}):h&&h(d)})}else i.Object._fromObject("Path",a,h,"path")},i.Path.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat(["d"]),i.Path.fromElement=function(a,h,s){var u=i.parseAttributes(a,i.Path.ATTRIBUTE_NAMES);u.fromSVG=!0,h(new i.Path(u.d,r(u,s)))}}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.util.array.min,o=i.util.array.max;i.Group||(i.Group=i.util.createClass(i.Object,i.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(r,n,e){n=n||{},this._objects=[],e&&this.callSuper("initialize",n),this._objects=r||[];for(var a=this._objects.length;a--;)this._objects[a].group=this;if(e)this._updateObjectsACoords();else{var h=n&&n.centerPoint;n.originX!==void 0&&(this.originX=n.originX),n.originY!==void 0&&(this.originY=n.originY),h||this._calcBounds(),this._updateObjectsCoords(h),delete n.centerPoint,this.callSuper("initialize",n)}this.setCoords()},_updateObjectsACoords:function(){for(var r=!0,n=this._objects.length;n--;)this._objects[n].setCoords(r)},_updateObjectsCoords:function(n){for(var n=n||this.getCenterPoint(),e=this._objects.length;e--;)this._updateObjectCoords(this._objects[e],n)},_updateObjectCoords:function(r,n){var e=r.left,a=r.top,h=!0;r.set({left:e-n.x,top:a-n.y}),r.group=this,r.setCoords(h)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(r){var n=!!this.group;return this._restoreObjectsState(),i.util.resetObjectTransform(this),r&&(n&&i.util.removeTransformFromObject(r,this.group.calcTransformMatrix()),this._objects.push(r),r.group=this,r._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,n?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(r){return this._restoreObjectsState(),i.util.resetObjectTransform(this),this.remove(r),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(r){this.dirty=!0,r.group=this,r._set("canvas",this.canvas)},_onObjectRemoved:function(r){this.dirty=!0,delete r.group},_set:function(r,n){var e=this._objects.length;if(this.useSetOnGroup)for(;e--;)this._objects[e].setOnGroup(r,n);if(r==="canvas")for(;e--;)this._objects[e]._set(r,n);i.Object.prototype._set.call(this,r,n)},toObject:function(r){var n=this.includeDefaultValues,e=this._objects.filter(function(h){return!h.excludeFromExport}).map(function(h){var s=h.includeDefaultValues;h.includeDefaultValues=n;var u=h.toObject(r);return h.includeDefaultValues=s,u}),a=i.Object.prototype.toObject.call(this,r);return a.objects=e,a},toDatalessObject:function(r){var n,e=this.sourcePath;if(e)n=e;else{var a=this.includeDefaultValues;n=this._objects.map(function(s){var u=s.includeDefaultValues;s.includeDefaultValues=a;var d=s.toDatalessObject(r);return s.includeDefaultValues=u,d})}var h=i.Object.prototype.toDatalessObject.call(this,r);return h.objects=n,h},render:function(r){this._transformDone=!0,this.callSuper("render",r),this._transformDone=!1},shouldCache:function(){var r=i.Object.prototype.shouldCache.call(this);if(r){for(var n=0,e=this._objects.length;n<e;n++)if(this._objects[n].willDrawShadow())return this.ownCaching=!1,!1}return r},willDrawShadow:function(){if(i.Object.prototype.willDrawShadow.call(this))return!0;for(var r=0,n=this._objects.length;r<n;r++)if(this._objects[r].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(r){for(var n=0,e=this._objects.length;n<e;n++)this._objects[n].render(r);this._drawClipPath(r,this.clipPath)},isCacheDirty:function(r){if(this.callSuper("isCacheDirty",r))return!0;if(!this.statefullCache)return!1;for(var n=0,e=this._objects.length;n<e;n++)if(this._objects[n].isCacheDirty(!0)){if(this._cacheCanvas){var a=this.cacheWidth/this.zoomX,h=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-a/2,-h/2,a,h)}return!0}return!1},_restoreObjectsState:function(){var r=this.calcOwnMatrix();return this._objects.forEach(function(n){i.util.addTransformToObject(n,r),delete n.group,n.setCoords()}),this},destroy:function(){return this._objects.forEach(function(r){r.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(r){r.dispose&&r.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var r=this._objects,n=this.canvas;this._objects=[];var e=this.toObject();delete e.objects;var a=new i.ActiveSelection([]);return a.set(e),a.type="activeSelection",n.remove(this),r.forEach(function(h){h.group=a,h.dirty=!0,n.add(h)}),a.canvas=n,a._objects=r,n._activeObject=a,a.setCoords(),a}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var r=!0;return this.forEachObject(function(n){n.setCoords(r)}),this},_calcBounds:function(r){for(var n=[],e=[],a,h,s,u=["tr","br","bl","tl"],d=0,m=this._objects.length,p,y=u.length;d<m;++d){for(a=this._objects[d],s=a.calcACoords(),p=0;p<y;p++)h=u[p],n.push(s[h].x),e.push(s[h].y);a.aCoords=s}this._getBounds(n,e,r)},_getBounds:function(r,n,e){var a=new i.Point(l(r),l(n)),h=new i.Point(o(r),o(n)),s=a.y||0,u=a.x||0,d=h.x-a.x||0,m=h.y-a.y||0;this.width=d,this.height=m,e||this.setPositionByOrigin({x:u,y:s},"left","top")},_toSVG:function(r){for(var n=["<g ","COMMON_PARTS",` >
`],e=0,a=this._objects.length;e<a;e++)n.push("		",this._objects[e].toSVG(r));return n.push(`</g>
`),n},getSvgStyles:function(){var r=typeof this.opacity<"u"&&this.opacity!==1?"opacity: "+this.opacity+";":"",n=this.visible?"":" visibility: hidden;";return[r,this.getSvgFilter(),n].join("")},toClipPathSVG:function(r){for(var n=[],e=0,a=this._objects.length;e<a;e++)n.push("	",this._objects[e].toClipPathSVG(r));return this._createBaseClipPathSVGMarkup(n,{reviver:r})}}),i.Group.fromObject=function(r,n){var e=r.objects,a=i.util.object.clone(r,!0);if(delete a.objects,typeof e=="string"){i.loadSVGFromURL(e,function(h){var s=i.util.groupSVGElements(h,r,e),u=a.clipPath;delete a.clipPath,s.set(a),u?i.util.enlivenObjects([u],function(d){s.clipPath=d[0],n&&n(s)}):n&&n(s)});return}i.util.enlivenObjects(e,function(h){i.util.enlivenObjectEnlivables(r,a,function(){n&&n(new i.Group(h,a,!0))})})})}(f),function(c){var i=c.fabric||(c.fabric={});i.ActiveSelection||(i.ActiveSelection=i.util.createClass(i.Group,{type:"activeSelection",initialize:function(l,o){o=o||{},this._objects=l||[];for(var r=this._objects.length;r--;)this._objects[r].group=this;o.originX&&(this.originX=o.originX),o.originY&&(this.originY=o.originY),this._calcBounds(),this._updateObjectsCoords(),i.Object.prototype.initialize.call(this,o),this.setCoords()},toGroup:function(){var l=this._objects.concat();this._objects=[];var o=i.Object.prototype.toObject.call(this),r=new i.Group([]);if(delete o.type,r.set(o),l.forEach(function(e){e.canvas.remove(e),e.group=r}),r._objects=l,!this.canvas)return r;var n=this.canvas;return n.add(r),n._activeObject=r,r.setCoords(),r},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(l,o,r){l.save(),l.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",l,o),r=r||{},typeof r.hasControls>"u"&&(r.hasControls=!1),r.forActiveSelection=!0;for(var n=0,e=this._objects.length;n<e;n++)this._objects[n]._renderControls(l,r);l.restore()}}),i.ActiveSelection.fromObject=function(l,o){i.util.enlivenObjects(l.objects,function(r){delete l.objects,o&&o(new i.ActiveSelection(r,l,!0))})})}(f),function(c){var i=t.util.object.extend;if(c.fabric||(c.fabric={}),c.fabric.Image){t.warn("fabric.Image is already defined.");return}t.Image=t.util.createClass(t.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:t.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:t.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(l,o){o||(o={}),this.filters=[],this.cacheKey="texture"+t.Object.__uid++,this.callSuper("initialize",o),this._initElement(l,o)},getElement:function(){return this._element||{}},setElement:function(l,o){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=l,this._originalElement=l,this._initConfig(o),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(l){var o=t.filterBackend;o&&o.evictCachesForKey&&o.evictCachesForKey(l)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(l){t.util.cleanUpJsdomNode(this[l]),this[l]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var l=this.getElement();return{width:l.naturalWidth||l.width,height:l.naturalHeight||l.height}},_stroke:function(l){if(!(!this.stroke||this.strokeWidth===0)){var o=this.width/2,r=this.height/2;l.beginPath(),l.moveTo(-o,-r),l.lineTo(o,-r),l.lineTo(o,r),l.lineTo(-o,r),l.lineTo(-o,-r),l.closePath()}},toObject:function(l){var o=[];this.filters.forEach(function(n){n&&o.push(n.toObject())});var r=i(this.callSuper("toObject",["cropX","cropY"].concat(l)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:o});return this.resizeFilter&&(r.resizeFilter=this.resizeFilter.toObject()),r},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var l=[],o=[],r,n=this._element,e=-this.width/2,a=-this.height/2,h="",s="";if(!n)return[];if(this.hasCrop()){var u=t.Object.__uid++;l.push('<clipPath id="imageCrop_'+u+`">
`,'	<rect x="'+e+'" y="'+a+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),h=' clip-path="url(#imageCrop_'+u+')" '}if(this.imageSmoothing||(s='" image-rendering="optimizeSpeed'),o.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',e-this.cropX,'" y="',a-this.cropY,'" width="',n.width||n.naturalWidth,'" height="',n.height||n.height,s,'"',h,`></image>
`),this.stroke||this.strokeDashArray){var d=this.fill;this.fill=null,r=["	<rect ",'x="',e,'" y="',a,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=d}return this.paintFirst!=="fill"?l=l.concat(r,o):l=l.concat(o,r),l},getSrc:function(l){var o=l?this._element:this._originalElement;return o?o.toDataURL?o.toDataURL():this.srcFromAttribute?o.getAttribute("src"):o.src:this.src||""},setSrc:function(l,o,r){return t.util.loadImage(l,function(n,e){this.setElement(n,r),this._setWidthHeight(),o&&o(this,e)},this,r&&r.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var l=this.resizeFilter,o=this.minimumScaleTrigger,r=this.getTotalObjectScaling(),n=r.scaleX,e=r.scaleY,a=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!l||n>o&&e>o){this._element=a,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=n,this._lastScaleY=e;return}t.filterBackend||(t.filterBackend=t.initFilterBackend());var h=t.util.createCanvasElement(),s=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,u=a.width,d=a.height;h.width=u,h.height=d,this._element=h,this._lastScaleX=l.scaleX=n,this._lastScaleY=l.scaleY=e,t.filterBackend.applyFilters([l],a,u,d,this._element,s),this._filterScalingX=h.width/this._originalElement.width,this._filterScalingY=h.height/this._originalElement.height},applyFilters:function(l){if(l=l||this.filters||[],l=l.filter(function(a){return a&&!a.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),l.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var o=this._originalElement,r=o.naturalWidth||o.width,n=o.naturalHeight||o.height;if(this._element===this._originalElement){var e=t.util.createCanvasElement();e.width=r,e.height=n,this._element=e,this._filteredEl=e}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,r,n),this._lastScaleX=1,this._lastScaleY=1;return t.filterBackend||(t.filterBackend=t.initFilterBackend()),t.filterBackend.applyFilters(l,this._originalElement,r,n,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(l){t.util.setImageSmoothing(l,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(l),this._renderPaintInOrder(l)},drawCacheOnCanvas:function(l){t.util.setImageSmoothing(l,this.imageSmoothing),t.Object.prototype.drawCacheOnCanvas.call(this,l)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(l){var o=this._element;if(o){var r=this._filterScalingX,n=this._filterScalingY,e=this.width,a=this.height,h=Math.min,s=Math.max,u=s(this.cropX,0),d=s(this.cropY,0),m=o.naturalWidth||o.width,p=o.naturalHeight||o.height,y=u*r,w=d*n,S=h(e*r,m-y),E=h(a*n,p-w),D=-e/2,W=-a/2,K=h(e,m/r-u),tt=h(a,p/n-d);o&&l.drawImage(o,y,w,S,E,D,W,K,tt)}},_needsResize:function(){var l=this.getTotalObjectScaling();return l.scaleX!==this._lastScaleX||l.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(l,o){this.setElement(t.util.getById(l),o),t.util.addClass(this.getElement(),t.Image.CSS_CANVAS)},_initConfig:function(l){l||(l={}),this.setOptions(l),this._setWidthHeight(l)},_initFilters:function(l,o){l&&l.length?t.util.enlivenObjects(l,function(r){o&&o(r)},"fabric.Image.filters"):o&&o()},_setWidthHeight:function(l){l||(l={});var o=this.getElement();this.width=l.width||o.naturalWidth||o.width||0,this.height=l.height||o.naturalHeight||o.height||0},parsePreserveAspectRatioAttribute:function(){var l=t.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),o=this._element.width,r=this._element.height,n=1,e=1,a=0,h=0,s=0,u=0,d,m=this.width,p=this.height,y={width:m,height:p};return l&&(l.alignX!=="none"||l.alignY!=="none")?(l.meetOrSlice==="meet"&&(n=e=t.util.findScaleToFit(this._element,y),d=(m-o*n)/2,l.alignX==="Min"&&(a=-d),l.alignX==="Max"&&(a=d),d=(p-r*e)/2,l.alignY==="Min"&&(h=-d),l.alignY==="Max"&&(h=d)),l.meetOrSlice==="slice"&&(n=e=t.util.findScaleToCover(this._element,y),d=o-m/n,l.alignX==="Mid"&&(s=d/2),l.alignX==="Max"&&(s=d),d=r-p/e,l.alignY==="Mid"&&(u=d/2),l.alignY==="Max"&&(u=d),o=m/n,r=p/e)):(n=m/o,e=p/r),{width:o,height:r,scaleX:n,scaleY:e,offsetLeft:a,offsetTop:h,cropX:s,cropY:u}}}),t.Image.CSS_CANVAS="canvas-img",t.Image.prototype.getSvgSrc=t.Image.prototype.getSrc,t.Image.fromObject=function(l,o){var r=t.util.object.clone(l);t.util.loadImage(r.src,function(n,e){if(e){o&&o(null,!0);return}t.Image.prototype._initFilters.call(r,r.filters,function(a){r.filters=a||[],t.Image.prototype._initFilters.call(r,[r.resizeFilter],function(h){r.resizeFilter=h[0],t.util.enlivenObjectEnlivables(r,r,function(){var s=new t.Image(n,r);o(s,!1)})})})},null,r.crossOrigin)},t.Image.fromURL=function(l,o,r){t.util.loadImage(l,function(n,e){o&&o(new t.Image(n,r),e)},null,r&&r.crossOrigin)},t.Image.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),t.Image.fromElement=function(l,o,r){var n=t.parseAttributes(l,t.Image.ATTRIBUTE_NAMES);t.Image.fromURL(n["xlink:href"],o,i(r?t.util.object.clone(r):{},n))}}(f),t.util.object.extend(t.Object.prototype,{_getAngleValueForStraighten:function(){var c=this.angle%360;return c>0?Math.round((c-1)/90)*90:Math.round(c/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(c){c=c||{};var i=function(){},l=c.onComplete||i,o=c.onChange||i,r=this;return t.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(n){r.rotate(n),o()},onComplete:function(){r.setCoords(),l()}})}}),t.util.object.extend(t.StaticCanvas.prototype,{straightenObject:function(c){return c.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(c){return c.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function c(l,o){var r="precision "+o+` float;
void main(){}`,n=l.createShader(l.FRAGMENT_SHADER);return l.shaderSource(n,r),l.compileShader(n),!!l.getShaderParameter(n,l.COMPILE_STATUS)}t.isWebglSupported=function(l){if(t.isLikelyNode)return!1;l=l||t.WebglFilterBackend.prototype.tileSize;var o=document.createElement("canvas"),r=o.getContext("webgl")||o.getContext("experimental-webgl"),n=!1;if(r){t.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),n=t.maxTextureSize>=l;for(var e=["highp","mediump","lowp"],a=0;a<3;a++)if(c(r,e[a])){t.webGlPrecision=e[a];break}}return this.isSupported=n,n},t.WebglFilterBackend=i;function i(l){l&&l.tileSize&&(this.tileSize=l.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}i.prototype={tileSize:2048,resources:{},setupGLContext:function(l,o){this.dispose(),this.createWebGLCanvas(l,o),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(l,o)},chooseFastestCopyGLTo2DMethod:function(l,o){var r=typeof window.performance<"u",n;try{new ImageData(1,1),n=!0}catch{n=!1}var e=typeof ArrayBuffer<"u",a=typeof Uint8ClampedArray<"u";if(r&&n&&e&&a){var h=t.util.createCanvasElement(),s=new ArrayBuffer(l*o*4);if(t.forceGLPutImageData){this.imageBuffer=s,this.copyGLTo2D=b;return}var u={imageBuffer:s,destinationWidth:l,destinationHeight:o,targetCanvas:h},d,m,p;h.width=l,h.height=o,d=window.performance.now(),C.call(u,this.gl,u),m=window.performance.now()-d,d=window.performance.now(),b.call(u,this.gl,u),p=window.performance.now()-d,m>p?(this.imageBuffer=s,this.copyGLTo2D=b):this.copyGLTo2D=C}},createWebGLCanvas:function(l,o){var r=t.util.createCanvasElement();r.width=l,r.height=o;var n={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},e=r.getContext("webgl",n);e||(e=r.getContext("experimental-webgl",n)),e&&(e.clearColor(0,0,0,0),this.canvas=r,this.gl=e)},applyFilters:function(l,o,r,n,e,a){var h=this.gl,s;a&&(s=this.getCachedTexture(a,o));var u={originalWidth:o.width||o.originalWidth,originalHeight:o.height||o.originalHeight,sourceWidth:r,sourceHeight:n,destinationWidth:r,destinationHeight:n,context:h,sourceTexture:this.createTexture(h,r,n,!s&&o),targetTexture:this.createTexture(h,r,n),originalTexture:s||this.createTexture(h,r,n,!s&&o),passes:l.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:e},d=h.createFramebuffer();return h.bindFramebuffer(h.FRAMEBUFFER,d),l.forEach(function(m){m&&m.applyTo(u)}),_(u),this.copyGLTo2D(h,u),h.bindTexture(h.TEXTURE_2D,null),h.deleteTexture(u.sourceTexture),h.deleteTexture(u.targetTexture),h.deleteFramebuffer(d),e.getContext("2d").setTransform(1,0,0,1,0,0),u},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(l,o,r,n,e){var a=l.createTexture();return l.bindTexture(l.TEXTURE_2D,a),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e||l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,e||l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),n?l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,n):l.texImage2D(l.TEXTURE_2D,0,l.RGBA,o,r,0,l.RGBA,l.UNSIGNED_BYTE,null),a},getCachedTexture:function(l,o){if(this.textureCache[l])return this.textureCache[l];var r=this.createTexture(this.gl,o.width,o.height,o);return this.textureCache[l]=r,r},evictCachesForKey:function(l){this.textureCache[l]&&(this.gl.deleteTexture(this.textureCache[l]),delete this.textureCache[l])},copyGLTo2D:C,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var l=this.gl,o={renderer:"",vendor:""};if(!l)return o;var r=l.getExtension("WEBGL_debug_renderer_info");if(r){var n=l.getParameter(r.UNMASKED_RENDERER_WEBGL),e=l.getParameter(r.UNMASKED_VENDOR_WEBGL);n&&(o.renderer=n.toLowerCase()),e&&(o.vendor=e.toLowerCase())}return this.gpuInfo=o,o}}}();function _(c){var i=c.targetCanvas,l=i.width,o=i.height,r=c.destinationWidth,n=c.destinationHeight;(l!==r||o!==n)&&(i.width=r,i.height=n)}function C(c,i){var l=c.canvas,o=i.targetCanvas,r=o.getContext("2d");r.translate(0,o.height),r.scale(1,-1);var n=l.height-o.height;r.drawImage(l,0,n,o.width,o.height,0,0,o.width,o.height)}function b(c,i){var l=i.targetCanvas,o=l.getContext("2d"),r=i.destinationWidth,n=i.destinationHeight,e=r*n*4,a=new Uint8Array(this.imageBuffer,0,e),h=new Uint8ClampedArray(this.imageBuffer,0,e);c.readPixels(0,0,r,n,c.RGBA,c.UNSIGNED_BYTE,a);var s=new ImageData(h,r,n);o.putImageData(s,0,0)}(function(){var c=function(){};t.Canvas2dFilterBackend=i;function i(){}i.prototype={evictCachesForKey:c,dispose:c,clearWebGLCaches:c,resources:{},applyFilters:function(l,o,r,n,e){var a=e.getContext("2d");a.drawImage(o,0,0,r,n);var h=a.getImageData(0,0,r,n),s=a.getImageData(0,0,r,n),u={sourceWidth:r,sourceHeight:n,imageData:h,originalEl:o,originalImageData:s,canvasEl:e,ctx:a,filterBackend:this};return l.forEach(function(d){d.applyTo(u)}),(u.imageData.width!==r||u.imageData.height!==n)&&(e.width=u.imageData.width,e.height=u.imageData.height),a.putImageData(u.imageData,0,0),u}}})(),t.Image=t.Image||{},t.Image.filters=t.Image.filters||{},t.Image.filters.BaseFilter=t.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(c){c&&this.setOptions(c)},setOptions:function(c){for(var i in c)this[i]=c[i]},createProgram:function(c,i,l){i=i||this.fragmentSource,l=l||this.vertexSource,t.webGlPrecision!=="highp"&&(i=i.replace(/precision highp float/g,"precision "+t.webGlPrecision+" float"));var o=c.createShader(c.VERTEX_SHADER);if(c.shaderSource(o,l),c.compileShader(o),!c.getShaderParameter(o,c.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+c.getShaderInfoLog(o));var r=c.createShader(c.FRAGMENT_SHADER);if(c.shaderSource(r,i),c.compileShader(r),!c.getShaderParameter(r,c.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+c.getShaderInfoLog(r));var n=c.createProgram();if(c.attachShader(n,o),c.attachShader(n,r),c.linkProgram(n),!c.getProgramParameter(n,c.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+c.getProgramInfoLog(n));var e=this.getAttributeLocations(c,n),a=this.getUniformLocations(c,n)||{};return a.uStepW=c.getUniformLocation(n,"uStepW"),a.uStepH=c.getUniformLocation(n,"uStepH"),{program:n,attributeLocations:e,uniformLocations:a}},getAttributeLocations:function(c,i){return{aPosition:c.getAttribLocation(i,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(c,i,l){var o=i.aPosition,r=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,r),c.enableVertexAttribArray(o),c.vertexAttribPointer(o,2,c.FLOAT,!1,0,0),c.bufferData(c.ARRAY_BUFFER,l,c.STATIC_DRAW)},_setupFrameBuffer:function(c){var i=c.context,l,o;c.passes>1?(l=c.destinationWidth,o=c.destinationHeight,(c.sourceWidth!==l||c.sourceHeight!==o)&&(i.deleteTexture(c.targetTexture),c.targetTexture=c.filterBackend.createTexture(i,l,o)),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,c.targetTexture,0)):(i.bindFramebuffer(i.FRAMEBUFFER,null),i.finish())},_swapTextures:function(c){c.passes--,c.pass++;var i=c.targetTexture;c.targetTexture=c.sourceTexture,c.sourceTexture=i},isNeutralState:function(){var c=this.mainParameter,i=t.Image.filters[this.type].prototype;if(c)if(Array.isArray(i[c])){for(var l=i[c].length;l--;)if(this[c][l]!==i[c][l])return!1;return!0}else return i[c]===this[c];else return!1},applyTo:function(c){c.webgl?(this._setupFrameBuffer(c),this.applyToWebGL(c),this._swapTextures(c)):this.applyTo2d(c)},retrieveShader:function(c){return c.programCache.hasOwnProperty(this.type)||(c.programCache[this.type]=this.createProgram(c.context)),c.programCache[this.type]},applyToWebGL:function(c){var i=c.context,l=this.retrieveShader(c);c.pass===0&&c.originalTexture?i.bindTexture(i.TEXTURE_2D,c.originalTexture):i.bindTexture(i.TEXTURE_2D,c.sourceTexture),i.useProgram(l.program),this.sendAttributeData(i,l.attributeLocations,c.aPosition),i.uniform1f(l.uniformLocations.uStepW,1/c.sourceWidth),i.uniform1f(l.uniformLocations.uStepH,1/c.sourceHeight),this.sendUniformData(i,l.uniformLocations),i.viewport(0,0,c.destinationWidth,c.destinationHeight),i.drawArrays(i.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(c,i,l){c.activeTexture(l),c.bindTexture(c.TEXTURE_2D,i),c.activeTexture(c.TEXTURE0)},unbindAdditionalTexture:function(c,i){c.activeTexture(i),c.bindTexture(c.TEXTURE_2D,null),c.activeTexture(c.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(c){this[this.mainParameter]=c},sendUniformData:function(){},createHelpLayer:function(c){if(!c.helpLayer){var i=document.createElement("canvas");i.width=c.sourceWidth,i.height=c.sourceHeight,c.helpLayer=i}},toObject:function(){var c={type:this.type},i=this.mainParameter;return i&&(c[i]=this[i]),c},toJSON:function(){return this.toObject()}}),t.Image.filters.BaseFilter.fromObject=function(c,i){var l=new t.Image.filters[c.type](c);return i&&i(l),l},function(c){var i=c.fabric||(c.fabric={}),l=i.Image.filters,o=i.util.createClass;l.ColorMatrix=o(l.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(r){this.callSuper("initialize",r),this.matrix=this.matrix.slice(0)},applyTo2d:function(r){var n=r.imageData,e=n.data,a=e.length,h=this.matrix,s,u,d,m,p,y=this.colorsOnly;for(p=0;p<a;p+=4)s=e[p],u=e[p+1],d=e[p+2],y?(e[p]=s*h[0]+u*h[1]+d*h[2]+h[4]*255,e[p+1]=s*h[5]+u*h[6]+d*h[7]+h[9]*255,e[p+2]=s*h[10]+u*h[11]+d*h[12]+h[14]*255):(m=e[p+3],e[p]=s*h[0]+u*h[1]+d*h[2]+m*h[3]+h[4]*255,e[p+1]=s*h[5]+u*h[6]+d*h[7]+m*h[8]+h[9]*255,e[p+2]=s*h[10]+u*h[11]+d*h[12]+m*h[13]+h[14]*255,e[p+3]=s*h[15]+u*h[16]+d*h[17]+m*h[18]+h[19]*255)},getUniformLocations:function(r,n){return{uColorMatrix:r.getUniformLocation(n,"uColorMatrix"),uConstants:r.getUniformLocation(n,"uConstants")}},sendUniformData:function(r,n){var e=this.matrix,a=[e[0],e[1],e[2],e[3],e[5],e[6],e[7],e[8],e[10],e[11],e[12],e[13],e[15],e[16],e[17],e[18]],h=[e[4],e[9],e[14],e[19]];r.uniformMatrix4fv(n.uColorMatrix,!1,a),r.uniform4fv(n.uConstants,h)}}),i.Image.filters.ColorMatrix.fromObject=i.Image.filters.BaseFilter.fromObject}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.Image.filters,o=i.util.createClass;l.Brightness=o(l.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(r){if(this.brightness!==0){var n=r.imageData,e=n.data,a,h=e.length,s=Math.round(this.brightness*255);for(a=0;a<h;a+=4)e[a]=e[a]+s,e[a+1]=e[a+1]+s,e[a+2]=e[a+2]+s}},getUniformLocations:function(r,n){return{uBrightness:r.getUniformLocation(n,"uBrightness")}},sendUniformData:function(r,n){r.uniform1f(n.uBrightness,this.brightness)}}),i.Image.filters.Brightness.fromObject=i.Image.filters.BaseFilter.fromObject}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.util.object.extend,o=i.Image.filters,r=i.util.createClass;o.Convolute=r(o.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(n){var e=Math.sqrt(this.matrix.length),a=this.type+"_"+e+"_"+(this.opaque?1:0),h=this.fragmentSource[a];return n.programCache.hasOwnProperty(a)||(n.programCache[a]=this.createProgram(n.context,h)),n.programCache[a]},applyTo2d:function(n){var e=n.imageData,a=e.data,h=this.matrix,s=Math.round(Math.sqrt(h.length)),u=Math.floor(s/2),d=e.width,m=e.height,p=n.ctx.createImageData(d,m),y=p.data,w=this.opaque?1:0,S,E,D,W,K,tt,N,J,$,Z,rt,st,T;for(rt=0;rt<m;rt++)for(Z=0;Z<d;Z++){for(K=(rt*d+Z)*4,S=0,E=0,D=0,W=0,T=0;T<s;T++)for(st=0;st<s;st++)N=rt+T-u,tt=Z+st-u,!(N<0||N>=m||tt<0||tt>=d)&&(J=(N*d+tt)*4,$=h[T*s+st],S+=a[J]*$,E+=a[J+1]*$,D+=a[J+2]*$,w||(W+=a[J+3]*$));y[K]=S,y[K+1]=E,y[K+2]=D,w?y[K+3]=a[K+3]:y[K+3]=W}n.imageData=p},getUniformLocations:function(n,e){return{uMatrix:n.getUniformLocation(e,"uMatrix"),uOpaque:n.getUniformLocation(e,"uOpaque"),uHalfSize:n.getUniformLocation(e,"uHalfSize"),uSize:n.getUniformLocation(e,"uSize")}},sendUniformData:function(n,e){n.uniform1fv(e.uMatrix,this.matrix)},toObject:function(){return l(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),i.Image.filters.Convolute.fromObject=i.Image.filters.BaseFilter.fromObject}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.Image.filters,o=i.util.createClass;l.Grayscale=o(l.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(r){var n=r.imageData,e=n.data,a,h=e.length,s,u=this.mode;for(a=0;a<h;a+=4)u==="average"?s=(e[a]+e[a+1]+e[a+2])/3:u==="lightness"?s=(Math.min(e[a],e[a+1],e[a+2])+Math.max(e[a],e[a+1],e[a+2]))/2:u==="luminosity"&&(s=.21*e[a]+.72*e[a+1]+.07*e[a+2]),e[a]=s,e[a+1]=s,e[a+2]=s},retrieveShader:function(r){var n=this.type+"_"+this.mode;if(!r.programCache.hasOwnProperty(n)){var e=this.fragmentSource[this.mode];r.programCache[n]=this.createProgram(r.context,e)}return r.programCache[n]},getUniformLocations:function(r,n){return{uMode:r.getUniformLocation(n,"uMode")}},sendUniformData:function(r,n){var e=1;r.uniform1i(n.uMode,e)},isNeutralState:function(){return!1}}),i.Image.filters.Grayscale.fromObject=i.Image.filters.BaseFilter.fromObject}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.Image.filters,o=i.util.createClass;l.Invert=o(l.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(r){var n=r.imageData,e=n.data,a,h=e.length;for(a=0;a<h;a+=4)e[a]=255-e[a],e[a+1]=255-e[a+1],e[a+2]=255-e[a+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(r,n){return{uInvert:r.getUniformLocation(n,"uInvert")}},sendUniformData:function(r,n){r.uniform1i(n.uInvert,this.invert)}}),i.Image.filters.Invert.fromObject=i.Image.filters.BaseFilter.fromObject}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.util.object.extend,o=i.Image.filters,r=i.util.createClass;o.Noise=r(o.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(n){if(this.noise!==0){var e=n.imageData,a=e.data,h,s=a.length,u=this.noise,d;for(h=0,s=a.length;h<s;h+=4)d=(.5-Math.random())*u,a[h]+=d,a[h+1]+=d,a[h+2]+=d}},getUniformLocations:function(n,e){return{uNoise:n.getUniformLocation(e,"uNoise"),uSeed:n.getUniformLocation(e,"uSeed")}},sendUniformData:function(n,e){n.uniform1f(e.uNoise,this.noise/255),n.uniform1f(e.uSeed,Math.random())},toObject:function(){return l(this.callSuper("toObject"),{noise:this.noise})}}),i.Image.filters.Noise.fromObject=i.Image.filters.BaseFilter.fromObject}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.Image.filters,o=i.util.createClass;l.Pixelate=o(l.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(r){var n=r.imageData,e=n.data,a=n.height,h=n.width,s,u,d,m,p,y,w,S,E,D,W;for(u=0;u<a;u+=this.blocksize)for(d=0;d<h;d+=this.blocksize)for(s=u*4*h+d*4,m=e[s],p=e[s+1],y=e[s+2],w=e[s+3],D=Math.min(u+this.blocksize,a),W=Math.min(d+this.blocksize,h),S=u;S<D;S++)for(E=d;E<W;E++)s=S*4*h+E*4,e[s]=m,e[s+1]=p,e[s+2]=y,e[s+3]=w},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(r,n){return{uBlocksize:r.getUniformLocation(n,"uBlocksize"),uStepW:r.getUniformLocation(n,"uStepW"),uStepH:r.getUniformLocation(n,"uStepH")}},sendUniformData:function(r,n){r.uniform1f(n.uBlocksize,this.blocksize)}}),i.Image.filters.Pixelate.fromObject=i.Image.filters.BaseFilter.fromObject}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.util.object.extend,o=i.Image.filters,r=i.util.createClass;o.RemoveColor=r(o.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(n){var e=n.imageData,a=e.data,h,s=this.distance*255,u,d,m,p=new i.Color(this.color).getSource(),y=[p[0]-s,p[1]-s,p[2]-s],w=[p[0]+s,p[1]+s,p[2]+s];for(h=0;h<a.length;h+=4)u=a[h],d=a[h+1],m=a[h+2],u>y[0]&&d>y[1]&&m>y[2]&&u<w[0]&&d<w[1]&&m<w[2]&&(a[h+3]=0)},getUniformLocations:function(n,e){return{uLow:n.getUniformLocation(e,"uLow"),uHigh:n.getUniformLocation(e,"uHigh")}},sendUniformData:function(n,e){var a=new i.Color(this.color).getSource(),h=parseFloat(this.distance),s=[0+a[0]/255-h,0+a[1]/255-h,0+a[2]/255-h,1],u=[a[0]/255+h,a[1]/255+h,a[2]/255+h,1];n.uniform4fv(e.uLow,s),n.uniform4fv(e.uHigh,u)},toObject:function(){return l(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),i.Image.filters.RemoveColor.fromObject=i.Image.filters.BaseFilter.fromObject}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.Image.filters,o=i.util.createClass,r={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var n in r)l[n]=o(l.ColorMatrix,{type:n,matrix:r[n],mainParameter:!1,colorsOnly:!0}),i.Image.filters[n].fromObject=i.Image.filters.BaseFilter.fromObject}(f),function(c){var i=c.fabric,l=i.Image.filters,o=i.util.createClass;l.BlendColor=o(l.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(r){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[r]+`}
}`},retrieveShader:function(r){var n=this.type+"_"+this.mode,e;return r.programCache.hasOwnProperty(n)||(e=this.buildSource(this.mode),r.programCache[n]=this.createProgram(r.context,e)),r.programCache[n]},applyTo2d:function(r){var n=r.imageData,e=n.data,a=e.length,h,s,u,d,m,p,y,w=1-this.alpha;y=new i.Color(this.color).getSource(),h=y[0]*this.alpha,s=y[1]*this.alpha,u=y[2]*this.alpha;for(var S=0;S<a;S+=4)switch(d=e[S],m=e[S+1],p=e[S+2],this.mode){case"multiply":e[S]=d*h/255,e[S+1]=m*s/255,e[S+2]=p*u/255;break;case"screen":e[S]=255-(255-d)*(255-h)/255,e[S+1]=255-(255-m)*(255-s)/255,e[S+2]=255-(255-p)*(255-u)/255;break;case"add":e[S]=d+h,e[S+1]=m+s,e[S+2]=p+u;break;case"diff":case"difference":e[S]=Math.abs(d-h),e[S+1]=Math.abs(m-s),e[S+2]=Math.abs(p-u);break;case"subtract":e[S]=d-h,e[S+1]=m-s,e[S+2]=p-u;break;case"darken":e[S]=Math.min(d,h),e[S+1]=Math.min(m,s),e[S+2]=Math.min(p,u);break;case"lighten":e[S]=Math.max(d,h),e[S+1]=Math.max(m,s),e[S+2]=Math.max(p,u);break;case"overlay":e[S]=h<128?2*d*h/255:255-2*(255-d)*(255-h)/255,e[S+1]=s<128?2*m*s/255:255-2*(255-m)*(255-s)/255,e[S+2]=u<128?2*p*u/255:255-2*(255-p)*(255-u)/255;break;case"exclusion":e[S]=h+d-2*h*d/255,e[S+1]=s+m-2*s*m/255,e[S+2]=u+p-2*u*p/255;break;case"tint":e[S]=h+d*w,e[S+1]=s+m*w,e[S+2]=u+p*w}},getUniformLocations:function(r,n){return{uColor:r.getUniformLocation(n,"uColor")}},sendUniformData:function(r,n){var e=new i.Color(this.color).getSource();e[0]=this.alpha*e[0]/255,e[1]=this.alpha*e[1]/255,e[2]=this.alpha*e[2]/255,e[3]=this.alpha,r.uniform4fv(n.uColor,e)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),i.Image.filters.BlendColor.fromObject=i.Image.filters.BaseFilter.fromObject}(f),function(c){var i=c.fabric,l=i.Image.filters,o=i.util.createClass;l.BlendImage=o(l.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(r){var n=this.type+"_"+this.mode,e=this.fragmentSource[this.mode];return r.programCache.hasOwnProperty(n)||(r.programCache[n]=this.createProgram(r.context,e)),r.programCache[n]},applyToWebGL:function(r){var n=r.context,e=this.createTexture(r.filterBackend,this.image);this.bindAdditionalTexture(n,e,n.TEXTURE1),this.callSuper("applyToWebGL",r),this.unbindAdditionalTexture(n,n.TEXTURE1)},createTexture:function(r,n){return r.getCachedTexture(n.cacheKey,n._element)},calculateMatrix:function(){var r=this.image,n=r._element.width,e=r._element.height;return[1/r.scaleX,0,0,0,1/r.scaleY,0,-r.left/n,-r.top/e,1]},applyTo2d:function(r){var n=r.imageData,e=r.filterBackend.resources,a=n.data,h=a.length,s=n.width,u=n.height,d,m,p,y,w,S,E,D,W,K,tt=this.image,N;e.blendImage||(e.blendImage=i.util.createCanvasElement()),W=e.blendImage,K=W.getContext("2d"),W.width!==s||W.height!==u?(W.width=s,W.height=u):K.clearRect(0,0,s,u),K.setTransform(tt.scaleX,0,0,tt.scaleY,tt.left,tt.top),K.drawImage(tt._element,0,0,s,u),N=K.getImageData(0,0,s,u).data;for(var J=0;J<h;J+=4)switch(w=a[J],S=a[J+1],E=a[J+2],D=a[J+3],d=N[J],m=N[J+1],p=N[J+2],y=N[J+3],this.mode){case"multiply":a[J]=w*d/255,a[J+1]=S*m/255,a[J+2]=E*p/255,a[J+3]=D*y/255;break;case"mask":a[J+3]=y;break}},getUniformLocations:function(r,n){return{uTransformMatrix:r.getUniformLocation(n,"uTransformMatrix"),uImage:r.getUniformLocation(n,"uImage")}},sendUniformData:function(r,n){var e=this.calculateMatrix();r.uniform1i(n.uImage,1),r.uniformMatrix3fv(n.uTransformMatrix,!1,e)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),i.Image.filters.BlendImage.fromObject=function(r,n){i.Image.fromObject(r.image,function(e){var a=i.util.object.clone(r);a.image=e,n(new i.Image.filters.BlendImage(a))})}}(f),function(c){var i=c.fabric||(c.fabric={}),l=Math.pow,o=Math.floor,r=Math.sqrt,n=Math.abs,e=Math.round,a=Math.sin,h=Math.ceil,s=i.Image.filters,u=i.util.createClass;s.Resize=u(s.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(d,m){return{uDelta:d.getUniformLocation(m,"uDelta"),uTaps:d.getUniformLocation(m,"uTaps")}},sendUniformData:function(d,m){d.uniform2fv(m.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),d.uniform1fv(m.uTaps,this.taps)},retrieveShader:function(d){var m=this.getFilterWindow(),p=this.type+"_"+m;if(!d.programCache.hasOwnProperty(p)){var y=this.generateShader(m);d.programCache[p]=this.createProgram(d.context,y)}return d.programCache[p]},getFilterWindow:function(){var d=this.tempScale;return Math.ceil(this.lanczosLobes/d)},getTaps:function(){for(var d=this.lanczosCreate(this.lanczosLobes),m=this.tempScale,p=this.getFilterWindow(),y=new Array(p),w=1;w<=p;w++)y[w-1]=d(w*m);return y},generateShader:function(y){for(var m=new Array(y),p=this.fragmentSourceTOP,y,w=1;w<=y;w++)m[w-1]=w+".0 * uDelta";return p+="uniform float uTaps["+y+`];
`,p+=`void main() {
`,p+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,p+=`  float sum = 1.0;
`,m.forEach(function(S,E){p+="  color += texture2D(uTexture, vTexCoord + "+S+") * uTaps["+E+`];
`,p+="  color += texture2D(uTexture, vTexCoord - "+S+") * uTaps["+E+`];
`,p+="  sum += 2.0 * uTaps["+E+`];
`}),p+=`  gl_FragColor = color / sum;
`,p+="}",p},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(d){d.webgl?(d.passes++,this.width=d.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=d.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),d.destinationWidth=this.dW,this._setupFrameBuffer(d),this.applyToWebGL(d),this._swapTextures(d),d.sourceWidth=d.destinationWidth,this.height=d.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),d.destinationHeight=this.dH,this._setupFrameBuffer(d),this.applyToWebGL(d),this._swapTextures(d),d.sourceHeight=d.destinationHeight):this.applyTo2d(d)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(d){return function(m){if(m>=d||m<=-d)return 0;if(m<11920929e-14&&m>-11920929e-14)return 1;m*=Math.PI;var p=m/d;return a(m)/m*a(p)/p}},applyTo2d:function(d){var m=d.imageData,p=this.scaleX,y=this.scaleY;this.rcpScaleX=1/p,this.rcpScaleY=1/y;var w=m.width,S=m.height,E=e(w*p),D=e(S*y),W;this.resizeType==="sliceHack"?W=this.sliceByTwo(d,w,S,E,D):this.resizeType==="hermite"?W=this.hermiteFastResize(d,w,S,E,D):this.resizeType==="bilinear"?W=this.bilinearFiltering(d,w,S,E,D):this.resizeType==="lanczos"&&(W=this.lanczosResize(d,w,S,E,D)),d.imageData=W},sliceByTwo:function(d,m,p,y,w){var S=d.imageData,E=.5,D=!1,W=!1,K=m*E,tt=p*E,N=i.filterBackend.resources,J,$,Z=0,rt=0,st=m,T=0;for(N.sliceByTwo||(N.sliceByTwo=document.createElement("canvas")),J=N.sliceByTwo,(J.width<m*1.5||J.height<p)&&(J.width=m*1.5,J.height=p),$=J.getContext("2d"),$.clearRect(0,0,m*1.5,p),$.putImageData(S,0,0),y=o(y),w=o(w);!D||!W;)m=K,p=tt,y<o(K*E)?K=o(K*E):(K=y,D=!0),w<o(tt*E)?tt=o(tt*E):(tt=w,W=!0),$.drawImage(J,Z,rt,m,p,st,T,K,tt),Z=st,rt=T,T+=tt;return $.getImageData(Z,rt,y,w)},lanczosResize:function(d,m,p,y,w){function S(P){var k,B,O,x,M,R,Y,j,G,F,it;for(T.x=(P+.5)*tt,A.x=o(T.x),k=0;k<w;k++){for(T.y=(k+.5)*N,A.y=o(T.y),M=0,R=0,Y=0,j=0,G=0,B=A.x-Z;B<=A.x+Z;B++)if(!(B<0||B>=m)){F=o(1e3*n(B-T.x)),st[F]||(st[F]={});for(var X=A.y-rt;X<=A.y+rt;X++)X<0||X>=p||(it=o(1e3*n(X-T.y)),st[F][it]||(st[F][it]=K(r(l(F*J,2)+l(it*$,2))/1e3)),O=st[F][it],O>0&&(x=(X*m+B)*4,M+=O,R+=O*E[x],Y+=O*E[x+1],j+=O*E[x+2],G+=O*E[x+3]))}x=(k*y+P)*4,W[x]=R/M,W[x+1]=Y/M,W[x+2]=j/M,W[x+3]=G/M}return++P<y?S(P):D}var E=d.imageData.data,D=d.ctx.createImageData(y,w),W=D.data,K=this.lanczosCreate(this.lanczosLobes),tt=this.rcpScaleX,N=this.rcpScaleY,J=2/this.rcpScaleX,$=2/this.rcpScaleY,Z=h(tt*this.lanczosLobes/2),rt=h(N*this.lanczosLobes/2),st={},T={},A={};return S(0)},bilinearFiltering:function(d,m,p,y,w){var S,E,D,W,K,tt,N,J,$,Z,rt,st,T=0,A,P=this.rcpScaleX,k=this.rcpScaleY,B=4*(m-1),O=d.imageData,x=O.data,M=d.ctx.createImageData(y,w),R=M.data;for(N=0;N<w;N++)for(J=0;J<y;J++)for(K=o(P*J),tt=o(k*N),$=P*J-K,Z=k*N-tt,A=4*(tt*m+K),rt=0;rt<4;rt++)S=x[A+rt],E=x[A+4+rt],D=x[A+B+rt],W=x[A+B+4+rt],st=S*(1-$)*(1-Z)+E*$*(1-Z)+D*Z*(1-$)+W*$*Z,R[T++]=st;return M},hermiteFastResize:function(d,m,p,y,w){for(var S=this.rcpScaleX,E=this.rcpScaleY,D=h(S/2),W=h(E/2),K=d.imageData,tt=K.data,N=d.ctx.createImageData(y,w),J=N.data,$=0;$<w;$++)for(var Z=0;Z<y;Z++){for(var rt=(Z+$*y)*4,st=0,T=0,A=0,P=0,k=0,B=0,O=0,x=($+.5)*E,M=o($*E);M<($+1)*E;M++)for(var R=n(x-(M+.5))/W,Y=(Z+.5)*S,j=R*R,G=o(Z*S);G<(Z+1)*S;G++){var F=n(Y-(G+.5))/D,it=r(j+F*F);it>1&&it<-1||(st=2*it*it*it-3*it*it+1,st>0&&(F=4*(G+M*m),O+=st*tt[F+3],A+=st,tt[F+3]<255&&(st=st*tt[F+3]/250),P+=st*tt[F],k+=st*tt[F+1],B+=st*tt[F+2],T+=st))}J[rt]=P/T,J[rt+1]=k/T,J[rt+2]=B/T,J[rt+3]=O/A}return N},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),i.Image.filters.Resize.fromObject=i.Image.filters.BaseFilter.fromObject}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.Image.filters,o=i.util.createClass;l.Contrast=o(l.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(r){if(this.contrast!==0){var n=r.imageData,e,h,a=n.data,h=a.length,s=Math.floor(this.contrast*255),u=259*(s+255)/(255*(259-s));for(e=0;e<h;e+=4)a[e]=u*(a[e]-128)+128,a[e+1]=u*(a[e+1]-128)+128,a[e+2]=u*(a[e+2]-128)+128}},getUniformLocations:function(r,n){return{uContrast:r.getUniformLocation(n,"uContrast")}},sendUniformData:function(r,n){r.uniform1f(n.uContrast,this.contrast)}}),i.Image.filters.Contrast.fromObject=i.Image.filters.BaseFilter.fromObject}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.Image.filters,o=i.util.createClass;l.Saturation=o(l.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(r){if(this.saturation!==0){var n=r.imageData,e=n.data,a=e.length,h=-this.saturation,s,u;for(s=0;s<a;s+=4)u=Math.max(e[s],e[s+1],e[s+2]),e[s]+=u!==e[s]?(u-e[s])*h:0,e[s+1]+=u!==e[s+1]?(u-e[s+1])*h:0,e[s+2]+=u!==e[s+2]?(u-e[s+2])*h:0}},getUniformLocations:function(r,n){return{uSaturation:r.getUniformLocation(n,"uSaturation")}},sendUniformData:function(r,n){r.uniform1f(n.uSaturation,-this.saturation)}}),i.Image.filters.Saturation.fromObject=i.Image.filters.BaseFilter.fromObject}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.Image.filters,o=i.util.createClass;l.Vibrance=o(l.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(r){if(this.vibrance!==0){var n=r.imageData,e=n.data,a=e.length,h=-this.vibrance,s,u,d,m;for(s=0;s<a;s+=4)u=Math.max(e[s],e[s+1],e[s+2]),d=(e[s]+e[s+1]+e[s+2])/3,m=Math.abs(u-d)*2/255*h,e[s]+=u!==e[s]?(u-e[s])*m:0,e[s+1]+=u!==e[s+1]?(u-e[s+1])*m:0,e[s+2]+=u!==e[s+2]?(u-e[s+2])*m:0}},getUniformLocations:function(r,n){return{uVibrance:r.getUniformLocation(n,"uVibrance")}},sendUniformData:function(r,n){r.uniform1f(n.uVibrance,-this.vibrance)}}),i.Image.filters.Vibrance.fromObject=i.Image.filters.BaseFilter.fromObject}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.Image.filters,o=i.util.createClass;l.Blur=o(l.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(r){r.webgl?(this.aspectRatio=r.sourceWidth/r.sourceHeight,r.passes++,this._setupFrameBuffer(r),this.horizontal=!0,this.applyToWebGL(r),this._swapTextures(r),this._setupFrameBuffer(r),this.horizontal=!1,this.applyToWebGL(r),this._swapTextures(r)):this.applyTo2d(r)},applyTo2d:function(r){r.imageData=this.simpleBlur(r)},simpleBlur:function(r){var n=r.filterBackend.resources,e,a,h=r.imageData.width,s=r.imageData.height;n.blurLayer1||(n.blurLayer1=i.util.createCanvasElement(),n.blurLayer2=i.util.createCanvasElement()),e=n.blurLayer1,a=n.blurLayer2,(e.width!==h||e.height!==s)&&(a.width=e.width=h,a.height=e.height=s);var u=e.getContext("2d"),d=a.getContext("2d"),m=15,p,y,w,S,E=this.blur*.06*.5;for(u.putImageData(r.imageData,0,0),d.clearRect(0,0,h,s),S=-m;S<=m;S++)p=(Math.random()-.5)/4,y=S/m,w=E*y*h+p,d.globalAlpha=1-Math.abs(y),d.drawImage(e,w,p),u.drawImage(a,0,0),d.globalAlpha=1,d.clearRect(0,0,a.width,a.height);for(S=-m;S<=m;S++)p=(Math.random()-.5)/4,y=S/m,w=E*y*s+p,d.globalAlpha=1-Math.abs(y),d.drawImage(e,p,w),u.drawImage(a,0,0),d.globalAlpha=1,d.clearRect(0,0,a.width,a.height);r.ctx.drawImage(e,0,0);var D=r.ctx.getImageData(0,0,e.width,e.height);return u.globalAlpha=1,u.clearRect(0,0,e.width,e.height),D},getUniformLocations:function(r,n){return{delta:r.getUniformLocation(n,"uDelta")}},sendUniformData:function(r,n){var e=this.chooseRightDelta();r.uniform2fv(n.delta,e)},chooseRightDelta:function(){var r=1,n=[0,0],e;return this.horizontal?this.aspectRatio>1&&(r=1/this.aspectRatio):this.aspectRatio<1&&(r=this.aspectRatio),e=r*this.blur*.12,this.horizontal?n[0]=e:n[1]=e,n}}),l.Blur.fromObject=i.Image.filters.BaseFilter.fromObject}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.Image.filters,o=i.util.createClass;l.Gamma=o(l.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(r){this.gamma=[1,1,1],l.BaseFilter.prototype.initialize.call(this,r)},applyTo2d:function(r){var n=r.imageData,e=n.data,a=this.gamma,h=e.length,s=1/a[0],u=1/a[1],d=1/a[2],m;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),m=0,h=256;m<h;m++)this.rVals[m]=Math.pow(m/255,s)*255,this.gVals[m]=Math.pow(m/255,u)*255,this.bVals[m]=Math.pow(m/255,d)*255;for(m=0,h=e.length;m<h;m+=4)e[m]=this.rVals[e[m]],e[m+1]=this.gVals[e[m+1]],e[m+2]=this.bVals[e[m+2]]},getUniformLocations:function(r,n){return{uGamma:r.getUniformLocation(n,"uGamma")}},sendUniformData:function(r,n){r.uniform3fv(n.uGamma,this.gamma)}}),i.Image.filters.Gamma.fromObject=i.Image.filters.BaseFilter.fromObject}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.Image.filters,o=i.util.createClass;l.Composed=o(l.BaseFilter,{type:"Composed",subFilters:[],initialize:function(r){this.callSuper("initialize",r),this.subFilters=this.subFilters.slice(0)},applyTo:function(r){r.passes+=this.subFilters.length-1,this.subFilters.forEach(function(n){n.applyTo(r)})},toObject:function(){return i.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(r){return r.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(r){return!r.isNeutralState()})}}),i.Image.filters.Composed.fromObject=function(r,n){var e=r.subFilters||[],a=e.map(function(s){return new i.Image.filters[s.type](s)}),h=new i.Image.filters.Composed({subFilters:a});return n&&n(h),h}}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.Image.filters,o=i.util.createClass;l.HueRotation=o(l.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var r=this.rotation*Math.PI,n=i.util.cos(r),e=i.util.sin(r),a=1/3,h=Math.sqrt(a)*e,s=1-n;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=n+s/3,this.matrix[1]=a*s-h,this.matrix[2]=a*s+h,this.matrix[5]=a*s+h,this.matrix[6]=n+a*s,this.matrix[7]=a*s-h,this.matrix[10]=a*s-h,this.matrix[11]=a*s+h,this.matrix[12]=n+a*s},isNeutralState:function(r){return this.calculateMatrix(),l.BaseFilter.prototype.isNeutralState.call(this,r)},applyTo:function(r){this.calculateMatrix(),l.BaseFilter.prototype.applyTo.call(this,r)}}),i.Image.filters.HueRotation.fromObject=i.Image.filters.BaseFilter.fromObject}(f),function(c){var i=c.fabric||(c.fabric={}),l=i.util.object.clone;if(i.Text){i.warn("fabric.Text is already defined");return}var o="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");i.Text=i.util.createClass(i.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:i.Object.prototype.stateProperties.concat(o),cacheProperties:i.Object.prototype.cacheProperties.concat(o),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(r,n){this.styles=n?n.styles||{}:{},this.text=r,this.__skipDimension=!0,this.callSuper("initialize",n),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var r=this.path;r&&(r.segmentsInfo=i.util.getPathSegmentsInfo(r.path))},getMeasuringContext:function(){return i._measuringContext||(i._measuringContext=this.canvas&&this.canvas.contextCache||i.util.createCanvasElement().getContext("2d")),i._measuringContext},_splitText:function(){var r=this._splitTextIntoLines(this.text);return this.textLines=r.lines,this._textLines=r.graphemeLines,this._unwrappedTextLines=r._unwrappedLines,this._text=r.graphemeText,r},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var r,n,e,a,h,s,u,d=0,m=this._textLines.length;d<m;d++)if(!(this.textAlign!=="justify"&&(d===m-1||this.isEndOfWrapping(d)))&&(a=0,h=this._textLines[d],n=this.getLineWidth(d),n<this.width&&(u=this.textLines[d].match(this._reSpacesAndTabs)))){e=u.length,r=(this.width-n)/e;for(var p=0,y=h.length;p<=y;p++)s=this.__charBounds[d][p],this._reSpaceAndTab.test(h[p])?(s.width+=r,s.kernedWidth+=r,s.left+=a,a+=r):s.left+=a}},isEndOfWrapping:function(r){return r===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var r=this.callSuper("_getCacheCanvasDimensions"),n=this.fontSize;return r.width+=n*r.zoomX,r.height+=n*r.zoomY,r},_render:function(r){var n=this.path;n&&!n.isNotVisible()&&n._render(r),this._setTextStyles(r),this._renderTextLinesBackground(r),this._renderTextDecoration(r,"underline"),this._renderText(r),this._renderTextDecoration(r,"overline"),this._renderTextDecoration(r,"linethrough")},_renderText:function(r){this.paintFirst==="stroke"?(this._renderTextStroke(r),this._renderTextFill(r)):(this._renderTextFill(r),this._renderTextStroke(r))},_setTextStyles:function(r,n,e){if(r.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":r.textBaseline="middle";break;case"ascender":r.textBaseline="top";break;case"descender":r.textBaseline="bottom";break}r.font=this._getFontDeclaration(n,e)},calcTextWidth:function(){for(var r=this.getLineWidth(0),n=1,e=this._textLines.length;n<e;n++){var a=this.getLineWidth(n);a>r&&(r=a)}return r},_renderTextLine:function(r,n,e,a,h,s){this._renderChars(r,n,e,a,h,s)},_renderTextLinesBackground:function(r){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var n,e,a=r.fillStyle,h,s,u=this._getLeftOffset(),d=this._getTopOffset(),m=0,p=0,y,w,S=this.path,E,D=0,W=this._textLines.length;D<W;D++){if(n=this.getHeightOfLine(D),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",D)){d+=n;continue}h=this._textLines[D],e=this._getLineLeftOffset(D),p=0,m=0,s=this.getValueOfPropertyAt(D,0,"textBackgroundColor");for(var K=0,tt=h.length;K<tt;K++)y=this.__charBounds[D][K],w=this.getValueOfPropertyAt(D,K,"textBackgroundColor"),S?(r.save(),r.translate(y.renderLeft,y.renderTop),r.rotate(y.angle),r.fillStyle=w,w&&r.fillRect(-y.width/2,-n/this.lineHeight*(1-this._fontSizeFraction),y.width,n/this.lineHeight),r.restore()):w!==s?(E=u+e+m,this.direction==="rtl"&&(E=this.width-E-p),r.fillStyle=s,s&&r.fillRect(E,d,p,n/this.lineHeight),m=y.left,p=y.width,s=w):p+=y.kernedWidth;w&&!S&&(E=u+e+m,this.direction==="rtl"&&(E=this.width-E-p),r.fillStyle=w,r.fillRect(E,d,p,n/this.lineHeight)),d+=n}r.fillStyle=a,this._removeShadow(r)}},getFontCache:function(r){var n=r.fontFamily.toLowerCase();i.charWidthsCache[n]||(i.charWidthsCache[n]={});var e=i.charWidthsCache[n],a=r.fontStyle.toLowerCase()+"_"+(r.fontWeight+"").toLowerCase();return e[a]||(e[a]={}),e[a]},_measureChar:function(r,n,e,a){var h=this.getFontCache(n),s=this._getFontDeclaration(n),u=this._getFontDeclaration(a),d=e+r,m=s===u,p,y,w,S=n.fontSize/this.CACHE_FONT_SIZE,E;if(e&&h[e]!==void 0&&(w=h[e]),h[r]!==void 0&&(E=p=h[r]),m&&h[d]!==void 0&&(y=h[d],E=y-w),p===void 0||w===void 0||y===void 0){var D=this.getMeasuringContext();this._setTextStyles(D,n,!0)}return p===void 0&&(E=p=D.measureText(r).width,h[r]=p),w===void 0&&m&&e&&(w=D.measureText(e).width,h[e]=w),m&&y===void 0&&(y=D.measureText(d).width,h[d]=y,E=y-w),{width:p*S,kernedWidth:E*S}},getHeightOfChar:function(r,n){return this.getValueOfPropertyAt(r,n,"fontSize")},measureLine:function(r){var n=this._measureLine(r);return this.charSpacing!==0&&(n.width-=this._getWidthOfCharSpacing()),n.width<0&&(n.width=0),n},_measureLine:function(r){var n=0,e,a,h=this._textLines[r],s,u,d=0,m=new Array(h.length),p=0,y,w,S=this.path,E=this.pathSide==="right";for(this.__charBounds[r]=m,e=0;e<h.length;e++)a=h[e],u=this._getGraphemeBox(a,r,e,s),m[e]=u,n+=u.kernedWidth,s=a;if(m[e]={left:u?u.left+u.width:0,width:0,kernedWidth:0,height:this.fontSize},S){switch(w=S.segmentsInfo[S.segmentsInfo.length-1].length,y=i.util.getPointOnPath(S.path,0,S.segmentsInfo),y.x+=S.pathOffset.x,y.y+=S.pathOffset.y,this.textAlign){case"left":p=E?w-n:0;break;case"center":p=(w-n)/2;break;case"right":p=E?0:w-n;break}for(p+=this.pathStartOffset*(E?-1:1),e=E?h.length-1:0;E?e>=0:e<h.length;E?e--:e++)u=m[e],p>w?p%=w:p<0&&(p+=w),this._setGraphemeOnPath(p,u,y),p+=u.kernedWidth}return{width:n,numOfSpaces:d}},_setGraphemeOnPath:function(r,n,e){var a=r+n.kernedWidth/2,h=this.path,s=i.util.getPointOnPath(h.path,a,h.segmentsInfo);n.renderLeft=s.x-e.x,n.renderTop=s.y-e.y,n.angle=s.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(r,n,e,a,h){var s=this.getCompleteStyleDeclaration(n,e),u=a?this.getCompleteStyleDeclaration(n,e-1):{},d=this._measureChar(r,s,a,u),m=d.kernedWidth,p=d.width,y;this.charSpacing!==0&&(y=this._getWidthOfCharSpacing(),p+=y,m+=y);var w={width:p,left:0,height:s.fontSize,kernedWidth:m,deltaY:s.deltaY};if(e>0&&!h){var S=this.__charBounds[n][e-1];w.left=S.left+S.width+d.kernedWidth-d.width}return w},getHeightOfLine:function(r){if(this.__lineHeights[r])return this.__lineHeights[r];for(var n=this._textLines[r],e=this.getHeightOfChar(r,0),a=1,h=n.length;a<h;a++)e=Math.max(this.getHeightOfChar(r,a),e);return this.__lineHeights[r]=e*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var r,n=0,e=0,a=this._textLines.length;e<a;e++)r=this.getHeightOfLine(e),n+=e===a-1?r/this.lineHeight:r;return n},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(r,n){r.save();for(var e=0,a=this._getLeftOffset(),h=this._getTopOffset(),s=0,u=this._textLines.length;s<u;s++){var d=this.getHeightOfLine(s),m=d/this.lineHeight,p=this._getLineLeftOffset(s);this._renderTextLine(n,r,this._textLines[s],a+p,h+e+m,s),e+=d}r.restore()},_renderTextFill:function(r){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(r,"fillText")},_renderTextStroke:function(r){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(r),r.save(),this._setLineDash(r,this.strokeDashArray),r.beginPath(),this._renderTextCommon(r,"strokeText"),r.closePath(),r.restore())},_renderChars:function(r,n,e,a,h,s){var u=this.getHeightOfLine(s),d=this.textAlign.indexOf("justify")!==-1,m,p,y="",w,S=0,E,D=this.path,W=!d&&this.charSpacing===0&&this.isEmptyStyles(s)&&!D,K=this.direction==="ltr",tt=this.direction==="ltr"?1:-1,N,J=n.canvas.getAttribute("dir");if(n.save(),J!==this.direction&&(n.canvas.setAttribute("dir",K?"ltr":"rtl"),n.direction=K?"ltr":"rtl",n.textAlign=K?"left":"right"),h-=u*this._fontSizeFraction/this.lineHeight,W){this._renderChar(r,n,s,0,e.join(""),a,h,u),n.restore();return}for(var $=0,Z=e.length-1;$<=Z;$++)E=$===Z||this.charSpacing||D,y+=e[$],w=this.__charBounds[s][$],S===0?(a+=tt*(w.kernedWidth-w.width),S+=w.width):S+=w.kernedWidth,d&&!E&&this._reSpaceAndTab.test(e[$])&&(E=!0),E||(m=m||this.getCompleteStyleDeclaration(s,$),p=this.getCompleteStyleDeclaration(s,$+1),E=i.util.hasStyleChanged(m,p,!1)),E&&(D?(n.save(),n.translate(w.renderLeft,w.renderTop),n.rotate(w.angle),this._renderChar(r,n,s,$,y,-S/2,0,u),n.restore()):(N=a,this._renderChar(r,n,s,$,y,N,h,u)),y="",m=p,a+=tt*S,S=0);n.restore()},_applyPatternGradientTransformText:function(r){var n=i.util.createCanvasElement(),e,a=this.width+this.strokeWidth,h=this.height+this.strokeWidth;return n.width=a,n.height=h,e=n.getContext("2d"),e.beginPath(),e.moveTo(0,0),e.lineTo(a,0),e.lineTo(a,h),e.lineTo(0,h),e.closePath(),e.translate(a/2,h/2),e.fillStyle=r.toLive(e),this._applyPatternGradientTransform(e,r),e.fill(),e.createPattern(n,"no-repeat")},handleFiller:function(r,n,e){var a,h;return e.toLive?e.gradientUnits==="percentage"||e.gradientTransform||e.patternTransform?(a=-this.width/2,h=-this.height/2,r.translate(a,h),r[n]=this._applyPatternGradientTransformText(e),{offsetX:a,offsetY:h}):(r[n]=e.toLive(r,this),this._applyPatternGradientTransform(r,e)):(r[n]=e,{offsetX:0,offsetY:0})},_setStrokeStyles:function(r,n){return r.lineWidth=n.strokeWidth,r.lineCap=this.strokeLineCap,r.lineDashOffset=this.strokeDashOffset,r.lineJoin=this.strokeLineJoin,r.miterLimit=this.strokeMiterLimit,this.handleFiller(r,"strokeStyle",n.stroke)},_setFillStyles:function(r,n){return this.handleFiller(r,"fillStyle",n.fill)},_renderChar:function(r,n,e,a,h,s,u){var d=this._getStyleDeclaration(e,a),m=this.getCompleteStyleDeclaration(e,a),p=r==="fillText"&&m.fill,y=r==="strokeText"&&m.stroke&&m.strokeWidth,w,S;!y&&!p||(n.save(),p&&(w=this._setFillStyles(n,m)),y&&(S=this._setStrokeStyles(n,m)),n.font=this._getFontDeclaration(m),d&&d.textBackgroundColor&&this._removeShadow(n),d&&d.deltaY&&(u+=d.deltaY),p&&n.fillText(h,s-w.offsetX,u-w.offsetY),y&&n.strokeText(h,s-S.offsetX,u-S.offsetY),n.restore())},setSuperscript:function(r,n){return this._setScript(r,n,this.superscript)},setSubscript:function(r,n){return this._setScript(r,n,this.subscript)},_setScript:function(r,n,e){var a=this.get2DCursorLocation(r,!0),h=this.getValueOfPropertyAt(a.lineIndex,a.charIndex,"fontSize"),s=this.getValueOfPropertyAt(a.lineIndex,a.charIndex,"deltaY"),u={fontSize:h*e.size,deltaY:s+h*e.baseline};return this.setSelectionStyles(u,r,n),this},_getLineLeftOffset:function(r){var n=this.getLineWidth(r),e=this.width-n,a=this.textAlign,h=this.direction,u,s=0,u=this.isEndOfWrapping(r);return a==="justify"||a==="justify-center"&&!u||a==="justify-right"&&!u||a==="justify-left"&&!u?0:(a==="center"&&(s=e/2),a==="right"&&(s=e),a==="justify-center"&&(s=e/2),a==="justify-right"&&(s=e),h==="rtl"&&(s-=e),s)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var r=this._forceClearCache;return r||(r=this.hasStateChanged("_dimensionAffectingProps")),r&&(this.dirty=!0,this._forceClearCache=!1),r},getLineWidth:function(r){if(this.__lineWidths[r]!==void 0)return this.__lineWidths[r];var n=this.measureLine(r),e=n.width;return this.__lineWidths[r]=e,e},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(r,n,e){var a=this._getStyleDeclaration(r,n);return a&&typeof a[e]<"u"?a[e]:this[e]},_renderTextDecoration:function(r,n){if(!(!this[n]&&!this.styleHas(n))){for(var e,a,h,s,u,d,m,p,y=this._getLeftOffset(),w=this._getTopOffset(),S,E,D,W,K,tt,N,J,$=this.path,Z=this._getWidthOfCharSpacing(),rt=this.offsets[n],st=0,T=this._textLines.length;st<T;st++){if(e=this.getHeightOfLine(st),!this[n]&&!this.styleHas(n,st)){w+=e;continue}m=this._textLines[st],tt=e/this.lineHeight,s=this._getLineLeftOffset(st),E=0,D=0,p=this.getValueOfPropertyAt(st,0,n),J=this.getValueOfPropertyAt(st,0,"fill"),S=w+tt*(1-this._fontSizeFraction),a=this.getHeightOfChar(st,0),u=this.getValueOfPropertyAt(st,0,"deltaY");for(var A=0,P=m.length;A<P;A++)if(W=this.__charBounds[st][A],K=this.getValueOfPropertyAt(st,A,n),N=this.getValueOfPropertyAt(st,A,"fill"),h=this.getHeightOfChar(st,A),d=this.getValueOfPropertyAt(st,A,"deltaY"),$&&K&&N)r.save(),r.fillStyle=J,r.translate(W.renderLeft,W.renderTop),r.rotate(W.angle),r.fillRect(-W.kernedWidth/2,rt*h+d,W.kernedWidth,this.fontSize/15),r.restore();else if((K!==p||N!==J||h!==a||d!==u)&&D>0){var k=y+s+E;this.direction==="rtl"&&(k=this.width-k-D),p&&J&&(r.fillStyle=J,r.fillRect(k,S+rt*a+u,D,this.fontSize/15)),E=W.left,D=W.width,p=K,J=N,a=h,u=d}else D+=W.kernedWidth;var k=y+s+E;this.direction==="rtl"&&(k=this.width-k-D),r.fillStyle=N,K&&N&&r.fillRect(k,S+rt*a+u,D-Z,this.fontSize/15),w+=e}this._removeShadow(r)}},_getFontDeclaration:function(r,n){var e=r||this,a=this.fontFamily,h=i.Text.genericFonts.indexOf(a.toLowerCase())>-1,s=a===void 0||a.indexOf("'")>-1||a.indexOf(",")>-1||a.indexOf('"')>-1||h?e.fontFamily:'"'+e.fontFamily+'"';return[i.isLikelyNode?e.fontWeight:e.fontStyle,i.isLikelyNode?e.fontStyle:e.fontWeight,n?this.CACHE_FONT_SIZE+"px":e.fontSize+"px",s].join(" ")},render:function(r){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",r)))},_splitTextIntoLines:function(r){for(var n=r.split(this._reNewline),e=new Array(n.length),a=[`
`],h=[],s=0;s<n.length;s++)e[s]=i.util.string.graphemeSplit(n[s]),h=h.concat(e[s],a);return h.pop(),{_unwrappedLines:e,lines:n,graphemeText:h,graphemeLines:e}},toObject:function(r){var n=o.concat(r),e=this.callSuper("toObject",n);return e.styles=i.util.stylesToArray(this.styles,this.text),e.path&&(e.path=this.path.toObject()),e},set:function(r,n){this.callSuper("set",r,n);var e=!1,a=!1;if(typeof r=="object")for(var h in r)h==="path"&&this.setPathInfo(),e=e||this._dimensionAffectingProps.indexOf(h)!==-1,a=a||h==="path";else e=this._dimensionAffectingProps.indexOf(r)!==-1,a=r==="path";return a&&this.setPathInfo(),e&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),i.Text.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),i.Text.DEFAULT_SVG_FONT_SIZE=16,i.Text.fromElement=function(r,n,e){if(!r)return n(null);var a=i.parseAttributes(r,i.Text.ATTRIBUTE_NAMES),h=a.textAnchor||"left";if(e=i.util.object.extend(e?l(e):{},a),e.top=e.top||0,e.left=e.left||0,a.textDecoration){var s=a.textDecoration;s.indexOf("underline")!==-1&&(e.underline=!0),s.indexOf("overline")!==-1&&(e.overline=!0),s.indexOf("line-through")!==-1&&(e.linethrough=!0),delete e.textDecoration}"dx"in a&&(e.left+=a.dx),"dy"in a&&(e.top+=a.dy),"fontSize"in e||(e.fontSize=i.Text.DEFAULT_SVG_FONT_SIZE);var u="";"textContent"in r?u=r.textContent:"firstChild"in r&&r.firstChild!==null&&"data"in r.firstChild&&r.firstChild.data!==null&&(u=r.firstChild.data),u=u.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var d=e.strokeWidth;e.strokeWidth=0;var m=new i.Text(u,e),p=m.getScaledHeight()/m.height,y=(m.height+m.strokeWidth)*m.lineHeight-m.height,w=y*p,S=m.getScaledHeight()+w,E=0;h==="center"&&(E=m.getScaledWidth()/2),h==="right"&&(E=m.getScaledWidth()),m.set({left:m.left-E,top:m.top-(S-m.fontSize*(.07+m._fontSizeFraction))/m.lineHeight,strokeWidth:typeof d<"u"?d:1}),n(m)},i.Text.fromObject=function(r,n){var e=l(r),a=r.path;return delete e.path,i.Object._fromObject("Text",e,function(h){h.styles=i.util.stylesFromArray(r.styles,r.text),a?i.Object._fromObject("Path",a,function(s){h.set("path",s),n(h)},"path"):n(h)},"text")},i.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],i.util.createAccessors&&i.util.createAccessors(i.Text)}(f),function(){t.util.object.extend(t.Text.prototype,{isEmptyStyles:function(c){if(!this.styles||typeof c<"u"&&!this.styles[c])return!0;var i=typeof c>"u"?this.styles:{line:this.styles[c]};for(var l in i)for(var o in i[l])for(var r in i[l][o])return!1;return!0},styleHas:function(c,i){if(!this.styles||!c||c===""||typeof i<"u"&&!this.styles[i])return!1;var l=typeof i>"u"?this.styles:{0:this.styles[i]};for(var o in l)for(var r in l[o])if(typeof l[o][r][c]<"u")return!0;return!1},cleanStyle:function(c){if(!this.styles||!c||c==="")return!1;var i=this.styles,l=0,o,r,n=!0,e=0,a;for(var h in i){o=0;for(var s in i[h]){var a=i[h][s],u=a.hasOwnProperty(c);l++,u?(r?a[c]!==r&&(n=!1):r=a[c],a[c]===this[c]&&delete a[c]):n=!1,Object.keys(a).length!==0?o++:delete i[h][s]}o===0&&delete i[h]}for(var d=0;d<this._textLines.length;d++)e+=this._textLines[d].length;n&&l===e&&(this[c]=r,this.removeStyle(c))},removeStyle:function(c){if(!(!this.styles||!c||c==="")){var i=this.styles,l,o,r;for(o in i){l=i[o];for(r in l)delete l[r][c],Object.keys(l[r]).length===0&&delete l[r];Object.keys(l).length===0&&delete i[o]}}},_extendStyles:function(c,i){var l=this.get2DCursorLocation(c);this._getLineStyle(l.lineIndex)||this._setLineStyle(l.lineIndex),this._getStyleDeclaration(l.lineIndex,l.charIndex)||this._setStyleDeclaration(l.lineIndex,l.charIndex,{}),t.util.object.extend(this._getStyleDeclaration(l.lineIndex,l.charIndex),i)},get2DCursorLocation:function(c,i){typeof c>"u"&&(c=this.selectionStart);for(var l=i?this._unwrappedTextLines:this._textLines,o=l.length,r=0;r<o;r++){if(c<=l[r].length)return{lineIndex:r,charIndex:c};c-=l[r].length+this.missingNewlineOffset(r)}return{lineIndex:r-1,charIndex:l[r-1].length<c?l[r-1].length:c}},getSelectionStyles:function(c,i,l){typeof c>"u"&&(c=this.selectionStart||0),typeof i>"u"&&(i=this.selectionEnd||c);for(var o=[],r=c;r<i;r++)o.push(this.getStyleAtPosition(r,l));return o},getStyleAtPosition:function(c,i){var l=this.get2DCursorLocation(c),o=i?this.getCompleteStyleDeclaration(l.lineIndex,l.charIndex):this._getStyleDeclaration(l.lineIndex,l.charIndex);return o||{}},setSelectionStyles:function(c,i,l){typeof i>"u"&&(i=this.selectionStart||0),typeof l>"u"&&(l=this.selectionEnd||i);for(var o=i;o<l;o++)this._extendStyles(o,c);return this._forceClearCache=!0,this},_getStyleDeclaration:function(c,i){var l=this.styles&&this.styles[c];return l?l[i]:null},getCompleteStyleDeclaration:function(c,i){for(var l=this._getStyleDeclaration(c,i)||{},o={},r,n=0;n<this._styleProperties.length;n++)r=this._styleProperties[n],o[r]=typeof l[r]>"u"?this[r]:l[r];return o},_setStyleDeclaration:function(c,i,l){this.styles[c][i]=l},_deleteStyleDeclaration:function(c,i){delete this.styles[c][i]},_getLineStyle:function(c){return!!this.styles[c]},_setLineStyle:function(c){this.styles[c]={}},_deleteLineStyle:function(c){delete this.styles[c]}})}(),function(){function c(i){i.textDecoration&&(i.textDecoration.indexOf("underline")>-1&&(i.underline=!0),i.textDecoration.indexOf("line-through")>-1&&(i.linethrough=!0),i.textDecoration.indexOf("overline")>-1&&(i.overline=!0),delete i.textDecoration)}t.IText=t.util.createClass(t.Text,t.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(i,l){this.callSuper("initialize",i,l),this.initBehavior()},setSelectionStart:function(i){i=Math.max(i,0),this._updateAndFire("selectionStart",i)},setSelectionEnd:function(i){i=Math.min(i,this.text.length),this._updateAndFire("selectionEnd",i)},_updateAndFire:function(i,l){this[i]!==l&&(this._fireSelectionChanged(),this[i]=l),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(i){this.clearContextTop(),this.callSuper("render",i),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(i){this.callSuper("_render",i)},clearContextTop:function(i){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var l=this.canvas.contextTop,o=this.canvas.viewportTransform;l.save(),l.transform(o[0],o[1],o[2],o[3],o[4],o[5]),this.transform(l),this._clearTextArea(l),i||l.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var i=this._getCursorBoundaries(),l=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(i,l):this.renderSelection(i,l),l.restore()}},_clearTextArea:function(i){var l=this.width+4,o=this.height+4;i.clearRect(-l/2,-o/2,l,o)},_getCursorBoundaries:function(i){typeof i>"u"&&(i=this.selectionStart);var l=this._getLeftOffset(),o=this._getTopOffset(),r=this._getCursorBoundariesOffsets(i);return{left:l,top:o,leftOffset:r.left,topOffset:r.top}},_getCursorBoundariesOffsets:function(i){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var l,o,r,n=0,e=0,a,h=this.get2DCursorLocation(i);r=h.charIndex,o=h.lineIndex;for(var s=0;s<o;s++)n+=this.getHeightOfLine(s);l=this._getLineLeftOffset(o);var u=this.__charBounds[o][r];return u&&(e=u.left),this.charSpacing!==0&&r===this._textLines[o].length&&(e-=this._getWidthOfCharSpacing()),a={top:n,left:l+(e>0?e:0)},this.direction==="rtl"&&(a.left*=-1),this.cursorOffsetCache=a,this.cursorOffsetCache},renderCursor:function(i,l){var o=this.get2DCursorLocation(),r=o.lineIndex,n=o.charIndex>0?o.charIndex-1:0,e=this.getValueOfPropertyAt(r,n,"fontSize"),a=this.scaleX*this.canvas.getZoom(),h=this.cursorWidth/a,s=i.topOffset,u=this.getValueOfPropertyAt(r,n,"deltaY");s+=(1-this._fontSizeFraction)*this.getHeightOfLine(r)/this.lineHeight-e*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(i,l),l.fillStyle=this.cursorColor||this.getValueOfPropertyAt(r,n,"fill"),l.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,l.fillRect(i.left+i.leftOffset-h/2,s+i.top+u,h,e)},renderSelection:function(i,l){for(var o=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,r=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,n=this.textAlign.indexOf("justify")!==-1,e=this.get2DCursorLocation(o),a=this.get2DCursorLocation(r),h=e.lineIndex,s=a.lineIndex,u=e.charIndex<0?0:e.charIndex,d=a.charIndex<0?0:a.charIndex,m=h;m<=s;m++){var p=this._getLineLeftOffset(m)||0,y=this.getHeightOfLine(m),w=0,S=0,E=0;if(m===h&&(S=this.__charBounds[h][u].left),m>=h&&m<s)E=n&&!this.isEndOfWrapping(m)?this.width:this.getLineWidth(m)||5;else if(m===s)if(d===0)E=this.__charBounds[s][d].left;else{var D=this._getWidthOfCharSpacing();E=this.__charBounds[s][d-1].left+this.__charBounds[s][d-1].width-D}w=y,(this.lineHeight<1||m===s&&this.lineHeight>1)&&(y/=this.lineHeight);var W=i.left+p+S,K=E-S,tt=y,N=0;this.inCompositionMode?(l.fillStyle=this.compositionColor||"black",tt=1,N=y):l.fillStyle=this.selectionColor,this.direction==="rtl"&&(W=this.width-W-K),l.fillRect(W,i.top+i.topOffset+N,K,tt),i.topOffset+=w}},getCurrentCharFontSize:function(){var i=this._getCurrentCharIndex();return this.getValueOfPropertyAt(i.l,i.c,"fontSize")},getCurrentCharColor:function(){var i=this._getCurrentCharIndex();return this.getValueOfPropertyAt(i.l,i.c,"fill")},_getCurrentCharIndex:function(){var i=this.get2DCursorLocation(this.selectionStart,!0),l=i.charIndex>0?i.charIndex-1:0;return{l:i.lineIndex,c:l}}}),t.IText.fromObject=function(i,l){var o=t.util.stylesFromArray(i.styles,i.text),r=Object.assign({},i,{styles:o});if(c(r),r.styles)for(var n in r.styles)for(var e in r.styles[n])c(r.styles[n][e]);t.Object._fromObject("IText",r,l,"text")}}(),function(){var c=t.util.object.clone;t.util.object.extend(t.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var i=this;this.on("added",function(){var l=i.canvas;l&&(l._hasITextHandlers||(l._hasITextHandlers=!0,i._initCanvasHandlers(l)),l._iTextInstances=l._iTextInstances||[],l._iTextInstances.push(i))})},initRemovedHandler:function(){var i=this;this.on("removed",function(){var l=i.canvas;l&&(l._iTextInstances=l._iTextInstances||[],t.util.removeFromArray(l._iTextInstances,i),l._iTextInstances.length===0&&(l._hasITextHandlers=!1,i._removeCanvasHandlers(l)))})},_initCanvasHandlers:function(i){i._mouseUpITextHandler=function(){i._iTextInstances&&i._iTextInstances.forEach(function(l){l.__isMousedown=!1})},i.on("mouse:up",i._mouseUpITextHandler)},_removeCanvasHandlers:function(i){i.off("mouse:up",i._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(i,l,o,r){var n;return n={isAborted:!1,abort:function(){this.isAborted=!0}},i.animate("_currentCursorOpacity",l,{duration:o,onComplete:function(){n.isAborted||i[r]()},onChange:function(){i.canvas&&i.selectionStart===i.selectionEnd&&i.renderCursorOrSelection()},abort:function(){return n.isAborted}}),n},_onTickComplete:function(){var i=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){i._currentTickCompleteState=i._animateCursor(i,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(i){var l=this,o=i?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){l._tick()},o)},abortCursorAnimation:function(){var i=this._currentTickState||this._currentTickCompleteState,l=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,i&&l&&l.clearContext(l.contextTop||l.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(i){var l=0,o=i-1;if(this._reSpace.test(this._text[o]))for(;this._reSpace.test(this._text[o]);)l++,o--;for(;/\S/.test(this._text[o])&&o>-1;)l++,o--;return i-l},findWordBoundaryRight:function(i){var l=0,o=i;if(this._reSpace.test(this._text[o]))for(;this._reSpace.test(this._text[o]);)l++,o++;for(;/\S/.test(this._text[o])&&o<this._text.length;)l++,o++;return i+l},findLineBoundaryLeft:function(i){for(var l=0,o=i-1;!/\n/.test(this._text[o])&&o>-1;)l++,o--;return i-l},findLineBoundaryRight:function(i){for(var l=0,o=i;!/\n/.test(this._text[o])&&o<this._text.length;)l++,o++;return i+l},searchWordBoundary:function(i,l){for(var o=this._text,r=this._reSpace.test(o[i])?i-1:i,n=o[r],e=t.reNonWord;!e.test(n)&&r>0&&r<o.length;)r+=l,n=o[r];return e.test(n)&&(r+=l===1?0:1),r},selectWord:function(i){i=i||this.selectionStart;var l=this.searchWordBoundary(i,-1),o=this.searchWordBoundary(i,1);this.selectionStart=l,this.selectionEnd=o,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(i){i=i||this.selectionStart;var l=this.findLineBoundaryLeft(i),o=this.findLineBoundaryRight(i);return this.selectionStart=l,this.selectionEnd=o,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(i){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(i),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(i){i._iTextInstances&&i._iTextInstances.forEach(function(l){l.selected=!1,l.isEditing&&l.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(i){if(!(!this.__isMousedown||!this.isEditing)){document.activeElement!==this.hiddenTextarea&&this.hiddenTextarea.focus();var l=this.getSelectionStartFromPointer(i.e),o=this.selectionStart,r=this.selectionEnd;(l!==this.__selectionStartOnMouseDown||o===r)&&(o===l||r===l)||(l>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=l):(this.selectionStart=l,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==o||this.selectionEnd!==r)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(i,l,o){var r=o.slice(0,i),n=t.util.string.graphemeSplit(r).length;if(i===l)return{selectionStart:n,selectionEnd:n};var e=o.slice(i,l),a=t.util.string.graphemeSplit(e).length;return{selectionStart:n,selectionEnd:n+a}},fromGraphemeToStringSelection:function(i,l,o){var r=o.slice(0,i),n=r.join("").length;if(i===l)return{selectionStart:n,selectionEnd:n};var e=o.slice(i,l),a=e.join("").length;return{selectionStart:n,selectionEnd:n+a}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var i=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=i.selectionStart,this.hiddenTextarea.selectionEnd=i.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var i=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=i.selectionEnd,this.inCompositionMode||(this.selectionStart=i.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var i=this._calcTextareaPosition();this.hiddenTextarea.style.left=i.left,this.hiddenTextarea.style.top=i.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var i=this.inCompositionMode?this.compositionStart:this.selectionStart,l=this._getCursorBoundaries(i),o=this.get2DCursorLocation(i),r=o.lineIndex,n=o.charIndex,e=this.getValueOfPropertyAt(r,n,"fontSize")*this.lineHeight,a=l.leftOffset,h=this.calcTransformMatrix(),s={x:l.left+a,y:l.top+l.topOffset+e},u=this.canvas.getRetinaScaling(),d=this.canvas.upperCanvasEl,m=d.width/u,p=d.height/u,y=m-e,w=p-e,S=d.clientWidth/m,E=d.clientHeight/p;return s=t.util.transformPoint(s,h),s=t.util.transformPoint(s,this.canvas.viewportTransform),s.x*=S,s.y*=E,s.x<0&&(s.x=0),s.x>y&&(s.x=y),s.y<0&&(s.y=0),s.y>w&&(s.y=w),s.x+=this.canvas._offset.left,s.y+=this.canvas._offset.top,{left:s.x+"px",top:s.y+"px",fontSize:e+"px",charHeight:e}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var i=this._textBeforeEdit!==this.text,l=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,l&&(l.blur&&l.blur(),l.parentNode&&l.parentNode.removeChild(l)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),i&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),i&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var i in this.styles)this._textLines[i]||delete this.styles[i]},removeStyleFromTo:function(i,l){var o=this.get2DCursorLocation(i,!0),r=this.get2DCursorLocation(l,!0),n=o.lineIndex,e=o.charIndex,a=r.lineIndex,h=r.charIndex,s,u;if(n!==a){if(this.styles[n])for(s=e;s<this._unwrappedTextLines[n].length;s++)delete this.styles[n][s];if(this.styles[a])for(s=h;s<this._unwrappedTextLines[a].length;s++)u=this.styles[a][s],u&&(this.styles[n]||(this.styles[n]={}),this.styles[n][e+s-h]=u);for(s=n+1;s<=a;s++)delete this.styles[s];this.shiftLineStyles(a,n-a)}else if(this.styles[n]){u=this.styles[n];var d=h-e,m,p;for(s=e;s<h;s++)delete u[s];for(p in this.styles[n])m=parseInt(p,10),m>=h&&(u[m-d]=u[p],delete u[p])}},shiftLineStyles:function(i,l){var o=c(this.styles);for(var r in this.styles){var n=parseInt(r,10);n>i&&(this.styles[n+l]=o[n],o[n-l]||delete this.styles[n])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(i,l,o,r){var n,e={},a=!1,h=this._unwrappedTextLines[i].length===l;o||(o=1),this.shiftLineStyles(i,o),this.styles[i]&&(n=this.styles[i][l===0?l:l-1]);for(var s in this.styles[i]){var u=parseInt(s,10);u>=l&&(a=!0,e[u-l]=this.styles[i][s],h&&l===0||delete this.styles[i][s])}var d=!1;for(a&&!h&&(this.styles[i+o]=e,d=!0),d&&o--;o>0;)r&&r[o-1]?this.styles[i+o]={0:c(r[o-1])}:n?this.styles[i+o]={0:c(n)}:delete this.styles[i+o],o--;this._forceClearCache=!0},insertCharStyleObject:function(i,l,o,r){this.styles||(this.styles={});var n=this.styles[i],e=n?c(n):{};o||(o=1);for(var a in e){var h=parseInt(a,10);h>=l&&(n[h+o]=e[h],e[h-o]||delete n[h])}if(this._forceClearCache=!0,r){for(;o--;)Object.keys(r[o]).length&&(this.styles[i]||(this.styles[i]={}),this.styles[i][l+o]=c(r[o]));return}if(n)for(var s=n[l?l-1:1];s&&o--;)this.styles[i][l+o]=c(s)},insertNewStyleBlock:function(i,l,o){for(var r=this.get2DCursorLocation(l,!0),n=[0],e=0,a=0;a<i.length;a++)i[a]===`
`?(e++,n[e]=0):n[e]++;n[0]>0&&(this.insertCharStyleObject(r.lineIndex,r.charIndex,n[0],o),o=o&&o.slice(n[0]+1)),e&&this.insertNewlineStyleObject(r.lineIndex,r.charIndex+n[0],e);for(var a=1;a<e;a++)n[a]>0?this.insertCharStyleObject(r.lineIndex+a,0,n[a],o):o&&this.styles[r.lineIndex+a]&&o[0]&&(this.styles[r.lineIndex+a][0]=o[0]),o=o&&o.slice(n[a]+1);n[a]>0&&this.insertCharStyleObject(r.lineIndex+a,0,n[a],o)},setSelectionStartEndWithShift:function(i,l,o){o<=i?(l===i?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=i),this.selectionStart=o):o>i&&o<l?this._selectionDirection==="right"?this.selectionEnd=o:this.selectionStart=o:(l===i?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=l),this.selectionEnd=o)},setSelectionInBoundaries:function(){var i=this.text.length;this.selectionStart>i?this.selectionStart=i:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>i?this.selectionEnd=i:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),t.util.object.extend(t.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(c){if(this.canvas){this.__newClickTime=+new Date;var i=c.pointer;this.isTripleClick(i)&&(this.fire("tripleclick",c),this._stopEvent(c.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=i,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(c){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===c.x&&this.__lastPointer.y===c.y},_stopEvent:function(c){c.preventDefault&&c.preventDefault(),c.stopPropagation&&c.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(c){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(c.e))},tripleClickHandler:function(c){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(c.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(c){!this.canvas||!this.editable||c.e.button&&c.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(c.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(c){!this.canvas||!this.editable||c.e.button&&c.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(c){if(this.__isMousedown=!1,!(!this.editable||this.group||c.transform&&c.transform.actionPerformed||c.e.button&&c.e.button!==1)){if(this.canvas){var i=this.canvas._activeObject;if(i&&i!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(c.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(c){var i=this.getSelectionStartFromPointer(c),l=this.selectionStart,o=this.selectionEnd;c.shiftKey?this.setSelectionStartEndWithShift(l,o,i):(this.selectionStart=i,this.selectionEnd=i),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(c){for(var i=this.getLocalPointer(c),l=0,o=0,r=0,n=0,e=0,a,h,s=0,u=this._textLines.length;s<u&&r<=i.y;s++)r+=this.getHeightOfLine(s)*this.scaleY,e=s,s>0&&(n+=this._textLines[s-1].length+this.missingNewlineOffset(s-1));a=this._getLineLeftOffset(e),o=a*this.scaleX,h=this._textLines[e],this.direction==="rtl"&&(i.x=this.width*this.scaleX-i.x+o);for(var d=0,m=h.length;d<m&&(l=o,o+=this.__charBounds[e][d].kernedWidth*this.scaleX,o<=i.x);d++)n++;return this._getNewSelectionStartFromOffset(i,l,o,n,m)},_getNewSelectionStartFromOffset:function(c,i,l,o,r){var n=c.x-i,e=l-c.x,a=e>n||e<0?0:1,h=o+a;return this.flipX&&(h=r-h),h>this._text.length&&(h=this._text.length),h}}),t.util.object.extend(t.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=t.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var c=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+c.top+"; left: "+c.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: "+c.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):t.document.body.appendChild(this.hiddenTextarea),t.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),t.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),t.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),t.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(t.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(c){if(this.isEditing){var i=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(c.keyCode in i)this[i[c.keyCode]](c);else if(c.keyCode in this.ctrlKeysMapDown&&(c.ctrlKey||c.metaKey))this[this.ctrlKeysMapDown[c.keyCode]](c);else return;c.stopImmediatePropagation(),c.preventDefault(),c.keyCode>=33&&c.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(c){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(c.keyCode in this.ctrlKeysMapUp&&(c.ctrlKey||c.metaKey))this[this.ctrlKeysMapUp[c.keyCode]](c);else return;c.stopImmediatePropagation(),c.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(c){var i=this.fromPaste;if(this.fromPaste=!1,c&&c.stopPropagation(),!!this.isEditing){var l=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,o=this._text.length,r=l.length,n,e,a=r-o,h=this.selectionStart,s=this.selectionEnd,u=h!==s,d,m,p;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var y=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),w=h>y.selectionStart;u?(n=this._text.slice(h,s),a+=s-h):r<o&&(w?n=this._text.slice(s+a,s):n=this._text.slice(h,h-a)),e=l.slice(y.selectionEnd-a,y.selectionEnd),n&&n.length&&(e.length&&(d=this.getSelectionStyles(h,h+1,!1),d=e.map(function(){return d[0]})),u?(m=h,p=s):w?(m=s-n.length,p=s):(m=s,p=s+n.length),this.removeStyleFromTo(m,p)),e.length&&(i&&e.join("")===t.copiedText&&!t.disableStyleCopyPaste&&(d=t.copiedTextStyle),this.insertNewStyleBlock(e,h,d)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(c){this.compositionStart=c.target.selectionStart,this.compositionEnd=c.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(t.copiedText=this.getSelectedText(),t.disableStyleCopyPaste?t.copiedTextStyle=null:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(c){return c&&c.clipboardData||t.window.clipboardData},_getWidthBeforeCursor:function(c,i){var l=this._getLineLeftOffset(c),o;return i>0&&(o=this.__charBounds[c][i-1],l+=o.left+o.width),l},getDownCursorOffset:function(c,i){var l=this._getSelectionForOffset(c,i),o=this.get2DCursorLocation(l),r=o.lineIndex;if(r===this._textLines.length-1||c.metaKey||c.keyCode===34)return this._text.length-l;var n=o.charIndex,e=this._getWidthBeforeCursor(r,n),a=this._getIndexOnLine(r+1,e),h=this._textLines[r].slice(n);return h.length+a+1+this.missingNewlineOffset(r)},_getSelectionForOffset:function(c,i){return c.shiftKey&&this.selectionStart!==this.selectionEnd&&i?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(c,i){var l=this._getSelectionForOffset(c,i),o=this.get2DCursorLocation(l),r=o.lineIndex;if(r===0||c.metaKey||c.keyCode===33)return-l;var n=o.charIndex,e=this._getWidthBeforeCursor(r,n),a=this._getIndexOnLine(r-1,e),h=this._textLines[r].slice(0,n),s=this.missingNewlineOffset(r-1);return-this._textLines[r-1].length+a-h.length+(1-s)},_getIndexOnLine:function(c,i){for(var l=this._textLines[c],o=this._getLineLeftOffset(c),r=o,n=0,e,a,h=0,s=l.length;h<s;h++)if(e=this.__charBounds[c][h].width,r+=e,r>i){a=!0;var u=r-e,d=r,m=Math.abs(u-i),p=Math.abs(d-i);n=p<m?h:h-1;break}return a||(n=l.length-1),n},moveCursorDown:function(c){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",c)},moveCursorUp:function(c){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",c)},_moveCursorUpOrDown:function(c,i){var l="get"+c+"CursorOffset",o=this[l](i,this._selectionDirection==="right");i.shiftKey?this.moveCursorWithShift(o):this.moveCursorWithoutShift(o),o!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(c){var i=this._selectionDirection==="left"?this.selectionStart+c:this.selectionEnd+c;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,i),c!==0},moveCursorWithoutShift:function(c){return c<0?(this.selectionStart+=c,this.selectionEnd=this.selectionStart):(this.selectionEnd+=c,this.selectionStart=this.selectionEnd),c!==0},moveCursorLeft:function(c){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",c)},_move:function(c,i,l){var o;if(c.altKey)o=this["findWordBoundary"+l](this[i]);else if(c.metaKey||c.keyCode===35||c.keyCode===36)o=this["findLineBoundary"+l](this[i]);else return this[i]+=l==="Left"?-1:1,!0;if(typeof o<"u"&&this[i]!==o)return this[i]=o,!0},_moveLeft:function(c,i){return this._move(c,i,"Left")},_moveRight:function(c,i){return this._move(c,i,"Right")},moveCursorLeftWithoutShift:function(c){var i=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(i=this._moveLeft(c,"selectionStart")),this.selectionEnd=this.selectionStart,i},moveCursorLeftWithShift:function(c){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(c,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(c,"selectionStart")},moveCursorRight:function(c){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",c)},_moveCursorLeftOrRight:function(c,i){var l="moveCursor"+c+"With";this._currentCursorOpacity=1,i.shiftKey?l+="Shift":l+="outShift",this[l](i)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(c){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(c,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(c,"selectionEnd")},moveCursorRightWithoutShift:function(c){var i=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(i=this._moveRight(c,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,i},removeChars:function(c,i){typeof i>"u"&&(i=c+1),this.removeStyleFromTo(c,i),this._text.splice(c,i-c),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(c,i,l,o){typeof o>"u"&&(o=l),o>l&&this.removeStyleFromTo(l,o);var r=t.util.string.graphemeSplit(c);this.insertNewStyleBlock(r,l,i),this._text=[].concat(this._text.slice(0,l),r,this._text.slice(o)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var c=t.util.toFixed,i=/  +/g;t.util.object.extend(t.Text.prototype,{_toSVG:function(){var l=this._getSVGLeftTopOffsets(),o=this._getSVGTextAndBg(l.textTop,l.textLeft);return this._wrapSVGTextAndBg(o)},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(),{reviver:l,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(l){var o=!0,r=this.getSvgTextDecoration(this);return[l.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",r?'text-decoration="'+r+'" ':"",'style="',this.getSvgStyles(o),'"',this.addPaintOrder()," >",l.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(l,o){var r=[],n=[],e=l,a;this._setSVGBg(n);for(var h=0,s=this._textLines.length;h<s;h++)a=this._getLineLeftOffset(h),(this.textBackgroundColor||this.styleHas("textBackgroundColor",h))&&this._setSVGTextLineBg(n,h,o+a,e),this._setSVGTextLineText(r,h,o+a,e),e+=this.getHeightOfLine(h);return{textSpans:r,textBgRects:n}},_createTextCharSpan:function(l,o,r,n){var e=l!==l.trim()||l.match(i),a=this.getSvgSpanStyles(o,e),h=a?'style="'+a+'"':"",s=o.deltaY,u="",d=t.Object.NUM_FRACTION_DIGITS;return s&&(u=' dy="'+c(s,d)+'" '),['<tspan x="',c(r,d),'" y="',c(n,d),'" ',u,h,">",t.util.string.escapeXml(l),"</tspan>"].join("")},_setSVGTextLineText:function(l,o,r,n){var e=this.getHeightOfLine(o),a=this.textAlign.indexOf("justify")!==-1,h,s,u="",d,m,p=0,y=this._textLines[o],w;n+=e*(1-this._fontSizeFraction)/this.lineHeight;for(var S=0,E=y.length-1;S<=E;S++)w=S===E||this.charSpacing,u+=y[S],d=this.__charBounds[o][S],p===0?(r+=d.kernedWidth-d.width,p+=d.width):p+=d.kernedWidth,a&&!w&&this._reSpaceAndTab.test(y[S])&&(w=!0),w||(h=h||this.getCompleteStyleDeclaration(o,S),s=this.getCompleteStyleDeclaration(o,S+1),w=t.util.hasStyleChanged(h,s,!0)),w&&(m=this._getStyleDeclaration(o,S)||{},l.push(this._createTextCharSpan(u,m,r,n)),u="",h=s,r+=p,p=0)},_pushTextBgRect:function(l,o,r,n,e,a){var h=t.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(o),' x="',c(r,h),'" y="',c(n,h),'" width="',c(e,h),'" height="',c(a,h),`"></rect>
`)},_setSVGTextLineBg:function(l,o,r,n){for(var e=this._textLines[o],a=this.getHeightOfLine(o)/this.lineHeight,h=0,s=0,u,d,m=this.getValueOfPropertyAt(o,0,"textBackgroundColor"),p=0,y=e.length;p<y;p++)u=this.__charBounds[o][p],d=this.getValueOfPropertyAt(o,p,"textBackgroundColor"),d!==m?(m&&this._pushTextBgRect(l,m,r+s,n,h,a),s=u.left,h=u.width,m=d):h+=u.kernedWidth;d&&this._pushTextBgRect(l,d,r+s,n,h,a)},_getFillAttributes:function(l){var o=l&&typeof l=="string"?new t.Color(l):"";return!o||!o.getSource()||o.getAlpha()===1?'fill="'+l+'"':'opacity="'+o.getAlpha()+'" fill="'+o.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(l){for(var o=0,r=0,n=0;n<l;n++)o+=this.getHeightOfLine(n);return r=this.getHeightOfLine(n),{lineTop:o,offset:(this._fontSizeMult-this._fontSizeFraction)*r/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(l){var o=t.Object.prototype.getSvgStyles.call(this,l);return o+" white-space: pre;"}})}(),function(c){var i=c.fabric||(c.fabric={});i.Textbox=i.util.createClass(i.IText,i.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:i.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(l){for(var o=0,r=0,n=0,e={},a=0;a<l.graphemeLines.length;a++)l.graphemeText[n]===`
`&&a>0?(r=0,n++,o++):!this.splitByGrapheme&&this._reSpaceAndTab.test(l.graphemeText[n])&&a>0&&(r++,n++),e[a]={line:o,offset:r},n+=l.graphemeLines[a].length,r+=l.graphemeLines[a].length;return e},styleHas:function(l,o){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[o];r&&(o=r.line)}return i.Text.prototype.styleHas.call(this,l,o)},isEmptyStyles:function(l){if(!this.styles)return!0;var o=0,r=l+1,n,e,a=!1,h=this._styleMap[l],s=this._styleMap[l+1];h&&(l=h.line,o=h.offset),s&&(r=s.line,a=r===l,n=s.offset),e=typeof l>"u"?this.styles:{line:this.styles[l]};for(var u in e)for(var d in e[u])if(d>=o&&(!a||d<n))for(var m in e[u][d])return!1;return!0},_getStyleDeclaration:function(l,o){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[l];if(!r)return null;l=r.line,o=r.offset+o}return this.callSuper("_getStyleDeclaration",l,o)},_setStyleDeclaration:function(l,o,r){var n=this._styleMap[l];l=n.line,o=n.offset+o,this.styles[l][o]=r},_deleteStyleDeclaration:function(l,o){var r=this._styleMap[l];l=r.line,o=r.offset+o,delete this.styles[l][o]},_getLineStyle:function(l){var o=this._styleMap[l];return!!this.styles[o.line]},_setLineStyle:function(l){var o=this._styleMap[l];this.styles[o.line]={}},_wrapText:function(l,o){var r=[],n;for(this.isWrapping=!0,n=0;n<l.length;n++)r=r.concat(this._wrapLine(l[n],n,o));return this.isWrapping=!1,r},_measureWord:function(l,o,r){var n=0,e,a=!0;r=r||0;for(var h=0,s=l.length;h<s;h++){var u=this._getGraphemeBox(l[h],o,h+r,e,a);n+=u.kernedWidth,e=l[h]}return n},_wrapLine:function(l,o,r,W){var e=0,a=this.splitByGrapheme,h=[],s=[],u=a?i.util.string.graphemeSplit(l):l.split(this._wordJoiners),d="",m=0,p=a?"":" ",y=0,w=0,S=0,E=!0,D=this._getWidthOfCharSpacing(),W=W||0;u.length===0&&u.push([]),r-=W;for(var K=0;K<u.length;K++)d=a?u[K]:i.util.string.graphemeSplit(u[K]),y=this._measureWord(d,o,m),m+=d.length,e+=w+y-D,e>r&&!E?(h.push(s),s=[],e=y,E=!0):e+=D,!E&&!a&&s.push(p),s=s.concat(d),w=a?0:this._measureWord([p],o,m),m++,E=!1,y>S&&(S=y);return K&&h.push(s),S+W>this.dynamicMinWidth&&(this.dynamicMinWidth=S-D+W),h},isEndOfWrapping:function(l){return!this._styleMap[l+1]||this._styleMap[l+1].line!==this._styleMap[l].line},missingNewlineOffset:function(l){return this.splitByGrapheme?this.isEndOfWrapping(l)?1:0:1},_splitTextIntoLines:function(l){for(var o=i.Text.prototype._splitTextIntoLines.call(this,l),r=this._wrapText(o.lines,this.width),n=new Array(r.length),e=0;e<r.length;e++)n[e]=r[e].join("");return o.lines=n,o.graphemeLines=r,o},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var l={};for(var o in this._styleMap)this._textLines[o]&&(l[this._styleMap[o].line]=1);for(var o in this.styles)l[o]||delete this.styles[o]},toObject:function(l){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(l))}}),i.Textbox.fromObject=function(l,o){var r=i.util.stylesFromArray(l.styles,l.text),n=Object.assign({},l,{styles:r});return i.Object._fromObject("Textbox",n,o,"text")}}(f),function(){var c=t.controlsUtils,i=c.scaleSkewCursorStyleHandler,l=c.scaleCursorStyleHandler,o=c.scalingEqually,r=c.scalingYOrSkewingX,n=c.scalingXOrSkewingY,e=c.scaleOrSkewActionName,a=t.Object.prototype.controls;if(a.ml=new t.Control({x:-.5,y:0,cursorStyleHandler:i,actionHandler:n,getActionName:e}),a.mr=new t.Control({x:.5,y:0,cursorStyleHandler:i,actionHandler:n,getActionName:e}),a.mb=new t.Control({x:0,y:.5,cursorStyleHandler:i,actionHandler:r,getActionName:e}),a.mt=new t.Control({x:0,y:-.5,cursorStyleHandler:i,actionHandler:r,getActionName:e}),a.tl=new t.Control({x:-.5,y:-.5,cursorStyleHandler:l,actionHandler:o}),a.tr=new t.Control({x:.5,y:-.5,cursorStyleHandler:l,actionHandler:o}),a.bl=new t.Control({x:-.5,y:.5,cursorStyleHandler:l,actionHandler:o}),a.br=new t.Control({x:.5,y:.5,cursorStyleHandler:l,actionHandler:o}),a.mtr=new t.Control({x:0,y:-.5,actionHandler:c.rotationWithSnapping,cursorStyleHandler:c.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),t.Textbox){var h=t.Textbox.prototype.controls={};h.mtr=a.mtr,h.tr=a.tr,h.br=a.br,h.tl=a.tl,h.bl=a.bl,h.mt=a.mt,h.mb=a.mb,h.mr=new t.Control({x:.5,y:0,actionHandler:c.changeWidth,cursorStyleHandler:i,actionName:"resizing"}),h.ml=new t.Control({x:-.5,y:0,actionHandler:c.changeWidth,cursorStyleHandler:i,actionName:"resizing"})}}()})(he);var es={grad:.9,turn:360,rad:360/(2*Math.PI)},Gt=function(f){return typeof f=="string"?f.length>0:typeof f=="number"},It=function(f,t,g){return t===void 0&&(t=0),g===void 0&&(g=Math.pow(10,t)),Math.round(g*f)/g+0},Nt=function(f,t,g){return t===void 0&&(t=0),g===void 0&&(g=1),f>g?g:f>t?f:t},on=function(f){return(f=isFinite(f)?f%360:0)>0?f:f+360},pi=function(f){return{r:Nt(f.r,0,255),g:Nt(f.g,0,255),b:Nt(f.b,0,255),a:Nt(f.a)}},Be=function(f){return{r:It(f.r),g:It(f.g),b:It(f.b),a:It(f.a,3)}},is=/^#([0-9a-f]{3,8})$/i,Se=function(f){var t=f.toString(16);return t.length<2?"0"+t:t},ln=function(f){var t=f.r,g=f.g,v=f.b,_=f.a,C=Math.max(t,g,v),b=C-Math.min(t,g,v),c=b?C===t?(g-v)/b:C===g?2+(v-t)/b:4+(t-g)/b:0;return{h:60*(c<0?c+6:c),s:C?b/C*100:0,v:C/255*100,a:_}},hn=function(f){var t=f.h,g=f.s,v=f.v,_=f.a;t=t/360*6,g/=100,v/=100;var C=Math.floor(t),b=v*(1-g),c=v*(1-(t-C)*g),i=v*(1-(1-t+C)*g),l=C%6;return{r:255*[v,c,b,b,i,v][l],g:255*[i,v,v,c,b,b][l],b:255*[b,b,i,v,v,c][l],a:_}},vi=function(f){return{h:on(f.h),s:Nt(f.s,0,100),l:Nt(f.l,0,100),a:Nt(f.a)}},_i=function(f){return{h:It(f.h),s:It(f.s),l:It(f.l),a:It(f.a,3)}},yi=function(f){return hn((g=(t=f).s,{h:t.h,s:(g*=((v=t.l)<50?v:100-v)/100)>0?2*g/(v+g)*100:0,v:v+g,a:t.a}));var t,g,v},de=function(f){return{h:(t=ln(f)).h,s:(_=(200-(g=t.s))*(v=t.v)/100)>0&&_<200?g*v/100/(_<=100?_:200-_)*100:0,l:_/2,a:t.a};var t,g,v,_},ns=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,rs=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ss=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,as=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ti={string:[[function(f){var t=is.exec(f);return t?(f=t[1]).length<=4?{r:parseInt(f[0]+f[0],16),g:parseInt(f[1]+f[1],16),b:parseInt(f[2]+f[2],16),a:f.length===4?It(parseInt(f[3]+f[3],16)/255,2):1}:f.length===6||f.length===8?{r:parseInt(f.substr(0,2),16),g:parseInt(f.substr(2,2),16),b:parseInt(f.substr(4,2),16),a:f.length===8?It(parseInt(f.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(f){var t=ss.exec(f)||as.exec(f);return t?t[2]!==t[4]||t[4]!==t[6]?null:pi({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(f){var t=ns.exec(f)||rs.exec(f);if(!t)return null;var g,v,_=vi({h:(g=t[1],v=t[2],v===void 0&&(v="deg"),Number(g)*(es[v]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return yi(_)},"hsl"]],object:[[function(f){var t=f.r,g=f.g,v=f.b,_=f.a,C=_===void 0?1:_;return Gt(t)&&Gt(g)&&Gt(v)?pi({r:Number(t),g:Number(g),b:Number(v),a:Number(C)}):null},"rgb"],[function(f){var t=f.h,g=f.s,v=f.l,_=f.a,C=_===void 0?1:_;if(!Gt(t)||!Gt(g)||!Gt(v))return null;var b=vi({h:Number(t),s:Number(g),l:Number(v),a:Number(C)});return yi(b)},"hsl"],[function(f){var t=f.h,g=f.s,v=f.v,_=f.a,C=_===void 0?1:_;if(!Gt(t)||!Gt(g)||!Gt(v))return null;var b=function(c){return{h:on(c.h),s:Nt(c.s,0,100),v:Nt(c.v,0,100),a:Nt(c.a)}}({h:Number(t),s:Number(g),v:Number(v),a:Number(C)});return hn(b)},"hsv"]]},bi=function(f,t){for(var g=0;g<t.length;g++){var v=t[g][0](f);if(v)return[v,t[g][1]]}return[null,void 0]},os=function(f){return typeof f=="string"?bi(f.trim(),ti.string):typeof f=="object"&&f!==null?bi(f,ti.object):[null,void 0]},je=function(f,t){var g=de(f);return{h:g.h,s:Nt(g.s+100*t,0,100),l:g.l,a:g.a}},We=function(f){return(299*f.r+587*f.g+114*f.b)/1e3/255},Ci=function(f,t){var g=de(f);return{h:g.h,s:g.s,l:Nt(g.l+100*t,0,100),a:g.a}},ei=function(){function f(t){this.parsed=os(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return f.prototype.isValid=function(){return this.parsed!==null},f.prototype.brightness=function(){return It(We(this.rgba),2)},f.prototype.isDark=function(){return We(this.rgba)<.5},f.prototype.isLight=function(){return We(this.rgba)>=.5},f.prototype.toHex=function(){return t=Be(this.rgba),g=t.r,v=t.g,_=t.b,b=(C=t.a)<1?Se(It(255*C)):"","#"+Se(g)+Se(v)+Se(_)+b;var t,g,v,_,C,b},f.prototype.toRgb=function(){return Be(this.rgba)},f.prototype.toRgbString=function(){return t=Be(this.rgba),g=t.r,v=t.g,_=t.b,(C=t.a)<1?"rgba("+g+", "+v+", "+_+", "+C+")":"rgb("+g+", "+v+", "+_+")";var t,g,v,_,C},f.prototype.toHsl=function(){return _i(de(this.rgba))},f.prototype.toHslString=function(){return t=_i(de(this.rgba)),g=t.h,v=t.s,_=t.l,(C=t.a)<1?"hsla("+g+", "+v+"%, "+_+"%, "+C+")":"hsl("+g+", "+v+"%, "+_+"%)";var t,g,v,_,C},f.prototype.toHsv=function(){return t=ln(this.rgba),{h:It(t.h),s:It(t.s),v:It(t.v),a:It(t.a,3)};var t},f.prototype.invert=function(){return jt({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},f.prototype.saturate=function(t){return t===void 0&&(t=.1),jt(je(this.rgba,t))},f.prototype.desaturate=function(t){return t===void 0&&(t=.1),jt(je(this.rgba,-t))},f.prototype.grayscale=function(){return jt(je(this.rgba,-1))},f.prototype.lighten=function(t){return t===void 0&&(t=.1),jt(Ci(this.rgba,t))},f.prototype.darken=function(t){return t===void 0&&(t=.1),jt(Ci(this.rgba,-t))},f.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},f.prototype.alpha=function(t){return typeof t=="number"?jt({r:(g=this.rgba).r,g:g.g,b:g.b,a:t}):It(this.rgba.a,3);var g},f.prototype.hue=function(t){var g=de(this.rgba);return typeof t=="number"?jt({h:t,s:g.s,l:g.l,a:g.a}):It(g.h)},f.prototype.isEqual=function(t){return this.toHex()===jt(t).toHex()},f}(),jt=function(f){return f instanceof ei?f:new ei(f)},wi=[],ls=function(f){f.forEach(function(t){wi.indexOf(t)<0&&(t(ei,ti),wi.push(t))})},Xe=function(f){var t=f/255;return t<.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},He=function(f){return .2126*Xe(f.r)+.7152*Xe(f.g)+.0722*Xe(f.b)};function hs(f){f.prototype.luminance=function(){return t=He(this.rgba),(g=2)===void 0&&(g=0),v===void 0&&(v=Math.pow(10,g)),Math.round(v*t)/v+0;var t,g,v},f.prototype.contrast=function(t){t===void 0&&(t="#FFF");var g,v,_,C,b,c,i,l=t instanceof f?t:new f(t);return C=this.rgba,b=l.toRgb(),c=He(C),i=He(b),g=c>i?(c+.05)/(i+.05):(i+.05)/(c+.05),(v=2)===void 0&&(v=0),_===void 0&&(_=Math.pow(10,v)),Math.floor(_*g)/_+0},f.prototype.isReadable=function(t,g){return t===void 0&&(t="#FFF"),g===void 0&&(g={}),this.contrast(t)>=(c=(b=(v=g).size)===void 0?"normal":b,(C=(_=v.level)===void 0?"AA":_)==="AAA"&&c==="normal"?7:C==="AA"&&c==="large"?3:4.5);var v,_,C,b,c}}const se=[];function cs(f,t){return{subscribe:Kt(f,t).subscribe}}function Kt(f,t=bt){let g;const v=new Set;function _(c){if(Ot(f,c)&&(f=c,g)){const i=!se.length;for(const l of v)l[1](),se.push(l,f);if(i){for(let l=0;l<se.length;l+=2)se[l][0](se[l+1]);se.length=0}}}function C(c){_(c(f))}function b(c,i=bt){const l=[c,i];return v.add(l),v.size===1&&(g=t(_)||bt),c(f),()=>{v.delete(l),v.size===0&&g&&(g(),g=null)}}return{set:_,update:C,subscribe:b}}function us(f,t,g){const v=!Array.isArray(f),_=v?[f]:f,C=t.length<2;return cs(g,b=>{let c=!1;const i=[];let l=0,o=bt;const r=()=>{if(l)return;o();const e=t(v?i[0]:i,b);C?b(e):o=Pe(e)?e:bt},n=_.map((e,a)=>nn(e,h=>{i[a]=h,l&=~(1<<a),c&&r()},()=>{l|=1<<a}));return c=!0,r(),function(){Ft(n),o(),c=!1}})}const qt=Kt({ArrowLeft:0,ArrowUp:0,ArrowRight:0,ArrowDown:0}),ri=us(qt,f=>({...f,ArrowV:f.ArrowUp+f.ArrowDown,ArrowH:f.ArrowLeft+f.ArrowRight,ArrowVH:f.ArrowUp+f.ArrowDown+f.ArrowLeft+f.ArrowRight}));function si(f,t=.001,g=.01){const C=Math.min(1,Math.max(1,f-50)/50);return t+(g-t)/2*(1-Math.cos(Math.PI*C))}const{window:ue}=ni;function fs(f){let t,g,v,_,C,b;var c=f[2].pickerIndicator;function i(l){return{props:{pos:l[9],isDark:l[5],hex:jt({h:l[3],s:l[0],v:l[1],a:1}).toHex()}}}return c&&(g=St(c,i(f))),{c(){var l,o;t=et("div"),g&&yt(g.$$.fragment),I(t,"class","picker svelte-uiwgvv"),I(t,"tabindex","0"),Ht(t,"--color-bg",f[8]),I(t,"aria-label","saturation and brightness picker (arrow keyboard navigation)"),I(t,"aria-valuemin",0),I(t,"aria-valuemax",100),I(t,"aria-valuetext",v="saturation "+((l=f[9].x)==null?void 0:l.toFixed())+"%, brightness "+((o=f[9].y)==null?void 0:o.toFixed())+"%")},m(l,o){ut(l,t,o),g&&pt(g,t,null),f[18](t),_=!0,C||(b=[ot(t,"mousedown",ne(Ut(f[10]))),ot(t,"touchstart",f[16]),ot(t,"touchmove",ne(Ut(f[16]))),ot(t,"touchend",f[16])],C=!0)},p(l,o){var n,e;const r={};if(o&512&&(r.pos=l[9]),o&32&&(r.isDark=l[5]),o&11&&(r.hex=jt({h:l[3],s:l[0],v:l[1],a:1}).toHex()),o&4&&c!==(c=l[2].pickerIndicator)){if(g){Dt();const a=g;ft(a.$$.fragment,1,0,()=>{vt(a,1)}),Mt()}c?(g=St(c,i(l)),yt(g.$$.fragment),at(g.$$.fragment,1),pt(g,t,null)):g=null}else c&&g.$set(r);(!_||o&256)&&Ht(t,"--color-bg",l[8]),(!_||o&512&&v!==(v="saturation "+((n=l[9].x)==null?void 0:n.toFixed())+"%, brightness "+((e=l[9].y)==null?void 0:e.toFixed())+"%"))&&I(t,"aria-valuetext",v)},i(l){_||(g&&at(g.$$.fragment,l),_=!0)},o(l){g&&ft(g.$$.fragment,l),_=!1},d(l){l&&ht(t),g&&vt(g),f[18](null),C=!1,Ft(b)}}}function ds(f){let t,g,v,_,C;var b=f[2].pickerWrapper;function c(i){return{props:{focused:i[7],toRight:i[4],$$slots:{default:[fs]},$$scope:{ctx:i}}}}return b&&(t=St(b,c(f))),{c(){t&&yt(t.$$.fragment),g=Vt()},m(i,l){t&&pt(t,i,l),ut(i,g,l),v=!0,_||(C=[ot(ue,"mouseup",f[11]),ot(ue,"mousedown",f[13]),ot(ue,"mousemove",f[12]),ot(ue,"keyup",f[14]),ot(ue,"keydown",f[15])],_=!0)},p(i,[l]){const o={};if(l&128&&(o.focused=i[7]),l&16&&(o.toRight=i[4]),l&67109743&&(o.$$scope={dirty:l,ctx:i}),l&4&&b!==(b=i[2].pickerWrapper)){if(t){Dt();const r=t;ft(r.$$.fragment,1,0,()=>{vt(r,1)}),Mt()}b?(t=St(b,c(i)),yt(t.$$.fragment),at(t.$$.fragment,1),pt(t,g.parentNode,g)):t=null}else b&&t.$set(o)},i(i){v||(t&&at(t.$$.fragment,i),v=!0)},o(i){t&&ft(t.$$.fragment,i),v=!1},d(i){i&&ht(g),t&&vt(t,i),_=!1,Ft(C)}}}function Si(f,t,g){return Math.min(Math.max(t,f),g)}function gs(f,t,g){let v,_;Lt(f,qt,N=>g(22,v=N)),Lt(f,ri,N=>g(23,_=N));let{components:C}=t,{h:b}=t,{s:c}=t,{v:i}=t,{isOpen:l}=t,{toRight:o}=t,{isDark:r}=t,n,e=!1,a=!1,h,s,u,d={x:100,y:0};function m(N){let J={x:N.offsetX,y:N.offsetY},$=n.getBoundingClientRect().width,Z=n.getBoundingClientRect().height;g(0,c=Si(J.x/$,0,1)*100),g(1,i=Si((Z-J.y)/Z,0,1)*100)}function p(N){N.button===0&&(e=!0,m(N))}function y(){e=!1}function w(N){e&&m({offsetX:Math.max(0,Math.min(n.getBoundingClientRect().width,N.clientX-n.getBoundingClientRect().left)),offsetY:Math.max(0,Math.min(n.getBoundingClientRect().height,N.clientY-n.getBoundingClientRect().top))})}function S(N){N.target.isSameNode(n)||g(7,a=!1)}function E(N){var J;N.key==="Tab"&&g(7,a=!!((J=document.activeElement)!=null&&J.isSameNode(n))),!N.repeat&&a&&W()}function D(N){a&&_.ArrowVH&&(N.preventDefault(),N.repeat||W())}function W(){_.ArrowVH?h||(s=0,h=window.setInterval(()=>{let N=si(++s);g(0,c=Math.min(100,Math.max(0,c+(v.ArrowRight-v.ArrowLeft)*N*100))),g(1,i=Math.min(100,Math.max(0,i+(v.ArrowUp-v.ArrowDown)*N*100)))},10)):h&&(clearInterval(h),h=void 0)}function K(N){N.preventDefault(),m({offsetX:N.changedTouches[0].clientX-n.getBoundingClientRect().left,offsetY:N.changedTouches[0].clientY-n.getBoundingClientRect().top})}function tt(N){Ct[N?"unshift":"push"](()=>{n=N,g(6,n)})}return f.$$set=N=>{"components"in N&&g(2,C=N.components),"h"in N&&g(3,b=N.h),"s"in N&&g(0,c=N.s),"v"in N&&g(1,i=N.v),"isOpen"in N&&g(17,l=N.isOpen),"toRight"in N&&g(4,o=N.toRight),"isDark"in N&&g(5,r=N.isDark)},f.$$.update=()=>{f.$$.dirty&8&&typeof b=="number"&&g(8,u=jt({h:b,s:100,v:100,a:1}).toHex()),f.$$.dirty&67&&typeof c=="number"&&typeof i=="number"&&n&&g(9,d={x:c,y:100-i})},[c,i,C,b,o,r,n,a,u,d,p,y,w,S,E,D,K,l,tt]}class ms extends kt{constructor(t){super(),Et(this,t,gs,ds,Ot,{components:2,h:3,s:0,v:1,isOpen:17,toRight:4,isDark:5})}}const{window:Te}=ni;function ps(f){let t,g,v,_,C,b;var c=f[1].sliderIndicator;function i(l){return{props:{pos:l[4],toRight:l[2]}}}return c&&(g=St(c,i(f))),{c(){t=et("div"),g&&yt(g.$$.fragment),I(t,"class","slider svelte-14nweqy"),I(t,"tabindex","0"),I(t,"aria-label","hue picker (arrow keyboard navigation)"),I(t,"aria-valuemin",0),I(t,"aria-valuemax",360),I(t,"aria-valuenow",v=Math.round(f[0])),Rt(t,"to-right",f[2])},m(l,o){ut(l,t,o),g&&pt(g,t,null),f[12](t),_=!0,C||(b=[ot(t,"mousedown",ne(Ut(f[6]))),ot(t,"touchstart",f[11]),ot(t,"touchmove",ne(Ut(f[11]))),ot(t,"touchend",f[11])],C=!0)},p(l,o){const r={};if(o&16&&(r.pos=l[4]),o&4&&(r.toRight=l[2]),o&2&&c!==(c=l[1].sliderIndicator)){if(g){Dt();const n=g;ft(n.$$.fragment,1,0,()=>{vt(n,1)}),Mt()}c?(g=St(c,i(l)),yt(g.$$.fragment),at(g.$$.fragment,1),pt(g,t,null)):g=null}else c&&g.$set(r);(!_||o&1&&v!==(v=Math.round(l[0])))&&I(t,"aria-valuenow",v),(!_||o&4)&&Rt(t,"to-right",l[2])},i(l){_||(g&&at(g.$$.fragment,l),_=!0)},o(l){g&&ft(g.$$.fragment,l),_=!1},d(l){l&&ht(t),g&&vt(g),f[12](null),C=!1,Ft(b)}}}function vs(f){let t,g,v,_,C;var b=f[1].sliderWrapper;function c(i){return{props:{focused:i[5],toRight:i[2],$$slots:{default:[ps]},$$scope:{ctx:i}}}}return b&&(t=St(b,c(f))),{c(){t&&yt(t.$$.fragment),g=Vt()},m(i,l){t&&pt(t,i,l),ut(i,g,l),v=!0,_||(C=[ot(Te,"mouseup",f[7]),ot(Te,"mousemove",f[8]),ot(Te,"keyup",f[9]),ot(Te,"keydown",f[10])],_=!0)},p(i,[l]){const o={};if(l&32&&(o.focused=i[5]),l&4&&(o.toRight=i[2]),l&1048607&&(o.$$scope={dirty:l,ctx:i}),l&2&&b!==(b=i[1].sliderWrapper)){if(t){Dt();const r=t;ft(r.$$.fragment,1,0,()=>{vt(r,1)}),Mt()}b?(t=St(b,c(i)),yt(t.$$.fragment),at(t.$$.fragment,1),pt(t,g.parentNode,g)):t=null}else b&&t.$set(o)},i(i){v||(t&&at(t.$$.fragment,i),v=!0)},o(i){t&&ft(t.$$.fragment,i),v=!1},d(i){i&&ht(g),t&&vt(t,i),_=!1,Ft(C)}}}function _s(f,t,g){let v,_;Lt(f,qt,S=>g(16,v=S)),Lt(f,ri,S=>g(17,_=S));let{components:C}=t,{toRight:b}=t,c,i=!1,{h:l}=t,o=0,r=!1,n,e;function a(S){const E=b?c.getBoundingClientRect().width:c.getBoundingClientRect().height,D=Math.max(0,Math.min(E,S));g(0,l=D/E*360)}function h(S){S.button===0&&(i=!0,a(b?S.offsetX:S.offsetY))}function s(){i=!1}function u(S){i&&a(b?S.clientX-c.getBoundingClientRect().left:S.clientY-c.getBoundingClientRect().top)}function d(S){var E;S.key==="Tab"&&g(5,r=!!((E=document.activeElement)!=null&&E.isSameNode(c))),!S.repeat&&r&&p()}function m(S){r&&_.ArrowVH&&(S.preventDefault(),S.repeat||p())}function p(){_.ArrowVH?n||(e=0,n=window.setInterval(()=>{const S=si(++e),E=b?v.ArrowRight-v.ArrowLeft:v.ArrowDown-v.ArrowUp;g(0,l=Math.min(360,Math.max(0,l+E*360*S)))},10)):n&&(clearInterval(n),n=void 0)}function y(S){S.preventDefault(),a(b?S.changedTouches[0].clientX-c.getBoundingClientRect().left:S.changedTouches[0].clientY-c.getBoundingClientRect().top)}function w(S){Ct[S?"unshift":"push"](()=>{c=S,g(3,c)})}return f.$$set=S=>{"components"in S&&g(1,C=S.components),"toRight"in S&&g(2,b=S.toRight),"h"in S&&g(0,l=S.h)},f.$$.update=()=>{f.$$.dirty&9&&typeof l=="number"&&c&&g(4,o=100*l/360)},[l,C,b,c,o,r,h,s,u,d,m,y,w]}class ys extends kt{constructor(t){super(),Et(this,t,_s,vs,Ot,{components:1,toRight:2,h:0})}}const{window:xe}=ni;function bs(f){let t,g,v,_,C,b,c;var i=f[0].alphaIndicator;function l(o){return{props:{pos:o[5],toRight:o[2]}}}return i&&(g=St(i,l(f))),{c(){var o,r;t=et("div"),g&&yt(g.$$.fragment),I(t,"class","alpha svelte-f2vq53"),I(t,"tabindex","0"),Ht(t,"--alpha-color",(o=f[1])==null?void 0:o.substring(0,7)),I(t,"aria-label","transparency picker (arrow keyboard navigation)"),I(t,"aria-valuemin",0),I(t,"aria-valuemax",100),I(t,"aria-valuenow",v=Math.round(f[5])),I(t,"aria-valuetext",_=((r=f[5])==null?void 0:r.toFixed())+"%"),Rt(t,"to-right",f[2])},m(o,r){ut(o,t,r),g&&pt(g,t,null),f[14](t),C=!0,b||(c=[ot(t,"mousedown",ne(Ut(f[6]))),ot(t,"touchstart",f[11]),ot(t,"touchmove",ne(Ut(f[11]))),ot(t,"touchend",f[11])],b=!0)},p(o,r){var e,a;const n={};if(r&32&&(n.pos=o[5]),r&4&&(n.toRight=o[2]),r&1&&i!==(i=o[0].alphaIndicator)){if(g){Dt();const h=g;ft(h.$$.fragment,1,0,()=>{vt(h,1)}),Mt()}i?(g=St(i,l(o)),yt(g.$$.fragment),at(g.$$.fragment,1),pt(g,t,null)):g=null}else i&&g.$set(n);(!C||r&2)&&Ht(t,"--alpha-color",(e=o[1])==null?void 0:e.substring(0,7)),(!C||r&32&&v!==(v=Math.round(o[5])))&&I(t,"aria-valuenow",v),(!C||r&32&&_!==(_=((a=o[5])==null?void 0:a.toFixed())+"%"))&&I(t,"aria-valuetext",_),(!C||r&4)&&Rt(t,"to-right",o[2])},i(o){C||(g&&at(g.$$.fragment,o),C=!0)},o(o){g&&ft(g.$$.fragment,o),C=!1},d(o){o&&ht(t),g&&vt(g),f[14](null),b=!1,Ft(c)}}}function Cs(f){let t,g,v,_,C;var b=f[0].alphaWrapper;function c(i){return{props:{focused:i[4],toRight:i[2],$$slots:{default:[bs]},$$scope:{ctx:i}}}}return b&&(t=St(b,c(f))),{c(){t&&yt(t.$$.fragment),g=Vt()},m(i,l){t&&pt(t,i,l),ut(i,g,l),v=!0,_||(C=[ot(xe,"mouseup",f[7]),ot(xe,"mousemove",f[8]),ot(xe,"keyup",f[9]),ot(xe,"keydown",f[10])],_=!0)},p(i,[l]){const o={};if(l&16&&(o.focused=i[4]),l&4&&(o.toRight=i[2]),l&4194351&&(o.$$scope={dirty:l,ctx:i}),l&1&&b!==(b=i[0].alphaWrapper)){if(t){Dt();const r=t;ft(r.$$.fragment,1,0,()=>{vt(r,1)}),Mt()}b?(t=St(b,c(i)),yt(t.$$.fragment),at(t.$$.fragment,1),pt(t,g.parentNode,g)):t=null}else b&&t.$set(o)},i(i){v||(t&&at(t.$$.fragment,i),v=!0)},o(i){t&&ft(t.$$.fragment,i),v=!1},d(i){i&&ht(g),t&&vt(t,i),_=!1,Ft(C)}}}function ws(f,t,g){let v,_;Lt(f,qt,D=>g(18,v=D)),Lt(f,ri,D=>g(19,_=D));let{components:C}=t,{isOpen:b}=t,{a:c=1}=t,{hex:i}=t,{toRight:l}=t,o,r=!1,n=!1,e,a,h;function s(D){const W=l?o.getBoundingClientRect().width:o.getBoundingClientRect().height,K=Math.max(0,Math.min(W,D));g(12,c=K/W)}function u(D){D.button===0&&(r=!0,s(l?D.offsetX:D.offsetY))}function d(){r=!1}function m(D){r&&s(l?D.clientX-o.getBoundingClientRect().left:D.clientY-o.getBoundingClientRect().top)}function p(D){var W;D.key==="Tab"&&g(4,n=!!((W=document.activeElement)!=null&&W.isSameNode(o))),!D.repeat&&n&&w()}function y(D){n&&_.ArrowVH&&(D.preventDefault(),D.repeat||w())}function w(){_.ArrowVH?e||(a=0,e=window.setInterval(()=>{const D=si(++a),W=l?v.ArrowRight-v.ArrowLeft:v.ArrowDown-v.ArrowUp;g(12,c=Math.min(1,Math.max(0,c+W*D)))},10)):e&&(clearInterval(e),e=void 0)}function S(D){D.preventDefault(),s(l?D.changedTouches[0].clientX-o.getBoundingClientRect().left:D.changedTouches[0].clientY-o.getBoundingClientRect().top)}function E(D){Ct[D?"unshift":"push"](()=>{o=D,g(3,o)})}return f.$$set=D=>{"components"in D&&g(0,C=D.components),"isOpen"in D&&g(13,b=D.isOpen),"a"in D&&g(12,c=D.a),"hex"in D&&g(1,i=D.hex),"toRight"in D&&g(2,l=D.toRight)},f.$$.update=()=>{f.$$.dirty&4104&&typeof c=="number"&&o&&g(5,h=100*c)},[C,i,l,o,n,h,u,d,m,p,y,S,c,b,E]}class Ss extends kt{constructor(t){super(),Et(this,t,ws,Cs,Ot,{components:0,isOpen:13,a:12,hex:1,toRight:2})}}function Ts(f){let t,g,v,_,C,b,c,i,l,o=f[2]&&Ti(f);return{c(){t=et("div"),g=et("input"),v=gt(),_=et("input"),C=gt(),b=et("input"),c=gt(),o&&o.c(),I(g,"aria-label","hue chanel color"),g.value=f[8],I(g,"type","number"),I(g,"min","0"),I(g,"max","360"),I(g,"class","svelte-11z4jba"),I(_,"aria-label","saturation chanel color"),_.value=f[7],I(_,"type","number"),I(_,"min","0"),I(_,"max","100"),I(_,"class","svelte-11z4jba"),I(b,"aria-label","brightness chanel color"),b.value=f[6],I(b,"type","number"),I(b,"min","0"),I(b,"max","100"),I(b,"class","svelte-11z4jba"),I(t,"class","input-container svelte-11z4jba")},m(r,n){ut(r,t,n),Q(t,g),Q(t,v),Q(t,_),Q(t,C),Q(t,b),Q(t,c),o&&o.m(t,null),i||(l=[ot(g,"input",f[12]("h")),ot(_,"input",f[12]("s")),ot(b,"input",f[12]("v"))],i=!0)},p(r,n){n&256&&g.value!==r[8]&&(g.value=r[8]),n&128&&_.value!==r[7]&&(_.value=r[7]),n&64&&b.value!==r[6]&&(b.value=r[6]),r[2]?o?o.p(r,n):(o=Ti(r),o.c(),o.m(t,null)):o&&(o.d(1),o=null)},d(r){r&&ht(t),o&&o.d(),i=!1,Ft(l)}}}function xs(f){let t,g,v,_,C,b,c,i,l,o,r,n,e=f[2]&&xi(f);return{c(){t=et("div"),g=et("input"),_=gt(),C=et("input"),c=gt(),i=et("input"),o=gt(),e&&e.c(),I(g,"aria-label","red chanel color"),g.value=v=f[0].r,I(g,"type","number"),I(g,"min","0"),I(g,"max","255"),I(g,"class","svelte-11z4jba"),I(C,"aria-label","green chanel color"),C.value=b=f[0].g,I(C,"type","number"),I(C,"min","0"),I(C,"max","255"),I(C,"class","svelte-11z4jba"),I(i,"aria-label","blue chanel color"),i.value=l=f[0].b,I(i,"type","number"),I(i,"min","0"),I(i,"max","255"),I(i,"class","svelte-11z4jba"),I(t,"class","input-container svelte-11z4jba")},m(a,h){ut(a,t,h),Q(t,g),Q(t,_),Q(t,C),Q(t,c),Q(t,i),Q(t,o),e&&e.m(t,null),r||(n=[ot(g,"input",f[11]("r")),ot(C,"input",f[11]("g")),ot(i,"input",f[11]("b"))],r=!0)},p(a,h){h&1&&v!==(v=a[0].r)&&g.value!==v&&(g.value=v),h&1&&b!==(b=a[0].g)&&C.value!==b&&(C.value=b),h&1&&l!==(l=a[0].b)&&i.value!==l&&(i.value=l),a[2]?e?e.p(a,h):(e=xi(a),e.c(),e.m(t,null)):e&&(e.d(1),e=null)},d(a){a&&ht(t),e&&e.d(),r=!1,Ft(n)}}}function Os(f){let t,g,v,_,C,b=f[2]&&Oi(f);return{c(){t=et("div"),g=et("input"),v=gt(),b&&b.c(),g.value=f[1],Ht(g,"flex","3"),I(g,"class","svelte-11z4jba"),I(t,"class","input-container svelte-11z4jba")},m(c,i){ut(c,t,i),Q(t,g),Q(t,v),b&&b.m(t,null),_||(C=ot(g,"input",f[10]),_=!0)},p(c,i){i&2&&g.value!==c[1]&&(g.value=c[1]),c[2]?b?b.p(c,i):(b=Oi(c),b.c(),b.m(t,null)):b&&(b.d(1),b=null)},d(c){c&&ht(t),b&&b.d(),_=!1,C()}}}function Ti(f){let t,g,v;return{c(){t=et("input"),I(t,"aria-label","transparency chanel color"),t.value=f[5],I(t,"type","number"),I(t,"min","0"),I(t,"max","1"),I(t,"step","0.01"),I(t,"class","svelte-11z4jba")},m(_,C){ut(_,t,C),g||(v=ot(t,"input",f[12]("a")),g=!0)},p(_,C){C&32&&t.value!==_[5]&&(t.value=_[5])},d(_){_&&ht(t),g=!1,v()}}}function xi(f){let t,g,v;return{c(){t=et("input"),I(t,"aria-label","transparency chanel color"),t.value=f[5],I(t,"type","number"),I(t,"min","0"),I(t,"max","1"),I(t,"step","0.01"),I(t,"class","svelte-11z4jba")},m(_,C){ut(_,t,C),g||(v=ot(t,"input",f[11]("a")),g=!0)},p(_,C){C&32&&t.value!==_[5]&&(t.value=_[5])},d(_){_&&ht(t),g=!1,v()}}}function Oi(f){let t,g,v;return{c(){t=et("input"),I(t,"aria-label","hexadecimal color"),t.value=f[5],I(t,"type","number"),I(t,"min","0"),I(t,"max","1"),I(t,"step","0.01"),I(t,"class","svelte-11z4jba")},m(_,C){ut(_,t,C),g||(v=ot(t,"input",f[11]("a")),g=!0)},p(_,C){C&32&&t.value!==_[5]&&(t.value=_[5])},d(_){_&&ht(t),g=!1,v()}}}function Ei(f){let t,g=f[9][f[4]]+"",v,_,C,b;return{c(){t=et("button"),v=Xt(g),I(t,"aria-label",_="change inputs to "+f[9][(f[4]+1)%3]),I(t,"class","svelte-11z4jba")},m(c,i){ut(c,t,i),Q(t,v),C||(b=ot(t,"click",f[14]),C=!0)},p(c,i){i&16&&g!==(g=c[9][c[4]]+"")&&le(v,g),i&16&&_!==(_="change inputs to "+c[9][(c[4]+1)%3])&&I(t,"aria-label",_)},d(c){c&&ht(t),C=!1,b()}}}function Es(f){let t,g;function v(c,i){return c[4]===0?Os:c[4]===1?xs:Ts}let _=v(f),C=_(f),b=f[3]&&Ei(f);return{c(){t=et("div"),C.c(),g=gt(),b&&b.c(),I(t,"class","text-input svelte-11z4jba")},m(c,i){ut(c,t,i),C.m(t,null),Q(t,g),b&&b.m(t,null)},p(c,[i]){_===(_=v(c))&&C?C.p(c,i):(C.d(1),C=_(c),C&&(C.c(),C.m(t,g))),c[3]?b?b.p(c,i):(b=Ei(c),b.c(),b.m(t,null)):b&&(b.d(1),b=null)},i:bt,o:bt,d(c){c&&ht(t),C.d(),b&&b.d()}}}const ks=/^#?([A-F0-9]{6}|[A-F0-9]{8})$/i;function As(f,t,g){let v,_,C,b,{isAlpha:c}=t,{rgb:i}=t,{hsv:l}=t,{hex:o}=t,{canChangeMode:r}=t;const n=["HEX","RGB","HSV"];let e=0;function a(d){const m=d.target;ks.test(m.value)&&g(1,o=m.value)}function h(d){return function(m){g(0,i={...i,[d]:parseFloat(m.target.value)})}}function s(d){return function(m){g(13,l={...l,[d]:parseFloat(m.target.value)})}}const u=()=>g(4,e=(e+1)%3);return f.$$set=d=>{"isAlpha"in d&&g(2,c=d.isAlpha),"rgb"in d&&g(0,i=d.rgb),"hsv"in d&&g(13,l=d.hsv),"hex"in d&&g(1,o=d.hex),"canChangeMode"in d&&g(3,r=d.canChangeMode)},f.$$.update=()=>{f.$$.dirty&8192&&g(8,v=Math.round(l.h)),f.$$.dirty&8192&&g(7,_=Math.round(l.s)),f.$$.dirty&8192&&g(6,C=Math.round(l.v)),f.$$.dirty&8192&&g(5,b=l.a===void 0?1:Math.round(l.a*100)/100)},[i,o,c,r,e,b,C,_,v,n,a,h,s,l,u]}class Ps extends kt{constructor(t){super(),Et(this,t,As,Es,Ot,{isAlpha:2,rgb:0,hsv:13,hex:1,canChangeMode:3})}}function Ds(f){let t,g;return{c(){t=et("div"),I(t,"class","slider-indicator svelte-htgglv"),I(t,"style",g=`top: calc(${f[0]/200*186}% + 2px);`)},m(v,_){ut(v,t,_)},p(v,[_]){_&1&&g!==(g=`top: calc(${v[0]/200*186}% + 2px);`)&&I(t,"style",g)},i:bt,o:bt,d(v){v&&ht(t)}}}function Ms(f,t,g){let{pos:v}=t,{toRight:_}=t;return f.$$set=C=>{"pos"in C&&g(0,v=C.pos),"toRight"in C&&g(1,_=C.toRight)},[v,_]}class ki extends kt{constructor(t){super(),Et(this,t,Ms,Ds,Ot,{pos:0,toRight:1})}}function Fs(f){let t,g;return{c(){t=et("div"),I(t,"class","picker-indicator svelte-1nw247x"),I(t,"style",g=`left: calc(${f[0].x/200*186}% + 2px); top: calc(${f[0].y/200*186}% + 2px); box-shadow: 0 0 4px ${f[1]?"white":"black"};`)},m(v,_){ut(v,t,_)},p(v,[_]){_&3&&g!==(g=`left: calc(${v[0].x/200*186}% + 2px); top: calc(${v[0].y/200*186}% + 2px); box-shadow: 0 0 4px ${v[1]?"white":"black"};`)&&I(t,"style",g)},i:bt,o:bt,d(v){v&&ht(t)}}}function Is(f,t,g){let{pos:v}=t,{hex:_}=t,{isDark:C}=t;return f.$$set=b=>{"pos"in b&&g(0,v=b.pos),"hex"in b&&g(2,_=b.hex),"isDark"in b&&g(1,C=b.isDark)},[v,C,_]}class Ls extends kt{constructor(t){super(),Et(this,t,Is,Fs,Ot,{pos:0,hex:2,isDark:1})}}function Rs(f){let t,g;return{c:bt,m(v,_){t||(g=[ot(window,"keyup",f[0]),ot(window,"keydown",f[1])],t=!0)},p:bt,i:bt,o:bt,d(v){t=!1,Ft(g)}}}function Bs(f,t,g){let v;Lt(f,qt,b=>g(2,v=b));function _(b){["ArrowLeft","ArrowUp","ArrowRight","ArrowDown"].includes(b.key)&&(Jt(qt,v[b.key]=0,v),qt.set(v))}function C(b){["ArrowLeft","ArrowUp","ArrowRight","ArrowDown"].includes(b.key)&&(b.repeat||(Jt(qt,v[b.key]=1,v),qt.set(v)))}return[_,C]}class js extends kt{constructor(t){super(),Et(this,t,Bs,Rs,Ot,{})}}function Ws(f){let t,g;const v=f[3].default,_=me(v,f,f[2],null);return{c(){t=et("div"),_&&_.c(),I(t,"class","picker-wrapper svelte-1isc651"),Rt(t,"focused",f[0])},m(C,b){ut(C,t,b),_&&_.m(t,null),g=!0},p(C,[b]){_&&_.p&&(!g||b&4)&&ve(_,v,C,C[2],g?pe(v,C[2],b,null):_e(C[2]),null),(!g||b&1)&&Rt(t,"focused",C[0])},i(C){g||(at(_,C),g=!0)},o(C){ft(_,C),g=!1},d(C){C&&ht(t),_&&_.d(C)}}}function Xs(f,t,g){let{$$slots:v={},$$scope:_}=t,{focused:C}=t,{toRight:b}=t;return f.$$set=c=>{"focused"in c&&g(0,C=c.focused),"toRight"in c&&g(1,b=c.toRight),"$$scope"in c&&g(2,_=c.$$scope)},[C,b,_,v]}class Hs extends kt{constructor(t){super(),Et(this,t,Xs,Ws,Ot,{focused:0,toRight:1})}}function Ns(f){let t,g;const v=f[3].default,_=me(v,f,f[2],null);return{c(){t=et("div"),_&&_.c(),I(t,"class","slider-wrapper svelte-1udewng"),Rt(t,"focused",f[0])},m(C,b){ut(C,t,b),_&&_.m(t,null),g=!0},p(C,[b]){_&&_.p&&(!g||b&4)&&ve(_,v,C,C[2],g?pe(v,C[2],b,null):_e(C[2]),null),(!g||b&1)&&Rt(t,"focused",C[0])},i(C){g||(at(_,C),g=!0)},o(C){ft(_,C),g=!1},d(C){C&&ht(t),_&&_.d(C)}}}function Ys(f,t,g){let{$$slots:v={},$$scope:_}=t,{focused:C}=t,{toRight:b}=t;return f.$$set=c=>{"focused"in c&&g(0,C=c.focused),"toRight"in c&&g(1,b=c.toRight),"$$scope"in c&&g(2,_=c.$$scope)},[C,b,_,v]}class Ai extends kt{constructor(t){super(),Et(this,t,Ys,Ns,Ot,{focused:0,toRight:1})}}function zs(f){let t,g,v,_,C,b,c,i,l,o,r;return{c(){t=et("label"),g=et("div"),v=et("input"),_=gt(),C=et("div"),b=gt(),c=et("div"),i=gt(),l=Xt(f[2]),I(v,"type","color"),v.value=f[1],I(v,"aria-haspopup","dialog"),I(v,"class","svelte-2ybi8r"),I(C,"class","alpha svelte-2ybi8r"),I(c,"class","color svelte-2ybi8r"),Ht(c,"background",f[1]),I(g,"class","container svelte-2ybi8r"),I(t,"class","svelte-2ybi8r")},m(n,e){ut(n,t,e),Q(t,g),Q(g,v),Q(g,_),Q(g,C),Q(g,b),Q(g,c),Q(t,i),Q(t,l),f[4](t),o||(r=[ot(v,"click",Ut(Us)),ot(v,"mousedown",Ut(Vs)),ot(t,"click",Ut(Gs)),ot(t,"mousedown",Ut(qs))],o=!0)},p(n,[e]){e&2&&(v.value=n[1]),e&2&&Ht(c,"background",n[1]),e&4&&le(l,n[2])},i:bt,o:bt,d(n){n&&ht(t),f[4](null),o=!1,Ft(r)}}}const Us=()=>{},Vs=()=>{},Gs=()=>{},qs=()=>{};function Ks(f,t,g){let{labelWrapper:v}=t,{hex:_}=t,{label:C}=t,{isOpen:b}=t;function c(i){Ct[i?"unshift":"push"](()=>{v=i,g(0,v)})}return f.$$set=i=>{"labelWrapper"in i&&g(0,v=i.labelWrapper),"hex"in i&&g(1,_=i.hex),"label"in i&&g(2,C=i.label),"isOpen"in i&&g(3,b=i.isOpen)},[v,_,C,b,c]}class Js extends kt{constructor(t){super(),Et(this,t,Ks,zs,Ot,{labelWrapper:0,hex:1,label:2,isOpen:3})}}function Qs(f){let t,g,v;const _=f[5].default,C=me(_,f,f[4],null);return{c(){t=et("div"),C&&C.c(),I(t,"class","wrapper svelte-160vdtq"),I(t,"role",g=f[2]?"dialog":void 0),I(t,"aria-label","color picker"),Rt(t,"isOpen",f[1]),Rt(t,"isPopup",f[2])},m(b,c){ut(b,t,c),C&&C.m(t,null),f[6](t),v=!0},p(b,[c]){C&&C.p&&(!v||c&16)&&ve(C,_,b,b[4],v?pe(_,b[4],c,null):_e(b[4]),null),(!v||c&4&&g!==(g=b[2]?"dialog":void 0))&&I(t,"role",g),(!v||c&2)&&Rt(t,"isOpen",b[1]),(!v||c&4)&&Rt(t,"isPopup",b[2])},i(b){v||(at(C,b),v=!0)},o(b){ft(C,b),v=!1},d(b){b&&ht(t),C&&C.d(b),f[6](null)}}}function Zs(f,t,g){let{$$slots:v={},$$scope:_}=t,{wrapper:C}=t,{isOpen:b}=t,{isPopup:c}=t,{toRight:i}=t;function l(o){Ct[o?"unshift":"push"](()=>{C=o,g(0,C)})}return f.$$set=o=>{"wrapper"in o&&g(0,C=o.wrapper),"isOpen"in o&&g(1,b=o.isOpen),"isPopup"in o&&g(2,c=o.isPopup),"toRight"in o&&g(3,i=o.toRight),"$$scope"in o&&g(4,_=o.$$scope)},[C,b,c,i,_,v,l]}class $s extends kt{constructor(t){super(),Et(this,t,Zs,Qs,Ot,{wrapper:0,isOpen:1,isPopup:2,toRight:3})}}function Pi(f,t,g){const v=f.slice();return v[9]=t[g].contrast,v[10]=t[g].hex,v[11]=t[g].placeholder,v[12]=t[g].reverse,v[13]=t[g].size,v}function Di(f){let t,g,v;var _=f[0].a11ySingleNotice;function C(b){return{props:{contrast:b[9],textColor:b[12]?b[10]:b[1],bgColor:b[12]?b[1]:b[10],placeholder:b[11],size:b[13]}}}return _&&(t=St(_,C(f))),{c(){t&&yt(t.$$.fragment),g=Vt()},m(b,c){t&&pt(t,b,c),ut(b,g,c),v=!0},p(b,c){const i={};if(c&16&&(i.contrast=b[9]),c&18&&(i.textColor=b[12]?b[10]:b[1]),c&18&&(i.bgColor=b[12]?b[1]:b[10]),c&16&&(i.placeholder=b[11]),c&16&&(i.size=b[13]),c&1&&_!==(_=b[0].a11ySingleNotice)){if(t){Dt();const l=t;ft(l.$$.fragment,1,0,()=>{vt(l,1)}),Mt()}_?(t=St(_,C(b)),yt(t.$$.fragment),at(t.$$.fragment,1),pt(t,g.parentNode,g)):t=null}else _&&t.$set(i)},i(b){v||(t&&at(t.$$.fragment,b),v=!0)},o(b){t&&ft(t.$$.fragment,b),v=!1},d(b){b&&ht(g),t&&vt(t,b)}}}function Mi(f){let t;return{c(){t=et("span"),I(t,"class","svelte-1s4dluu")},m(g,v){ut(g,t,v),t.innerHTML=f[2]},p(g,v){v&4&&(t.innerHTML=g[2])},d(g){g&&ht(t)}}}function ta(f){let t,g,v,_,C,b,c,i,l;var o=f[0].a11ySummary;function r(s){return{props:{a11yColors:s[4],hex:s[1]}}}o&&(v=St(o,r(f)));let n=f[4],e=[];for(let s=0;s<n.length;s+=1)e[s]=Di(Pi(f,n,s));const a=s=>ft(e[s],1,1,()=>{e[s]=null});let h=f[2]&&Mi(f);return{c(){t=et("details"),g=et("summary"),v&&yt(v.$$.fragment),C=gt(),b=et("div");for(let s=0;s<e.length;s+=1)e[s].c();c=gt(),h&&h.c(),I(g,"tabindex",_=f[5]?-1:void 0),I(g,"class","svelte-1s4dluu"),I(b,"class","svelte-1s4dluu"),I(t,"class",i="a11y-notice "+(f[5]?"not-closable":"")+" svelte-1s4dluu"),t.open=f[3]},m(s,u){ut(s,t,u),Q(t,g),v&&pt(v,g,null),Q(t,C),Q(t,b);for(let d=0;d<e.length;d+=1)e[d]&&e[d].m(b,null);Q(b,c),h&&h.m(b,null),l=!0},p(s,[u]){const d={};if(u&16&&(d.a11yColors=s[4]),u&2&&(d.hex=s[1]),u&1&&o!==(o=s[0].a11ySummary)){if(v){Dt();const m=v;ft(m.$$.fragment,1,0,()=>{vt(m,1)}),Mt()}o?(v=St(o,r(s)),yt(v.$$.fragment),at(v.$$.fragment,1),pt(v,g,null)):v=null}else o&&v.$set(d);if((!l||u&32&&_!==(_=s[5]?-1:void 0))&&I(g,"tabindex",_),u&19){n=s[4];let m;for(m=0;m<n.length;m+=1){const p=Pi(s,n,m);e[m]?(e[m].p(p,u),at(e[m],1)):(e[m]=Di(p),e[m].c(),at(e[m],1),e[m].m(b,c))}for(Dt(),m=n.length;m<e.length;m+=1)a(m);Mt()}s[2]?h?h.p(s,u):(h=Mi(s),h.c(),h.m(b,null)):h&&(h.d(1),h=null),(!l||u&32&&i!==(i="a11y-notice "+(s[5]?"not-closable":"")+" svelte-1s4dluu"))&&I(t,"class",i),(!l||u&8)&&(t.open=s[3])},i(s){if(!l){v&&at(v.$$.fragment,s);for(let u=0;u<n.length;u+=1)at(e[u]);l=!0}},o(s){v&&ft(v.$$.fragment,s),e=e.filter(Boolean);for(let u=0;u<e.length;u+=1)ft(e[u]);l=!1},d(s){s&&ht(t),v&&vt(v),Je(e,s),h&&h.d()}}}function ea(f,t,g){let v,_,{components:C}=t,{a11yColors:b}=t,{hex:c}=t,{color:i}=t,{a11yGuidelines:l}=t,{isA11yOpen:o}=t,{isA11yClosable:r}=t;return f.$$set=n=>{"components"in n&&g(0,C=n.components),"a11yColors"in n&&g(6,b=n.a11yColors),"hex"in n&&g(1,c=n.hex),"color"in n&&g(7,i=n.color),"a11yGuidelines"in n&&g(2,l=n.a11yGuidelines),"isA11yOpen"in n&&g(3,o=n.isA11yOpen),"isA11yClosable"in n&&g(8,r=n.isA11yClosable)},f.$$.update=()=>{f.$$.dirty&264&&g(5,v=o&&!r),f.$$.dirty&192&&g(4,_=b.map(n=>({...n,contrast:i==null?void 0:i.contrast(n.hex)})))},[C,c,l,o,_,v,b,i,r]}class ia extends kt{constructor(t){super(),Et(this,t,ea,ta,Ot,{components:0,a11yColors:6,hex:1,color:7,a11yGuidelines:2,isA11yOpen:3,isA11yClosable:8})}}function na(f){let t,g,v=(f[2]||"Lorem Ipsum")+"",_,C,b,c,i,l,o=(f[3]>=10?f[3].toFixed(1):f[3])+"",r,n,e,a,h;return{c(){t=et("div"),g=et("p"),_=Xt(v),b=gt(),c=et("div"),i=et("p"),l=Xt("contrast: "),r=Xt(o),n=gt(),e=et("span"),e.textContent="AA",a=gt(),h=et("span"),h.textContent="AAA",I(g,"class",C="lorem "+(f[4]==="large"&&"large")+" svelte-obnxge"),Ht(g,"color",f[0]),Ht(g,"background-color",f[1]),I(i,"class","svelte-obnxge"),I(e,"class","grade svelte-obnxge"),Rt(e,"grade-ok",f[3]>(f[4]==="large"?3:4.5)),I(h,"class","grade svelte-obnxge"),Rt(h,"grade-ok",f[3]>(f[4]==="large"?4.5:7)),I(c,"class","score svelte-obnxge"),I(t,"class","a11y-single-notice svelte-obnxge")},m(s,u){ut(s,t,u),Q(t,g),Q(g,_),Q(t,b),Q(t,c),Q(c,i),Q(i,l),Q(i,r),Q(c,n),Q(c,e),Q(c,a),Q(c,h)},p(s,[u]){u&4&&v!==(v=(s[2]||"Lorem Ipsum")+"")&&le(_,v),u&16&&C!==(C="lorem "+(s[4]==="large"&&"large")+" svelte-obnxge")&&I(g,"class",C),u&1&&Ht(g,"color",s[0]),u&2&&Ht(g,"background-color",s[1]),u&8&&o!==(o=(s[3]>=10?s[3].toFixed(1):s[3])+"")&&le(r,o),u&24&&Rt(e,"grade-ok",s[3]>(s[4]==="large"?3:4.5)),u&24&&Rt(h,"grade-ok",s[3]>(s[4]==="large"?4.5:7))},i:bt,o:bt,d(s){s&&ht(t)}}}function ra(f,t,g){let{textColor:v}=t,{bgColor:_}=t,{placeholder:C=void 0}=t,{contrast:b=1}=t,{size:c=void 0}=t;return f.$$set=i=>{"textColor"in i&&g(0,v=i.textColor),"bgColor"in i&&g(1,_=i.bgColor),"placeholder"in i&&g(2,C=i.placeholder),"contrast"in i&&g(3,b=i.contrast),"size"in i&&g(4,c=i.size)},[v,_,C,b,c]}class sa extends kt{constructor(t){super(),Et(this,t,ra,na,Ot,{textColor:0,bgColor:1,placeholder:2,contrast:3,size:4})}}function aa(f){let t;return{c(){t=Xt(f[0])},m(g,v){ut(g,t,v)},p(g,[v]){v&1&&le(t,g[0])},i:bt,o:bt,d(g){g&&ht(t)}}}function oa({contrast:f,size:t}){return f?t==="large"?f<3?2:f<4.5?1:0:f<4.5?2:f<7?1:0:1}function la(f,t,g){let v,_,{a11yColors:C}=t,{hex:b}=t;return f.$$set=c=>{"a11yColors"in c&&g(1,C=c.a11yColors),"hex"in c&&g(2,b=c.hex)},f.$$.update=()=>{f.$$.dirty&2&&g(3,v=C.map(oa).reduce((c,i)=>c+i)),f.$$.dirty&8&&g(0,_=v?`⚠️ ${v} contrast grade${v&&"s"} fail`:"Contrast grade information")},[_,C,b,v]}class ha extends kt{constructor(t){super(),Et(this,t,la,aa,Ot,{a11yColors:1,hex:2})}}function ca(f){let t;return{c(){t=et("input"),I(t,"type","hidden"),t.value=f[2]},m(g,v){ut(g,t,v)},p(g,v){v[0]&4&&(t.value=g[2])},i:bt,o:bt,d(g){g&&ht(t)}}}function ua(f){let t,g,v,_,C;function b(o){f[25](o)}function c(o){f[26](o)}var i=f[21]().input;function l(o){let r={hex:o[2],label:o[6]};return o[19]!==void 0&&(r.labelWrapper=o[19]),o[3]!==void 0&&(r.isOpen=o[3]),{props:r}}return i&&(t=St(i,l(f)),Ct.push(()=>Pt(t,"labelWrapper",b)),Ct.push(()=>Pt(t,"isOpen",c))),{c(){t&&yt(t.$$.fragment),_=Vt()},m(o,r){t&&pt(t,o,r),ut(o,_,r),C=!0},p(o,r){const n={};if(r[0]&4&&(n.hex=o[2]),r[0]&64&&(n.label=o[6]),!g&&r[0]&524288&&(g=!0,n.labelWrapper=o[19],Wt(()=>g=!1)),!v&&r[0]&8&&(v=!0,n.isOpen=o[3],Wt(()=>v=!1)),i!==(i=o[21]().input)){if(t){Dt();const e=t;ft(e.$$.fragment,1,0,()=>{vt(e,1)}),Mt()}i?(t=St(i,l(o)),Ct.push(()=>Pt(t,"labelWrapper",b)),Ct.push(()=>Pt(t,"isOpen",c)),yt(t.$$.fragment),at(t.$$.fragment,1),pt(t,_.parentNode,_)):t=null}else i&&t.$set(n)},i(o){C||(t&&at(t.$$.fragment,o),C=!0)},o(o){t&&ft(t.$$.fragment,o),C=!1},d(o){o&&ht(_),t&&vt(t,o)}}}function Fi(f){let t,g,v,_;function C(i){f[31](i)}function b(i){f[32](i)}let c={components:f[21](),hex:f[2],toRight:f[17]};return f[1].a!==void 0&&(c.a=f[1].a),f[3]!==void 0&&(c.isOpen=f[3]),t=new Ss({props:c}),Ct.push(()=>Pt(t,"a",C)),Ct.push(()=>Pt(t,"isOpen",b)),{c(){yt(t.$$.fragment)},m(i,l){pt(t,i,l),_=!0},p(i,l){const o={};l[0]&4&&(o.hex=i[2]),l[0]&131072&&(o.toRight=i[17]),!g&&l[0]&2&&(g=!0,o.a=i[1].a,Wt(()=>g=!1)),!v&&l[0]&8&&(v=!0,o.isOpen=i[3],Wt(()=>v=!1)),t.$set(o)},i(i){_||(at(t.$$.fragment,i),_=!0)},o(i){ft(t.$$.fragment,i),_=!1},d(i){vt(t,i)}}}function Ii(f){let t,g,v,_,C,b;function c(n){f[33](n)}function i(n){f[34](n)}function l(n){f[35](n)}var o=f[21]().textInput;function r(n){let e={isAlpha:n[7],canChangeMode:n[10]};return n[2]!==void 0&&(e.hex=n[2]),n[0]!==void 0&&(e.rgb=n[0]),n[1]!==void 0&&(e.hsv=n[1]),{props:e}}return o&&(t=St(o,r(f)),Ct.push(()=>Pt(t,"hex",c)),Ct.push(()=>Pt(t,"rgb",i)),Ct.push(()=>Pt(t,"hsv",l))),{c(){t&&yt(t.$$.fragment),C=Vt()},m(n,e){t&&pt(t,n,e),ut(n,C,e),b=!0},p(n,e){const a={};if(e[0]&128&&(a.isAlpha=n[7]),e[0]&1024&&(a.canChangeMode=n[10]),!g&&e[0]&4&&(g=!0,a.hex=n[2],Wt(()=>g=!1)),!v&&e[0]&1&&(v=!0,a.rgb=n[0],Wt(()=>v=!1)),!_&&e[0]&2&&(_=!0,a.hsv=n[1],Wt(()=>_=!1)),o!==(o=n[21]().textInput)){if(t){Dt();const h=t;ft(h.$$.fragment,1,0,()=>{vt(h,1)}),Mt()}o?(t=St(o,r(n)),Ct.push(()=>Pt(t,"hex",c)),Ct.push(()=>Pt(t,"rgb",i)),Ct.push(()=>Pt(t,"hsv",l)),yt(t.$$.fragment),at(t.$$.fragment,1),pt(t,C.parentNode,C)):t=null}else o&&t.$set(a)},i(n){b||(t&&at(t.$$.fragment,n),b=!0)},o(n){t&&ft(t.$$.fragment,n),b=!1},d(n){n&&ht(C),t&&vt(t,n)}}}function Li(f){let t,g,v;var _=f[21]().a11yNotice;function C(b){return{props:{components:b[21](),a11yColors:b[12],color:b[4],hex:b[2],a11yGuidelines:b[13],isA11yOpen:b[14],isA11yClosable:b[15]}}}return _&&(t=St(_,C(f))),{c(){t&&yt(t.$$.fragment),g=Vt()},m(b,c){t&&pt(t,b,c),ut(b,g,c),v=!0},p(b,c){const i={};if(c[0]&4096&&(i.a11yColors=b[12]),c[0]&16&&(i.color=b[4]),c[0]&4&&(i.hex=b[2]),c[0]&8192&&(i.a11yGuidelines=b[13]),c[0]&16384&&(i.isA11yOpen=b[14]),c[0]&32768&&(i.isA11yClosable=b[15]),_!==(_=b[21]().a11yNotice)){if(t){Dt();const l=t;ft(l.$$.fragment,1,0,()=>{vt(l,1)}),Mt()}_?(t=St(_,C(b)),yt(t.$$.fragment),at(t.$$.fragment,1),pt(t,g.parentNode,g)):t=null}else _&&t.$set(i)},i(b){v||(t&&at(t.$$.fragment,b),v=!0)},o(b){t&&ft(t.$$.fragment,b),v=!1},d(b){b&&ht(g),t&&vt(t,b)}}}function fa(f){let t,g,v,_,C,b,c,i,l,o,r,n;function e(w){f[27](w)}function a(w){f[28](w)}function h(w){f[29](w)}let s={components:f[21](),h:f[1].h,toRight:f[17],isDark:f[5]};f[1].s!==void 0&&(s.s=f[1].s),f[1].v!==void 0&&(s.v=f[1].v),f[3]!==void 0&&(s.isOpen=f[3]),t=new ms({props:s}),Ct.push(()=>Pt(t,"s",e)),Ct.push(()=>Pt(t,"v",a)),Ct.push(()=>Pt(t,"isOpen",h));function u(w){f[30](w)}let d={components:f[21](),toRight:f[17]};f[1].h!==void 0&&(d.h=f[1].h),b=new ys({props:d}),Ct.push(()=>Pt(b,"h",u));let m=f[7]&&Fi(f),p=f[9]&&Ii(f),y=f[11]&&Li(f);return{c(){yt(t.$$.fragment),C=gt(),yt(b.$$.fragment),i=gt(),m&&m.c(),l=gt(),p&&p.c(),o=gt(),y&&y.c(),r=Vt()},m(w,S){pt(t,w,S),ut(w,C,S),pt(b,w,S),ut(w,i,S),m&&m.m(w,S),ut(w,l,S),p&&p.m(w,S),ut(w,o,S),y&&y.m(w,S),ut(w,r,S),n=!0},p(w,S){const E={};S[0]&2&&(E.h=w[1].h),S[0]&131072&&(E.toRight=w[17]),S[0]&32&&(E.isDark=w[5]),!g&&S[0]&2&&(g=!0,E.s=w[1].s,Wt(()=>g=!1)),!v&&S[0]&2&&(v=!0,E.v=w[1].v,Wt(()=>v=!1)),!_&&S[0]&8&&(_=!0,E.isOpen=w[3],Wt(()=>_=!1)),t.$set(E);const D={};S[0]&131072&&(D.toRight=w[17]),!c&&S[0]&2&&(c=!0,D.h=w[1].h,Wt(()=>c=!1)),b.$set(D),w[7]?m?(m.p(w,S),S[0]&128&&at(m,1)):(m=Fi(w),m.c(),at(m,1),m.m(l.parentNode,l)):m&&(Dt(),ft(m,1,1,()=>{m=null}),Mt()),w[9]?p?(p.p(w,S),S[0]&512&&at(p,1)):(p=Ii(w),p.c(),at(p,1),p.m(o.parentNode,o)):p&&(Dt(),ft(p,1,1,()=>{p=null}),Mt()),w[11]?y?(y.p(w,S),S[0]&2048&&at(y,1)):(y=Li(w),y.c(),at(y,1),y.m(r.parentNode,r)):y&&(Dt(),ft(y,1,1,()=>{y=null}),Mt())},i(w){n||(at(t.$$.fragment,w),at(b.$$.fragment,w),at(m),at(p),at(y),n=!0)},o(w){ft(t.$$.fragment,w),ft(b.$$.fragment,w),ft(m),ft(p),ft(y),n=!1},d(w){vt(t,w),w&&ht(C),vt(b,w),w&&ht(i),m&&m.d(w),w&&ht(l),p&&p.d(w),w&&ht(o),y&&y.d(w),w&&ht(r)}}}function da(f){let t,g,v,_,C,b,c,i,l,o,r;t=new js({});const n=[ua,ca],e=[];function a(d,m){return d[8]?0:1}_=a(f),C=e[_]=n[_](f);function h(d){f[36](d)}var s=f[21]().wrapper;function u(d){let m={isOpen:d[3],isPopup:d[16],toRight:d[17],$$slots:{default:[fa]},$$scope:{ctx:d}};return d[20]!==void 0&&(m.wrapper=d[20]),{props:m}}return s&&(c=St(s,u(f)),Ct.push(()=>Pt(c,"wrapper",h))),{c(){yt(t.$$.fragment),g=gt(),v=et("span"),C.c(),b=gt(),c&&yt(c.$$.fragment),I(v,"class","color-picker svelte-7ntk55")},m(d,m){pt(t,d,m),ut(d,g,m),ut(d,v,m),e[_].m(v,null),Q(v,b),c&&pt(c,v,null),f[37](v),l=!0,o||(r=[ot(window,"mousedown",f[22]),ot(window,"keyup",f[23])],o=!0)},p(d,m){let p=_;_=a(d),_===p?e[_].p(d,m):(Dt(),ft(e[p],1,1,()=>{e[p]=null}),Mt(),C=e[_],C?C.p(d,m):(C=e[_]=n[_](d),C.c()),at(C,1),C.m(v,b));const y={};if(m[0]&8&&(y.isOpen=d[3]),m[0]&65536&&(y.isPopup=d[16]),m[0]&131072&&(y.toRight=d[17]),m[0]&196287|m[1]&8192&&(y.$$scope={dirty:m,ctx:d}),!i&&m[0]&1048576&&(i=!0,y.wrapper=d[20],Wt(()=>i=!1)),s!==(s=d[21]().wrapper)){if(c){Dt();const w=c;ft(w.$$.fragment,1,0,()=>{vt(w,1)}),Mt()}s?(c=St(s,u(d)),Ct.push(()=>Pt(c,"wrapper",h)),yt(c.$$.fragment),at(c.$$.fragment,1),pt(c,v,null)):c=null}else s&&c.$set(y)},i(d){l||(at(t.$$.fragment,d),at(C),c&&at(c.$$.fragment,d),l=!0)},o(d){ft(t.$$.fragment,d),ft(C),c&&ft(c.$$.fragment,d),l=!1},d(d){vt(t,d),d&&ht(g),d&&ht(v),e[_].d(),c&&vt(c),f[37](null),o=!1,Ft(r)}}}function ga(f,t,g){ls([hs]);let{components:v={}}=t;const _=zr();let{label:C="Choose a color"}=t,{isAlpha:b=!0}=t,{isInput:c=!0}=t,{isTextInput:i=!0}=t,{canChangeMode:l=!0}=t,{isA11y:o=!1}=t,{a11yColors:r=[{hex:"#ffffff"}]}=t,{a11yGuidelines:n='<p style="margin: 0; font-size: 12px;">Learn more at <a href="https://webaim.org/articles/contrast/" target="_blank">WebAIM contrast guide</a></p>'}=t,{isA11yOpen:e=!1}=t,{isA11yClosable:a=!0}=t,{isPopup:h=c}=t,{isOpen:s=!c}=t,{toRight:u=!1}=t,{rgb:d={r:255,g:0,b:0,a:1}}=t,{hsv:m={h:0,s:100,v:100,a:1}}=t,{hex:p="#ff0000"}=t,{color:y=void 0}=t,{isDark:w=!1}=t,S={r:255,g:0,b:0,a:1},E={h:0,s:100,v:100,a:1},D="#ff0000",W;const K={sliderIndicator:ki,pickerIndicator:Ls,alphaIndicator:ki,pickerWrapper:Hs,sliderWrapper:Ai,alphaWrapper:Ai,textInput:Ps,a11yNotice:ia,a11ySingleNotice:sa,a11ySummary:ha,input:Js,wrapper:$s};function tt(){return{...K,...v}}let N,J;function $({target:F}){c&&(N.contains(F)||N.isSameNode(F)?g(3,s=!s):s&&!J.contains(F)&&g(3,s=!1))}function Z(F){F.key==="Tab"&&g(3,s=W==null?void 0:W.contains(document.activeElement))}function rt(){m.h===E.h&&m.s===E.s&&m.v===E.v&&m.a===E.a&&d.r===S.r&&d.g===S.g&&d.b===S.b&&d.a===S.a&&p===D||(m.a===void 0&&g(1,m.a=1,m),E.a===void 0&&(E.a=1),d.a===void 0&&g(0,d.a=1,d),S.a===void 0&&(S.a=1),(p==null?void 0:p.substring(7))==="ff"&&g(2,p=p.substring(0,7)),(p==null?void 0:p.substring(7))==="ff"&&g(2,p=p.substring(0,7)),m.h!==E.h||m.s!==E.s||m.v!==E.v||m.a!==E.a?(g(4,y=jt(m)),g(0,d=y.toRgb()),g(2,p=y.toHex())):d.r!==S.r||d.g!==S.g||d.b!==S.b||d.a!==S.a?(g(4,y=jt(d)),g(2,p=y.toHex()),g(1,m=y.toHsv())):p!==D&&(g(4,y=jt(p)),g(0,d=y.toRgb()),g(1,m=y.toHsv())),y&&g(5,w=y.isDark()),E=Object.assign({},m),S=Object.assign({},d),D=p,_("input",{color:y,hsv:m,rgb:d,hex:p}))}function st(F){N=F,g(19,N)}function T(F){s=F,g(3,s)}function A(F){f.$$.not_equal(m.s,F)&&(m.s=F,g(1,m))}function P(F){f.$$.not_equal(m.v,F)&&(m.v=F,g(1,m))}function k(F){s=F,g(3,s)}function B(F){f.$$.not_equal(m.h,F)&&(m.h=F,g(1,m))}function O(F){f.$$.not_equal(m.a,F)&&(m.a=F,g(1,m))}function x(F){s=F,g(3,s)}function M(F){p=F,g(2,p)}function R(F){d=F,g(0,d)}function Y(F){m=F,g(1,m)}function j(F){J=F,g(20,J)}function G(F){Ct[F?"unshift":"push"](()=>{W=F,g(18,W)})}return f.$$set=F=>{"components"in F&&g(24,v=F.components),"label"in F&&g(6,C=F.label),"isAlpha"in F&&g(7,b=F.isAlpha),"isInput"in F&&g(8,c=F.isInput),"isTextInput"in F&&g(9,i=F.isTextInput),"canChangeMode"in F&&g(10,l=F.canChangeMode),"isA11y"in F&&g(11,o=F.isA11y),"a11yColors"in F&&g(12,r=F.a11yColors),"a11yGuidelines"in F&&g(13,n=F.a11yGuidelines),"isA11yOpen"in F&&g(14,e=F.isA11yOpen),"isA11yClosable"in F&&g(15,a=F.isA11yClosable),"isPopup"in F&&g(16,h=F.isPopup),"isOpen"in F&&g(3,s=F.isOpen),"toRight"in F&&g(17,u=F.toRight),"rgb"in F&&g(0,d=F.rgb),"hsv"in F&&g(1,m=F.hsv),"hex"in F&&g(2,p=F.hex),"color"in F&&g(4,y=F.color),"isDark"in F&&g(5,w=F.isDark)},f.$$.update=()=>{f.$$.dirty[0]&7&&(m||d||p)&&rt()},[d,m,p,s,y,w,C,b,c,i,l,o,r,n,e,a,h,u,W,N,J,tt,$,Z,v,st,T,A,P,k,B,O,x,M,R,Y,j,G]}class ma extends kt{constructor(t){super(),Et(this,t,ga,da,Ot,{components:24,label:6,isAlpha:7,isInput:8,isTextInput:9,canChangeMode:10,isA11y:11,a11yColors:12,a11yGuidelines:13,isA11yOpen:14,isA11yClosable:15,isPopup:16,isOpen:3,toRight:17,rgb:0,hsv:1,hex:2,color:4,isDark:5},null,[-1,-1])}}const Ri=Kt("#F9BB01"),Ae=Kt(),be=Kt(600),Bi=Kt(!1),ji=Kt(!1),Wi=Kt(!1),Xi=Kt(!1),pa="/assets/watermark-c2d43a34.png",va="/assets/close-7faef788.svg";const _a=f=>({}),Hi=f=>({});function ya(f){let t,g,v,_,C,b,c,i,l,o;const r=f[3].header,n=me(r,f,f[2],Hi),e=f[3].default,a=me(e,f,f[2],null);return{c(){t=et("dialog"),g=et("div"),n&&n.c(),v=gt(),a&&a.c(),_=gt(),C=et("button"),b=et("img"),Ke(b.src,c=va)||I(b,"src",c),I(b,"aria-hidden",""),I(b,"alt","닫기"),I(C,"class","close svelte-ckxgtn"),C.autofocus=!0,I(C,"aria-label","닫기"),I(g,"class","svelte-ckxgtn"),I(t,"class","svelte-ckxgtn")},m(h,s){ut(h,t,s),Q(t,g),n&&n.m(g,null),Q(g,v),a&&a.m(g,null),Q(g,_),Q(g,C),Q(C,b),f[6](t),i=!0,C.focus(),l||(o=[ot(C,"click",f[5]),ot(g,"click",ne(f[4])),ot(t,"close",f[7]),ot(t,"click",Xr(f[8]))],l=!0)},p(h,[s]){n&&n.p&&(!i||s&4)&&ve(n,r,h,h[2],i?pe(r,h[2],s,_a):_e(h[2]),Hi),a&&a.p&&(!i||s&4)&&ve(a,e,h,h[2],i?pe(e,h[2],s,null):_e(h[2]),null)},i(h){i||(at(n,h),at(a,h),i=!0)},o(h){ft(n,h),ft(a,h),i=!1},d(h){h&&ht(t),n&&n.d(h),a&&a.d(h),f[6](null),l=!1,Ft(o)}}}function ba(f,t,g){let{$$slots:v={},$$scope:_}=t,{showModal:C}=t,b;function c(n){Ur.call(this,f,n)}const i=()=>b.close();function l(n){Ct[n?"unshift":"push"](()=>{b=n,g(1,b)})}const o=()=>g(0,C=!1),r=()=>b.close();return f.$$set=n=>{"showModal"in n&&g(0,C=n.showModal),"$$scope"in n&&g(2,_=n.$$scope)},f.$$.update=()=>{f.$$.dirty&3&&b&&C&&b.showModal()},[C,b,_,v,c,i,l,o,r]}class Ca extends kt{constructor(t){super(),Et(this,t,ba,ya,Ot,{showModal:0})}}function wa(f){let t,g,v,_,C,b;return{c(){t=et("img"),v=gt(),_=et("button"),_.textContent="저장하기",Ke(t.src,g=f[3])||I(t,"src",g),I(t,"alt","데브진스"),I(_,"class","save svelte-9v3wcg")},m(c,i){ut(c,t,i),ut(c,v,i),ut(c,_,i),C||(b=ot(_,"click",f[7]),C=!0)},p(c,i){i&8&&!Ke(t.src,g=c[3])&&I(t,"src",g)},d(c){c&&ht(t),c&&ht(v),c&&ht(_),C=!1,b()}}}function Sa(f){let t;return{c(){t=et("h2"),t.textContent="짜잔~ 완성된 이미지에요.",I(t,"slot","header"),I(t,"class","svelte-9v3wcg")},m(g,v){ut(g,t,v)},p:bt,d(g){g&&ht(t)}}}function Ta(f){let t,g,v,_,C,b,c,i,l,o,r,n,e,a,h,s,u,d,m,p,y,w,S,E,D,W,K;function tt(Z){f[9](Z)}let N={$$slots:{header:[Sa],default:[wa]},$$scope:{ctx:f}};f[2]!==void 0&&(N.showModal=f[2]),t=new Ca({props:N}),Ct.push(()=>Pt(t,"showModal",tt));function J(Z){f[10](Z)}let $={isA11yClosable:!1,label:"배경색"};return f[0]!==void 0&&($.hex=f[0]),i=new ma({props:$}),Ct.push(()=>Pt(i,"hex",J)),{c(){yt(t.$$.fragment),v=gt(),_=et("div"),C=et("div"),b=et("h2"),b.textContent="배경색",c=gt(),yt(i.$$.fragment),o=gt(),r=et("div"),n=et("h2"),n.textContent="사진 추가",e=gt(),a=et("div"),h=et("button"),h.textContent="추가",s=gt(),u=et("button"),u.textContent="제거",d=gt(),m=et("input"),p=gt(),y=et("div"),w=et("h2"),w.textContent="이미지",S=gt(),E=et("button"),E.textContent="만들기",I(b,"class","svelte-9v3wcg"),I(C,"class","svelte-9v3wcg"),I(n,"class","svelte-9v3wcg"),I(h,"class","svelte-9v3wcg"),I(u,"class","svelte-9v3wcg"),I(m,"type","file"),I(m,"accept","image/*"),Ht(m,"display","none"),I(r,"class","svelte-9v3wcg"),I(w,"class","svelte-9v3wcg"),I(E,"class","svelte-9v3wcg"),I(y,"class","svelte-9v3wcg"),I(_,"class","toolbar svelte-9v3wcg")},m(Z,rt){pt(t,Z,rt),ut(Z,v,rt),ut(Z,_,rt),Q(_,C),Q(C,b),Q(C,c),pt(i,C,null),Q(_,o),Q(_,r),Q(r,n),Q(r,e),Q(r,a),Q(a,h),Q(a,s),Q(a,u),Q(r,d),Q(r,m),f[12](m),Q(_,p),Q(_,y),Q(y,w),Q(y,S),Q(y,E),D=!0,W||(K=[ot(h,"click",f[11]),ot(u,"click",f[5]),ot(m,"change",f[4]),ot(E,"click",f[6])],W=!0)},p(Z,[rt]){const st={};rt&16392&&(st.$$scope={dirty:rt,ctx:Z}),!g&&rt&4&&(g=!0,st.showModal=Z[2],Wt(()=>g=!1)),t.$set(st);const T={};!l&&rt&1&&(l=!0,T.hex=Z[0],Wt(()=>l=!1)),i.$set(T)},i(Z){D||(at(t.$$.fragment,Z),at(i.$$.fragment,Z),D=!0)},o(Z){ft(t.$$.fragment,Z),ft(i.$$.fragment,Z),D=!1},d(Z){vt(t,Z),Z&&ht(v),Z&&ht(_),vt(i),f[12](null),W=!1,Ft(K)}}}function xa(f,t,g){let v,_,C;Lt(f,Ae,u=>g(8,v=u)),Lt(f,be,u=>g(13,_=u)),Lt(f,Ri,u=>g(0,C=u));let b,c=!1,i="";const l=u=>{const d=u.currentTarget.files;if(!d)return;const m=d[0];if(!m)return;o();const p=URL.createObjectURL(m);he.fabric.Image.fromURL(p,function(y){const w=.39166666666666666,S=360/600;y.set({left:w*_,top:S*_,angle:-10}),y.set("logo","logo"),y.scaleToWidth(_/6),v.add(y)})},o=()=>{v.getObjects().filter(m=>m.logo==="logo").forEach(m=>v.remove(m))},r=()=>{he.fabric.Image.fromURL(pa,function(u){u.scaleToWidth(_),u.scaleToWidth(_),u.selectable=!1,v.add(u),v.renderAll(),g(3,i=v.toDataURL({format:"png",quality:1,multiplier:4})),v.remove(u),g(2,c=!0)})},n=()=>{const u=document.createElement("a");u.download="dev-jeans.png",u.href=i,u.click()};function e(u){c=u,g(2,c)}function a(u){C=u,Ri.set(C)}const h=()=>b.click();function s(u){Ct[u?"unshift":"push"](()=>{b=u,g(1,b)})}return f.$$.update=()=>{f.$$.dirty&257&&v&&v.setBackgroundColor(C,()=>{v.renderAll()})},[C,b,c,i,l,o,r,n,v,e,a,h,s]}class Oa extends kt{constructor(t){super(),Et(this,t,xa,Ta,Ot,{})}}const Ea="/assets/glasses-ca8642be.png",ka="/assets/hair-416c3326.png",Aa="/assets/laptop-afa03861.png",Pa="/assets/coffee-7794bf02.png";function Da(f){let t,g,v,_,C,b,c,i,l,o,r,n,e,a,h,s,u,d,m,p,y,w,S,E,D;return{c(){t=et("div"),g=et("h2"),g.textContent="아이템을 추가해 꾸며주세요!",v=gt(),_=et("ul"),C=et("li"),b=et("button"),c=Xt("안경"),l=gt(),o=et("li"),r=et("button"),n=Xt("앞머리"),a=gt(),h=et("li"),s=et("button"),u=Xt("노트북"),m=gt(),p=et("li"),y=et("button"),w=Xt("커피"),I(g,"class","svelte-1pxcdh4"),I(b,"class",i=zt(f[3]?"active":"")+" svelte-1pxcdh4"),I(C,"class","svelte-1pxcdh4"),I(r,"class",e=zt(f[2]?"active":"")+" svelte-1pxcdh4"),I(o,"class","svelte-1pxcdh4"),I(s,"class",d=zt(f[1]?"active":"")+" svelte-1pxcdh4"),I(h,"class","svelte-1pxcdh4"),I(y,"class",S=zt(f[0]?"active":"")+" svelte-1pxcdh4"),I(p,"class","svelte-1pxcdh4"),I(_,"class","toolbar svelte-1pxcdh4"),I(t,"class","container svelte-1pxcdh4")},m(W,K){ut(W,t,K),Q(t,g),Q(t,v),Q(t,_),Q(_,C),Q(C,b),Q(b,c),Q(_,l),Q(_,o),Q(o,r),Q(r,n),Q(_,a),Q(_,h),Q(h,s),Q(s,u),Q(_,m),Q(_,p),Q(p,y),Q(y,w),E||(D=[ot(b,"click",f[4]("glasses")),ot(r,"click",f[4]("hair")),ot(s,"click",f[4]("laptop")),ot(y,"click",f[4]("coffee"))],E=!0)},p(W,[K]){K&8&&i!==(i=zt(W[3]?"active":"")+" svelte-1pxcdh4")&&I(b,"class",i),K&4&&e!==(e=zt(W[2]?"active":"")+" svelte-1pxcdh4")&&I(r,"class",e),K&2&&d!==(d=zt(W[1]?"active":"")+" svelte-1pxcdh4")&&I(s,"class",d),K&1&&S!==(S=zt(W[0]?"active":"")+" svelte-1pxcdh4")&&I(y,"class",S)},i:bt,o:bt,d(W){W&&ht(t),E=!1,Ft(D)}}}function Ma(f,t,g){let v,_,C,b,c,i;Lt(f,Xi,n=>g(0,v=n)),Lt(f,Wi,n=>g(1,_=n)),Lt(f,ji,n=>g(2,C=n)),Lt(f,Bi,n=>g(3,b=n)),Lt(f,Ae,n=>g(5,c=n)),Lt(f,be,n=>g(6,i=n));const l=n=>{let e;n==="glasses"?e=Ea:n==="hair"?e=ka:n==="laptop"?e=Aa:n==="coffee"&&(e=Pa),he.fabric.Image.fromURL(e,function(a){a.scaleToWidth(i),a.scaleToWidth(i),a.selectable=!1,a.set("costume",n),c.add(a),c.renderAll()})},o=n=>{c.getObjects().filter(h=>h.costume===n).forEach(h=>c.remove(h))},r=n=>()=>{n==="glasses"?Jt(Bi,b=!b,b):n==="hair"?Jt(ji,C=!C,C):n==="laptop"?Jt(Wi,_=!_,_):n==="coffee"&&Jt(Xi,v=!v,v)};return f.$$.update=()=>{if(f.$$.dirty&47){const n=c.getObjects(),e=n.find(u=>u.costume==="glasses"),a=n.find(u=>u.costume==="hair"),h=n.find(u=>u.costume==="laptop"),s=n.find(u=>u.costume==="coffee");!e&&b?l("glasses"):e&&!b&&o("glasses"),!a&&C?l("hair"):a&&!C&&o("hair"),!h&&_?l("laptop"):h&&!_&&o("laptop"),!s&&v?l("coffee"):s&&!v&&o("coffee")}},[v,_,C,b,r,c]}class Fa extends kt{constructor(t){super(),Et(this,t,Ma,Da,Ot,{})}}function Ni(f,t,g){const v=f.slice();return v[3]=t[g],v}function Yi(f,t,g){const v=f.slice();return v[3]=t[g],v}function zi(f){let t,g,v=f[3].label+"",_,C,b,c,i;return{c(){t=et("li"),g=et("button"),_=Xt(v),C=gt(),I(g,"type","button"),I(g,"class","svelte-bzko04"),I(t,"class",b=zt(f[0]===f[3].value?"active":"")+" svelte-bzko04")},m(l,o){ut(l,t,o),Q(t,g),Q(g,_),Q(t,C),c||(i=ot(g,"click",function(){Pe(f[2](f[3].value))&&f[2](f[3].value).apply(this,arguments)}),c=!0)},p(l,o){f=l,o&2&&v!==(v=f[3].label+"")&&le(_,v),o&3&&b!==(b=zt(f[0]===f[3].value?"active":"")+" svelte-bzko04")&&I(t,"class",b)},d(l){l&&ht(t),c=!1,i()}}}function Ui(f){let t,g,v,_;var C=f[3].component;function b(c){return{}}return C&&(g=St(C,b())),{c(){t=et("div"),g&&yt(g.$$.fragment),v=gt(),I(t,"class","box svelte-bzko04")},m(c,i){ut(c,t,i),g&&pt(g,t,null),Q(t,v),_=!0},p(c,i){if(i&2&&C!==(C=c[3].component)){if(g){Dt();const l=g;ft(l.$$.fragment,1,0,()=>{vt(l,1)}),Mt()}C?(g=St(C,b()),yt(g.$$.fragment),at(g.$$.fragment,1),pt(g,t,v)):g=null}},i(c){_||(g&&at(g.$$.fragment,c),_=!0)},o(c){g&&ft(g.$$.fragment,c),_=!1},d(c){c&&ht(t),g&&vt(g)}}}function Vi(f){let t,g,v=f[0]==f[3].value&&Ui(f);return{c(){v&&v.c(),t=Vt()},m(_,C){v&&v.m(_,C),ut(_,t,C),g=!0},p(_,C){_[0]==_[3].value?v?(v.p(_,C),C&3&&at(v,1)):(v=Ui(_),v.c(),at(v,1),v.m(t.parentNode,t)):v&&(Dt(),ft(v,1,1,()=>{v=null}),Mt())},i(_){g||(at(v),g=!0)},o(_){ft(v),g=!1},d(_){v&&v.d(_),_&&ht(t)}}}function Ia(f){let t,g,v,_,C=f[1],b=[];for(let o=0;o<C.length;o+=1)b[o]=zi(Yi(f,C,o));let c=f[1],i=[];for(let o=0;o<c.length;o+=1)i[o]=Vi(Ni(f,c,o));const l=o=>ft(i[o],1,1,()=>{i[o]=null});return{c(){t=et("ul");for(let o=0;o<b.length;o+=1)b[o].c();g=gt();for(let o=0;o<i.length;o+=1)i[o].c();v=Vt(),I(t,"class","taps svelte-bzko04")},m(o,r){ut(o,t,r);for(let n=0;n<b.length;n+=1)b[n]&&b[n].m(t,null);ut(o,g,r);for(let n=0;n<i.length;n+=1)i[n]&&i[n].m(o,r);ut(o,v,r),_=!0},p(o,[r]){if(r&7){C=o[1];let n;for(n=0;n<C.length;n+=1){const e=Yi(o,C,n);b[n]?b[n].p(e,r):(b[n]=zi(e),b[n].c(),b[n].m(t,null))}for(;n<b.length;n+=1)b[n].d(1);b.length=C.length}if(r&3){c=o[1];let n;for(n=0;n<c.length;n+=1){const e=Ni(o,c,n);i[n]?(i[n].p(e,r),at(i[n],1)):(i[n]=Vi(e),i[n].c(),at(i[n],1),i[n].m(v.parentNode,v))}for(Dt(),n=c.length;n<i.length;n+=1)l(n);Mt()}},i(o){if(!_){for(let r=0;r<c.length;r+=1)at(i[r]);_=!0}},o(o){i=i.filter(Boolean);for(let r=0;r<i.length;r+=1)ft(i[r]);_=!1},d(o){o&&ht(t),Je(b,o),o&&ht(g),Je(i,o),o&&ht(v)}}}function La(f,t,g){let{items:v=[]}=t,{activeTabValue:_=1}=t;const C=b=>()=>g(0,_=b);return f.$$set=b=>{"items"in b&&g(1,v=b.items),"activeTabValue"in b&&g(0,_=b.activeTabValue)},[_,v,C]}class Ra extends kt{constructor(t){super(),Et(this,t,La,Ia,Ot,{items:1,activeTabValue:0})}}function Ba(f){let t,g,v;return g=new Ra({props:{items:f[0]}}),{c(){t=et("div"),yt(g.$$.fragment),I(t,"class","container svelte-1nz23oh")},m(_,C){ut(_,t,C),pt(g,t,null),v=!0},p:bt,i(_){v||(at(g.$$.fragment,_),v=!0)},o(_){ft(g.$$.fragment,_),v=!1},d(_){_&&ht(t),vt(g)}}}function ja(f){return[[{label:"편집 하기",value:1,component:Oa},{label:"꾸미기",value:2,component:Fa}]]}class Wa extends kt{constructor(t){super(),Et(this,t,ja,Ba,Ot,{})}}function Xa(f){let t,g,v,_,C,b,c,i,l,o,r,n,e;return b=new Wa({}),{c(){t=et("main"),g=et("h1"),g.textContent="~개발진스 짤 만들어 쓰기~",v=gt(),_=et("canvas"),C=gt(),yt(b.$$.fragment),c=gt(),i=et("footer"),l=et("span"),l.innerHTML='Instagram: <a href="https://www.instagram.com/dev_hee/" class="svelte-15k31bi">@dev_hee</a>',o=gt(),r=et("span"),r.innerHTML='Blog: <a href="https://velog.io/@heelieben" class="svelte-15k31bi">@pigme</a>',I(g,"class","svelte-15k31bi"),I(_,"id","canvas"),I(_,"width","2400"),I(_,"height","2400"),Ht(_,"border","1px solid #ccc"),I(t,"style",`width: ${be}`),I(t,"class","svelte-15k31bi"),I(i,"style",n=`width: ${f[0]}`),I(i,"class","svelte-15k31bi")},m(a,h){ut(a,t,h),Q(t,g),Q(t,v),Q(t,_),ut(a,C,h),pt(b,a,h),ut(a,c,h),ut(a,i,h),Q(i,l),Q(i,o),Q(i,r),e=!0},p(a,[h]){(!e||h&1&&n!==(n=`width: ${a[0]}`))&&I(i,"style",n)},i(a){e||(at(b.$$.fragment,a),e=!0)},o(a){ft(b.$$.fragment,a),e=!1},d(a){a&&ht(t),a&&ht(C),vt(b,a),a&&ht(c),a&&ht(i)}}}function Ha(f,t,g){let v,_;Lt(f,Ae,c=>g(1,v=c)),Lt(f,be,c=>g(0,_=c));const C=()=>window.innerWidth<600?window.innerWidth:600;return Yr(()=>{Jt(Ae,v=new he.fabric.Canvas("canvas"),v),Jt(be,_=C(),_),v.setWidth(_*v.getZoom()),v.setHeight(_*v.getZoom()),he.fabric.Image.fromURL(Qr,function(c){c.scaleToWidth(_),c.scaleToWidth(_),c.selectable=!1,v.add(c),v.renderAll()})}),[_]}class Na extends kt{constructor(t){super(),Et(this,t,Ha,Xa,Ot,{})}}const Ya={apiKey:"AIzaSyAaUDcN2yxsp28P7iP4tmxm0FuXBBFF1D0",authDomain:"dev-jeans-9f478.firebaseapp.com",projectId:"dev-jeans-9f478",storageBucket:"dev-jeans-9f478.appspot.com",messagingSenderId:"802537567325",appId:"1:802537567325:web:e2c1ec7fa8b1018e9149b4",measurementId:"G-K45XF80LMC"};Or(Ya);new Na({target:document.getElementById("app")});
