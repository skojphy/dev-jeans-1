(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))p(_);new MutationObserver(_=>{for(const b of _)if(b.type==="childList")for(const y of b.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&p(y)}).observe(document,{childList:!0,subtree:!0});function d(_){const b={};return _.integrity&&(b.integrity=_.integrity),_.referrerPolicy&&(b.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?b.credentials="include":_.crossOrigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function p(_){if(_.ep)return;_.ep=!0;const b=d(_);fetch(_.href,b)}})();function bt(){}function Tr(c,t){for(const d in t)c[d]=t[d];return c}function En(c){return c()}function Ri(){return Object.create(null)}function Ft(c){c.forEach(En)}function Ge(c){return typeof c=="function"}function Ot(c,t){return c!=c?t==t:c!==t||c&&typeof c=="object"||typeof c=="function"}let Fe;function fi(c,t){return Fe||(Fe=document.createElement("a")),Fe.href=t,c===Fe.href}function xr(c){return Object.keys(c).length===0}function Dn(c,...t){if(c==null)return bt;const d=c.subscribe(...t);return d.unsubscribe?()=>d.unsubscribe():d}function Et(c,t,d){c.$$.on_destroy.push(Dn(t,d))}function Ae(c,t,d,p){if(c){const _=Pn(c,t,d,p);return c[0](_)}}function Pn(c,t,d,p){return c[1]&&p?Tr(d.ctx.slice(),c[1](p(t))):d.ctx}function ke(c,t,d,p){if(c[2]&&p){const _=c[2](p(d));if(t.dirty===void 0)return _;if(typeof _=="object"){const b=[],y=Math.max(t.dirty.length,_.length);for(let h=0;h<y;h+=1)b[h]=t.dirty[h]|_[h];return b}return t.dirty|_}return t.dirty}function Ee(c,t,d,p,_,b){if(_){const y=Pn(t,d,p,b);c.p(y,_)}}function De(c){if(c.ctx.length>32){const t=[],d=c.ctx.length/32;for(let p=0;p<d;p++)t[p]=-1;return t}return-1}function Ne(c){return c??""}function Pe(c,t,d){return c.set(d),t}function Q(c,t){c.appendChild(t)}function ot(c,t,d){c.insertBefore(t,d||null)}function st(c){c.parentNode&&c.parentNode.removeChild(c)}function Xe(c,t){for(let d=0;d<c.length;d+=1)c[d]&&c[d].d(t)}function $(c){return document.createElement(c)}function Vt(c){return document.createTextNode(c)}function dt(){return Vt(" ")}function Gt(){return Vt("")}function ct(c,t,d,p){return c.addEventListener(t,d,p),()=>c.removeEventListener(t,d,p)}function Ut(c){return function(t){return t.preventDefault(),c.call(this,t)}}function re(c){return function(t){return t.stopPropagation(),c.call(this,t)}}function Or(c){return function(t){t.target===this&&c.call(this,t)}}function F(c,t,d){d==null?c.removeAttribute(t):c.getAttribute(t)!==d&&c.setAttribute(t,d)}function Ar(c){return Array.from(c.childNodes)}function _e(c,t){t=""+t,c.wholeText!==t&&(c.data=t)}function Wt(c,t,d,p){d===null?c.style.removeProperty(t):c.style.setProperty(t,d,p?"important":"")}function Lt(c,t,d){c.classList[d?"add":"remove"](t)}function kr(c,t,{bubbles:d=!1,cancelable:p=!1}={}){const _=document.createEvent("CustomEvent");return _.initCustomEvent(c,d,p,t),_}function St(c,t){return new c(t)}let Ie;function Te(c){Ie=c}function In(){if(!Ie)throw new Error("Function called outside component initialization");return Ie}function Mn(c){In().$$.on_mount.push(c)}function Er(){const c=In();return(t,d,{cancelable:p=!1}={})=>{const _=c.$$.callbacks[t];if(_){const b=kr(t,d,{cancelable:p});return _.slice().forEach(y=>{y.call(c,b)}),!b.defaultPrevented}return!0}}function Dr(c,t){const d=c.$$.callbacks[t.type];d&&d.slice().forEach(p=>p.call(this,t))}const ge=[],Ct=[];let pe=[];const di=[],Pr=Promise.resolve();let gi=!1;function Ir(){gi||(gi=!0,Pr.then(Fn))}function mi(c){pe.push(c)}function Nt(c){di.push(c)}const Ze=new Set;let fe=0;function Fn(){if(fe!==0)return;const c=Ie;do{try{for(;fe<ge.length;){const t=ge[fe];fe++,Te(t),Mr(t.$$)}}catch(t){throw ge.length=0,fe=0,t}for(Te(null),ge.length=0,fe=0;Ct.length;)Ct.pop()();for(let t=0;t<pe.length;t+=1){const d=pe[t];Ze.has(d)||(Ze.add(d),d())}pe.length=0}while(ge.length);for(;di.length;)di.pop()();gi=!1,Ze.clear(),Te(c)}function Mr(c){if(c.fragment!==null){c.update(),Ft(c.before_update);const t=c.dirty;c.dirty=[-1],c.fragment&&c.fragment.p(c.ctx,t),c.after_update.forEach(mi)}}function Fr(c){const t=[],d=[];pe.forEach(p=>c.indexOf(p)===-1?t.push(p):d.push(p)),d.forEach(p=>p()),pe=t}const We=new Set;let ie;function It(){ie={r:0,c:[],p:ie}}function Mt(){ie.r||Ft(ie.c),ie=ie.p}function at(c,t){c&&c.i&&(We.delete(c),c.i(t))}function ft(c,t,d,p){if(c&&c.o){if(We.has(c))return;We.add(c),ie.c.push(()=>{We.delete(c),p&&(d&&c.d(1),p())}),c.o(t)}else p&&p()}const xi=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Pt(c,t,d){const p=c.$$.props[t];p!==void 0&&(c.$$.bound[p]=d,d(c.$$.ctx[p]))}function yt(c){c&&c.c()}function pt(c,t,d,p){const{fragment:_,after_update:b}=c.$$;_&&_.m(t,d),p||mi(()=>{const y=c.$$.on_mount.map(En).filter(Ge);c.$$.on_destroy?c.$$.on_destroy.push(...y):Ft(y),c.$$.on_mount=[]}),b.forEach(mi)}function vt(c,t){const d=c.$$;d.fragment!==null&&(Fr(d.after_update),Ft(d.on_destroy),d.fragment&&d.fragment.d(t),d.on_destroy=d.fragment=null,d.ctx=[])}function Rr(c,t){c.$$.dirty[0]===-1&&(ge.push(c),Ir(),c.$$.dirty.fill(0)),c.$$.dirty[t/31|0]|=1<<t%31}function At(c,t,d,p,_,b,y,h=[-1]){const e=Ie;Te(c);const l=c.$$={fragment:null,ctx:[],props:b,update:bt,not_equal:_,bound:Ri(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(e?e.$$.context:[])),callbacks:Ri(),dirty:h,skip_bound:!1,root:t.target||e.$$.root};y&&y(l.root);let o=!1;if(l.ctx=d?d(c,t.props||{},(n,r,...i)=>{const a=i.length?i[0]:r;return l.ctx&&_(l.ctx[n],l.ctx[n]=a)&&(!l.skip_bound&&l.bound[n]&&l.bound[n](a),o&&Rr(c,n)),r}):[],l.update(),o=!0,Ft(l.before_update),l.fragment=p?p(l.ctx):!1,t.target){if(t.hydrate){const n=Ar(t.target);l.fragment&&l.fragment.l(n),n.forEach(st)}else l.fragment&&l.fragment.c();t.intro&&at(c.$$.fragment),pt(c,t.target,t.anchor,t.customElement),Fn()}Te(e)}class kt{$destroy(){vt(this,1),this.$destroy=bt}$on(t,d){if(!Ge(d))return bt;const p=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return p.push(d),()=>{const _=p.indexOf(d);_!==-1&&p.splice(_,1)}}$set(t){this.$$set&&!xr(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Lr="/assets/dev-jeans-a579548d.png";function Br(c){if(c.__esModule)return c;var t=c.default;if(typeof t=="function"){var d=function p(){if(this instanceof p){var _=[null];_.push.apply(_,arguments);var b=Function.bind.apply(t,_);return new b}return t.apply(this,arguments)};d.prototype=t.prototype}else d={};return Object.defineProperty(d,"__esModule",{value:!0}),Object.keys(c).forEach(function(p){var _=Object.getOwnPropertyDescriptor(c,p);Object.defineProperty(d,p,_.get?_:{enumerable:!0,get:function(){return c[p]}})}),d}var se={};const jr={},Wr=Object.freeze(Object.defineProperty({__proto__:null,default:jr},Symbol.toStringTag,{value:"Module"})),$e=Br(Wr);(function(c){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var t=t||{version:"5.3.0"};if(c.fabric=t,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?t.document=document:t.document=document.implementation.createHTMLDocument(""),t.window=window;else{var d=$e,p=new d.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;t.document=p.document,t.jsdomImplForWrapper=$e.implForWrapper,t.nodeCanvas=$e.Canvas,t.window=p,DOMParser=t.window.DOMParser}t.isTouchSupported="ontouchstart"in t.window||"ontouchstart"in t.document||t.window&&t.window.navigator&&t.window.navigator.maxTouchPoints>0,t.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",t.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],t.DPI=96,t.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",t.commaWsp="(?:\\s+,?\\s*|,\\s*)",t.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,t.reNonWord=/[ \n\.,;!\?\-]/,t.fontPaths={},t.iMatrix=[1,0,0,1,0,0],t.svgNS="http://www.w3.org/2000/svg",t.perfLimitSizeTotal=2097152,t.maxCacheSideLimit=4096,t.minCacheSideLimit=256,t.charWidthsCache={},t.textureSize=2048,t.disableStyleCopyPaste=!1,t.enableGLFiltering=!0,t.devicePixelRatio=t.window.devicePixelRatio||t.window.webkitDevicePixelRatio||t.window.mozDevicePixelRatio||1,t.browserShadowBlurConstant=1,t.arcToSegmentsCache={},t.boundsOfCurveCache={},t.cachesBoundsOfCurve=!0,t.forceGLPutImageData=!1,t.initFilterBackend=function(){if(t.enableGLFiltering&&t.isWebglSupported&&t.isWebglSupported(t.textureSize))return console.log("max texture size: "+t.maxTextureSize),new t.WebglFilterBackend({tileSize:t.textureSize});if(t.Canvas2dFilterBackend)return new t.Canvas2dFilterBackend},typeof document<"u"&&typeof window<"u"&&(window.fabric=t),function(){function h(i,a){if(this.__eventListeners[i]){var u=this.__eventListeners[i];a?u[u.indexOf(a)]=!1:t.util.array.fill(u,!1)}}function e(i,a){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var u in i)this.on(u,i[u]);else this.__eventListeners[i]||(this.__eventListeners[i]=[]),this.__eventListeners[i].push(a);return this}function l(i,a){var u=function(){a.apply(this,arguments),this.off(i,u)}.bind(this);this.on(i,u)}function o(i,a){if(arguments.length===1)for(var u in i)l.call(this,u,i[u]);else l.call(this,i,a);return this}function n(i,a){if(!this.__eventListeners)return this;if(arguments.length===0)for(i in this.__eventListeners)h.call(this,i);else if(arguments.length===1&&typeof arguments[0]=="object")for(var u in i)h.call(this,u,i[u]);else h.call(this,i,a);return this}function r(i,a){if(!this.__eventListeners)return this;var u=this.__eventListeners[i];if(!u)return this;for(var s=0,f=u.length;s<f;s++)u[s]&&u[s].call(this,a||{});return this.__eventListeners[i]=u.filter(function(g){return g!==!1}),this}t.Observable={fire:r,on:e,once:o,off:n}}(),t.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var h=0,e=arguments.length;h<e;h++)this._onObjectAdded(arguments[h]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(h,e,l){var o=this._objects;return l?o[e]=h:o.splice(e,0,h),this._onObjectAdded&&this._onObjectAdded(h),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var h=this._objects,e,l=!1,o=0,n=arguments.length;o<n;o++)e=h.indexOf(arguments[o]),e!==-1&&(l=!0,h.splice(e,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[o]));return this.renderOnAddRemove&&l&&this.requestRenderAll(),this},forEachObject:function(h,e){for(var l=this.getObjects(),o=0,n=l.length;o<n;o++)h.call(e,l[o],o,l);return this},getObjects:function(h){return typeof h>"u"?this._objects.concat():this._objects.filter(function(e){return e.type===h})},item:function(h){return this._objects[h]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(h,e){return this._objects.indexOf(h)>-1?!0:e?this._objects.some(function(l){return typeof l.contains=="function"&&l.contains(h,!0)}):!1},complexity:function(){return this._objects.reduce(function(h,e){return h+=e.complexity?e.complexity():0,h},0)}},t.CommonMethods={_setOptions:function(h){for(var e in h)this.set(e,h[e])},_initGradient:function(h,e){h&&h.colorStops&&!(h instanceof t.Gradient)&&this.set(e,new t.Gradient(h))},_initPattern:function(h,e,l){h&&h.source&&!(h instanceof t.Pattern)?this.set(e,new t.Pattern(h,l)):l&&l()},_setObject:function(h){for(var e in h)this._set(e,h[e])},set:function(h,e){return typeof h=="object"?this._setObject(h):this._set(h,e),this},_set:function(h,e){this[h]=e},toggle:function(h){var e=this.get(h);return typeof e=="boolean"&&this.set(h,!e),this},get:function(h){return this[h]}},function(h){var e=Math.sqrt,l=Math.atan2,o=Math.pow,n=Math.PI/180,r=Math.PI/2;t.util={cos:function(i){if(i===0)return 1;i<0&&(i=-i);var a=i/r;switch(a){case 1:case 3:return 0;case 2:return-1}return Math.cos(i)},sin:function(i){if(i===0)return 0;var a=i/r,u=1;switch(i<0&&(u=-1),a){case 1:return u;case 2:return 0;case 3:return-u}return Math.sin(i)},removeFromArray:function(i,a){var u=i.indexOf(a);return u!==-1&&i.splice(u,1),i},getRandomInt:function(i,a){return Math.floor(Math.random()*(a-i+1))+i},degreesToRadians:function(i){return i*n},radiansToDegrees:function(i){return i/n},rotatePoint:function(i,a,u){var s=new t.Point(i.x-a.x,i.y-a.y),f=t.util.rotateVector(s,u);return new t.Point(f.x,f.y).addEquals(a)},rotateVector:function(i,a){var u=t.util.sin(a),s=t.util.cos(a),f=i.x*s-i.y*u,g=i.x*u+i.y*s;return{x:f,y:g}},createVector:function(i,a){return new t.Point(a.x-i.x,a.y-i.y)},calcAngleBetweenVectors:function(i,a){return Math.acos((i.x*a.x+i.y*a.y)/(Math.hypot(i.x,i.y)*Math.hypot(a.x,a.y)))},getHatVector:function(i){return new t.Point(i.x,i.y).multiply(1/Math.hypot(i.x,i.y))},getBisector:function(i,a,u){var s=t.util.createVector(i,a),f=t.util.createVector(i,u),g=t.util.calcAngleBetweenVectors(s,f),m=t.util.calcAngleBetweenVectors(t.util.rotateVector(s,g),f),v=g*(m===0?1:-1)/2;return{vector:t.util.getHatVector(t.util.rotateVector(s,v)),angle:g}},projectStrokeOnPoints:function(i,a,u){var s=[],f=a.strokeWidth/2,g=a.strokeUniform?new t.Point(1/a.scaleX,1/a.scaleY):new t.Point(1,1),m=function(v){var C=f/Math.hypot(v.x,v.y);return new t.Point(v.x*C*g.x,v.y*C*g.y)};return i.length<=1||i.forEach(function(v,C){var w=new t.Point(v.x,v.y),S,A;C===0?(A=i[C+1],S=u?m(t.util.createVector(A,w)).addEquals(w):i[i.length-1]):C===i.length-1?(S=i[C-1],A=u?m(t.util.createVector(S,w)).addEquals(w):i[0]):(S=i[C-1],A=i[C+1]);var P=t.util.getBisector(w,S,A),X=P.vector,K=P.angle,tt,H;if(a.strokeLineJoin==="miter"&&(tt=-f/Math.sin(K/2),H=new t.Point(X.x*tt*g.x,X.y*tt*g.y),Math.hypot(H.x,H.y)/f<=a.strokeMiterLimit)){s.push(w.add(H)),s.push(w.subtract(H));return}tt=-f*Math.SQRT2,H=new t.Point(X.x*tt*g.x,X.y*tt*g.y),s.push(w.add(H)),s.push(w.subtract(H))}),s},transformPoint:function(i,a,u){return u?new t.Point(a[0]*i.x+a[2]*i.y,a[1]*i.x+a[3]*i.y):new t.Point(a[0]*i.x+a[2]*i.y+a[4],a[1]*i.x+a[3]*i.y+a[5])},makeBoundingBoxFromPoints:function(i,a){if(a)for(var u=0;u<i.length;u++)i[u]=t.util.transformPoint(i[u],a);var s=[i[0].x,i[1].x,i[2].x,i[3].x],f=t.util.array.min(s),g=t.util.array.max(s),m=g-f,v=[i[0].y,i[1].y,i[2].y,i[3].y],C=t.util.array.min(v),w=t.util.array.max(v),S=w-C;return{left:f,top:C,width:m,height:S}},invertTransform:function(i){var a=1/(i[0]*i[3]-i[1]*i[2]),u=[a*i[3],-a*i[1],-a*i[2],a*i[0]],s=t.util.transformPoint({x:i[4],y:i[5]},u,!0);return u[4]=-s.x,u[5]=-s.y,u},toFixed:function(i,a){return parseFloat(Number(i).toFixed(a))},parseUnit:function(i,a){var u=/\D{0,2}$/.exec(i),s=parseFloat(i);switch(a||(a=t.Text.DEFAULT_SVG_FONT_SIZE),u[0]){case"mm":return s*t.DPI/25.4;case"cm":return s*t.DPI/2.54;case"in":return s*t.DPI;case"pt":return s*t.DPI/72;case"pc":return s*t.DPI/72*12;case"em":return s*a;default:return s}},falseFunction:function(){return!1},getKlass:function(i,a){return i=t.util.string.camelize(i.charAt(0).toUpperCase()+i.slice(1)),t.util.resolveNamespace(a)[i]},getSvgAttributes:function(i){var a=["instantiated_by_use","style","id","class"];switch(i){case"linearGradient":a=a.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":a=a.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":a=a.concat(["offset","stop-color","stop-opacity"]);break}return a},resolveNamespace:function(i){if(!i)return t;var a=i.split("."),u=a.length,s,f=h||t.window;for(s=0;s<u;++s)f=f[a[s]];return f},loadImage:function(i,a,u,s){if(!i){a&&a.call(u,i);return}var f=t.util.createImage(),g=function(){a&&a.call(u,f,!1),f=f.onload=f.onerror=null};f.onload=g,f.onerror=function(){t.log("Error loading "+f.src),a&&a.call(u,null,!0),f=f.onload=f.onerror=null},i.indexOf("data")!==0&&s!==void 0&&s!==null&&(f.crossOrigin=s),i.substring(0,14)==="data:image/svg"&&(f.onload=null,t.util.loadImageInDom(f,g)),f.src=i},loadImageInDom:function(i,a){var u=t.document.createElement("div");u.style.width=u.style.height="1px",u.style.left=u.style.top="-100%",u.style.position="absolute",u.appendChild(i),t.document.querySelector("body").appendChild(u),i.onload=function(){a(),u.parentNode.removeChild(u),u=null}},enlivenObjects:function(i,a,u,s){i=i||[];var f=[],g=0,m=i.length;function v(){++g===m&&a&&a(f.filter(function(C){return C}))}if(!m){a&&a(f);return}i.forEach(function(C,w){if(!C||!C.type){v();return}var S=t.util.getKlass(C.type,u);S.fromObject(C,function(A,P){P||(f[w]=A),s&&s(C,A,P),v()})})},enlivenObjectEnlivables:function(i,a,u){var s=t.Object.ENLIVEN_PROPS.filter(function(f){return!!i[f]});t.util.enlivenObjects(s.map(function(f){return i[f]}),function(f){var g={};s.forEach(function(m,v){g[m]=f[v],a&&(a[m]=f[v])}),u&&u(g)})},enlivenPatterns:function(i,a){i=i||[];function u(){++f===g&&a&&a(s)}var s=[],f=0,g=i.length;if(!g){a&&a(s);return}i.forEach(function(m,v){m&&m.source?new t.Pattern(m,function(C){s[v]=C,u()}):(s[v]=m,u())})},groupSVGElements:function(i,a,u){var s;return i&&i.length===1?(typeof u<"u"&&(i[0].sourcePath=u),i[0]):(a&&(a.width&&a.height?a.centerPoint={x:a.width/2,y:a.height/2}:(delete a.width,delete a.height)),s=new t.Group(i,a),typeof u<"u"&&(s.sourcePath=u),s)},populateWithProperties:function(i,a,u){if(u&&Array.isArray(u))for(var s=0,f=u.length;s<f;s++)u[s]in i&&(a[u[s]]=i[u[s]])},createCanvasElement:function(){return t.document.createElement("canvas")},copyCanvasElement:function(i){var a=t.util.createCanvasElement();return a.width=i.width,a.height=i.height,a.getContext("2d").drawImage(i,0,0),a},toDataURL:function(i,a,u){return i.toDataURL("image/"+a,u)},createImage:function(){return t.document.createElement("img")},multiplyTransformMatrices:function(i,a,u){return[i[0]*a[0]+i[2]*a[1],i[1]*a[0]+i[3]*a[1],i[0]*a[2]+i[2]*a[3],i[1]*a[2]+i[3]*a[3],u?0:i[0]*a[4]+i[2]*a[5]+i[4],u?0:i[1]*a[4]+i[3]*a[5]+i[5]]},qrDecompose:function(i){var a=l(i[1],i[0]),u=o(i[0],2)+o(i[1],2),s=e(u),f=(i[0]*i[3]-i[2]*i[1])/s,g=l(i[0]*i[2]+i[1]*i[3],u);return{angle:a/n,scaleX:s,scaleY:f,skewX:g/n,skewY:0,translateX:i[4],translateY:i[5]}},calcRotateMatrix:function(i){if(!i.angle)return t.iMatrix.concat();var a=t.util.degreesToRadians(i.angle),u=t.util.cos(a),s=t.util.sin(a);return[u,s,-s,u,0,0]},calcDimensionsMatrix:function(i){var a=typeof i.scaleX>"u"?1:i.scaleX,u=typeof i.scaleY>"u"?1:i.scaleY,s=[i.flipX?-a:a,0,0,i.flipY?-u:u,0,0],f=t.util.multiplyTransformMatrices,g=t.util.degreesToRadians;return i.skewX&&(s=f(s,[1,0,Math.tan(g(i.skewX)),1],!0)),i.skewY&&(s=f(s,[1,Math.tan(g(i.skewY)),0,1],!0)),s},composeMatrix:function(i){var a=[1,0,0,1,i.translateX||0,i.translateY||0],u=t.util.multiplyTransformMatrices;return i.angle&&(a=u(a,t.util.calcRotateMatrix(i))),(i.scaleX!==1||i.scaleY!==1||i.skewX||i.skewY||i.flipX||i.flipY)&&(a=u(a,t.util.calcDimensionsMatrix(i))),a},resetObjectTransform:function(i){i.scaleX=1,i.scaleY=1,i.skewX=0,i.skewY=0,i.flipX=!1,i.flipY=!1,i.rotate(0)},saveObjectTransform:function(i){return{scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,angle:i.angle,left:i.left,flipX:i.flipX,flipY:i.flipY,top:i.top}},isTransparent:function(i,a,u,s){s>0&&(a>s?a-=s:a=0,u>s?u-=s:u=0);var f=!0,g,m,v=i.getImageData(a,u,s*2||1,s*2||1),C=v.data.length;for(g=3;g<C&&(m=v.data[g],f=m<=0,f!==!1);g+=4);return v=null,f},parsePreserveAspectRatioAttribute:function(i){var a="meet",u="Mid",s="Mid",f=i.split(" "),g;return f&&f.length&&(a=f.pop(),a!=="meet"&&a!=="slice"?(g=a,a="meet"):f.length&&(g=f.pop())),u=g!=="none"?g.slice(1,4):"none",s=g!=="none"?g.slice(5,8):"none",{meetOrSlice:a,alignX:u,alignY:s}},clearFabricFontCache:function(i){i=(i||"").toLowerCase(),i?t.charWidthsCache[i]&&delete t.charWidthsCache[i]:t.charWidthsCache={}},limitDimsByArea:function(i,a){var u=Math.sqrt(a*i),s=Math.floor(a/u);return{x:Math.floor(u),y:s}},capValue:function(i,a,u){return Math.max(i,Math.min(a,u))},findScaleToFit:function(i,a){return Math.min(a.width/i.width,a.height/i.height)},findScaleToCover:function(i,a){return Math.max(a.width/i.width,a.height/i.height)},matrixToSVG:function(i){return"matrix("+i.map(function(a){return t.util.toFixed(a,t.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(i,a){var u=t.util.invertTransform(a),s=t.util.multiplyTransformMatrices(u,i.calcOwnMatrix());t.util.applyTransformToObject(i,s)},addTransformToObject:function(i,a){t.util.applyTransformToObject(i,t.util.multiplyTransformMatrices(a,i.calcOwnMatrix()))},applyTransformToObject:function(i,a){var u=t.util.qrDecompose(a),s=new t.Point(u.translateX,u.translateY);i.flipX=!1,i.flipY=!1,i.set("scaleX",u.scaleX),i.set("scaleY",u.scaleY),i.skewX=u.skewX,i.skewY=u.skewY,i.angle=u.angle,i.setPositionByOrigin(s,"center","center")},sizeAfterTransform:function(i,a,u){var s=i/2,f=a/2,g=[{x:-s,y:-f},{x:s,y:-f},{x:-s,y:f},{x:s,y:f}],m=t.util.calcDimensionsMatrix(u),v=t.util.makeBoundingBoxFromPoints(g,m);return{x:v.width,y:v.height}},mergeClipPaths:function(i,a){var u=i,s=a;u.inverted&&!s.inverted&&(u=a,s=i),t.util.applyTransformToObject(s,t.util.multiplyTransformMatrices(t.util.invertTransform(u.calcTransformMatrix()),s.calcTransformMatrix()));var f=u.inverted&&s.inverted;return f&&(u.inverted=s.inverted=!1),new t.Group([u],{clipPath:s,inverted:f})},hasStyleChanged:function(i,a,u){return u=u||!1,i.fill!==a.fill||i.stroke!==a.stroke||i.strokeWidth!==a.strokeWidth||i.fontSize!==a.fontSize||i.fontFamily!==a.fontFamily||i.fontWeight!==a.fontWeight||i.fontStyle!==a.fontStyle||i.textBackgroundColor!==a.textBackgroundColor||i.deltaY!==a.deltaY||u&&(i.overline!==a.overline||i.underline!==a.underline||i.linethrough!==a.linethrough)},stylesToArray:function(u,a){for(var u=t.util.object.clone(u,!0),s=a.split(`
`),f=-1,g={},m=[],v=0;v<s.length;v++){if(!u[v]){f+=s[v].length;continue}for(var C=0;C<s[v].length;C++){f++;var w=u[v][C];if(w&&Object.keys(w).length>0){var S=t.util.hasStyleChanged(g,w,!0);S?m.push({start:f,end:f+1,style:w}):m[m.length-1].end++}g=w||{}}}return m},stylesFromArray:function(i,a){if(!Array.isArray(i))return i;for(var u=a.split(`
`),s=-1,f=0,g={},m=0;m<u.length;m++)for(var v=0;v<u[m].length;v++)s++,i[f]&&i[f].start<=s&&s<i[f].end&&(g[m]=g[m]||{},g[m][v]=Object.assign({},i[f].style),s===i[f].end-1&&f++);return g}}}(c),function(){var h=Array.prototype.join,e={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},l={m:"l",M:"L"};function o(T,E,D,k,B,O,x,I,L,Y,j){var G=t.util.cos(T),M=t.util.sin(T),et=t.util.cos(E),W=t.util.sin(E),R=D*B*et-k*O*W+x,U=k*B*et+D*O*W+I,V=Y+L*(-D*B*M-k*O*G),N=j+L*(-k*B*M+D*O*G),q=R+L*(D*B*W+k*O*et),it=U+L*(k*B*W-D*O*et);return["C",V,N,q,it,R,U]}function n(T,E,D,k,B,O,x){var I=Math.PI,L=x*I/180,Y=t.util.sin(L),j=t.util.cos(L),G=0,M=0;D=Math.abs(D),k=Math.abs(k);var et=-j*T*.5-Y*E*.5,W=-j*E*.5+Y*T*.5,R=D*D,U=k*k,V=W*W,N=et*et,q=R*U-R*V-U*N,it=0;if(q<0){var gt=Math.sqrt(1-q/(R*U));D*=gt,k*=gt}else it=(B===O?-1:1)*Math.sqrt(q/(R*V+U*N));var ht=it*D*W/k,z=-it*k*et/D,ut=j*ht-Y*z+T*.5,mt=Y*ht+j*z+E*.5,_t=r(1,0,(et-ht)/D,(W-z)/k),xt=r((et-ht)/D,(W-z)/k,(-et-ht)/D,(-W-z)/k);O===0&&xt>0?xt-=2*I:O===1&&xt<0&&(xt+=2*I);for(var wt=Math.ceil(Math.abs(xt/I*2)),Bt=[],Dt=xt/wt,te=8/3*Math.sin(Dt/4)*Math.sin(Dt/4)/Math.sin(Dt/2),Ce=_t+Dt,zt=0;zt<wt;zt++)Bt[zt]=o(_t,Ce,j,Y,D,k,ut,mt,te,G,M),G=Bt[zt][5],M=Bt[zt][6],_t=Ce,Ce+=Dt;return Bt}function r(T,E,D,k){var B=Math.atan2(E,T),O=Math.atan2(k,D);return O>=B?O-B:2*Math.PI-(B-O)}function i(T,E,D,k,B,O,x,I){var L;if(t.cachesBoundsOfCurve&&(L=h.call(arguments),t.boundsOfCurveCache[L]))return t.boundsOfCurveCache[L];var Y=Math.sqrt,j=Math.min,G=Math.max,M=Math.abs,et=[],W=[[],[]],R,U,V,N,q,it,gt,ht;U=6*T-12*D+6*B,R=-3*T+9*D-9*B+3*x,V=3*D-3*T;for(var z=0;z<2;++z){if(z>0&&(U=6*E-12*k+6*O,R=-3*E+9*k-9*O+3*I,V=3*k-3*E),M(R)<1e-12){if(M(U)<1e-12)continue;N=-V/U,0<N&&N<1&&et.push(N);continue}gt=U*U-4*V*R,!(gt<0)&&(ht=Y(gt),q=(-U+ht)/(2*R),0<q&&q<1&&et.push(q),it=(-U-ht)/(2*R),0<it&&it<1&&et.push(it))}for(var ut,mt,_t=et.length,xt=_t,wt;_t--;)N=et[_t],wt=1-N,ut=wt*wt*wt*T+3*wt*wt*N*D+3*wt*N*N*B+N*N*N*x,W[0][_t]=ut,mt=wt*wt*wt*E+3*wt*wt*N*k+3*wt*N*N*O+N*N*N*I,W[1][_t]=mt;W[0][xt]=T,W[1][xt]=E,W[0][xt+1]=x,W[1][xt+1]=I;var Bt=[{x:j.apply(null,W[0]),y:j.apply(null,W[1])},{x:G.apply(null,W[0]),y:G.apply(null,W[1])}];return t.cachesBoundsOfCurve&&(t.boundsOfCurveCache[L]=Bt),Bt}function a(T,E,D){for(var k=D[1],B=D[2],O=D[3],x=D[4],I=D[5],L=D[6],Y=D[7],j=n(L-T,Y-E,k,B,x,I,O),G=0,M=j.length;G<M;G++)j[G][1]+=T,j[G][2]+=E,j[G][3]+=T,j[G][4]+=E,j[G][5]+=T,j[G][6]+=E;return j}function u(T){var E=0,D=0,k=T.length,B=0,O=0,x,I,L,Y=[],j,G,M;for(I=0;I<k;++I){switch(L=!1,x=T[I].slice(0),x[0]){case"l":x[0]="L",x[1]+=E,x[2]+=D;case"L":E=x[1],D=x[2];break;case"h":x[1]+=E;case"H":x[0]="L",x[2]=D,E=x[1];break;case"v":x[1]+=D;case"V":x[0]="L",D=x[1],x[1]=E,x[2]=D;break;case"m":x[0]="M",x[1]+=E,x[2]+=D;case"M":E=x[1],D=x[2],B=x[1],O=x[2];break;case"c":x[0]="C",x[1]+=E,x[2]+=D,x[3]+=E,x[4]+=D,x[5]+=E,x[6]+=D;case"C":G=x[3],M=x[4],E=x[5],D=x[6];break;case"s":x[0]="S",x[1]+=E,x[2]+=D,x[3]+=E,x[4]+=D;case"S":j==="C"?(G=2*E-G,M=2*D-M):(G=E,M=D),E=x[3],D=x[4],x[0]="C",x[5]=x[3],x[6]=x[4],x[3]=x[1],x[4]=x[2],x[1]=G,x[2]=M,G=x[3],M=x[4];break;case"q":x[0]="Q",x[1]+=E,x[2]+=D,x[3]+=E,x[4]+=D;case"Q":G=x[1],M=x[2],E=x[3],D=x[4];break;case"t":x[0]="T",x[1]+=E,x[2]+=D;case"T":j==="Q"?(G=2*E-G,M=2*D-M):(G=E,M=D),x[0]="Q",E=x[1],D=x[2],x[1]=G,x[2]=M,x[3]=E,x[4]=D;break;case"a":x[0]="A",x[6]+=E,x[7]+=D;case"A":L=!0,Y=Y.concat(a(E,D,x)),E=x[6],D=x[7];break;case"z":case"Z":E=B,D=O;break}L||Y.push(x),j=x[0]}return Y}function s(T,E,D,k){return Math.sqrt((D-T)*(D-T)+(k-E)*(k-E))}function f(T){return T*T*T}function g(T){return 3*T*T*(1-T)}function m(T){return 3*T*(1-T)*(1-T)}function v(T){return(1-T)*(1-T)*(1-T)}function C(T,E,D,k,B,O,x,I){return function(L){var Y=f(L),j=g(L),G=m(L),M=v(L);return{x:x*Y+B*j+D*G+T*M,y:I*Y+O*j+k*G+E*M}}}function w(T,E,D,k,B,O,x,I){return function(L){var Y=1-L,j=3*Y*Y*(D-T)+6*Y*L*(B-D)+3*L*L*(x-B),G=3*Y*Y*(k-E)+6*Y*L*(O-k)+3*L*L*(I-O);return Math.atan2(G,j)}}function S(T){return T*T}function A(T){return 2*T*(1-T)}function P(T){return(1-T)*(1-T)}function X(T,E,D,k,B,O){return function(x){var I=S(x),L=A(x),Y=P(x);return{x:B*I+D*L+T*Y,y:O*I+k*L+E*Y}}}function K(T,E,D,k,B,O){return function(x){var I=1-x,L=2*I*(D-T)+2*x*(B-D),Y=2*I*(k-E)+2*x*(O-k);return Math.atan2(Y,L)}}function tt(T,E,D){var k={x:E,y:D},B,O=0,x;for(x=1;x<=100;x+=1)B=T(x/100),O+=s(k.x,k.y,B.x,B.y),k=B;return O}function H(T,E){for(var D=0,k=0,B=T.iterator,O={x:T.x,y:T.y},x,I,L=.01,Y=T.angleFinder,j;k<E&&L>1e-4;)x=B(D),j=D,I=s(O.x,O.y,x.x,x.y),I+k>E?(D-=L,L/=2):(O=x,D+=L,k+=I);return x.angle=Y(j),x}function J(T){for(var E=0,D=T.length,k,B=0,O=0,x=0,I=0,L=[],Y,j,G,M=0;M<D;M++){switch(k=T[M],j={x:B,y:O,command:k[0]},k[0]){case"M":j.length=0,x=B=k[1],I=O=k[2];break;case"L":j.length=s(B,O,k[1],k[2]),B=k[1],O=k[2];break;case"C":Y=C(B,O,k[1],k[2],k[3],k[4],k[5],k[6]),G=w(B,O,k[1],k[2],k[3],k[4],k[5],k[6]),j.iterator=Y,j.angleFinder=G,j.length=tt(Y,B,O),B=k[5],O=k[6];break;case"Q":Y=X(B,O,k[1],k[2],k[3],k[4]),G=K(B,O,k[1],k[2],k[3],k[4]),j.iterator=Y,j.angleFinder=G,j.length=tt(Y,B,O),B=k[3],O=k[4];break;case"Z":case"z":j.destX=x,j.destY=I,j.length=s(B,O,x,I),B=x,O=I;break}E+=j.length,L.push(j)}return L.push({length:E,x:B,y:O}),L}function Z(T,E,D){D||(D=J(T));for(var k=0;E-D[k].length>0&&k<D.length-2;)E-=D[k].length,k++;var B=D[k],O=E/B.length,x=B.command,I=T[k],L;switch(x){case"M":return{x:B.x,y:B.y,angle:0};case"Z":case"z":return L=new t.Point(B.x,B.y).lerp(new t.Point(B.destX,B.destY),O),L.angle=Math.atan2(B.destY-B.y,B.destX-B.x),L;case"L":return L=new t.Point(B.x,B.y).lerp(new t.Point(I[1],I[2]),O),L.angle=Math.atan2(I[2]-B.y,I[1]-B.x),L;case"C":return H(B,E);case"Q":return H(B,E)}}function nt(T){var E=[],D=[],k,B,O=t.rePathCommand,x="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",I="("+x+")"+t.commaWsp,L="([01])"+t.commaWsp+"?",Y=I+"?"+I+"?"+I+L+L+I+"?("+x+")",j=new RegExp(Y,"g"),G,M,et;if(!T||!T.match)return E;et=T.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var W=0,R,U=et.length;W<U;W++){k=et[W],M=k.slice(1).trim(),D.length=0;var V=k.charAt(0);if(R=[V],V.toLowerCase()==="a")for(var N;N=j.exec(M);)for(var q=1;q<N.length;q++)D.push(N[q]);else for(;G=O.exec(M);)D.push(G[0]);for(var q=0,it=D.length;q<it;q++)B=parseFloat(D[q]),isNaN(B)||R.push(B);var gt=e[V.toLowerCase()],ht=l[V]||V;if(R.length-1>gt)for(var z=1,ut=R.length;z<ut;z+=gt)E.push([V].concat(R.slice(z,z+gt))),V=ht;else E.push(R)}return E}function lt(T,E){var D=[],k,B=new t.Point(T[0].x,T[0].y),O=new t.Point(T[1].x,T[1].y),x=T.length,I=1,L=0,Y=x>2;for(E=E||0,Y&&(I=T[2].x<O.x?-1:T[2].x===O.x?0:1,L=T[2].y<O.y?-1:T[2].y===O.y?0:1),D.push(["M",B.x-I*E,B.y-L*E]),k=1;k<x;k++){if(!B.eq(O)){var j=B.midPointFrom(O);D.push(["Q",B.x,B.y,j.x,j.y])}B=T[k],k+1<T.length&&(O=T[k+1])}return Y&&(I=B.x>T[k-2].x?1:B.x===T[k-2].x?0:-1,L=B.y>T[k-2].y?1:B.y===T[k-2].y?0:-1),D.push(["L",B.x+I*E,B.y+L*E]),D}function rt(T,E,D){return D&&(E=t.util.multiplyTransformMatrices(E,[1,0,0,1,-D.x,-D.y])),T.map(function(k){for(var B=k.slice(0),O={},x=1;x<k.length-1;x+=2)O.x=k[x],O.y=k[x+1],O=t.util.transformPoint(O,E),B[x]=O.x,B[x+1]=O.y;return B})}t.util.joinPath=function(T){return T.map(function(E){return E.join(" ")}).join(" ")},t.util.parsePath=nt,t.util.makePathSimpler=u,t.util.getSmoothPathFromPoints=lt,t.util.getPathSegmentsInfo=J,t.util.getBoundsOfCurve=i,t.util.getPointOnPath=Z,t.util.transformPath=rt}(),function(){var h=Array.prototype.slice;function e(i,a){for(var u=h.call(arguments,2),s=[],f=0,g=i.length;f<g;f++)s[f]=u.length?i[f][a].apply(i[f],u):i[f][a].call(i[f]);return s}function l(i,a){return r(i,a,function(u,s){return u>=s})}function o(i,a){return r(i,a,function(u,s){return u<s})}function n(i,a){for(var u=i.length;u--;)i[u]=a;return i}function r(i,a,u){if(!(!i||i.length===0)){var s=i.length-1,f=a?i[s][a]:i[s];if(a)for(;s--;)u(i[s][a],f)&&(f=i[s][a]);else for(;s--;)u(i[s],f)&&(f=i[s]);return f}}t.util.array={fill:n,invoke:e,min:o,max:l}}(),function(){function h(l,o,n){if(n)if(!t.isLikelyNode&&o instanceof Element)l=o;else if(o instanceof Array){l=[];for(var r=0,i=o.length;r<i;r++)l[r]=h({},o[r],n)}else if(o&&typeof o=="object")for(var a in o)a==="canvas"||a==="group"?l[a]=null:o.hasOwnProperty(a)&&(l[a]=h({},o[a],n));else l=o;else for(var a in o)l[a]=o[a];return l}function e(l,o){return h({},l,o)}t.util.object={extend:h,clone:e},t.util.object.extend(t.util,t.Observable)}(),function(){function h(r){return r.replace(/-+(.)?/g,function(i,a){return a?a.toUpperCase():""})}function e(r,i){return r.charAt(0).toUpperCase()+(i?r.slice(1):r.slice(1).toLowerCase())}function l(r){return r.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function o(r){var i=0,a,u=[];for(i=0,a;i<r.length;i++)(a=n(r,i))!==!1&&u.push(a);return u}function n(r,i){var a=r.charCodeAt(i);if(isNaN(a))return"";if(a<55296||a>57343)return r.charAt(i);if(55296<=a&&a<=56319){if(r.length<=i+1)throw"High surrogate without following low surrogate";var u=r.charCodeAt(i+1);if(56320>u||u>57343)throw"High surrogate without following low surrogate";return r.charAt(i)+r.charAt(i+1)}if(i===0)throw"Low surrogate without preceding high surrogate";var s=r.charCodeAt(i-1);if(55296>s||s>56319)throw"Low surrogate without preceding high surrogate";return!1}t.util.string={camelize:h,capitalize:e,escapeXml:l,graphemeSplit:o}}(),function(){var h=Array.prototype.slice,e=function(){},l=function(){for(var a in{toString:1})if(a==="toString")return!1;return!0}(),o=function(a,u,s){for(var f in u)f in a.prototype&&typeof a.prototype[f]=="function"&&(u[f]+"").indexOf("callSuper")>-1?a.prototype[f]=function(g){return function(){var m=this.constructor.superclass;this.constructor.superclass=s;var v=u[g].apply(this,arguments);if(this.constructor.superclass=m,g!=="initialize")return v}}(f):a.prototype[f]=u[f],l&&(u.toString!==Object.prototype.toString&&(a.prototype.toString=u.toString),u.valueOf!==Object.prototype.valueOf&&(a.prototype.valueOf=u.valueOf))};function n(){}function r(a){for(var u=null,s=this;s.constructor.superclass;){var f=s.constructor.superclass.prototype[a];if(s[a]!==f){u=f;break}s=s.constructor.superclass.prototype}return u?arguments.length>1?u.apply(this,h.call(arguments,1)):u.call(this):console.log("tried to callSuper "+a+", method not found in prototype chain",this)}function i(){var a=null,u=h.call(arguments,0);typeof u[0]=="function"&&(a=u.shift());function s(){this.initialize.apply(this,arguments)}s.superclass=a,s.subclasses=[],a&&(n.prototype=a.prototype,s.prototype=new n,a.subclasses.push(s));for(var f=0,g=u.length;f<g;f++)o(s,u[f],a);return s.prototype.initialize||(s.prototype.initialize=e),s.prototype.constructor=s,s.prototype.callSuper=r,s}t.util.createClass=i}(),function(){var h=!!t.document.createElement("div").attachEvent,e=["touchstart","touchmove","touchend"];t.util.addListener=function(o,n,r,i){o&&o.addEventListener(n,r,h?!1:i)},t.util.removeListener=function(o,n,r,i){o&&o.removeEventListener(n,r,h?!1:i)};function l(o){var n=o.changedTouches;return n&&n[0]?n[0]:o}t.util.getPointer=function(o){var n=o.target,r=t.util.getScrollLeftTop(n),i=l(o);return{x:i.clientX+r.left,y:i.clientY+r.top}},t.util.isTouchEvent=function(o){return e.indexOf(o.type)>-1||o.pointerType==="touch"}}(),function(){function h(i,a){var u=i.style;if(!u)return i;if(typeof a=="string")return i.style.cssText+=";"+a,a.indexOf("opacity")>-1?r(i,a.match(/opacity:\s*(\d?\.?\d*)/)[1]):i;for(var s in a)if(s==="opacity")r(i,a[s]);else{var f=s==="float"||s==="cssFloat"?typeof u.styleFloat>"u"?"cssFloat":"styleFloat":s;u.setProperty(f,a[s])}return i}var e=t.document.createElement("div"),l=typeof e.style.opacity=="string",o=typeof e.style.filter=="string",n=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,r=function(i){return i};l?r=function(i,a){return i.style.opacity=a,i}:o&&(r=function(i,a){var u=i.style;return i.currentStyle&&!i.currentStyle.hasLayout&&(u.zoom=1),n.test(u.filter)?(a=a>=.9999?"":"alpha(opacity="+a*100+")",u.filter=u.filter.replace(n,a)):u.filter+=" alpha(opacity="+a*100+")",i}),t.util.setStyle=h}(),function(){var h=Array.prototype.slice;function e(v){return typeof v=="string"?t.document.getElementById(v):v}var l,o=function(v){return h.call(v,0)};try{l=o(t.document.childNodes)instanceof Array}catch{}l||(o=function(v){for(var C=new Array(v.length),w=v.length;w--;)C[w]=v[w];return C});function n(v,C){var w=t.document.createElement(v);for(var S in C)S==="class"?w.className=C[S]:S==="for"?w.htmlFor=C[S]:w.setAttribute(S,C[S]);return w}function r(v,C){v&&(" "+v.className+" ").indexOf(" "+C+" ")===-1&&(v.className+=(v.className?" ":"")+C)}function i(v,C,w){return typeof C=="string"&&(C=n(C,w)),v.parentNode&&v.parentNode.replaceChild(C,v),C.appendChild(v),C}function a(v){for(var C=0,w=0,S=t.document.documentElement,A=t.document.body||{scrollLeft:0,scrollTop:0};v&&(v.parentNode||v.host)&&(v=v.parentNode||v.host,v===t.document?(C=A.scrollLeft||S.scrollLeft||0,w=A.scrollTop||S.scrollTop||0):(C+=v.scrollLeft||0,w+=v.scrollTop||0),!(v.nodeType===1&&v.style.position==="fixed")););return{left:C,top:w}}function u(v){var C,w=v&&v.ownerDocument,S={left:0,top:0},A={left:0,top:0},P,X={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!w)return A;for(var K in X)A[X[K]]+=parseInt(s(v,K),10)||0;return C=w.documentElement,typeof v.getBoundingClientRect<"u"&&(S=v.getBoundingClientRect()),P=a(v),{left:S.left+P.left-(C.clientLeft||0)+A.left,top:S.top+P.top-(C.clientTop||0)+A.top}}var s;t.document.defaultView&&t.document.defaultView.getComputedStyle?s=function(v,C){var w=t.document.defaultView.getComputedStyle(v,null);return w?w[C]:void 0}:s=function(v,C){var w=v.style[C];return!w&&v.currentStyle&&(w=v.currentStyle[C]),w},function(){var v=t.document.documentElement.style,C="userSelect"in v?"userSelect":"MozUserSelect"in v?"MozUserSelect":"WebkitUserSelect"in v?"WebkitUserSelect":"KhtmlUserSelect"in v?"KhtmlUserSelect":"";function w(A){return typeof A.onselectstart<"u"&&(A.onselectstart=t.util.falseFunction),C?A.style[C]="none":typeof A.unselectable=="string"&&(A.unselectable="on"),A}function S(A){return typeof A.onselectstart<"u"&&(A.onselectstart=null),C?A.style[C]="":typeof A.unselectable=="string"&&(A.unselectable=""),A}t.util.makeElementUnselectable=w,t.util.makeElementSelectable=S}();function f(v){var C=t.jsdomImplForWrapper(v);return C._canvas||C._image}function g(v){if(t.isLikelyNode){var C=t.jsdomImplForWrapper(v);C&&(C._image=null,C._canvas=null,C._currentSrc=null,C._attributes=null,C._classList=null)}}function m(v,C){v.imageSmoothingEnabled=v.imageSmoothingEnabled||v.webkitImageSmoothingEnabled||v.mozImageSmoothingEnabled||v.msImageSmoothingEnabled||v.oImageSmoothingEnabled,v.imageSmoothingEnabled=C}t.util.setImageSmoothing=m,t.util.getById=e,t.util.toArray=o,t.util.addClass=r,t.util.makeElement=n,t.util.wrapElement=i,t.util.getScrollLeftTop=a,t.util.getElementOffset=u,t.util.getNodeCanvas=f,t.util.cleanUpJsdomNode=g}(),function(){function h(o,n){return o+(/\?/.test(o)?"&":"?")+n}function e(){}function l(o,n){n||(n={});var r=n.method?n.method.toUpperCase():"GET",i=n.onComplete||function(){},a=new t.window.XMLHttpRequest,u=n.body||n.parameters;return a.onreadystatechange=function(){a.readyState===4&&(i(a),a.onreadystatechange=e)},r==="GET"&&(u=null,typeof n.parameters=="string"&&(o=h(o,n.parameters))),a.open(r,o,!0),(r==="POST"||r==="PUT")&&a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(u),a}t.util.request=l}(),t.log=console.log,t.warn=console.warn,function(){var h=t.util.object.extend,e=t.util.object.clone,l=[];t.util.object.extend(l,{cancelAll:function(){var f=this.splice(0);return f.forEach(function(g){g.cancel()}),f},cancelByCanvas:function(f){if(!f)return[];var g=this.filter(function(m){return typeof m.target=="object"&&m.target.canvas===f});return g.forEach(function(m){m.cancel()}),g},cancelByTarget:function(f){var g=this.findAnimationsByTarget(f);return g.forEach(function(m){m.cancel()}),g},findAnimationIndex:function(f){return this.indexOf(this.findAnimation(f))},findAnimation:function(f){return this.find(function(g){return g.cancel===f})},findAnimationsByTarget:function(f){return f?this.filter(function(g){return g.target===f}):[]}});function o(){return!1}function n(f,g,m,v){return-m*Math.cos(f/v*(Math.PI/2))+m+g}function r(f){f||(f={});var g=!1,m,v=function(){var C=t.runningAnimations.indexOf(m);return C>-1&&t.runningAnimations.splice(C,1)[0]};return m=h(e(f),{cancel:function(){return g=!0,v()},currentValue:"startValue"in f?f.startValue:0,completionRate:0,durationRate:0}),t.runningAnimations.push(m),u(function(C){var w=C||+new Date,S=f.duration||500,A=w+S,P,X=f.onChange||o,K=f.abort||o,tt=f.onComplete||o,H=f.easing||n,J="startValue"in f?f.startValue.length>0:!1,Z="startValue"in f?f.startValue:0,nt="endValue"in f?f.endValue:100,lt=f.byValue||(J?Z.map(function(rt,T){return nt[T]-Z[T]}):nt-Z);f.onStart&&f.onStart(),function rt(T){P=T||+new Date;var E=P>A?S:P-w,D=E/S,k=J?Z.map(function(O,x){return H(E,Z[x],lt[x],S)}):H(E,Z,lt,S),B=Math.abs(J?(k[0]-Z[0])/lt[0]:(k-Z)/lt);if(m.currentValue=J?k.slice():k,m.completionRate=B,m.durationRate=D,!g){if(K(k,B,D)){v();return}if(P>A){m.currentValue=J?nt.slice():nt,m.completionRate=1,m.durationRate=1,X(J?nt.slice():nt,1,1),tt(nt,1,1),v();return}else X(k,B,D),u(rt)}}(w)}),m.cancel}var i=t.window.requestAnimationFrame||t.window.webkitRequestAnimationFrame||t.window.mozRequestAnimationFrame||t.window.oRequestAnimationFrame||t.window.msRequestAnimationFrame||function(f){return t.window.setTimeout(f,1e3/60)},a=t.window.cancelAnimationFrame||t.window.clearTimeout;function u(){return i.apply(t.window,arguments)}function s(){return a.apply(t.window,arguments)}t.util.animate=r,t.util.requestAnimFrame=u,t.util.cancelAnimFrame=s,t.runningAnimations=l}(),function(){function h(l,o,n){var r="rgba("+parseInt(l[0]+n*(o[0]-l[0]),10)+","+parseInt(l[1]+n*(o[1]-l[1]),10)+","+parseInt(l[2]+n*(o[2]-l[2]),10);return r+=","+(l&&o?parseFloat(l[3]+n*(o[3]-l[3])):1),r+=")",r}function e(l,o,n,r){var i=new t.Color(l).getSource(),a=new t.Color(o).getSource(),u=r.onComplete,s=r.onChange;return r=r||{},t.util.animate(t.util.object.extend(r,{duration:n||500,startValue:i,endValue:a,byValue:a,easing:function(f,g,m,v){var C=r.colorEasing?r.colorEasing(f,v):1-Math.cos(f/v*(Math.PI/2));return h(g,m,C)},onComplete:function(f,g,m){if(u)return u(h(a,a,0),g,m)},onChange:function(f,g,m){if(s){if(Array.isArray(f))return s(h(f,f,0),g,m);s(f,g,m)}}}))}t.util.animateColor=e}(),function(){function h(T,E,D,k){return T<Math.abs(E)?(T=E,k=D/4):E===0&&T===0?k=D/(2*Math.PI)*Math.asin(1):k=D/(2*Math.PI)*Math.asin(E/T),{a:T,c:E,p:D,s:k}}function e(T,E,D){return T.a*Math.pow(2,10*(E-=1))*Math.sin((E*D-T.s)*(2*Math.PI)/T.p)}function l(T,E,D,k){return D*((T=T/k-1)*T*T+1)+E}function o(T,E,D,k){return T/=k/2,T<1?D/2*T*T*T+E:D/2*((T-=2)*T*T+2)+E}function n(T,E,D,k){return D*(T/=k)*T*T*T+E}function r(T,E,D,k){return-D*((T=T/k-1)*T*T*T-1)+E}function i(T,E,D,k){return T/=k/2,T<1?D/2*T*T*T*T+E:-D/2*((T-=2)*T*T*T-2)+E}function a(T,E,D,k){return D*(T/=k)*T*T*T*T+E}function u(T,E,D,k){return D*((T=T/k-1)*T*T*T*T+1)+E}function s(T,E,D,k){return T/=k/2,T<1?D/2*T*T*T*T*T+E:D/2*((T-=2)*T*T*T*T+2)+E}function f(T,E,D,k){return-D*Math.cos(T/k*(Math.PI/2))+D+E}function g(T,E,D,k){return D*Math.sin(T/k*(Math.PI/2))+E}function m(T,E,D,k){return-D/2*(Math.cos(Math.PI*T/k)-1)+E}function v(T,E,D,k){return T===0?E:D*Math.pow(2,10*(T/k-1))+E}function C(T,E,D,k){return T===k?E+D:D*(-Math.pow(2,-10*T/k)+1)+E}function w(T,E,D,k){return T===0?E:T===k?E+D:(T/=k/2,T<1?D/2*Math.pow(2,10*(T-1))+E:D/2*(-Math.pow(2,-10*--T)+2)+E)}function S(T,E,D,k){return-D*(Math.sqrt(1-(T/=k)*T)-1)+E}function A(T,E,D,k){return D*Math.sqrt(1-(T=T/k-1)*T)+E}function P(T,E,D,k){return T/=k/2,T<1?-D/2*(Math.sqrt(1-T*T)-1)+E:D/2*(Math.sqrt(1-(T-=2)*T)+1)+E}function X(T,E,D,k){var B=1.70158,O=0,x=D;if(T===0)return E;if(T/=k,T===1)return E+D;O||(O=k*.3);var I=h(x,D,O,B);return-e(I,T,k)+E}function K(T,E,D,k){var B=1.70158,O=0,x=D;if(T===0)return E;if(T/=k,T===1)return E+D;O||(O=k*.3);var I=h(x,D,O,B);return I.a*Math.pow(2,-10*T)*Math.sin((T*k-I.s)*(2*Math.PI)/I.p)+I.c+E}function tt(T,E,D,k){var B=1.70158,O=0,x=D;if(T===0)return E;if(T/=k/2,T===2)return E+D;O||(O=k*(.3*1.5));var I=h(x,D,O,B);return T<1?-.5*e(I,T,k)+E:I.a*Math.pow(2,-10*(T-=1))*Math.sin((T*k-I.s)*(2*Math.PI)/I.p)*.5+I.c+E}function H(T,E,D,k,B){return B===void 0&&(B=1.70158),D*(T/=k)*T*((B+1)*T-B)+E}function J(T,E,D,k,B){return B===void 0&&(B=1.70158),D*((T=T/k-1)*T*((B+1)*T+B)+1)+E}function Z(T,E,D,k,B){return B===void 0&&(B=1.70158),T/=k/2,T<1?D/2*(T*T*(((B*=1.525)+1)*T-B))+E:D/2*((T-=2)*T*(((B*=1.525)+1)*T+B)+2)+E}function nt(T,E,D,k){return D-lt(k-T,0,D,k)+E}function lt(T,E,D,k){return(T/=k)<1/2.75?D*(7.5625*T*T)+E:T<2/2.75?D*(7.5625*(T-=1.5/2.75)*T+.75)+E:T<2.5/2.75?D*(7.5625*(T-=2.25/2.75)*T+.9375)+E:D*(7.5625*(T-=2.625/2.75)*T+.984375)+E}function rt(T,E,D,k){return T<k/2?nt(T*2,0,D,k)*.5+E:lt(T*2-k,0,D,k)*.5+D*.5+E}t.util.ease={easeInQuad:function(T,E,D,k){return D*(T/=k)*T+E},easeOutQuad:function(T,E,D,k){return-D*(T/=k)*(T-2)+E},easeInOutQuad:function(T,E,D,k){return T/=k/2,T<1?D/2*T*T+E:-D/2*(--T*(T-2)-1)+E},easeInCubic:function(T,E,D,k){return D*(T/=k)*T*T+E},easeOutCubic:l,easeInOutCubic:o,easeInQuart:n,easeOutQuart:r,easeInOutQuart:i,easeInQuint:a,easeOutQuint:u,easeInOutQuint:s,easeInSine:f,easeOutSine:g,easeInOutSine:m,easeInExpo:v,easeOutExpo:C,easeInOutExpo:w,easeInCirc:S,easeOutCirc:A,easeInOutCirc:P,easeInElastic:X,easeOutElastic:K,easeInOutElastic:tt,easeInBack:H,easeOutBack:J,easeInOutBack:Z,easeInBounce:nt,easeOutBounce:lt,easeInOutBounce:rt}}(),function(h){var e=h.fabric||(h.fabric={}),l=e.util.object.extend,o=e.util.object.clone,n=e.util.toFixed,r=e.util.parseUnit,i=e.util.multiplyTransformMatrices,a=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],u=["symbol","image","marker","pattern","view","svg"],s=["pattern","defs","symbol","metadata","clipPath","mask","desc"],f=["symbol","g","a","svg","clipPath","defs"],g={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},m={stroke:"strokeOpacity",fill:"fillOpacity"},v="font-size",C="clip-path";e.svgValidTagNamesRegEx=A(a),e.svgViewBoxElementsRegEx=A(u),e.svgInvalidAncestorsRegEx=A(s),e.svgValidParentsRegEx=A(f),e.cssRules={},e.gradientDefs={},e.clipPaths={};function w(O){return O in g?g[O]:O}function S(O,x,I,L){var Y=Array.isArray(x),j;if((O==="fill"||O==="stroke")&&x==="none")x="";else{if(O==="strokeUniform")return x==="non-scaling-stroke";if(O==="strokeDashArray")x==="none"?x=null:x=x.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(O==="transformMatrix")I&&I.transformMatrix?x=i(I.transformMatrix,e.parseTransformAttribute(x)):x=e.parseTransformAttribute(x);else if(O==="visible")x=x!=="none"&&x!=="hidden",I&&I.visible===!1&&(x=!1);else if(O==="opacity")x=parseFloat(x),I&&typeof I.opacity<"u"&&(x*=I.opacity);else if(O==="textAnchor")x=x==="start"?"left":x==="end"?"right":"center";else if(O==="charSpacing")j=r(x,L)/L*1e3;else if(O==="paintFirst"){var G=x.indexOf("fill"),M=x.indexOf("stroke"),x="fill";(G>-1&&M>-1&&M<G||G===-1&&M>-1)&&(x="stroke")}else{if(O==="href"||O==="xlink:href"||O==="font")return x;if(O==="imageSmoothing")return x==="optimizeQuality";j=Y?x.map(r):r(x,L)}}return!Y&&isNaN(j)?x:j}function A(O){return new RegExp("^("+O.join("|")+")\\b","i")}function P(O){for(var x in m)if(!(typeof O[m[x]]>"u"||O[x]==="")){if(typeof O[x]>"u"){if(!e.Object.prototype[x])continue;O[x]=e.Object.prototype[x]}if(O[x].indexOf("url(")!==0){var I=new e.Color(O[x]);O[x]=I.setAlpha(n(I.getAlpha()*O[m[x]],2)).toRgba()}}return O}function X(O,x){var I,L=[],Y,j,G;for(j=0,G=x.length;j<G;j++)I=x[j],Y=O.getElementsByTagName(I),L=L.concat(Array.prototype.slice.call(Y));return L}e.parseTransformAttribute=function(){function O(z,ut){var mt=e.util.cos(ut[0]),_t=e.util.sin(ut[0]),xt=0,wt=0;ut.length===3&&(xt=ut[1],wt=ut[2]),z[0]=mt,z[1]=_t,z[2]=-_t,z[3]=mt,z[4]=xt-(mt*xt-_t*wt),z[5]=wt-(_t*xt+mt*wt)}function x(z,ut){var mt=ut[0],_t=ut.length===2?ut[1]:ut[0];z[0]=mt,z[3]=_t}function I(z,ut,mt){z[mt]=Math.tan(e.util.degreesToRadians(ut[0]))}function L(z,ut){z[4]=ut[0],ut.length===2&&(z[5]=ut[1])}var Y=e.iMatrix,j=e.reNum,G=e.commaWsp,M="(?:(skewX)\\s*\\(\\s*("+j+")\\s*\\))",et="(?:(skewY)\\s*\\(\\s*("+j+")\\s*\\))",W="(?:(rotate)\\s*\\(\\s*("+j+")(?:"+G+"("+j+")"+G+"("+j+"))?\\s*\\))",R="(?:(scale)\\s*\\(\\s*("+j+")(?:"+G+"("+j+"))?\\s*\\))",U="(?:(translate)\\s*\\(\\s*("+j+")(?:"+G+"("+j+"))?\\s*\\))",V="(?:(matrix)\\s*\\(\\s*("+j+")"+G+"("+j+")"+G+"("+j+")"+G+"("+j+")"+G+"("+j+")"+G+"("+j+")\\s*\\))",N="(?:"+V+"|"+U+"|"+R+"|"+W+"|"+M+"|"+et+")",q="(?:"+N+"(?:"+G+"*"+N+")*)",it="^\\s*(?:"+q+"?)\\s*$",gt=new RegExp(it),ht=new RegExp(N,"g");return function(z){var ut=Y.concat(),mt=[];if(!z||z&&!gt.test(z))return ut;z.replace(ht,function(xt){var wt=new RegExp(N).exec(xt).filter(function(te){return!!te}),Bt=wt[1],Dt=wt.slice(2).map(parseFloat);switch(Bt){case"translate":L(ut,Dt);break;case"rotate":Dt[0]=e.util.degreesToRadians(Dt[0]),O(ut,Dt);break;case"scale":x(ut,Dt);break;case"skewX":I(ut,Dt,2);break;case"skewY":I(ut,Dt,1);break;case"matrix":ut=Dt;break}mt.push(ut.concat()),ut=Y.concat()});for(var _t=mt[0];mt.length>1;)mt.shift(),_t=e.util.multiplyTransformMatrices(_t,mt[0]);return _t}}();function K(O,x){var I,L;O.replace(/;\s*$/,"").split(";").forEach(function(Y){var j=Y.split(":");I=j[0].trim().toLowerCase(),L=j[1].trim(),x[I]=L})}function tt(O,x){var I,L;for(var Y in O)typeof O[Y]>"u"||(I=Y.toLowerCase(),L=O[Y],x[I]=L)}function H(O,x){var I={};for(var L in e.cssRules[x])if(J(O,L.split(" ")))for(var Y in e.cssRules[x][L])I[Y]=e.cssRules[x][L][Y];return I}function J(O,x){var I,L=!0;return I=nt(O,x.pop()),I&&x.length&&(L=Z(O,x)),I&&L&&x.length===0}function Z(O,x){for(var I,L=!0;O.parentNode&&O.parentNode.nodeType===1&&x.length;)L&&(I=x.pop()),O=O.parentNode,L=nt(O,I);return x.length===0}function nt(O,x){var I=O.nodeName,L=O.getAttribute("class"),Y=O.getAttribute("id"),j,G;if(j=new RegExp("^"+I,"i"),x=x.replace(j,""),Y&&x.length&&(j=new RegExp("#"+Y+"(?![a-zA-Z\\-]+)","i"),x=x.replace(j,"")),L&&x.length)for(L=L.split(" "),G=L.length;G--;)j=new RegExp("\\."+L[G]+"(?![a-zA-Z\\-]+)","i"),x=x.replace(j,"");return x.length===0}function lt(O,x){var I;if(O.getElementById&&(I=O.getElementById(x)),I)return I;var L,Y,j,G=O.getElementsByTagName("*");for(Y=0,j=G.length;Y<j;Y++)if(L=G[Y],x===L.getAttribute("id"))return L}function rt(O){for(var x=X(O,["use","svg:use"]),I=0;x.length&&I<x.length;){var L=x[I],Y=L.getAttribute("xlink:href")||L.getAttribute("href");if(Y===null)return;var j=Y.slice(1),G=L.getAttribute("x")||0,M=L.getAttribute("y")||0,et=lt(O,j).cloneNode(!0),W=(et.getAttribute("transform")||"")+" translate("+G+", "+M+")",R,U=x.length,V,N,q,it,gt=e.svgNS;if(E(et),/^svg$/i.test(et.nodeName)){var ht=et.ownerDocument.createElementNS(gt,"g");for(N=0,q=et.attributes,it=q.length;N<it;N++)V=q.item(N),ht.setAttributeNS(gt,V.nodeName,V.nodeValue);for(;et.firstChild;)ht.appendChild(et.firstChild);et=ht}for(N=0,q=L.attributes,it=q.length;N<it;N++)V=q.item(N),!(V.nodeName==="x"||V.nodeName==="y"||V.nodeName==="xlink:href"||V.nodeName==="href")&&(V.nodeName==="transform"?W=V.nodeValue+" "+W:et.setAttribute(V.nodeName,V.nodeValue));et.setAttribute("transform",W),et.setAttribute("instantiated_by_use","1"),et.removeAttribute("id"),R=L.parentNode,R.replaceChild(et,L),x.length===U&&I++}}var T=new RegExp("^\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*$");function E(O){if(!e.svgViewBoxElementsRegEx.test(O.nodeName))return{};var x=O.getAttribute("viewBox"),I=1,L=1,Y=0,j=0,G,M,et,W,R=O.getAttribute("width"),U=O.getAttribute("height"),V=O.getAttribute("x")||0,N=O.getAttribute("y")||0,q=O.getAttribute("preserveAspectRatio")||"",it=!x||!(x=x.match(T)),gt=!R||!U||R==="100%"||U==="100%",ht=it&&gt,z={},ut="",mt=0,_t=0;if(z.width=0,z.height=0,z.toBeParsed=ht,it&&(V||N)&&O.parentNode&&O.parentNode.nodeName!=="#document"&&(ut=" translate("+r(V)+" "+r(N)+") ",et=(O.getAttribute("transform")||"")+ut,O.setAttribute("transform",et),O.removeAttribute("x"),O.removeAttribute("y")),ht)return z;if(it)return z.width=r(R),z.height=r(U),z;if(Y=-parseFloat(x[1]),j=-parseFloat(x[2]),G=parseFloat(x[3]),M=parseFloat(x[4]),z.minX=Y,z.minY=j,z.viewBoxWidth=G,z.viewBoxHeight=M,gt?(z.width=G,z.height=M):(z.width=r(R),z.height=r(U),I=z.width/G,L=z.height/M),q=e.util.parsePreserveAspectRatioAttribute(q),q.alignX!=="none"&&(q.meetOrSlice==="meet"&&(L=I=I>L?L:I),q.meetOrSlice==="slice"&&(L=I=I>L?I:L),mt=z.width-G*I,_t=z.height-M*I,q.alignX==="Mid"&&(mt/=2),q.alignY==="Mid"&&(_t/=2),q.alignX==="Min"&&(mt=0),q.alignY==="Min"&&(_t=0)),I===1&&L===1&&Y===0&&j===0&&V===0&&N===0)return z;if((V||N)&&O.parentNode.nodeName!=="#document"&&(ut=" translate("+r(V)+" "+r(N)+") "),et=ut+" matrix("+I+" 0 0 "+L+" "+(Y*I+mt)+" "+(j*L+_t)+") ",O.nodeName==="svg"){for(W=O.ownerDocument.createElementNS(e.svgNS,"g");O.firstChild;)W.appendChild(O.firstChild);O.appendChild(W)}else W=O,W.removeAttribute("x"),W.removeAttribute("y"),et=W.getAttribute("transform")+et;return W.setAttribute("transform",et),z}function D(O,x){for(;O&&(O=O.parentNode);)if(O.nodeName&&x.test(O.nodeName.replace("svg:",""))&&!O.getAttribute("instantiated_by_use"))return!0;return!1}e.parseSVGDocument=function(O,x,I,L){if(O){rt(O);var Y=e.Object.__uid++,j,G,M=E(O),et=e.util.toArray(O.getElementsByTagName("*"));if(M.crossOrigin=L&&L.crossOrigin,M.svgUid=Y,et.length===0&&e.isLikelyNode){et=O.selectNodes('//*[name(.)!="svg"]');var W=[];for(j=0,G=et.length;j<G;j++)W[j]=et[j];et=W}var R=et.filter(function(V){return E(V),e.svgValidTagNamesRegEx.test(V.nodeName.replace("svg:",""))&&!D(V,e.svgInvalidAncestorsRegEx)});if(!R||R&&!R.length){x&&x([],{});return}var U={};et.filter(function(V){return V.nodeName.replace("svg:","")==="clipPath"}).forEach(function(V){var N=V.getAttribute("id");U[N]=e.util.toArray(V.getElementsByTagName("*")).filter(function(q){return e.svgValidTagNamesRegEx.test(q.nodeName.replace("svg:",""))})}),e.gradientDefs[Y]=e.getGradientDefs(O),e.cssRules[Y]=e.getCSSRules(O),e.clipPaths[Y]=U,e.parseElements(R,function(V,N){x&&(x(V,M,N,et),delete e.gradientDefs[Y],delete e.cssRules[Y],delete e.clipPaths[Y])},o(M),I,L)}};function k(O,x){var I=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],L="xlink:href",Y=x.getAttribute(L).slice(1),j=lt(O,Y);if(j&&j.getAttribute(L)&&k(O,j),I.forEach(function(M){j&&!x.hasAttribute(M)&&j.hasAttribute(M)&&x.setAttribute(M,j.getAttribute(M))}),!x.children.length)for(var G=j.cloneNode(!0);G.firstChild;)x.appendChild(G.firstChild);x.removeAttribute(L)}var B=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+e.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+e.reNum+"))?\\s+(.*)");l(e,{parseFontDeclaration:function(O,x){var I=O.match(B);if(I){var L=I[1],Y=I[3],j=I[4],G=I[5],M=I[6];L&&(x.fontStyle=L),Y&&(x.fontWeight=isNaN(parseFloat(Y))?Y:parseFloat(Y)),j&&(x.fontSize=r(j)),M&&(x.fontFamily=M),G&&(x.lineHeight=G==="normal"?1:G)}},getGradientDefs:function(O){var x=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],I=X(O,x),L,Y=0,j={};for(Y=I.length;Y--;)L=I[Y],L.getAttribute("xlink:href")&&k(O,L),j[L.getAttribute("id")]=L;return j},parseAttributes:function(O,x,I){if(O){var L,Y={},j,G;typeof I>"u"&&(I=O.getAttribute("svgUid")),O.parentNode&&e.svgValidParentsRegEx.test(O.parentNode.nodeName)&&(Y=e.parseAttributes(O.parentNode,x,I));var M=x.reduce(function(q,it){return L=O.getAttribute(it),L&&(q[it]=L),q},{}),et=l(H(O,I),e.parseStyleAttribute(O));M=l(M,et),et[C]&&O.setAttribute(C,et[C]),j=G=Y.fontSize||e.Text.DEFAULT_SVG_FONT_SIZE,M[v]&&(M[v]=j=r(M[v],G));var W,R,U={};for(var V in M)W=w(V),R=S(W,M[V],Y,j),U[W]=R;U&&U.font&&e.parseFontDeclaration(U.font,U);var N=l(Y,U);return e.svgValidParentsRegEx.test(O.nodeName)?N:P(N)}},parseElements:function(O,x,I,L,Y){new e.ElementsParser(O,x,I,L,Y).parse()},parseStyleAttribute:function(O){var x={},I=O.getAttribute("style");return I&&(typeof I=="string"?K(I,x):tt(I,x)),x},parsePointsAttribute:function(O){if(!O)return null;O=O.replace(/,/g," ").trim(),O=O.split(/\s+/);var x=[],I,L;for(I=0,L=O.length;I<L;I+=2)x.push({x:parseFloat(O[I]),y:parseFloat(O[I+1])});return x},getCSSRules:function(O){var x=O.getElementsByTagName("style"),I,L,Y={},j;for(I=0,L=x.length;I<L;I++){var G=x[I].textContent;G=G.replace(/\/\*[\s\S]*?\*\//g,""),G.trim()!==""&&(j=G.split("}"),j=j.filter(function(M){return M.trim()}),j.forEach(function(M){var et=M.split("{"),W={},R=et[1].trim(),U=R.split(";").filter(function(it){return it.trim()});for(I=0,L=U.length;I<L;I++){var V=U[I].split(":"),N=V[0].trim(),q=V[1].trim();W[N]=q}M=et[0].trim(),M.split(",").forEach(function(it){it=it.replace(/^svg/i,"").trim(),it!==""&&(Y[it]?e.util.object.extend(Y[it],W):Y[it]=e.util.object.clone(W))})}))}return Y},loadSVGFromURL:function(O,x,I,L){O=O.replace(/^\n\s*/,"").trim(),new e.util.request(O,{method:"get",onComplete:Y});function Y(j){var G=j.responseXML;if(!G||!G.documentElement)return x&&x(null),!1;e.parseSVGDocument(G.documentElement,function(M,et,W,R){x&&x(M,et,W,R)},I,L)}},loadSVGFromString:function(O,x,I,L){var Y=new e.window.DOMParser,j=Y.parseFromString(O.trim(),"text/xml");e.parseSVGDocument(j.documentElement,function(G,M,et,W){x(G,M,et,W)},I,L)}})}(c),t.ElementsParser=function(h,e,l,o,n,r){this.elements=h,this.callback=e,this.options=l,this.reviver=o,this.svgUid=l&&l.svgUid||0,this.parsingOptions=n,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=r},function(h){h.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},h.createObjects=function(){var e=this;this.elements.forEach(function(l,o){l.setAttribute("svgUid",e.svgUid),e.createObject(l,o)})},h.findTag=function(e){return t[t.util.string.capitalize(e.tagName.replace("svg:",""))]},h.createObject=function(e,l){var o=this.findTag(e);if(o&&o.fromElement)try{o.fromElement(e,this.createCallback(l,e),this.options)}catch(n){t.log(n)}else this.checkIfDone()},h.createCallback=function(e,l){var o=this;return function(n){var r;o.resolveGradient(n,l,"fill"),o.resolveGradient(n,l,"stroke"),n instanceof t.Image&&n._originalElement&&(r=n.parsePreserveAspectRatioAttribute(l)),n._removeTransformMatrix(r),o.resolveClipPath(n,l),o.reviver&&o.reviver(l,n),o.instances[e]=n,o.checkIfDone()}},h.extractPropertyDefinition=function(e,l,o){var n=e[l],r=this.regexUrl;if(r.test(n)){r.lastIndex=0;var i=r.exec(n)[1];return r.lastIndex=0,t[o][this.svgUid][i]}},h.resolveGradient=function(e,l,o){var n=this.extractPropertyDefinition(e,o,"gradientDefs");if(n){var r=l.getAttribute(o+"-opacity"),i=t.Gradient.fromElement(n,e,r,this.options);e.set(o,i)}},h.createClipPathCallback=function(e,l){return function(o){o._removeTransformMatrix(),o.fillRule=o.clipRule,l.push(o)}},h.resolveClipPath=function(e,l){var o=this.extractPropertyDefinition(e,"clipPath","clipPaths"),n,r,i,a,u,s;if(o){a=[],i=t.util.invertTransform(e.calcTransformMatrix());for(var f=o[0].parentNode,g=l;g.parentNode&&g.getAttribute("clip-path")!==e.clipPath;)g=g.parentNode;g.parentNode.appendChild(f);for(var m=0;m<o.length;m++)n=o[m],r=this.findTag(n),r.fromElement(n,this.createClipPathCallback(e,a),this.options);a.length===1?o=a[0]:o=new t.Group(a),u=t.util.multiplyTransformMatrices(i,o.calcTransformMatrix()),o.clipPath&&this.resolveClipPath(o,g);var s=t.util.qrDecompose(u);o.flipX=!1,o.flipY=!1,o.set("scaleX",s.scaleX),o.set("scaleY",s.scaleY),o.angle=s.angle,o.skewX=s.skewX,o.skewY=0,o.setPositionByOrigin({x:s.translateX,y:s.translateY},"center","center"),e.clipPath=o}else delete e.clipPath},h.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(e){return e!=null}),this.callback(this.instances,this.elements))}}(t.ElementsParser.prototype),function(h){var e=h.fabric||(h.fabric={});if(e.Point){e.warn("fabric.Point is already defined");return}e.Point=l;function l(o,n){this.x=o,this.y=n}l.prototype={type:"point",constructor:l,add:function(o){return new l(this.x+o.x,this.y+o.y)},addEquals:function(o){return this.x+=o.x,this.y+=o.y,this},scalarAdd:function(o){return new l(this.x+o,this.y+o)},scalarAddEquals:function(o){return this.x+=o,this.y+=o,this},subtract:function(o){return new l(this.x-o.x,this.y-o.y)},subtractEquals:function(o){return this.x-=o.x,this.y-=o.y,this},scalarSubtract:function(o){return new l(this.x-o,this.y-o)},scalarSubtractEquals:function(o){return this.x-=o,this.y-=o,this},multiply:function(o){return new l(this.x*o,this.y*o)},multiplyEquals:function(o){return this.x*=o,this.y*=o,this},divide:function(o){return new l(this.x/o,this.y/o)},divideEquals:function(o){return this.x/=o,this.y/=o,this},eq:function(o){return this.x===o.x&&this.y===o.y},lt:function(o){return this.x<o.x&&this.y<o.y},lte:function(o){return this.x<=o.x&&this.y<=o.y},gt:function(o){return this.x>o.x&&this.y>o.y},gte:function(o){return this.x>=o.x&&this.y>=o.y},lerp:function(o,n){return typeof n>"u"&&(n=.5),n=Math.max(Math.min(1,n),0),new l(this.x+(o.x-this.x)*n,this.y+(o.y-this.y)*n)},distanceFrom:function(o){var n=this.x-o.x,r=this.y-o.y;return Math.sqrt(n*n+r*r)},midPointFrom:function(o){return this.lerp(o)},min:function(o){return new l(Math.min(this.x,o.x),Math.min(this.y,o.y))},max:function(o){return new l(Math.max(this.x,o.x),Math.max(this.y,o.y))},toString:function(){return this.x+","+this.y},setXY:function(o,n){return this.x=o,this.y=n,this},setX:function(o){return this.x=o,this},setY:function(o){return this.y=o,this},setFromPoint:function(o){return this.x=o.x,this.y=o.y,this},swap:function(o){var n=this.x,r=this.y;this.x=o.x,this.y=o.y,o.x=n,o.y=r},clone:function(){return new l(this.x,this.y)}}}(c),function(h){var e=h.fabric||(h.fabric={});if(e.Intersection){e.warn("fabric.Intersection is already defined");return}function l(o){this.status=o,this.points=[]}e.Intersection=l,e.Intersection.prototype={constructor:l,appendPoint:function(o){return this.points.push(o),this},appendPoints:function(o){return this.points=this.points.concat(o),this}},e.Intersection.intersectLineLine=function(o,n,r,i){var a,u=(i.x-r.x)*(o.y-r.y)-(i.y-r.y)*(o.x-r.x),s=(n.x-o.x)*(o.y-r.y)-(n.y-o.y)*(o.x-r.x),f=(i.y-r.y)*(n.x-o.x)-(i.x-r.x)*(n.y-o.y);if(f!==0){var g=u/f,m=s/f;0<=g&&g<=1&&0<=m&&m<=1?(a=new l("Intersection"),a.appendPoint(new e.Point(o.x+g*(n.x-o.x),o.y+g*(n.y-o.y)))):a=new l}else u===0||s===0?a=new l("Coincident"):a=new l("Parallel");return a},e.Intersection.intersectLinePolygon=function(o,n,r){var i=new l,a=r.length,u,s,f,g;for(g=0;g<a;g++)u=r[g],s=r[(g+1)%a],f=l.intersectLineLine(o,n,u,s),i.appendPoints(f.points);return i.points.length>0&&(i.status="Intersection"),i},e.Intersection.intersectPolygonPolygon=function(o,n){var r=new l,i=o.length,a;for(a=0;a<i;a++){var u=o[a],s=o[(a+1)%i],f=l.intersectLinePolygon(u,s,n);r.appendPoints(f.points)}return r.points.length>0&&(r.status="Intersection"),r},e.Intersection.intersectPolygonRectangle=function(o,n,r){var i=n.min(r),a=n.max(r),u=new e.Point(a.x,i.y),s=new e.Point(i.x,a.y),f=l.intersectLinePolygon(i,u,o),g=l.intersectLinePolygon(u,a,o),m=l.intersectLinePolygon(a,s,o),v=l.intersectLinePolygon(s,i,o),C=new l;return C.appendPoints(f.points),C.appendPoints(g.points),C.appendPoints(m.points),C.appendPoints(v.points),C.points.length>0&&(C.status="Intersection"),C}}(c),function(h){var e=h.fabric||(h.fabric={});if(e.Color){e.warn("fabric.Color is already defined.");return}function l(n){n?this._tryParsingColor(n):this.setSource([0,0,0,1])}e.Color=l,e.Color.prototype={_tryParsingColor:function(n){var r;n in l.colorNameMap&&(n=l.colorNameMap[n]),n==="transparent"&&(r=[255,255,255,0]),r||(r=l.sourceFromHex(n)),r||(r=l.sourceFromRgb(n)),r||(r=l.sourceFromHsl(n)),r||(r=[0,0,0,1]),r&&this.setSource(r)},_rgbToHsl:function(n,r,i){n/=255,r/=255,i/=255;var a,u,s,f=e.util.array.max([n,r,i]),g=e.util.array.min([n,r,i]);if(s=(f+g)/2,f===g)a=u=0;else{var m=f-g;switch(u=s>.5?m/(2-f-g):m/(f+g),f){case n:a=(r-i)/m+(r<i?6:0);break;case r:a=(i-n)/m+2;break;case i:a=(n-r)/m+4;break}a/=6}return[Math.round(a*360),Math.round(u*100),Math.round(s*100)]},getSource:function(){return this._source},setSource:function(n){this._source=n},toRgb:function(){var n=this.getSource();return"rgb("+n[0]+","+n[1]+","+n[2]+")"},toRgba:function(){var n=this.getSource();return"rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")"},toHsl:function(){var n=this.getSource(),r=this._rgbToHsl(n[0],n[1],n[2]);return"hsl("+r[0]+","+r[1]+"%,"+r[2]+"%)"},toHsla:function(){var n=this.getSource(),r=this._rgbToHsl(n[0],n[1],n[2]);return"hsla("+r[0]+","+r[1]+"%,"+r[2]+"%,"+n[3]+")"},toHex:function(){var n=this.getSource(),r,i,a;return r=n[0].toString(16),r=r.length===1?"0"+r:r,i=n[1].toString(16),i=i.length===1?"0"+i:i,a=n[2].toString(16),a=a.length===1?"0"+a:a,r.toUpperCase()+i.toUpperCase()+a.toUpperCase()},toHexa:function(){var n=this.getSource(),r;return r=Math.round(n[3]*255),r=r.toString(16),r=r.length===1?"0"+r:r,this.toHex()+r.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(n){var r=this.getSource();return r[3]=n,this.setSource(r),this},toGrayscale:function(){var n=this.getSource(),r=parseInt((n[0]*.3+n[1]*.59+n[2]*.11).toFixed(0),10),i=n[3];return this.setSource([r,r,r,i]),this},toBlackWhite:function(n){var r=this.getSource(),i=(r[0]*.3+r[1]*.59+r[2]*.11).toFixed(0),a=r[3];return n=n||127,i=Number(i)<Number(n)?0:255,this.setSource([i,i,i,a]),this},overlayWith:function(n){n instanceof l||(n=new l(n));var r=[],i=this.getAlpha(),a=.5,u=this.getSource(),s=n.getSource(),f;for(f=0;f<3;f++)r.push(Math.round(u[f]*(1-a)+s[f]*a));return r[3]=i,this.setSource(r),this}},e.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,e.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,e.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,e.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function o(n,r,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(r-n)*6*i:i<1/2?r:i<2/3?n+(r-n)*(2/3-i)*6:n}e.Color.fromRgb=function(n){return l.fromSource(l.sourceFromRgb(n))},e.Color.sourceFromRgb=function(n){var r=n.match(l.reRGBa);if(r){var i=parseInt(r[1],10)/(/%$/.test(r[1])?100:1)*(/%$/.test(r[1])?255:1),a=parseInt(r[2],10)/(/%$/.test(r[2])?100:1)*(/%$/.test(r[2])?255:1),u=parseInt(r[3],10)/(/%$/.test(r[3])?100:1)*(/%$/.test(r[3])?255:1);return[parseInt(i,10),parseInt(a,10),parseInt(u,10),r[4]?parseFloat(r[4]):1]}},e.Color.fromRgba=l.fromRgb,e.Color.fromHsl=function(n){return l.fromSource(l.sourceFromHsl(n))},e.Color.sourceFromHsl=function(n){var r=n.match(l.reHSLa);if(r){var i=(parseFloat(r[1])%360+360)%360/360,a=parseFloat(r[2])/(/%$/.test(r[2])?100:1),u=parseFloat(r[3])/(/%$/.test(r[3])?100:1),s,f,g;if(a===0)s=f=g=u;else{var m=u<=.5?u*(a+1):u+a-u*a,v=u*2-m;s=o(v,m,i+1/3),f=o(v,m,i),g=o(v,m,i-1/3)}return[Math.round(s*255),Math.round(f*255),Math.round(g*255),r[4]?parseFloat(r[4]):1]}},e.Color.fromHsla=l.fromHsl,e.Color.fromHex=function(n){return l.fromSource(l.sourceFromHex(n))},e.Color.sourceFromHex=function(n){if(n.match(l.reHex)){var r=n.slice(n.indexOf("#")+1),i=r.length===3||r.length===4,a=r.length===8||r.length===4,u=i?r.charAt(0)+r.charAt(0):r.substring(0,2),s=i?r.charAt(1)+r.charAt(1):r.substring(2,4),f=i?r.charAt(2)+r.charAt(2):r.substring(4,6),g=a?i?r.charAt(3)+r.charAt(3):r.substring(6,8):"FF";return[parseInt(u,16),parseInt(s,16),parseInt(f,16),parseFloat((parseInt(g,16)/255).toFixed(2))]}},e.Color.fromSource=function(n){var r=new l;return r.setSource(n),r}}(c),function(h){var e=h.fabric||(h.fabric={}),l=["e","se","s","sw","w","nw","n","ne","e"],o=["ns","nesw","ew","nwse"],n={},r="left",i="top",a="right",u="bottom",s="center",f={top:u,bottom:i,left:a,right:r,center:s},g=e.util.radiansToDegrees,m=Math.sign||function(W){return(W>0)-(W<0)||+W};function v(W,R){var U=W.angle+g(Math.atan2(R.y,R.x))+360;return Math.round(U%360/45)}function C(W,R){var U=R.transform.target,V=U.canvas,N=e.util.object.clone(R);N.target=U,V&&V.fire("object:"+W,N),U.fire(W,R)}function w(W,R){var U=R.canvas,V=U.uniScaleKey,N=W[V];return U.uniformScaling&&!N||!U.uniformScaling&&N}function S(W){return W.originX===s&&W.originY===s}function A(W,R,U){var V=W.lockScalingX,N=W.lockScalingY;return!!(V&&N||!R&&(V||N)&&U||V&&R==="x"||N&&R==="y")}function P(W,R,U){var V="not-allowed",N=w(W,U),q="";if(R.x!==0&&R.y===0?q="x":R.x===0&&R.y!==0&&(q="y"),A(U,q,N))return V;var it=v(U,R);return l[it]+"-resize"}function X(W,R,U){var V="not-allowed";if(R.x!==0&&U.lockSkewingY||R.y!==0&&U.lockSkewingX)return V;var N=v(U,R)%4;return o[N]+"-resize"}function K(W,R,U){return W[U.canvas.altActionKey]?n.skewCursorStyleHandler(W,R,U):n.scaleCursorStyleHandler(W,R,U)}function tt(W,R,U){var V=W[U.canvas.altActionKey];if(R.x===0)return V?"skewX":"scaleY";if(R.y===0)return V?"skewY":"scaleX"}function H(W,R,U){return U.lockRotation?"not-allowed":R.cursorStyle}function J(W,R,U,V){return{e:W,transform:R,pointer:{x:U,y:V}}}function Z(W){return function(R,U,V,N){var q=U.target,it=q.getCenterPoint(),gt=q.translateToOriginPoint(it,U.originX,U.originY),ht=W(R,U,V,N);return q.setPositionByOrigin(gt,U.originX,U.originY),ht}}function nt(W,R){return function(U,V,N,q){var it=R(U,V,N,q);return it&&C(W,J(U,V,N,q)),it}}function lt(W,R,U,V,N){var q=W.target,it=q.controls[W.corner],gt=q.canvas.getZoom(),ht=q.padding/gt,z=q.toLocalPoint(new e.Point(V,N),R,U);return z.x>=ht&&(z.x-=ht),z.x<=-ht&&(z.x+=ht),z.y>=ht&&(z.y-=ht),z.y<=ht&&(z.y+=ht),z.x-=it.offsetX,z.y-=it.offsetY,z}function rt(W){return W.flipX!==W.flipY}function T(W,R,U,V,N){if(W[R]!==0){var q=W._getTransformedDimensions()[V],it=N/q*W[U];W.set(U,it)}}function E(W,R,U,V){var N=R.target,q=N._getTransformedDimensions(0,N.skewY),it=lt(R,R.originX,R.originY,U,V),gt=Math.abs(it.x*2)-q.x,ht=N.skewX,z;gt<2?z=0:(z=g(Math.atan2(gt/N.scaleX,q.y/N.scaleY)),R.originX===r&&R.originY===u&&(z=-z),R.originX===a&&R.originY===i&&(z=-z),rt(N)&&(z=-z));var ut=ht!==z;if(ut){var mt=N._getTransformedDimensions().y;N.set("skewX",z),T(N,"skewY","scaleY","y",mt)}return ut}function D(W,R,U,V){var N=R.target,q=N._getTransformedDimensions(N.skewX,0),it=lt(R,R.originX,R.originY,U,V),gt=Math.abs(it.y*2)-q.y,ht=N.skewY,z;gt<2?z=0:(z=g(Math.atan2(gt/N.scaleY,q.x/N.scaleX)),R.originX===r&&R.originY===u&&(z=-z),R.originX===a&&R.originY===i&&(z=-z),rt(N)&&(z=-z));var ut=ht!==z;if(ut){var mt=N._getTransformedDimensions().x;N.set("skewY",z),T(N,"skewX","scaleX","x",mt)}return ut}function k(W,R,U,V){var N=R.target,q=N.skewX,it,gt=R.originY;if(N.lockSkewingX)return!1;if(q===0){var ht=lt(R,s,s,U,V);ht.x>0?it=r:it=a}else q>0&&(it=gt===i?r:a),q<0&&(it=gt===i?a:r),rt(N)&&(it=it===r?a:r);R.originX=it;var z=nt("skewing",Z(E));return z(W,R,U,V)}function B(W,R,U,V){var N=R.target,q=N.skewY,it,gt=R.originX;if(N.lockSkewingY)return!1;if(q===0){var ht=lt(R,s,s,U,V);ht.y>0?it=i:it=u}else q>0&&(it=gt===r?i:u),q<0&&(it=gt===r?u:i),rt(N)&&(it=it===i?u:i);R.originY=it;var z=nt("skewing",Z(D));return z(W,R,U,V)}function O(W,R,U,V){var N=R,q=N.target,it=q.translateToOriginPoint(q.getCenterPoint(),N.originX,N.originY);if(q.lockRotation)return!1;var gt=Math.atan2(N.ey-it.y,N.ex-it.x),ht=Math.atan2(V-it.y,U-it.x),z=g(ht-gt+N.theta),ut=!0;if(q.snapAngle>0){var mt=q.snapAngle,_t=q.snapThreshold||mt,xt=Math.ceil(z/mt)*mt,wt=Math.floor(z/mt)*mt;Math.abs(z-wt)<_t?z=wt:Math.abs(z-xt)<_t&&(z=xt)}return z<0&&(z=360+z),z%=360,ut=q.angle!==z,q.angle=z,ut}function x(W,R,U,V,N){N=N||{};var q=R.target,it=q.lockScalingX,gt=q.lockScalingY,ht=N.by,z,ut,mt,_t,xt=w(W,q),wt=A(q,ht,xt),Bt,Dt,te=R.gestureScale;if(wt)return!1;if(te)ut=R.scaleX*te,mt=R.scaleY*te;else{if(z=lt(R,R.originX,R.originY,U,V),Bt=ht!=="y"?m(z.x):1,Dt=ht!=="x"?m(z.y):1,R.signX||(R.signX=Bt),R.signY||(R.signY=Dt),q.lockScalingFlip&&(R.signX!==Bt||R.signY!==Dt))return!1;if(_t=q._getTransformedDimensions(),xt&&!ht){var Ce=Math.abs(z.x)+Math.abs(z.y),zt=R.original,Cr=Math.abs(_t.x*zt.scaleX/q.scaleX)+Math.abs(_t.y*zt.scaleY/q.scaleY),Fi=Ce/Cr;ut=zt.scaleX*Fi,mt=zt.scaleY*Fi}else ut=Math.abs(z.x*q.scaleX/_t.x),mt=Math.abs(z.y*q.scaleY/_t.y);S(R)&&(ut*=2,mt*=2),R.signX!==Bt&&ht!=="y"&&(R.originX=f[R.originX],ut*=-1,R.signX=Bt),R.signY!==Dt&&ht!=="x"&&(R.originY=f[R.originY],mt*=-1,R.signY=Dt)}var wr=q.scaleX,Sr=q.scaleY;return ht?(ht==="x"&&q.set("scaleX",ut),ht==="y"&&q.set("scaleY",mt)):(!it&&q.set("scaleX",ut),!gt&&q.set("scaleY",mt)),wr!==q.scaleX||Sr!==q.scaleY}function I(W,R,U,V){return x(W,R,U,V)}function L(W,R,U,V){return x(W,R,U,V,{by:"x"})}function Y(W,R,U,V){return x(W,R,U,V,{by:"y"})}function j(W,R,U,V){return W[R.target.canvas.altActionKey]?n.skewHandlerX(W,R,U,V):n.scalingY(W,R,U,V)}function G(W,R,U,V){return W[R.target.canvas.altActionKey]?n.skewHandlerY(W,R,U,V):n.scalingX(W,R,U,V)}function M(W,R,U,V){var N=R.target,q=lt(R,R.originX,R.originY,U,V),it=N.strokeWidth/(N.strokeUniform?N.scaleX:1),gt=S(R)?2:1,ht=N.width,z=Math.abs(q.x*gt/N.scaleX)-it;return N.set("width",Math.max(z,0)),ht!==z}function et(W,R,U,V){var N=R.target,q=U-R.offsetX,it=V-R.offsetY,gt=!N.get("lockMovementX")&&N.left!==q,ht=!N.get("lockMovementY")&&N.top!==it;return gt&&N.set("left",q),ht&&N.set("top",it),(gt||ht)&&C("moving",J(W,R,U,V)),gt||ht}n.scaleCursorStyleHandler=P,n.skewCursorStyleHandler=X,n.scaleSkewCursorStyleHandler=K,n.rotationWithSnapping=nt("rotating",Z(O)),n.scalingEqually=nt("scaling",Z(I)),n.scalingX=nt("scaling",Z(L)),n.scalingY=nt("scaling",Z(Y)),n.scalingYOrSkewingX=j,n.scalingXOrSkewingY=G,n.changeWidth=nt("resizing",Z(M)),n.skewHandlerX=k,n.skewHandlerY=B,n.dragHandler=et,n.scaleOrSkewActionName=tt,n.rotationStyleHandler=H,n.fireEvent=C,n.wrapWithFixedAnchor=Z,n.wrapWithFireEvent=nt,n.getLocalPoint=lt,e.controlsUtils=n}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.util.degreesToRadians,o=e.controlsUtils;function n(i,a,u,s,f){s=s||{};var g=this.sizeX||s.cornerSize||f.cornerSize,m=this.sizeY||s.cornerSize||f.cornerSize,v=typeof s.transparentCorners<"u"?s.transparentCorners:f.transparentCorners,C=v?"stroke":"fill",w=!v&&(s.cornerStrokeColor||f.cornerStrokeColor),S=a,A=u,P;i.save(),i.fillStyle=s.cornerColor||f.cornerColor,i.strokeStyle=s.cornerStrokeColor||f.cornerStrokeColor,g>m?(P=g,i.scale(1,m/g),A=u*g/m):m>g?(P=m,i.scale(g/m,1),S=a*m/g):P=g,i.lineWidth=1,i.beginPath(),i.arc(S,A,P/2,0,2*Math.PI,!1),i[C](),w&&i.stroke(),i.restore()}function r(i,a,u,s,f){s=s||{};var g=this.sizeX||s.cornerSize||f.cornerSize,m=this.sizeY||s.cornerSize||f.cornerSize,v=typeof s.transparentCorners<"u"?s.transparentCorners:f.transparentCorners,C=v?"stroke":"fill",w=!v&&(s.cornerStrokeColor||f.cornerStrokeColor),S=g/2,A=m/2;i.save(),i.fillStyle=s.cornerColor||f.cornerColor,i.strokeStyle=s.cornerStrokeColor||f.cornerStrokeColor,i.lineWidth=1,i.translate(a,u),i.rotate(l(f.angle)),i[C+"Rect"](-S,-A,g,m),w&&i.strokeRect(-S,-A,g,m),i.restore()}o.renderCircleControl=n,o.renderSquareControl=r}(c),function(h){var e=h.fabric||(h.fabric={});function l(o){for(var n in o)this[n]=o[n]}e.Control=l,e.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(o,n){return n.cursorStyle},getActionName:function(o,n){return n.actionName},getVisibility:function(o,n){var r=o._controlsVisibility;return r&&typeof r[n]<"u"?r[n]:this.visible},setVisibility:function(o){this.visible=o},positionHandler:function(o,n){var r=e.util.transformPoint({x:this.x*o.x+this.offsetX,y:this.y*o.y+this.offsetY},n);return r},calcCornerCoords:function(o,n,r,i,a){var u,s,f,g,m=a?this.touchSizeX:this.sizeX,v=a?this.touchSizeY:this.sizeY;if(m&&v&&m!==v){var C=Math.atan2(v,m),w=Math.sqrt(m*m+v*v)/2,S=C-e.util.degreesToRadians(o),A=Math.PI/2-C-e.util.degreesToRadians(o);u=w*e.util.cos(S),s=w*e.util.sin(S),f=w*e.util.cos(A),g=w*e.util.sin(A)}else{var P=m&&v?m:n;w=P*.7071067812;var S=e.util.degreesToRadians(45-o);u=f=w*e.util.cos(S),s=g=w*e.util.sin(S)}return{tl:{x:r-g,y:i-f},tr:{x:r+u,y:i-s},bl:{x:r-u,y:i+s},br:{x:r+g,y:i+f}}},render:function(o,n,r,i,a){switch(i=i||{},i.cornerStyle||a.cornerStyle){case"circle":e.controlsUtils.renderCircleControl.call(this,o,n,r,i,a);break;default:e.controlsUtils.renderSquareControl.call(this,o,n,r,i,a)}}}}(c),function(){function h(r,i){var a=r.getAttribute("style"),u=r.getAttribute("offset")||0,s,f,g,m;if(u=parseFloat(u)/(/%$/.test(u)?100:1),u=u<0?0:u>1?1:u,a){var v=a.split(/\s*;\s*/);for(v[v.length-1]===""&&v.pop(),m=v.length;m--;){var C=v[m].split(/\s*:\s*/),w=C[0].trim(),S=C[1].trim();w==="stop-color"?s=S:w==="stop-opacity"&&(g=S)}}return s||(s=r.getAttribute("stop-color")||"rgb(0,0,0)"),g||(g=r.getAttribute("stop-opacity")),s=new t.Color(s),f=s.getAlpha(),g=isNaN(parseFloat(g))?1:parseFloat(g),g*=f*i,{offset:u,color:s.toRgb(),opacity:g}}function e(r){return{x1:r.getAttribute("x1")||0,y1:r.getAttribute("y1")||0,x2:r.getAttribute("x2")||"100%",y2:r.getAttribute("y2")||0}}function l(r){return{x1:r.getAttribute("fx")||r.getAttribute("cx")||"50%",y1:r.getAttribute("fy")||r.getAttribute("cy")||"50%",r1:0,x2:r.getAttribute("cx")||"50%",y2:r.getAttribute("cy")||"50%",r2:r.getAttribute("r")||"50%"}}var o=t.util.object.clone;t.Gradient=t.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(r){r||(r={}),r.coords||(r.coords={});var i,a=this;Object.keys(r).forEach(function(u){a[u]=r[u]}),this.id?this.id+="_"+t.Object.__uid++:this.id=t.Object.__uid++,i={x1:r.coords.x1||0,y1:r.coords.y1||0,x2:r.coords.x2||0,y2:r.coords.y2||0},this.type==="radial"&&(i.r1=r.coords.r1||0,i.r2=r.coords.r2||0),this.coords=i,this.colorStops=r.colorStops.slice()},addColorStop:function(r){for(var i in r){var a=new t.Color(r[i]);this.colorStops.push({offset:parseFloat(i),color:a.toRgb(),opacity:a.getAlpha()})}return this},toObject:function(r){var i={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return t.util.populateWithProperties(this,i,r),i},toSVG:function(r,f){var a=o(this.coords,!0),u,s,f=f||{},g,m,v=o(this.colorStops,!0),C=a.r1>a.r2,w=this.gradientTransform?this.gradientTransform.concat():t.iMatrix.concat(),S=-this.offsetX,A=-this.offsetY,P=!!f.additionalTransform,X=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(v.sort(function(Z,nt){return Z.offset-nt.offset}),X==="objectBoundingBox"?(S/=r.width,A/=r.height):(S+=r.width/2,A+=r.height/2),r.type==="path"&&this.gradientUnits!=="percentage"&&(S-=r.pathOffset.x,A-=r.pathOffset.y),w[4]-=S,w[5]-=A,m='id="SVGID_'+this.id+'" gradientUnits="'+X+'"',m+=' gradientTransform="'+(P?f.additionalTransform+" ":"")+t.util.matrixToSVG(w)+'" ',this.type==="linear"?g=["<linearGradient ",m,' x1="',a.x1,'" y1="',a.y1,'" x2="',a.x2,'" y2="',a.y2,`">
`]:this.type==="radial"&&(g=["<radialGradient ",m,' cx="',C?a.x1:a.x2,'" cy="',C?a.y1:a.y2,'" r="',C?a.r1:a.r2,'" fx="',C?a.x2:a.x1,'" fy="',C?a.y2:a.y1,`">
`]),this.type==="radial"){if(C)for(v=v.concat(),v.reverse(),u=0,s=v.length;u<s;u++)v[u].offset=1-v[u].offset;var K=Math.min(a.r1,a.r2);if(K>0){var tt=Math.max(a.r1,a.r2),H=K/tt;for(u=0,s=v.length;u<s;u++)v[u].offset+=H*(1-v[u].offset)}}for(u=0,s=v.length;u<s;u++){var J=v[u];g.push("<stop ",'offset="',J.offset*100+"%",'" style="stop-color:',J.color,typeof J.opacity<"u"?";stop-opacity: "+J.opacity:";",`"/>
`)}return g.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),g.join("")},toLive:function(r){var i,a=t.util.object.clone(this.coords),u,s;if(this.type){for(this.type==="linear"?i=r.createLinearGradient(a.x1,a.y1,a.x2,a.y2):this.type==="radial"&&(i=r.createRadialGradient(a.x1,a.y1,a.r1,a.x2,a.y2,a.r2)),u=0,s=this.colorStops.length;u<s;u++){var f=this.colorStops[u].color,g=this.colorStops[u].opacity,m=this.colorStops[u].offset;typeof g<"u"&&(f=new t.Color(f).setAlpha(g).toRgba()),i.addColorStop(m,f)}return i}}}),t.util.object.extend(t.Gradient,{fromElement:function(r,i,a,u){var s=parseFloat(a)/(/%$/.test(a)?100:1);s=s<0?0:s>1?1:s,isNaN(s)&&(s=1);var f=r.getElementsByTagName("stop"),g,m=r.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",v=r.getAttribute("gradientTransform")||"",C=[],w,S,A=0,P=0,X;for(r.nodeName==="linearGradient"||r.nodeName==="LINEARGRADIENT"?(g="linear",w=e(r)):(g="radial",w=l(r)),S=f.length;S--;)C.push(h(f[S],s));X=t.parseTransformAttribute(v),n(i,w,u,m),m==="pixels"&&(A=-i.left,P=-i.top);var K=new t.Gradient({id:r.getAttribute("id"),type:g,coords:w,colorStops:C,gradientUnits:m,gradientTransform:X,offsetX:A,offsetY:P});return K}});function n(r,i,a,u){var s,f;Object.keys(i).forEach(function(g){s=i[g],s==="Infinity"?f=1:s==="-Infinity"?f=0:(f=parseFloat(i[g],10),typeof s=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(s)&&(f*=.01,u==="pixels"&&((g==="x1"||g==="x2"||g==="r2")&&(f*=a.viewBoxWidth||a.width),(g==="y1"||g==="y2")&&(f*=a.viewBoxHeight||a.height)))),i[g]=f})}}(),function(){var h=t.util.toFixed;t.Pattern=t.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(e,l){if(e||(e={}),this.id=t.Object.__uid++,this.setOptions(e),!e.source||e.source&&typeof e.source!="string"){l&&l(this);return}else{var o=this;this.source=t.util.createImage(),t.util.loadImage(e.source,function(n,r){o.source=n,l&&l(o,r)},null,this.crossOrigin)}},toObject:function(e){var l=t.Object.NUM_FRACTION_DIGITS,o,n;return typeof this.source.src=="string"?o=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(o=this.source.toDataURL()),n={type:"pattern",source:o,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:h(this.offsetX,l),offsetY:h(this.offsetY,l),patternTransform:this.patternTransform?this.patternTransform.concat():null},t.util.populateWithProperties(this,n,e),n},toSVG:function(e){var l=typeof this.source=="function"?this.source():this.source,o=l.width/e.width,n=l.height/e.height,r=this.offsetX/e.width,i=this.offsetY/e.height,a="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(n=1,i&&(n+=Math.abs(i))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(o=1,r&&(o+=Math.abs(r))),l.src?a=l.src:l.toDataURL&&(a=l.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+r+'" y="'+i+'" width="'+o+'" height="'+n+`">
<image x="0" y="0" width="`+l.width+'" height="'+l.height+'" xlink:href="'+a+`"></image>
</pattern>
`},setOptions:function(e){for(var l in e)this[l]=e[l]},toLive:function(e){var l=this.source;return!l||typeof l.src<"u"&&(!l.complete||l.naturalWidth===0||l.naturalHeight===0)?"":e.createPattern(l,this.repeat)}})}(),function(h){var e=h.fabric||(h.fabric={}),l=e.util.toFixed;if(e.Shadow){e.warn("fabric.Shadow is already defined.");return}e.Shadow=e.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(o){typeof o=="string"&&(o=this._parseShadow(o));for(var n in o)this[n]=o[n];this.id=e.Object.__uid++},_parseShadow:function(o){var n=o.trim(),r=e.Shadow.reOffsetsAndBlur.exec(n)||[],i=n.replace(e.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:i.trim(),offsetX:parseFloat(r[1],10)||0,offsetY:parseFloat(r[2],10)||0,blur:parseFloat(r[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(o){var n=40,r=40,i=e.Object.NUM_FRACTION_DIGITS,a=e.util.rotateVector({x:this.offsetX,y:this.offsetY},e.util.degreesToRadians(-o.angle)),u=20,s=new e.Color(this.color);return o.width&&o.height&&(n=l((Math.abs(a.x)+this.blur)/o.width,i)*100+u,r=l((Math.abs(a.y)+this.blur)/o.height,i)*100+u),o.flipX&&(a.x*=-1),o.flipY&&(a.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+r+'%" height="'+(100+2*r)+'%" x="-'+n+'%" width="'+(100+2*n)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+l(this.blur?this.blur/2:0,i)+`"></feGaussianBlur>
	<feOffset dx="`+l(a.x,i)+'" dy="'+l(a.y,i)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+s.toRgb()+'" flood-opacity="'+s.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var o={},n=e.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(r){this[r]!==n[r]&&(o[r]=this[r])},this),o}}),e.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}(c),function(){if(t.StaticCanvas){t.warn("fabric.StaticCanvas is already defined.");return}var h=t.util.object.extend,e=t.util.getElementOffset,l=t.util.removeFromArray,o=t.util.toFixed,n=t.util.transformPoint,r=t.util.invertTransform,i=t.util.getNodeCanvas,a=t.util.createCanvasElement,u=new Error("Could not initialize `canvas` element");t.StaticCanvas=t.util.createClass(t.CommonMethods,{initialize:function(s,f){f||(f={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(s,f)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:t.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(s,f){var g=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(s),this._initOptions(f),this.interactive||this._initRetinaScaling(),f.overlayImage&&this.setOverlayImage(f.overlayImage,g),f.backgroundImage&&this.setBackgroundImage(f.backgroundImage,g),f.backgroundColor&&this.setBackgroundColor(f.backgroundColor,g),f.overlayColor&&this.setOverlayColor(f.overlayColor,g),this.calcOffset()},_isRetinaScaling:function(){return t.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,t.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var s=t.devicePixelRatio;this.__initRetinaScaling(s,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(s,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(s,f,g){f.setAttribute("width",this.width*s),f.setAttribute("height",this.height*s),g.scale(s,s)},calcOffset:function(){return this._offset=e(this.lowerCanvasEl),this},setOverlayImage:function(s,f,g){return this.__setBgOverlayImage("overlayImage",s,f,g)},setBackgroundImage:function(s,f,g){return this.__setBgOverlayImage("backgroundImage",s,f,g)},setOverlayColor:function(s,f){return this.__setBgOverlayColor("overlayColor",s,f)},setBackgroundColor:function(s,f){return this.__setBgOverlayColor("backgroundColor",s,f)},__setBgOverlayImage:function(s,f,g,m){return typeof f=="string"?t.util.loadImage(f,function(v,C){if(v){var w=new t.Image(v,m);this[s]=w,w.canvas=this}g&&g(v,C)},this,m&&m.crossOrigin):(m&&f.setOptions(m),this[s]=f,f&&(f.canvas=this),g&&g(f,!1)),this},__setBgOverlayColor:function(s,f,g){return this[s]=f,this._initGradient(f,s),this._initPattern(f,s,g),this},_createCanvasElement:function(){var s=a();if(!s||(s.style||(s.style={}),typeof s.getContext>"u"))throw u;return s},_initOptions:function(s){var f=this.lowerCanvasEl;this._setOptions(s),this.width=this.width||parseInt(f.width,10)||0,this.height=this.height||parseInt(f.height,10)||0,this.lowerCanvasEl.style&&(f.width=this.width,f.height=this.height,f.style.width=this.width+"px",f.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(s){s&&s.getContext?this.lowerCanvasEl=s:this.lowerCanvasEl=t.util.getById(s)||this._createCanvasElement(),t.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(s,f){return this.setDimensions({width:s},f)},setHeight:function(s,f){return this.setDimensions({height:s},f)},setDimensions:function(s,f){var g;f=f||{};for(var m in s)g=s[m],f.cssOnly||(this._setBackstoreDimension(m,s[m]),g+="px",this.hasLostContext=!0),f.backstoreOnly||this._setCssDimension(m,g);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),f.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(s,f){return this.lowerCanvasEl[s]=f,this.upperCanvasEl&&(this.upperCanvasEl[s]=f),this.cacheCanvasEl&&(this.cacheCanvasEl[s]=f),this[s]=f,this},_setCssDimension:function(s,f){return this.lowerCanvasEl.style[s]=f,this.upperCanvasEl&&(this.upperCanvasEl.style[s]=f),this.wrapperEl&&(this.wrapperEl.style[s]=f),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(s){var f=this._activeObject,g=this.backgroundImage,m=this.overlayImage,v,C,w;for(this.viewportTransform=s,C=0,w=this._objects.length;C<w;C++)v=this._objects[C],v.group||v.setCoords(!0);return f&&f.setCoords(),g&&g.setCoords(!0),m&&m.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(s,f){var g=s,m=this.viewportTransform.slice(0);s=n(s,r(this.viewportTransform)),m[0]=f,m[3]=f;var v=n(s,m);return m[4]+=g.x-v.x,m[5]+=g.y-v.y,this.setViewportTransform(m)},setZoom:function(s){return this.zoomToPoint(new t.Point(0,0),s),this},absolutePan:function(s){var f=this.viewportTransform.slice(0);return f[4]=-s.x,f[5]=-s.y,this.setViewportTransform(f)},relativePan:function(s){return this.absolutePan(new t.Point(-s.x-this.viewportTransform[4],-s.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(s){this.stateful&&s.setupState(),s._set("canvas",this),s.setCoords(),this.fire("object:added",{target:s}),s.fire("added")},_onObjectRemoved:function(s){this.fire("object:removed",{target:s}),s.fire("removed"),delete s.canvas},clearContext:function(s){return s.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var s=this.contextContainer;return this.renderCanvas(s,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=t.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var s={},f=this.width,g=this.height,m=r(this.viewportTransform);return s.tl=n({x:0,y:0},m),s.br=n({x:f,y:g},m),s.tr=new t.Point(s.br.x,s.tl.y),s.bl=new t.Point(s.tl.x,s.br.y),this.vptCoords=s,s},cancelRequestedRender:function(){this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(s,f){var g=this.viewportTransform,m=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(s),t.util.setImageSmoothing(s,this.imageSmoothingEnabled),this.fire("before:render",{ctx:s}),this._renderBackground(s),s.save(),s.transform(g[0],g[1],g[2],g[3],g[4],g[5]),this._renderObjects(s,f),s.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(s),m&&(m.canvas=this,m.shouldCache(),m._transformDone=!0,m.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(s)),this._renderOverlay(s),this.controlsAboveOverlay&&this.interactive&&this.drawControls(s),this.fire("after:render",{ctx:s})},drawClipPathOnCanvas:function(s){var f=this.viewportTransform,g=this.clipPath;s.save(),s.transform(f[0],f[1],f[2],f[3],f[4],f[5]),s.globalCompositeOperation="destination-in",g.transform(s),s.scale(1/g.zoomX,1/g.zoomY),s.drawImage(g._cacheCanvas,-g.cacheTranslationX,-g.cacheTranslationY),s.restore()},_renderObjects:function(s,f){var g,m;for(g=0,m=f.length;g<m;++g)f[g]&&f[g].render(s)},_renderBackgroundOrOverlay:function(s,f){var g=this[f+"Color"],m=this[f+"Image"],v=this.viewportTransform,C=this[f+"Vpt"];if(!(!g&&!m)){if(g){s.save(),s.beginPath(),s.moveTo(0,0),s.lineTo(this.width,0),s.lineTo(this.width,this.height),s.lineTo(0,this.height),s.closePath(),s.fillStyle=g.toLive?g.toLive(s,this):g,C&&s.transform(v[0],v[1],v[2],v[3],v[4],v[5]),s.transform(1,0,0,1,g.offsetX||0,g.offsetY||0);var w=g.gradientTransform||g.patternTransform;w&&s.transform(w[0],w[1],w[2],w[3],w[4],w[5]),s.fill(),s.restore()}m&&(s.save(),C&&s.transform(v[0],v[1],v[2],v[3],v[4],v[5]),m.render(s),s.restore())}},_renderBackground:function(s){this._renderBackgroundOrOverlay(s,"background")},_renderOverlay:function(s){this._renderBackgroundOrOverlay(s,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new t.Point(this.width/2,this.height/2)},centerObjectH:function(s){return this._centerObject(s,new t.Point(this.getCenterPoint().x,s.getCenterPoint().y))},centerObjectV:function(s){return this._centerObject(s,new t.Point(s.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(s){var f=this.getCenterPoint();return this._centerObject(s,f)},viewportCenterObject:function(s){var f=this.getVpCenter();return this._centerObject(s,f)},viewportCenterObjectH:function(s){var f=this.getVpCenter();return this._centerObject(s,new t.Point(f.x,s.getCenterPoint().y)),this},viewportCenterObjectV:function(s){var f=this.getVpCenter();return this._centerObject(s,new t.Point(s.getCenterPoint().x,f.y))},getVpCenter:function(){var s=this.getCenterPoint(),f=r(this.viewportTransform);return n(s,f)},_centerObject:function(s,f){return s.setPositionByOrigin(f,"center","center"),s.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(s){return this.toDatalessObject(s)},toObject:function(s){return this._toObjectMethod("toObject",s)},toDatalessObject:function(s){return this._toObjectMethod("toDatalessObject",s)},_toObjectMethod:function(s,f){var g=this.clipPath,m={version:t.version,objects:this._toObjects(s,f)};return g&&!g.excludeFromExport&&(m.clipPath=this._toObject(this.clipPath,s,f)),h(m,this.__serializeBgOverlay(s,f)),t.util.populateWithProperties(this,m,f),m},_toObjects:function(s,f){return this._objects.filter(function(g){return!g.excludeFromExport}).map(function(g){return this._toObject(g,s,f)},this)},_toObject:function(s,f,g){var m;this.includeDefaultValues||(m=s.includeDefaultValues,s.includeDefaultValues=!1);var v=s[f](g);return this.includeDefaultValues||(s.includeDefaultValues=m),v},__serializeBgOverlay:function(s,f){var g={},m=this.backgroundImage,v=this.overlayImage,C=this.backgroundColor,w=this.overlayColor;return C&&C.toObject?C.excludeFromExport||(g.background=C.toObject(f)):C&&(g.background=C),w&&w.toObject?w.excludeFromExport||(g.overlay=w.toObject(f)):w&&(g.overlay=w),m&&!m.excludeFromExport&&(g.backgroundImage=this._toObject(m,s,f)),v&&!v.excludeFromExport&&(g.overlayImage=this._toObject(v,s,f)),g},svgViewportTransformation:!0,toSVG:function(s,f){s||(s={}),s.reviver=f;var g=[];return this._setSVGPreamble(g,s),this._setSVGHeader(g,s),this.clipPath&&g.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(g,"background"),this._setSVGBgOverlayImage(g,"backgroundImage",f),this._setSVGObjects(g,f),this.clipPath&&g.push(`</g>
`),this._setSVGBgOverlayColor(g,"overlay"),this._setSVGBgOverlayImage(g,"overlayImage",f),g.push("</svg>"),g.join("")},_setSVGPreamble:function(s,f){f.suppressPreamble||s.push('<?xml version="1.0" encoding="',f.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(s,f){var g=f.width||this.width,m=f.height||this.height,v,C='viewBox="0 0 '+this.width+" "+this.height+'" ',w=t.Object.NUM_FRACTION_DIGITS;f.viewBox?C='viewBox="'+f.viewBox.x+" "+f.viewBox.y+" "+f.viewBox.width+" "+f.viewBox.height+'" ':this.svgViewportTransformation&&(v=this.viewportTransform,C='viewBox="'+o(-v[4]/v[0],w)+" "+o(-v[5]/v[3],w)+" "+o(this.width/v[0],w)+" "+o(this.height/v[3],w)+'" '),s.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',g,'" ','height="',m,'" ',C,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",t.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(f),`</defs>
`)},createSVGClipPathMarkup:function(s){var f=this.clipPath;return f?(f.clipPathId="CLIPPATH_"+t.Object.__uid++,'<clipPath id="'+f.clipPathId+`" >
`+this.clipPath.toClipPathSVG(s.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var s=this,f=["background","overlay"].map(function(g){var m=s[g+"Color"];if(m&&m.toLive){var v=s[g+"Vpt"],C=s.viewportTransform,w={width:s.width/(v?C[0]:1),height:s.height/(v?C[3]:1)};return m.toSVG(w,{additionalTransform:v?t.util.matrixToSVG(C):""})}});return f.join("")},createSVGFontFacesMarkup:function(){var s="",f={},g,m,v,C,w,S,A,P,X,K=t.fontPaths,tt=[];for(this._objects.forEach(function J(Z){tt.push(Z),Z._objects&&Z._objects.forEach(J)}),P=0,X=tt.length;P<X;P++)if(g=tt[P],m=g.fontFamily,!(g.type.indexOf("text")===-1||f[m]||!K[m])&&(f[m]=!0,!!g.styles)){v=g.styles;for(w in v){C=v[w];for(A in C)S=C[A],m=S.fontFamily,!f[m]&&K[m]&&(f[m]=!0)}}for(var H in f)s+=[`		@font-face {
`,"			font-family: '",H,`';
`,"			src: url('",K[H],`');
`,`		}
`].join("");return s&&(s=['	<style type="text/css">',`<![CDATA[
`,s,"]]>",`</style>
`].join("")),s},_setSVGObjects:function(s,f){var g,m,v,C=this._objects;for(m=0,v=C.length;m<v;m++)g=C[m],!g.excludeFromExport&&this._setSVGObject(s,g,f)},_setSVGObject:function(s,f,g){s.push(f.toSVG(g))},_setSVGBgOverlayImage:function(s,f,g){this[f]&&!this[f].excludeFromExport&&this[f].toSVG&&s.push(this[f].toSVG(g))},_setSVGBgOverlayColor:function(s,f){var g=this[f+"Color"],m=this.viewportTransform,v=this.width,C=this.height;if(g)if(g.toLive){var w=g.repeat,S=t.util.invertTransform(m),A=this[f+"Vpt"],P=A?t.util.matrixToSVG(S):"";s.push('<rect transform="'+P+" translate(",v/2,",",C/2,')"',' x="',g.offsetX-v/2,'" y="',g.offsetY-C/2,'" ','width="',w==="repeat-y"||w==="no-repeat"?g.source.width:v,'" height="',w==="repeat-x"||w==="no-repeat"?g.source.height:C,'" fill="url(#SVGID_'+g.id+')"',`></rect>
`)}else s.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',g,'"',`></rect>
`)},sendToBack:function(s){if(!s)return this;var f=this._activeObject,g,m,v;if(s===f&&s.type==="activeSelection")for(v=f._objects,g=v.length;g--;)m=v[g],l(this._objects,m),this._objects.unshift(m);else l(this._objects,s),this._objects.unshift(s);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(s){if(!s)return this;var f=this._activeObject,g,m,v;if(s===f&&s.type==="activeSelection")for(v=f._objects,g=0;g<v.length;g++)m=v[g],l(this._objects,m),this._objects.push(m);else l(this._objects,s),this._objects.push(s);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(s,f){if(!s)return this;var g=this._activeObject,m,v,C,w,S,A=0;if(s===g&&s.type==="activeSelection")for(S=g._objects,m=0;m<S.length;m++)v=S[m],C=this._objects.indexOf(v),C>0+A&&(w=C-1,l(this._objects,v),this._objects.splice(w,0,v)),A++;else C=this._objects.indexOf(s),C!==0&&(w=this._findNewLowerIndex(s,C,f),l(this._objects,s),this._objects.splice(w,0,s));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(s,f,g){var m,v;if(g)for(m=f,v=f-1;v>=0;--v){var C=s.intersectsWithObject(this._objects[v])||s.isContainedWithinObject(this._objects[v])||this._objects[v].isContainedWithinObject(s);if(C){m=v;break}}else m=f-1;return m},bringForward:function(s,f){if(!s)return this;var g=this._activeObject,m,v,C,w,S,A=0;if(s===g&&s.type==="activeSelection")for(S=g._objects,m=S.length;m--;)v=S[m],C=this._objects.indexOf(v),C<this._objects.length-1-A&&(w=C+1,l(this._objects,v),this._objects.splice(w,0,v)),A++;else C=this._objects.indexOf(s),C!==this._objects.length-1&&(w=this._findNewUpperIndex(s,C,f),l(this._objects,s),this._objects.splice(w,0,s));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(s,f,g){var m,v,C;if(g)for(m=f,v=f+1,C=this._objects.length;v<C;++v){var w=s.intersectsWithObject(this._objects[v])||s.isContainedWithinObject(this._objects[v])||this._objects[v].isContainedWithinObject(s);if(w){m=v;break}}else m=f+1;return m},moveTo:function(s,f){return l(this._objects,s),this._objects.splice(f,0,s),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(s){s.dispose&&s.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),t.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),t.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),h(t.StaticCanvas.prototype,t.Observable),h(t.StaticCanvas.prototype,t.Collection),h(t.StaticCanvas.prototype,t.DataURLExporter),h(t.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(s){var f=a();if(!f||!f.getContext)return null;var g=f.getContext("2d");if(!g)return null;switch(s){case"setLineDash":return typeof g.setLineDash<"u";default:return null}}}),t.StaticCanvas.prototype.toJSON=t.StaticCanvas.prototype.toObject,t.isLikelyNode&&(t.StaticCanvas.prototype.createPNGStream=function(){var s=i(this.lowerCanvasEl);return s&&s.createPNGStream()},t.StaticCanvas.prototype.createJPEGStream=function(s){var f=i(this.lowerCanvasEl);return f&&f.createJPEGStream(s)})}(),t.BaseBrush=t.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(h){h.strokeStyle=this.color,h.lineWidth=this.width,h.lineCap=this.strokeLineCap,h.miterLimit=this.strokeMiterLimit,h.lineJoin=this.strokeLineJoin,h.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(h){var e=this.canvas.viewportTransform;h.save(),h.transform(e[0],e[1],e[2],e[3],e[4],e[5])},_setShadow:function(){if(this.shadow){var h=this.canvas,e=this.shadow,l=h.contextTop,o=h.getZoom();h&&h._isRetinaScaling()&&(o*=t.devicePixelRatio),l.shadowColor=e.color,l.shadowBlur=e.blur*o,l.shadowOffsetX=e.offsetX*o,l.shadowOffsetY=e.offsetY*o}},needsFullRender:function(){var h=new t.Color(this.color);return h.getAlpha()<1||!!this.shadow},_resetShadow:function(){var h=this.canvas.contextTop;h.shadowColor="",h.shadowBlur=h.shadowOffsetX=h.shadowOffsetY=0},_isOutSideCanvas:function(h){return h.x<0||h.x>this.canvas.getWidth()||h.y<0||h.y>this.canvas.getHeight()}}),function(){t.PencilBrush=t.util.createClass(t.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(h){this.canvas=h,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(h,e,l){var o=e.midPointFrom(l);return h.quadraticCurveTo(e.x,e.y,o.x,o.y),o},onMouseDown:function(h,e){this.canvas._isMainEvent(e.e)&&(this.drawStraightLine=e.e[this.straightLineKey],this._prepareForDrawing(h),this._captureDrawingPath(h),this._render())},onMouseMove:function(h,e){if(this.canvas._isMainEvent(e.e)&&(this.drawStraightLine=e.e[this.straightLineKey],!(this.limitedToCanvasSize===!0&&this._isOutSideCanvas(h))&&this._captureDrawingPath(h)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var l=this._points,o=l.length,n=this.canvas.contextTop;this._saveAndTransform(n),this.oldEnd&&(n.beginPath(),n.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(n,l[o-2],l[o-1],!0),n.stroke(),n.restore()}},onMouseUp:function(h){return this.canvas._isMainEvent(h.e)?(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(h){var e=new t.Point(h.x,h.y);this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y)},_addPoint:function(h){return this._points.length>1&&h.eq(this._points[this._points.length-1])?!1:(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(h),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(h){var e=new t.Point(h.x,h.y);return this._addPoint(e)},_render:function(h){var e,l,o=this._points[0],n=this._points[1];if(h=h||this.canvas.contextTop,this._saveAndTransform(h),h.beginPath(),this._points.length===2&&o.x===n.x&&o.y===n.y){var r=this.width/1e3;o=new t.Point(o.x,o.y),n=new t.Point(n.x,n.y),o.x-=r,n.x+=r}for(h.moveTo(o.x,o.y),e=1,l=this._points.length;e<l;e++)this._drawSegment(h,o,n),o=this._points[e],n=this._points[e+1];h.lineTo(o.x,o.y),h.stroke(),h.restore()},convertPointsToSVGPath:function(h){var e=this.width/1e3;return t.util.getSmoothPathFromPoints(h,e)},_isEmptySVGPath:function(h){var e=t.util.joinPath(h);return e==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(h){var e=new t.Path(h,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,e.shadow=new t.Shadow(this.shadow)),e},decimatePoints:function(h,e){if(h.length<=2)return h;var l=this.canvas.getZoom(),o=Math.pow(e/l,2),n,r=h.length-1,i=h[0],a=[i],u;for(n=1;n<r-1;n++)u=Math.pow(i.x-h[n].x,2)+Math.pow(i.y-h[n].y,2),u>=o&&(i=h[n],a.push(i));return a.push(h[r]),a},_finalizeAndAddPath:function(){var h=this.canvas.contextTop;h.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var e=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(e)){this.canvas.requestRenderAll();return}var l=this.createPath(e);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:l}),this.canvas.add(l),this.canvas.requestRenderAll(),l.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:l})}})}(),t.CircleBrush=t.util.createClass(t.BaseBrush,{width:10,initialize:function(h){this.canvas=h,this.points=[]},drawDot:function(h){var e=this.addPoint(h),l=this.canvas.contextTop;this._saveAndTransform(l),this.dot(l,e),l.restore()},dot:function(h,e){h.fillStyle=e.fill,h.beginPath(),h.arc(e.x,e.y,e.radius,0,Math.PI*2,!1),h.closePath(),h.fill()},onMouseDown:function(h){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(h)},_render:function(){var h=this.canvas.contextTop,e,l,o=this.points;for(this._saveAndTransform(h),e=0,l=o.length;e<l;e++)this.dot(h,o[e]);h.restore()},onMouseMove:function(h){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(h)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(h),this._render()):this.drawDot(h))},onMouseUp:function(){var h=this.canvas.renderOnAddRemove,e,l;this.canvas.renderOnAddRemove=!1;var o=[];for(e=0,l=this.points.length;e<l;e++){var n=this.points[e],r=new t.Circle({radius:n.radius,left:n.x,top:n.y,originX:"center",originY:"center",fill:n.fill});this.shadow&&(r.shadow=new t.Shadow(this.shadow)),o.push(r)}var i=new t.Group(o);i.canvas=this.canvas,this.canvas.fire("before:path:created",{path:i}),this.canvas.add(i),this.canvas.fire("path:created",{path:i}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=h,this.canvas.requestRenderAll()},addPoint:function(h){var e=new t.Point(h.x,h.y),l=t.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,o=new t.Color(this.color).setAlpha(t.util.getRandomInt(0,100)/100).toRgba();return e.radius=l,e.fill=o,this.points.push(e),e}}),t.SprayBrush=t.util.createClass(t.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(h){this.canvas=h,this.sprayChunks=[]},onMouseDown:function(h){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(h),this.render(this.sprayChunkPoints)},onMouseMove:function(h){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(h)||(this.addSprayChunk(h),this.render(this.sprayChunkPoints))},onMouseUp:function(){var h=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],l=0,o=this.sprayChunks.length;l<o;l++)for(var n=this.sprayChunks[l],r=0,i=n.length;r<i;r++){var a=new t.Rect({width:n[r].width,height:n[r].width,left:n[r].x+1,top:n[r].y+1,originX:"center",originY:"center",fill:this.color});e.push(a)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));var u=new t.Group(e);this.shadow&&u.set("shadow",new t.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:u}),this.canvas.add(u),this.canvas.fire("path:created",{path:u}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=h,this.canvas.requestRenderAll()},_getOptimizedRects:function(h){var e={},l,o,n;for(o=0,n=h.length;o<n;o++)l=h[o].left+""+h[o].top,e[l]||(e[l]=h[o]);var r=[];for(l in e)r.push(e[l]);return r},render:function(h){var e=this.canvas.contextTop,l,o;for(e.fillStyle=this.color,this._saveAndTransform(e),l=0,o=h.length;l<o;l++){var n=h[l];typeof n.opacity<"u"&&(e.globalAlpha=n.opacity),e.fillRect(n.x,n.y,n.width,n.width)}e.restore()},_render:function(){var h=this.canvas.contextTop,e,l;for(h.fillStyle=this.color,this._saveAndTransform(h),e=0,l=this.sprayChunks.length;e<l;e++)this.render(this.sprayChunks[e]);h.restore()},addSprayChunk:function(h){this.sprayChunkPoints=[];var e,l,o,n=this.width/2,r;for(r=0;r<this.density;r++){e=t.util.getRandomInt(h.x-n,h.x+n),l=t.util.getRandomInt(h.y-n,h.y+n),this.dotWidthVariance?o=t.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):o=this.dotWidth;var i=new t.Point(e,l);i.width=o,this.randomOpacity&&(i.opacity=t.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(i)}this.sprayChunks.push(this.sprayChunkPoints)}}),t.PatternBrush=t.util.createClass(t.PencilBrush,{getPatternSrc:function(){var h=20,e=5,l=t.util.createCanvasElement(),o=l.getContext("2d");return l.width=l.height=h+e,o.fillStyle=this.color,o.beginPath(),o.arc(h/2,h/2,h/2,0,Math.PI*2,!1),o.closePath(),o.fill(),l},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(h){return h.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(h){this.callSuper("_setBrushStyles",h),h.strokeStyle=this.getPattern(h)},createPath:function(h){var e=this.callSuper("createPath",h),l=e._getLeftTopCoords().scalarAdd(e.strokeWidth/2);return e.stroke=new t.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-l.x,offsetY:-l.y}),e}}),function(){var h=t.util.getPointer,e=t.util.degreesToRadians,l=t.util.isTouchEvent;t.Canvas=t.util.createClass(t.StaticCanvas,{initialize:function(n,r){r||(r={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(n,r),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=t.PencilBrush&&new t.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var n=this.getActiveObjects(),r,i,a;if(n.length>0&&!this.preserveObjectStacking){i=[],a=[];for(var u=0,s=this._objects.length;u<s;u++)r=this._objects[u],n.indexOf(r)===-1?i.push(r):a.push(r);n.length>1&&(this._activeObject._objects=a),i.push.apply(i,a)}else i=this._objects;return i},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var n=this.contextContainer;return this.renderCanvas(n,this._chooseObjectsToRender()),this},renderTopLayer:function(n){n.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(n),this.contextTopDirty=!0),n.restore()},renderTop:function(){var n=this.contextTop;return this.clearContext(n),this.renderTopLayer(n),this.fire("after:render"),this},_normalizePointer:function(n,r){var i=n.calcTransformMatrix(),a=t.util.invertTransform(i),u=this.restorePointerVpt(r);return t.util.transformPoint(u,a)},isTargetTransparent:function(n,r,i){if(n.shouldCache()&&n._cacheCanvas&&n!==this._activeObject){var a=this._normalizePointer(n,{x:r,y:i}),u=Math.max(n.cacheTranslationX+a.x*n.zoomX,0),s=Math.max(n.cacheTranslationY+a.y*n.zoomY,0),v=t.util.isTransparent(n._cacheContext,Math.round(u),Math.round(s),this.targetFindTolerance);return v}var f=this.contextCache,g=n.selectionBackgroundColor,m=this.viewportTransform;n.selectionBackgroundColor="",this.clearContext(f),f.save(),f.transform(m[0],m[1],m[2],m[3],m[4],m[5]),n.render(f),f.restore(),n.selectionBackgroundColor=g;var v=t.util.isTransparent(f,r,i,this.targetFindTolerance);return v},_isSelectionKeyPressed:function(n){var r=!1;return Array.isArray(this.selectionKey)?r=!!this.selectionKey.find(function(i){return n[i]===!0}):r=n[this.selectionKey],r},_shouldClearSelection:function(n,r){var i=this.getActiveObjects(),a=this._activeObject;return!r||r&&a&&i.length>1&&i.indexOf(r)===-1&&a!==r&&!this._isSelectionKeyPressed(n)||r&&!r.evented||r&&!r.selectable&&a&&a!==r},_shouldCenterTransform:function(n,r,i){if(n){var a;return r==="scale"||r==="scaleX"||r==="scaleY"||r==="resizing"?a=this.centeredScaling||n.centeredScaling:r==="rotate"&&(a=this.centeredRotation||n.centeredRotation),a?!i:i}},_getOriginFromCorner:function(n,r){var i={x:n.originX,y:n.originY};return r==="ml"||r==="tl"||r==="bl"?i.x="right":(r==="mr"||r==="tr"||r==="br")&&(i.x="left"),r==="tl"||r==="mt"||r==="tr"?i.y="bottom":(r==="bl"||r==="mb"||r==="br")&&(i.y="top"),i},_getActionFromCorner:function(n,r,i,a){if(!r||!n)return"drag";var u=a.controls[r];return u.getActionName(i,u,a)},_setupCurrentTransform:function(n,r,i){if(r){var a=this.getPointer(n),u=r.__corner,s=r.controls[u],f=i&&u?s.getActionHandler(n,r,s):t.controlsUtils.dragHandler,g=this._getActionFromCorner(i,u,n,r),m=this._getOriginFromCorner(r,u),v=n[this.centeredKey],C={target:r,action:g,actionHandler:f,corner:u,scaleX:r.scaleX,scaleY:r.scaleY,skewX:r.skewX,skewY:r.skewY,offsetX:a.x-r.left,offsetY:a.y-r.top,originX:m.x,originY:m.y,ex:a.x,ey:a.y,lastX:a.x,lastY:a.y,theta:e(r.angle),width:r.width*r.scaleX,shiftKey:n.shiftKey,altKey:v,original:t.util.saveObjectTransform(r)};this._shouldCenterTransform(r,g,v)&&(C.originX="center",C.originY="center"),C.original.originX=m.x,C.original.originY=m.y,this._currentTransform=C,this._beforeTransform(n)}},setCursor:function(n){this.upperCanvasEl.style.cursor=n},_drawSelection:function(n){var r=this._groupSelector,i=new t.Point(r.ex,r.ey),a=t.util.transformPoint(i,this.viewportTransform),u=new t.Point(r.ex+r.left,r.ey+r.top),s=t.util.transformPoint(u,this.viewportTransform),f=Math.min(a.x,s.x),g=Math.min(a.y,s.y),m=Math.max(a.x,s.x),v=Math.max(a.y,s.y),C=this.selectionLineWidth/2;this.selectionColor&&(n.fillStyle=this.selectionColor,n.fillRect(f,g,m-f,v-g)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(n.lineWidth=this.selectionLineWidth,n.strokeStyle=this.selectionBorderColor,f+=C,g+=C,m-=C,v-=C,t.Object.prototype._setLineDash.call(this,n,this.selectionDashArray),n.strokeRect(f,g,m-f,v-g))},findTarget:function(n,r){if(!this.skipTargetFind){var i=!0,a=this.getPointer(n,i),u=this._activeObject,s=this.getActiveObjects(),f,g,m=l(n),v=s.length>1&&!r||s.length===1;if(this.targets=[],v&&u._findTargetCorner(a,m)||s.length>1&&!r&&u===this._searchPossibleTargets([u],a))return u;if(s.length===1&&u===this._searchPossibleTargets([u],a))if(this.preserveObjectStacking)f=u,g=this.targets,this.targets=[];else return u;var C=this._searchPossibleTargets(this._objects,a);return n[this.altSelectionKey]&&C&&f&&C!==f&&(C=f,this.targets=g),C}},_checkTarget:function(n,r,i){if(r&&r.visible&&r.evented&&r.containsPoint(n))if((this.perPixelTargetFind||r.perPixelTargetFind)&&!r.isEditing){var a=this.isTargetTransparent(r,i.x,i.y);if(!a)return!0}else return!0},_searchPossibleTargets:function(n,r){for(var i,a=n.length,u;a--;){var s=n[a],f=s.group?this._normalizePointer(s.group,r):r;if(this._checkTarget(f,s,r)){i=n[a],i.subTargetCheck&&i instanceof t.Group&&(u=this._searchPossibleTargets(i._objects,r),u&&this.targets.push(u));break}}return i},restorePointerVpt:function(n){return t.util.transformPoint(n,t.util.invertTransform(this.viewportTransform))},getPointer:function(n,r){if(this._absolutePointer&&!r)return this._absolutePointer;if(this._pointer&&r)return this._pointer;var i=h(n),a=this.upperCanvasEl,u=a.getBoundingClientRect(),s=u.width||0,f=u.height||0,g;(!s||!f)&&("top"in u&&"bottom"in u&&(f=Math.abs(u.top-u.bottom)),"right"in u&&"left"in u&&(s=Math.abs(u.right-u.left))),this.calcOffset(),i.x=i.x-this._offset.left,i.y=i.y-this._offset.top,r||(i=this.restorePointerVpt(i));var m=this.getRetinaScaling();return m!==1&&(i.x/=m,i.y/=m),s===0||f===0?g={width:1,height:1}:g={width:a.width/s,height:a.height/f},{x:i.x*g.width,y:i.y*g.height}},_createUpperCanvas:function(){var n=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),r=this.lowerCanvasEl,i=this.upperCanvasEl;i?i.className="":(i=this._createCanvasElement(),this.upperCanvasEl=i),t.util.addClass(i,"upper-canvas "+n),this.wrapperEl.appendChild(i),this._copyCanvasStyle(r,i),this._applyCanvasStyle(i),this.contextTop=i.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=t.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),t.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),t.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(n){var r=this.width||n.width,i=this.height||n.height;t.util.setStyle(n,{position:"absolute",width:r+"px",height:i+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),n.width=r,n.height=i,t.util.makeElementUnselectable(n)},_copyCanvasStyle:function(n,r){r.style.cssText=n.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var n=this._activeObject;return n?n.type==="activeSelection"&&n._objects?n._objects.slice(0):[n]:[]},_onObjectRemoved:function(n){n===this._activeObject&&(this.fire("before:selection:cleared",{target:n}),this._discardActiveObject(),this.fire("selection:cleared",{target:n}),n.fire("deselected")),n===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",n)},_fireSelectionEvents:function(n,r){var i=!1,a=this.getActiveObjects(),u=[],s=[];n.forEach(function(f){a.indexOf(f)===-1&&(i=!0,f.fire("deselected",{e:r,target:f}),s.push(f))}),a.forEach(function(f){n.indexOf(f)===-1&&(i=!0,f.fire("selected",{e:r,target:f}),u.push(f))}),n.length>0&&a.length>0?i&&this.fire("selection:updated",{e:r,selected:u,deselected:s}):a.length>0?this.fire("selection:created",{e:r,selected:u}):n.length>0&&this.fire("selection:cleared",{e:r,deselected:s})},setActiveObject:function(n,r){var i=this.getActiveObjects();return this._setActiveObject(n,r),this._fireSelectionEvents(i,r),this},_setActiveObject:function(n,r){return this._activeObject===n||!this._discardActiveObject(r,n)||n.onSelect({e:r})?!1:(this._activeObject=n,!0)},_discardActiveObject:function(n,r){var i=this._activeObject;if(i){if(i.onDeselect({e:n,object:r}))return!1;this._activeObject=null}return!0},discardActiveObject:function(n){var r=this.getActiveObjects(),i=this.getActiveObject();return r.length&&this.fire("before:selection:cleared",{target:i,e:n}),this._discardActiveObject(n),this._fireSelectionEvents(r,n),this},dispose:function(){var n=this.wrapperEl;return this.removeListeners(),n.removeChild(this.upperCanvasEl),n.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(r){t.util.cleanUpJsdomNode(this[r]),this[r]=void 0}.bind(this)),n.parentNode&&n.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,t.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(n){var r=this._activeObject;r&&r._renderControls(n)},_toObject:function(n,r,i){var a=this._realizeGroupTransformOnObject(n),u=this.callSuper("_toObject",n,r,i);return this._unwindGroupTransformOnObject(n,a),u},_realizeGroupTransformOnObject:function(n){if(n.group&&n.group.type==="activeSelection"&&this._activeObject===n.group){var r=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],i={};return r.forEach(function(a){i[a]=n[a]}),t.util.addTransformToObject(n,this._activeObject.calcOwnMatrix()),i}else return null},_unwindGroupTransformOnObject:function(n,r){r&&n.set(r)},_setSVGObject:function(n,r,i){var a=this._realizeGroupTransformOnObject(r);this.callSuper("_setSVGObject",n,r,i),this._unwindGroupTransformOnObject(r,a)},setViewportTransform:function(n){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),t.StaticCanvas.prototype.setViewportTransform.call(this,n)}});for(var o in t.StaticCanvas)o!=="prototype"&&(t.Canvas[o]=t.StaticCanvas[o])}(),function(){var h=t.util.addListener,e=t.util.removeListener,l=3,o=2,n=1,r={passive:!1};function i(a,u){return a.button&&a.button===u-1}t.util.object.extend(t.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(h,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(a,u){var s=this.upperCanvasEl,f=this._getEventPrefix();a(t.window,"resize",this._onResize),a(s,f+"down",this._onMouseDown),a(s,f+"move",this._onMouseMove,r),a(s,f+"out",this._onMouseOut),a(s,f+"enter",this._onMouseEnter),a(s,"wheel",this._onMouseWheel),a(s,"contextmenu",this._onContextMenu),a(s,"dblclick",this._onDoubleClick),a(s,"dragover",this._onDragOver),a(s,"dragenter",this._onDragEnter),a(s,"dragleave",this._onDragLeave),a(s,"drop",this._onDrop),this.enablePointerEvents||a(s,"touchstart",this._onTouchStart,r),typeof eventjs<"u"&&u in eventjs&&(eventjs[u](s,"gesture",this._onGesture),eventjs[u](s,"drag",this._onDrag),eventjs[u](s,"orientation",this._onOrientationChange),eventjs[u](s,"shake",this._onShake),eventjs[u](s,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(e,"remove");var a=this._getEventPrefix();e(t.document,a+"up",this._onMouseUp),e(t.document,"touchend",this._onTouchEnd,r),e(t.document,a+"move",this._onMouseMove,r),e(t.document,"touchmove",this._onMouseMove,r)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(a,u){this.__onTransformGesture&&this.__onTransformGesture(a,u)},_onDrag:function(a,u){this.__onDrag&&this.__onDrag(a,u)},_onMouseWheel:function(a){this.__onMouseWheel(a)},_onMouseOut:function(a){var u=this._hoveredTarget;this.fire("mouse:out",{target:u,e:a}),this._hoveredTarget=null,u&&u.fire("mouseout",{e:a});var s=this;this._hoveredTargets.forEach(function(f){s.fire("mouse:out",{target:u,e:a}),f&&u.fire("mouseout",{e:a})}),this._hoveredTargets=[]},_onMouseEnter:function(a){!this._currentTransform&&!this.findTarget(a)&&(this.fire("mouse:over",{target:null,e:a}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(a,u){this.__onOrientationChange&&this.__onOrientationChange(a,u)},_onShake:function(a,u){this.__onShake&&this.__onShake(a,u)},_onLongPress:function(a,u){this.__onLongPress&&this.__onLongPress(a,u)},_onDragOver:function(a){a.preventDefault();var u=this._simpleEventHandler("dragover",a);this._fireEnterLeaveEvents(u,a)},_onDrop:function(a){return this._simpleEventHandler("drop:before",a),this._simpleEventHandler("drop",a)},_onContextMenu:function(a){return this.stopContextMenu&&(a.stopPropagation(),a.preventDefault()),!1},_onDoubleClick:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"dblclick"),this._resetTransformEventData(a)},getPointerId:function(a){var u=a.changedTouches;return u?u[0]&&u[0].identifier:this.enablePointerEvents?a.pointerId:-1},_isMainEvent:function(a){return a.isPrimary===!0?!0:a.isPrimary===!1?!1:a.type==="touchend"&&a.touches.length===0?!0:a.changedTouches?a.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(a){a.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(a)),this.__onMouseDown(a),this._resetTransformEventData();var u=this.upperCanvasEl,s=this._getEventPrefix();h(t.document,"touchend",this._onTouchEnd,r),h(t.document,"touchmove",this._onMouseMove,r),e(u,s+"down",this._onMouseDown)},_onMouseDown:function(a){this.__onMouseDown(a),this._resetTransformEventData();var u=this.upperCanvasEl,s=this._getEventPrefix();e(u,s+"move",this._onMouseMove,r),h(t.document,s+"up",this._onMouseUp),h(t.document,s+"move",this._onMouseMove,r)},_onTouchEnd:function(a){if(!(a.touches.length>0)){this.__onMouseUp(a),this._resetTransformEventData(),this.mainTouchId=null;var u=this._getEventPrefix();e(t.document,"touchend",this._onTouchEnd,r),e(t.document,"touchmove",this._onMouseMove,r);var s=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){h(s.upperCanvasEl,u+"down",s._onMouseDown),s._willAddMouseDown=0},400)}},_onMouseUp:function(a){this.__onMouseUp(a),this._resetTransformEventData();var u=this.upperCanvasEl,s=this._getEventPrefix();this._isMainEvent(a)&&(e(t.document,s+"up",this._onMouseUp),e(t.document,s+"move",this._onMouseMove,r),h(u,s+"move",this._onMouseMove,r))},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault(),this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a){var u=this._activeObject;return!!u!=!!a||u&&a&&u!==a?!0:(u&&u.isEditing,!1)},__onMouseUp:function(a){var u,s=this._currentTransform,f=this._groupSelector,g=!1,m=!f||f.left===0&&f.top===0;if(this._cacheTransformEventData(a),u=this._target,this._handleEvent(a,"up:before"),i(a,l)){this.fireRightClick&&this._handleEvent(a,"up",l,m);return}if(i(a,o)){this.fireMiddleClick&&this._handleEvent(a,"up",o,m),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(a);return}if(this._isMainEvent(a)){if(s&&(this._finalizeCurrentTransform(a),g=s.actionPerformed),!m){var v=u===this._activeObject;this._maybeGroupObjects(a),g||(g=this._shouldRender(u)||!v&&u===this._activeObject)}var C,w;if(u){if(C=u._findTargetCorner(this.getPointer(a,!0),t.util.isTouchEvent(a)),u.selectable&&u!==this._activeObject&&u.activeOn==="up")this.setActiveObject(u,a),g=!0;else{var S=u.controls[C],A=S&&S.getMouseUpHandler(a,u,S);A&&(w=this.getPointer(a),A(a,s,w.x,w.y))}u.isMoving=!1}if(s&&(s.target!==u||s.corner!==C)){var P=s.target&&s.target.controls[s.corner],X=P&&P.getMouseUpHandler(a,u,S);w=w||this.getPointer(a),X&&X(a,s,w.x,w.y)}this._setCursorFromEvent(a,u),this._handleEvent(a,"up",n,m),this._groupSelector=null,this._currentTransform=null,u&&(u.__corner=0),g?this.requestRenderAll():m||this.renderTop()}},_simpleEventHandler:function(a,u){var s=this.findTarget(u),f=this.targets,g={e:u,target:s,subTargets:f};if(this.fire(a,g),s&&s.fire(a,g),!f)return s;for(var m=0;m<f.length;m++)f[m].fire(a,g);return s},_handleEvent:function(a,u,s,f){var g=this._target,m=this.targets||[],v={e:a,target:g,subTargets:m,button:s||n,isClick:f||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};u==="up"&&(v.currentTarget=this.findTarget(a),v.currentSubTargets=this.targets),this.fire("mouse:"+u,v),g&&g.fire("mouse"+u,v);for(var C=0;C<m.length;C++)m[C].fire("mouse"+u,v)},_finalizeCurrentTransform:function(a){var u=this._currentTransform,s=u.target,f={e:a,target:s,transform:u,action:u.action};s._scaling&&(s._scaling=!1),s.setCoords(),(u.actionPerformed||this.stateful&&s.hasStateChanged())&&this._fire("modified",f)},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(a).requestRenderAll();var u=this.getPointer(a);this.freeDrawingBrush.onMouseDown(u,{e:a,pointer:u}),this._handleEvent(a,"down")},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var u=this.getPointer(a);this.freeDrawingBrush.onMouseMove(u,{e:a,pointer:u})}this.setCursor(this.freeDrawingCursor),this._handleEvent(a,"move")},_onMouseUpInDrawingMode:function(a){var u=this.getPointer(a);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:a,pointer:u}),this._handleEvent(a,"up")},__onMouseDown:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"down:before");var u=this._target;if(i(a,l)){this.fireRightClick&&this._handleEvent(a,"down",l);return}if(i(a,o)){this.fireMiddleClick&&this._handleEvent(a,"down",o);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(a);return}if(this._isMainEvent(a)&&!this._currentTransform){var s=this._pointer;this._previousPointer=s;var f=this._shouldRender(u),g=this._shouldGroup(a,u);if(this._shouldClearSelection(a,u)?this.discardActiveObject(a):g&&(this._handleGrouping(a,u),u=this._activeObject),this.selection&&(!u||!u.selectable&&!u.isEditing&&u!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),u){var m=u===this._activeObject;u.selectable&&u.activeOn==="down"&&this.setActiveObject(u,a);var v=u._findTargetCorner(this.getPointer(a,!0),t.util.isTouchEvent(a));if(u.__corner=v,u===this._activeObject&&(v||!g)){this._setupCurrentTransform(a,u,m);var C=u.controls[v],s=this.getPointer(a),w=C&&C.getMouseDownHandler(a,u,C);w&&w(a,this._currentTransform,s.x,s.y)}}this._handleEvent(a,"down"),(f||g)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(a){this._resetTransformEventData(),this._pointer=this.getPointer(a,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(a)||null},_beforeTransform:function(a){var u=this._currentTransform;this.stateful&&u.target.saveState(),this.fire("before:transform",{e:a,transform:u})},__onMouseMove:function(a){this._handleEvent(a,"move:before"),this._cacheTransformEventData(a);var u,s;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(a);return}if(this._isMainEvent(a)){var f=this._groupSelector;f?(s=this._absolutePointer,f.left=s.x-f.ex,f.top=s.y-f.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(u=this.findTarget(a)||null,this._setCursorFromEvent(a,u),this._fireOverOutEvents(u,a)),this._handleEvent(a,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(a,u){var s=this._hoveredTarget,f=this._hoveredTargets,g=this.targets,m=Math.max(f.length,g.length);this.fireSyntheticInOutEvents(a,u,{oldTarget:s,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var v=0;v<m;v++)this.fireSyntheticInOutEvents(g[v],u,{oldTarget:f[v],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=a,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(a,u){var s=this._draggedoverTarget,f=this._hoveredTargets,g=this.targets,m=Math.max(f.length,g.length);this.fireSyntheticInOutEvents(a,u,{oldTarget:s,evtOut:"dragleave",evtIn:"dragenter"});for(var v=0;v<m;v++)this.fireSyntheticInOutEvents(g[v],u,{oldTarget:f[v],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=a},fireSyntheticInOutEvents:function(a,u,s){var f,g,m=s.oldTarget,v,C,w=m!==a,S=s.canvasEvtIn,A=s.canvasEvtOut;w&&(f={e:u,target:a,previousTarget:m},g={e:u,target:m,nextTarget:a}),C=a&&w,v=m&&w,v&&(A&&this.fire(A,g),m.fire(s.evtOut,g)),C&&(S&&this.fire(S,f),a.fire(s.evtIn,f))},__onMouseWheel:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"wheel"),this._resetTransformEventData()},_transformObject:function(a){var u=this.getPointer(a),s=this._currentTransform;s.reset=!1,s.shiftKey=a.shiftKey,s.altKey=a[this.centeredKey],this._performTransformAction(a,s,u),s.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(a,u,s){var f=s.x,g=s.y,m=u.action,v=!1,C=u.actionHandler;C&&(v=C(a,u,f,g)),m==="drag"&&v&&(u.target.isMoving=!0,this.setCursor(u.target.moveCursor||this.moveCursor)),u.actionPerformed=u.actionPerformed||v},_fire:t.controlsUtils.fireEvent,_setCursorFromEvent:function(a,u){if(!u)return this.setCursor(this.defaultCursor),!1;var s=u.hoverCursor||this.hoverCursor,f=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,g=(!f||!f.contains(u))&&u._findTargetCorner(this.getPointer(a,!0));g?this.setCursor(this.getCornerCursor(g,u,a)):(u.subTargetCheck&&this.targets.concat().reverse().map(function(m){s=m.hoverCursor||s}),this.setCursor(s))},getCornerCursor:function(a,u,s){var f=u.controls[a];return f.cursorStyleHandler(s,f,u)}})}(),function(){var h=Math.min,e=Math.max;t.util.object.extend(t.Canvas.prototype,{_shouldGroup:function(l,o){var n=this._activeObject;return n&&this._isSelectionKeyPressed(l)&&o&&o.selectable&&this.selection&&(n!==o||n.type==="activeSelection")&&!o.onSelect({e:l})},_handleGrouping:function(l,o){var n=this._activeObject;n.__corner||o===n&&(o=this.findTarget(l,!0),!o||!o.selectable)||(n&&n.type==="activeSelection"?this._updateActiveSelection(o,l):this._createActiveSelection(o,l))},_updateActiveSelection:function(l,o){var n=this._activeObject,r=n._objects.slice(0);n.contains(l)?(n.removeWithUpdate(l),this._hoveredTarget=l,this._hoveredTargets=this.targets.concat(),n.size()===1&&this._setActiveObject(n.item(0),o)):(n.addWithUpdate(l),this._hoveredTarget=n,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(r,o)},_createActiveSelection:function(l,o){var n=this.getActiveObjects(),r=this._createGroup(l);this._hoveredTarget=r,this._setActiveObject(r,o),this._fireSelectionEvents(n,o)},_createGroup:function(l){var o=this._objects,n=o.indexOf(this._activeObject)<o.indexOf(l),r=n?[this._activeObject,l]:[l,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new t.ActiveSelection(r,{canvas:this})},_groupSelectedObjects:function(l){var o=this._collectObjects(l),n;o.length===1?this.setActiveObject(o[0],l):o.length>1&&(n=new t.ActiveSelection(o.reverse(),{canvas:this}),this.setActiveObject(n,l))},_collectObjects:function(l){for(var o=[],n,r=this._groupSelector.ex,i=this._groupSelector.ey,a=r+this._groupSelector.left,u=i+this._groupSelector.top,s=new t.Point(h(r,a),h(i,u)),f=new t.Point(e(r,a),e(i,u)),g=!this.selectionFullyContained,m=r===a&&i===u,v=this._objects.length;v--&&(n=this._objects[v],!(!(!n||!n.selectable||!n.visible)&&(g&&n.intersectsWithRect(s,f,!0)||n.isContainedWithinRect(s,f,!0)||g&&n.containsPoint(s,null,!0)||g&&n.containsPoint(f,null,!0))&&(o.push(n),m))););return o.length>1&&(o=o.filter(function(C){return!C.onSelect({e:l})})),o},_maybeGroupObjects:function(l){this.selection&&this._groupSelector&&this._groupSelectedObjects(l),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){t.util.object.extend(t.StaticCanvas.prototype,{toDataURL:function(h){h||(h={});var e=h.format||"png",l=h.quality||1,o=(h.multiplier||1)*(h.enableRetinaScaling?this.getRetinaScaling():1),n=this.toCanvasElement(o,h);return t.util.toDataURL(n,e,l)},toCanvasElement:function(h,e){h=h||1,e=e||{};var l=(e.width||this.width)*h,o=(e.height||this.height)*h,n=this.getZoom(),r=this.width,i=this.height,a=n*h,u=this.viewportTransform,s=(u[4]-(e.left||0))*h,f=(u[5]-(e.top||0))*h,g=this.interactive,m=[a,0,0,a,s,f],v=this.enableRetinaScaling,C=t.util.createCanvasElement(),w=this.contextTop;return C.width=l,C.height=o,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=m,this.width=l,this.height=o,this.calcViewportBoundaries(),this.renderCanvas(C.getContext("2d"),this._objects),this.viewportTransform=u,this.width=r,this.height=i,this.calcViewportBoundaries(),this.interactive=g,this.enableRetinaScaling=v,this.contextTop=w,C}})}(),t.util.object.extend(t.StaticCanvas.prototype,{loadFromJSON:function(h,e,l){if(h){var o=typeof h=="string"?JSON.parse(h):t.util.object.clone(h),n=this,r=o.clipPath,i=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete o.clipPath,this._enlivenObjects(o.objects,function(a){n.clear(),n._setBgOverlay(o,function(){r?n._enlivenObjects([r],function(u){n.clipPath=u[0],n.__setupCanvas.call(n,o,a,i,e)}):n.__setupCanvas.call(n,o,a,i,e)})},l),this}},__setupCanvas:function(h,e,l,o){var n=this;e.forEach(function(r,i){n.insertAt(r,i)}),this.renderOnAddRemove=l,delete h.objects,delete h.backgroundImage,delete h.overlayImage,delete h.background,delete h.overlay,this._setOptions(h),this.renderAll(),o&&o()},_setBgOverlay:function(h,e){var l={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!h.backgroundImage&&!h.overlayImage&&!h.background&&!h.overlay){e&&e();return}var o=function(){l.backgroundImage&&l.overlayImage&&l.backgroundColor&&l.overlayColor&&e&&e()};this.__setBgOverlay("backgroundImage",h.backgroundImage,l,o),this.__setBgOverlay("overlayImage",h.overlayImage,l,o),this.__setBgOverlay("backgroundColor",h.background,l,o),this.__setBgOverlay("overlayColor",h.overlay,l,o)},__setBgOverlay:function(h,e,l,o){var n=this;if(!e){l[h]=!0,o&&o();return}h==="backgroundImage"||h==="overlayImage"?t.util.enlivenObjects([e],function(r){n[h]=r[0],l[h]=!0,o&&o()}):this["set"+t.util.string.capitalize(h,!0)](e,function(){l[h]=!0,o&&o()})},_enlivenObjects:function(h,e,l){if(!h||h.length===0){e&&e([]);return}t.util.enlivenObjects(h,function(o){e&&e(o)},null,l)},_toDataURL:function(h,e){this.clone(function(l){e(l.toDataURL(h))})},_toDataURLWithMultiplier:function(h,e,l){this.clone(function(o){l(o.toDataURLWithMultiplier(h,e))})},clone:function(h,e){var l=JSON.stringify(this.toJSON(e));this.cloneWithoutData(function(o){o.loadFromJSON(l,function(){h&&h(o)})})},cloneWithoutData:function(h){var e=t.util.createCanvasElement();e.width=this.width,e.height=this.height;var l=new t.Canvas(e);this.backgroundImage?(l.setBackgroundImage(this.backgroundImage.src,function(){l.renderAll(),h&&h(l)}),l.backgroundImageOpacity=this.backgroundImageOpacity,l.backgroundImageStretch=this.backgroundImageStretch):h&&h(l)}}),function(h){var e=h.fabric||(h.fabric={}),l=e.util.object.extend,o=e.util.object.clone,n=e.util.toFixed,r=e.util.string.capitalize,i=e.util.degreesToRadians,a=!e.isLikelyNode,u=2;e.Object||(e.Object=e.util.createClass(e.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:a,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(s){s&&this.setOptions(s)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=e.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(s){var f=e.perfLimitSizeTotal,g=s.width,m=s.height,v=e.maxCacheSideLimit,C=e.minCacheSideLimit;if(g<=v&&m<=v&&g*m<=f)return g<C&&(s.width=C),m<C&&(s.height=C),s;var w=g/m,S=e.util.limitDimsByArea(w,f),A=e.util.capValue,P=A(C,S.x,v),X=A(C,S.y,v);return g>P&&(s.zoomX/=g/P,s.width=P,s.capped=!0),m>X&&(s.zoomY/=m/X,s.height=X,s.capped=!0),s},_getCacheCanvasDimensions:function(){var s=this.getTotalObjectScaling(),f=this._getTransformedDimensions(0,0),g=f.x*s.scaleX/this.scaleX,m=f.y*s.scaleY/this.scaleY;return{width:g+u,height:m+u,zoomX:s.scaleX,zoomY:s.scaleY,x:g,y:m}},_updateCacheCanvas:function(){var s=this.canvas;if(this.noScaleCache&&s&&s._currentTransform){var f=s._currentTransform.target,g=s._currentTransform.action;if(this===f&&g.slice&&g.slice(0,5)==="scale")return!1}var m=this._cacheCanvas,v=this._limitCacheSize(this._getCacheCanvasDimensions()),C=e.minCacheSideLimit,w=v.width,S=v.height,A,P,X=v.zoomX,K=v.zoomY,tt=w!==this.cacheWidth||S!==this.cacheHeight,H=this.zoomX!==X||this.zoomY!==K,J=tt||H,Z=0,nt=0,lt=!1;if(tt){var rt=this._cacheCanvas.width,T=this._cacheCanvas.height,E=w>rt||S>T,D=(w<rt*.9||S<T*.9)&&rt>C&&T>C;lt=E||D,E&&!v.capped&&(w>C||S>C)&&(Z=w*.1,nt=S*.1)}return this instanceof e.Text&&this.path&&(J=!0,lt=!0,Z+=this.getHeightOfLine(0)*this.zoomX,nt+=this.getHeightOfLine(0)*this.zoomY),J?(lt?(m.width=Math.ceil(w+Z),m.height=Math.ceil(S+nt)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,m.width,m.height)),A=v.x/2,P=v.y/2,this.cacheTranslationX=Math.round(m.width/2-A)+A,this.cacheTranslationY=Math.round(m.height/2-P)+P,this.cacheWidth=w,this.cacheHeight=S,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(X,K),this.zoomX=X,this.zoomY=K,!0):!1},setOptions:function(s){this._setOptions(s),this._initGradient(s.fill,"fill"),this._initGradient(s.stroke,"stroke"),this._initPattern(s.fill,"fill"),this._initPattern(s.stroke,"stroke")},transform:function(s){var f=this.group&&!this.group._transformDone||this.group&&this.canvas&&s===this.canvas.contextTop,g=this.calcTransformMatrix(!f);s.transform(g[0],g[1],g[2],g[3],g[4],g[5])},toObject:function(s){var f=e.Object.NUM_FRACTION_DIGITS,g={type:this.type,version:e.version,originX:this.originX,originY:this.originY,left:n(this.left,f),top:n(this.top,f),width:n(this.width,f),height:n(this.height,f),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:n(this.strokeWidth,f),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:n(this.strokeMiterLimit,f),scaleX:n(this.scaleX,f),scaleY:n(this.scaleY,f),angle:n(this.angle,f),flipX:this.flipX,flipY:this.flipY,opacity:n(this.opacity,f),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:n(this.skewX,f),skewY:n(this.skewY,f)};return this.clipPath&&!this.clipPath.excludeFromExport&&(g.clipPath=this.clipPath.toObject(s),g.clipPath.inverted=this.clipPath.inverted,g.clipPath.absolutePositioned=this.clipPath.absolutePositioned),e.util.populateWithProperties(this,g,s),this.includeDefaultValues||(g=this._removeDefaultValues(g)),g},toDatalessObject:function(s){return this.toObject(s)},_removeDefaultValues:function(s){var f=e.util.getKlass(s.type).prototype,g=f.stateProperties;return g.forEach(function(m){m==="left"||m==="top"||(s[m]===f[m]&&delete s[m],Array.isArray(s[m])&&Array.isArray(f[m])&&s[m].length===0&&f[m].length===0&&delete s[m])}),s},toString:function(){return"#<fabric."+r(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var s=e.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(s.scaleX),scaleY:Math.abs(s.scaleY)}},getTotalObjectScaling:function(){var s=this.getObjectScaling(),f=s.scaleX,g=s.scaleY;if(this.canvas){var m=this.canvas.getZoom(),v=this.canvas.getRetinaScaling();f*=m*v,g*=m*v}return{scaleX:f,scaleY:g}},getObjectOpacity:function(){var s=this.opacity;return this.group&&(s*=this.group.getObjectOpacity()),s},_set:function(s,f){var g=s==="scaleX"||s==="scaleY",m=this[s]!==f,v=!1;return g&&(f=this._constrainScale(f)),s==="scaleX"&&f<0?(this.flipX=!this.flipX,f*=-1):s==="scaleY"&&f<0?(this.flipY=!this.flipY,f*=-1):s==="shadow"&&f&&!(f instanceof e.Shadow)?f=new e.Shadow(f):s==="dirty"&&this.group&&this.group.set("dirty",f),this[s]=f,m&&(v=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(s)>-1?(this.dirty=!0,v&&this.group.set("dirty",!0)):v&&this.stateProperties.indexOf(s)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:e.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(s){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(s.save(),this._setupCompositeOperation(s),this.drawSelectionBackground(s),this.transform(s),this._setOpacity(s),this._setShadow(s,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(s)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(s),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),s.restore())},renderCache:function(s){s=s||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,s.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(s,f){if(s.save(),f.inverted?s.globalCompositeOperation="destination-out":s.globalCompositeOperation="destination-in",f.absolutePositioned){var g=e.util.invertTransform(this.calcTransformMatrix());s.transform(g[0],g[1],g[2],g[3],g[4],g[5])}f.transform(s),s.scale(1/f.zoomX,1/f.zoomY),s.drawImage(f._cacheCanvas,-f.cacheTranslationX,-f.cacheTranslationY),s.restore()},drawObject:function(s,f){var g=this.fill,m=this.stroke;f?(this.fill="black",this.stroke="",this._setClippingProperties(s)):this._renderBackground(s),this._render(s),this._drawClipPath(s,this.clipPath),this.fill=g,this.stroke=m},_drawClipPath:function(s,f){f&&(f.canvas=this.canvas,f.shouldCache(),f._transformDone=!0,f.renderCache({forClipping:!0}),this.drawClipPathOnCache(s,f))},drawCacheOnCanvas:function(s){s.scale(1/this.zoomX,1/this.zoomY),s.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(s){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!s&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!s){var f=this.cacheWidth/this.zoomX,g=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-f/2,-g/2,f,g)}return!0}return!1},_renderBackground:function(s){if(this.backgroundColor){var f=this._getNonTransformedDimensions();s.fillStyle=this.backgroundColor,s.fillRect(-f.x/2,-f.y/2,f.x,f.y),this._removeShadow(s)}},_setOpacity:function(s){this.group&&!this.group._transformDone?s.globalAlpha=this.getObjectOpacity():s.globalAlpha*=this.opacity},_setStrokeStyles:function(s,f){var g=f.stroke;g&&(s.lineWidth=f.strokeWidth,s.lineCap=f.strokeLineCap,s.lineDashOffset=f.strokeDashOffset,s.lineJoin=f.strokeLineJoin,s.miterLimit=f.strokeMiterLimit,g.toLive?g.gradientUnits==="percentage"||g.gradientTransform||g.patternTransform?this._applyPatternForTransformedGradient(s,g):(s.strokeStyle=g.toLive(s,this),this._applyPatternGradientTransform(s,g)):s.strokeStyle=f.stroke)},_setFillStyles:function(s,f){var g=f.fill;g&&(g.toLive?(s.fillStyle=g.toLive(s,this),this._applyPatternGradientTransform(s,f.fill)):s.fillStyle=g)},_setClippingProperties:function(s){s.globalAlpha=1,s.strokeStyle="transparent",s.fillStyle="#000000"},_setLineDash:function(s,f){!f||f.length===0||(1&f.length&&f.push.apply(f,f),s.setLineDash(f))},_renderControls:function(s,f){var g=this.getViewportTransform(),m=this.calcTransformMatrix(),v,C,w;f=f||{},C=typeof f.hasBorders<"u"?f.hasBorders:this.hasBorders,w=typeof f.hasControls<"u"?f.hasControls:this.hasControls,m=e.util.multiplyTransformMatrices(g,m),v=e.util.qrDecompose(m),s.save(),s.translate(v.translateX,v.translateY),s.lineWidth=1*this.borderScaleFactor,this.group||(s.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(v.angle-=180),s.rotate(i(this.group?v.angle:this.angle)),f.forActiveSelection||this.group?C&&this.drawBordersInGroup(s,v,f):C&&this.drawBorders(s,f),w&&this.drawControls(s,f),s.restore()},_setShadow:function(s){if(this.shadow){var f=this.shadow,g=this.canvas,m,v=g&&g.viewportTransform[0]||1,C=g&&g.viewportTransform[3]||1;f.nonScaling?m={scaleX:1,scaleY:1}:m=this.getObjectScaling(),g&&g._isRetinaScaling()&&(v*=e.devicePixelRatio,C*=e.devicePixelRatio),s.shadowColor=f.color,s.shadowBlur=f.blur*e.browserShadowBlurConstant*(v+C)*(m.scaleX+m.scaleY)/4,s.shadowOffsetX=f.offsetX*v*m.scaleX,s.shadowOffsetY=f.offsetY*C*m.scaleY}},_removeShadow:function(s){this.shadow&&(s.shadowColor="",s.shadowBlur=s.shadowOffsetX=s.shadowOffsetY=0)},_applyPatternGradientTransform:function(s,f){if(!f||!f.toLive)return{offsetX:0,offsetY:0};var g=f.gradientTransform||f.patternTransform,m=-this.width/2+f.offsetX||0,v=-this.height/2+f.offsetY||0;return f.gradientUnits==="percentage"?s.transform(this.width,0,0,this.height,m,v):s.transform(1,0,0,1,m,v),g&&s.transform(g[0],g[1],g[2],g[3],g[4],g[5]),{offsetX:m,offsetY:v}},_renderPaintInOrder:function(s){this.paintFirst==="stroke"?(this._renderStroke(s),this._renderFill(s)):(this._renderFill(s),this._renderStroke(s))},_render:function(){},_renderFill:function(s){this.fill&&(s.save(),this._setFillStyles(s,this),this.fillRule==="evenodd"?s.fill("evenodd"):s.fill(),s.restore())},_renderStroke:function(s){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(s),s.save(),this.strokeUniform&&this.group){var f=this.getObjectScaling();s.scale(1/f.scaleX,1/f.scaleY)}else this.strokeUniform&&s.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(s,this.strokeDashArray),this._setStrokeStyles(s,this),s.stroke(),s.restore()}},_applyPatternForTransformedGradient:function(s,f){var g=this._limitCacheSize(this._getCacheCanvasDimensions()),m=e.util.createCanvasElement(),v,C=this.canvas.getRetinaScaling(),w=g.x/this.scaleX/C,S=g.y/this.scaleY/C;m.width=w,m.height=S,v=m.getContext("2d"),v.beginPath(),v.moveTo(0,0),v.lineTo(w,0),v.lineTo(w,S),v.lineTo(0,S),v.closePath(),v.translate(w/2,S/2),v.scale(g.zoomX/this.scaleX/C,g.zoomY/this.scaleY/C),this._applyPatternGradientTransform(v,f),v.fillStyle=f.toLive(s),v.fill(),s.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),s.scale(C*this.scaleX/g.zoomX,C*this.scaleY/g.zoomY),s.strokeStyle=v.createPattern(m,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var s=e.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",s.scaleX),this.set("scaleY",s.scaleY),this.angle=s.angle,this.skewX=s.skewX,this.skewY=0}},_removeTransformMatrix:function(s){var f=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),f=e.util.transformPoint(f,this.transformMatrix)),this.transformMatrix=null,s&&(this.scaleX*=s.scaleX,this.scaleY*=s.scaleY,this.cropX=s.cropX,this.cropY=s.cropY,f.x+=s.offsetLeft,f.y+=s.offsetTop,this.width=s.width,this.height=s.height),this.setPositionByOrigin(f,"center","center")},clone:function(s,f){var g=this.toObject(f);this.constructor.fromObject?this.constructor.fromObject(g,s):e.Object._fromObject("Object",g,s)},cloneAsImage:function(s,f){var g=this.toCanvasElement(f);return s&&s(new e.Image(g)),this},toCanvasElement:function(s){s||(s={});var f=e.util,g=f.saveObjectTransform(this),m=this.group,v=this.shadow,C=Math.abs,w=(s.multiplier||1)*(s.enableRetinaScaling?e.devicePixelRatio:1);delete this.group,s.withoutTransform&&f.resetObjectTransform(this),s.withoutShadow&&(this.shadow=null);var S=e.util.createCanvasElement(),A=this.getBoundingRect(!0,!0),P=this.shadow,X,K={x:0,y:0},tt,H,J;P&&(tt=P.blur,P.nonScaling?X={scaleX:1,scaleY:1}:X=this.getObjectScaling(),K.x=2*Math.round(C(P.offsetX)+tt)*C(X.scaleX),K.y=2*Math.round(C(P.offsetY)+tt)*C(X.scaleY)),H=A.width+K.x,J=A.height+K.y,S.width=Math.ceil(H),S.height=Math.ceil(J);var Z=new e.StaticCanvas(S,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});s.format==="jpeg"&&(Z.backgroundColor="#fff"),this.setPositionByOrigin(new e.Point(Z.width/2,Z.height/2),"center","center");var nt=this.canvas;Z.add(this);var lt=Z.toCanvasElement(w||1,s);return this.shadow=v,this.set("canvas",nt),m&&(this.group=m),this.set(g).setCoords(),Z._objects=[],Z.dispose(),Z=null,lt},toDataURL:function(s){return s||(s={}),e.util.toDataURL(this.toCanvasElement(s),s.format||"png",s.quality||1)},isType:function(s){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===s},complexity:function(){return 1},toJSON:function(s){return this.toObject(s)},rotate:function(s){var f=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return f&&this._setOriginToCenter(),this.set("angle",s),f&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(s,f){f=f||this.canvas.getPointer(s);var g=new e.Point(f.x,f.y),m=this._getLeftTopCoords();return this.angle&&(g=e.util.rotatePoint(g,m,i(-this.angle))),{x:g.x-m.x,y:g.y-m.y}},_setupCompositeOperation:function(s){this.globalCompositeOperation&&(s.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){e.runningAnimations&&e.runningAnimations.cancelByTarget(this)}}),e.util.createAccessors&&e.util.createAccessors(e.Object),l(e.Object.prototype,e.Observable),e.Object.NUM_FRACTION_DIGITS=2,e.Object.ENLIVEN_PROPS=["clipPath"],e.Object._fromObject=function(s,f,g,m){var v=e[s];f=o(f,!0),e.util.enlivenPatterns([f.fill,f.stroke],function(C){typeof C[0]<"u"&&(f.fill=C[0]),typeof C[1]<"u"&&(f.stroke=C[1]),e.util.enlivenObjectEnlivables(f,f,function(){var w=m?new v(f[m],f):new v(f);g&&g(w)})})},e.Object.__uid=0)}(c),function(){var h=t.util.degreesToRadians,e={left:-.5,center:0,right:.5},l={top:-.5,center:0,bottom:.5};t.util.object.extend(t.Object.prototype,{translateToGivenOrigin:function(o,n,r,i,a){var u=o.x,s=o.y,f,g,m;return typeof n=="string"?n=e[n]:n-=.5,typeof i=="string"?i=e[i]:i-=.5,f=i-n,typeof r=="string"?r=l[r]:r-=.5,typeof a=="string"?a=l[a]:a-=.5,g=a-r,(f||g)&&(m=this._getTransformedDimensions(),u=o.x+f*m.x,s=o.y+g*m.y),new t.Point(u,s)},translateToCenterPoint:function(o,n,r){var i=this.translateToGivenOrigin(o,n,r,"center","center");return this.angle?t.util.rotatePoint(i,o,h(this.angle)):i},translateToOriginPoint:function(o,n,r){var i=this.translateToGivenOrigin(o,"center","center",n,r);return this.angle?t.util.rotatePoint(i,o,h(this.angle)):i},getCenterPoint:function(){var o=new t.Point(this.left,this.top);return this.translateToCenterPoint(o,this.originX,this.originY)},getPointByOrigin:function(o,n){var r=this.getCenterPoint();return this.translateToOriginPoint(r,o,n)},toLocalPoint:function(o,n,r){var i=this.getCenterPoint(),a,u;return typeof n<"u"&&typeof r<"u"?a=this.translateToGivenOrigin(i,"center","center",n,r):a=new t.Point(this.left,this.top),u=new t.Point(o.x,o.y),this.angle&&(u=t.util.rotatePoint(u,i,-h(this.angle))),u.subtractEquals(a)},setPositionByOrigin:function(o,n,r){var i=this.translateToCenterPoint(o,n,r),a=this.translateToOriginPoint(i,this.originX,this.originY);this.set("left",a.x),this.set("top",a.y)},adjustPosition:function(o){var n=h(this.angle),r=this.getScaledWidth(),i=t.util.cos(n)*r,a=t.util.sin(n)*r,u,s;typeof this.originX=="string"?u=e[this.originX]:u=this.originX-.5,typeof o=="string"?s=e[o]:s=o-.5,this.left+=i*(s-u),this.top+=a*(s-u),this.setCoords(),this.originX=o},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var o=this.getCenterPoint();this.originX="center",this.originY="center",this.left=o.x,this.top=o.y},_resetOrigin:function(){var o=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=o.x,this.top=o.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function h(r){return[new t.Point(r.tl.x,r.tl.y),new t.Point(r.tr.x,r.tr.y),new t.Point(r.br.x,r.br.y),new t.Point(r.bl.x,r.bl.y)]}var e=t.util,l=e.degreesToRadians,o=e.multiplyTransformMatrices,n=e.transformPoint;e.object.extend(t.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(r,i){return i?r?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),r?this.aCoords:this.lineCoords)},getCoords:function(r,i){return h(this._getCoords(r,i))},intersectsWithRect:function(r,i,a,u){var s=this.getCoords(a,u),f=t.Intersection.intersectPolygonRectangle(s,r,i);return f.status==="Intersection"},intersectsWithObject:function(r,i,a){var u=t.Intersection.intersectPolygonPolygon(this.getCoords(i,a),r.getCoords(i,a));return u.status==="Intersection"||r.isContainedWithinObject(this,i,a)||this.isContainedWithinObject(r,i,a)},isContainedWithinObject:function(r,i,a){for(var u=this.getCoords(i,a),s=i?r.aCoords:r.lineCoords,f=0,g=r._getImageLines(s);f<4;f++)if(!r.containsPoint(u[f],g))return!1;return!0},isContainedWithinRect:function(r,i,a,u){var s=this.getBoundingRect(a,u);return s.left>=r.x&&s.left+s.width<=i.x&&s.top>=r.y&&s.top+s.height<=i.y},containsPoint:function(r,f,a,u){var s=this._getCoords(a,u),f=f||this._getImageLines(s),g=this._findCrossPoints(r,f);return g!==0&&g%2===1},isOnScreen:function(r){if(!this.canvas)return!1;var i=this.canvas.vptCoords.tl,a=this.canvas.vptCoords.br,u=this.getCoords(!0,r);return u.some(function(s){return s.x<=a.x&&s.x>=i.x&&s.y<=a.y&&s.y>=i.y})||this.intersectsWithRect(i,a,!0,r)?!0:this._containsCenterOfCanvas(i,a,r)},_containsCenterOfCanvas:function(r,i,a){var u={x:(r.x+i.x)/2,y:(r.y+i.y)/2};return!!this.containsPoint(u,null,!0,a)},isPartiallyOnScreen:function(r){if(!this.canvas)return!1;var i=this.canvas.vptCoords.tl,a=this.canvas.vptCoords.br;if(this.intersectsWithRect(i,a,!0,r))return!0;var u=this.getCoords(!0,r).every(function(s){return(s.x>=a.x||s.x<=i.x)&&(s.y>=a.y||s.y<=i.y)});return u&&this._containsCenterOfCanvas(i,a,r)},_getImageLines:function(r){var i={topline:{o:r.tl,d:r.tr},rightline:{o:r.tr,d:r.br},bottomline:{o:r.br,d:r.bl},leftline:{o:r.bl,d:r.tl}};return i},_findCrossPoints:function(r,i){var a,u,s,f,g,m=0,v;for(var C in i)if(v=i[C],!(v.o.y<r.y&&v.d.y<r.y)&&!(v.o.y>=r.y&&v.d.y>=r.y)&&(v.o.x===v.d.x&&v.o.x>=r.x?g=v.o.x:(a=0,u=(v.d.y-v.o.y)/(v.d.x-v.o.x),s=r.y-a*r.x,f=v.o.y-u*v.o.x,g=-(s-f)/(a-u)),g>=r.x&&(m+=1),m===2))break;return m},getBoundingRect:function(r,i){var a=this.getCoords(r,i);return e.makeBoundingBoxFromPoints(a)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(r){return Math.abs(r)<this.minScaleLimit?r<0?-this.minScaleLimit:this.minScaleLimit:r===0?1e-4:r},scale:function(r){return this._set("scaleX",r),this._set("scaleY",r),this.setCoords()},scaleToWidth:function(r,i){var a=this.getBoundingRect(i).width/this.getScaledWidth();return this.scale(r/this.width/a)},scaleToHeight:function(r,i){var a=this.getBoundingRect(i).height/this.getScaledHeight();return this.scale(r/this.height/a)},calcLineCoords:function(){var r=this.getViewportTransform(),i=this.padding,a=l(this.angle),u=e.cos(a),s=e.sin(a),f=u*i,g=s*i,m=f+g,v=f-g,C=this.calcACoords(),w={tl:n(C.tl,r),tr:n(C.tr,r),bl:n(C.bl,r),br:n(C.br,r)};return i&&(w.tl.x-=v,w.tl.y-=m,w.tr.x+=m,w.tr.y-=v,w.bl.x-=m,w.bl.y+=v,w.br.x+=v,w.br.y+=m),w},calcOCoords:function(){var r=this._calcRotateMatrix(),i=this._calcTranslateMatrix(),a=this.getViewportTransform(),u=o(a,i),s=o(u,r),s=o(s,[1/a[0],0,0,1/a[3],0,0]),f=this._calculateCurrentDimensions(),g={};return this.forEachControl(function(m,v,C){g[v]=m.positionHandler(f,s,C)}),g},calcACoords:function(){var r=this._calcRotateMatrix(),i=this._calcTranslateMatrix(),a=o(i,r),u=this._getTransformedDimensions(),s=u.x/2,f=u.y/2;return{tl:n({x:-s,y:-f},a),tr:n({x:s,y:-f},a),bl:n({x:-s,y:f},a),br:n({x:s,y:f},a)}},setCoords:function(r){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),r?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return e.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var r=this.getCenterPoint();return[1,0,0,1,r.x,r.y]},transformMatrixKey:function(r){var i="_",a="";return!r&&this.group&&(a=this.group.transformMatrixKey(r)+i),a+this.top+i+this.left+i+this.scaleX+i+this.scaleY+i+this.skewX+i+this.skewY+i+this.angle+i+this.originX+i+this.originY+i+this.width+i+this.height+i+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(r){var i=this.calcOwnMatrix();if(r||!this.group)return i;var a=this.transformMatrixKey(r),u=this.matrixCache||(this.matrixCache={});return u.key===a?u.value:(this.group&&(i=o(this.group.calcTransformMatrix(!1),i)),u.key=a,u.value=i,i)},calcOwnMatrix:function(){var r=this.transformMatrixKey(!0),i=this.ownMatrixCache||(this.ownMatrixCache={});if(i.key===r)return i.value;var a=this._calcTranslateMatrix(),u={angle:this.angle,translateX:a[4],translateY:a[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return i.key=r,i.value=e.composeMatrix(u),i.value},_getNonTransformedDimensions:function(){var r=this.strokeWidth,i=this.width+r,a=this.height+r;return{x:i,y:a}},_getTransformedDimensions:function(r,i){typeof r>"u"&&(r=this.skewX),typeof i>"u"&&(i=this.skewY);var a,u,s,f=r===0&&i===0;if(this.strokeUniform?(u=this.width,s=this.height):(a=this._getNonTransformedDimensions(),u=a.x,s=a.y),f)return this._finalizeDimensions(u*this.scaleX,s*this.scaleY);var g=e.sizeAfterTransform(u,s,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:r,skewY:i});return this._finalizeDimensions(g.x,g.y)},_finalizeDimensions:function(r,i){return this.strokeUniform?{x:r+this.strokeWidth,y:i+this.strokeWidth}:{x:r,y:i}},_calculateCurrentDimensions:function(){var r=this.getViewportTransform(),i=this._getTransformedDimensions(),a=n(i,r,!0);return a.scalarAdd(2*this.padding)}})}(),t.util.object.extend(t.Object.prototype,{sendToBack:function(){return this.group?t.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?t.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(h){return this.group?t.StaticCanvas.prototype.sendBackwards.call(this.group,this,h):this.canvas&&this.canvas.sendBackwards(this,h),this},bringForward:function(h){return this.group?t.StaticCanvas.prototype.bringForward.call(this.group,this,h):this.canvas&&this.canvas.bringForward(this,h),this},moveTo:function(h){return this.group&&this.group.type!=="activeSelection"?t.StaticCanvas.prototype.moveTo.call(this.group,this,h):this.canvas&&this.canvas.moveTo(this,h),this}}),function(){function h(l,o){if(o){if(o.toLive)return l+": url(#SVGID_"+o.id+"); ";var n=new t.Color(o),r=l+": "+n.toRgb()+"; ",i=n.getAlpha();return i!==1&&(r+=l+"-opacity: "+i.toString()+"; "),r}else return l+": none; "}var e=t.util.toFixed;t.util.object.extend(t.Object.prototype,{getSvgStyles:function(l){var o=this.fillRule?this.fillRule:"nonzero",n=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):"none",i=this.strokeDashOffset?this.strokeDashOffset:"0",a=this.strokeLineCap?this.strokeLineCap:"butt",u=this.strokeLineJoin?this.strokeLineJoin:"miter",s=this.strokeMiterLimit?this.strokeMiterLimit:"4",f=typeof this.opacity<"u"?this.opacity:"1",g=this.visible?"":" visibility: hidden;",m=l?"":this.getSvgFilter(),v=h("fill",this.fill),C=h("stroke",this.stroke);return[C,"stroke-width: ",n,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",a,"; ","stroke-dashoffset: ",i,"; ","stroke-linejoin: ",u,"; ","stroke-miterlimit: ",s,"; ",v,"fill-rule: ",o,"; ","opacity: ",f,";",m,g].join("")},getSvgSpanStyles:function(l,o){var n="; ",i=l.fontFamily?"font-family: "+(l.fontFamily.indexOf("'")===-1&&l.fontFamily.indexOf('"')===-1?"'"+l.fontFamily+"'":l.fontFamily)+n:"",r=l.strokeWidth?"stroke-width: "+l.strokeWidth+n:"",i=i,a=l.fontSize?"font-size: "+l.fontSize+"px"+n:"",u=l.fontStyle?"font-style: "+l.fontStyle+n:"",s=l.fontWeight?"font-weight: "+l.fontWeight+n:"",f=l.fill?h("fill",l.fill):"",g=l.stroke?h("stroke",l.stroke):"",m=this.getSvgTextDecoration(l),v=l.deltaY?"baseline-shift: "+-l.deltaY+"; ":"";return m&&(m="text-decoration: "+m+n),[g,r,i,a,u,s,m,f,v,o?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(l){return["overline","underline","line-through"].filter(function(o){return l[o.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(l,o){var n=l?this.calcTransformMatrix():this.calcOwnMatrix(),r='transform="'+t.util.matrixToSVG(n);return r+(o||"")+'" '},_setSVGBg:function(l){if(this.backgroundColor){var o=t.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',e(-this.width/2,o),'" y="',e(-this.height/2,o),'" width="',e(this.width,o),'" height="',e(this.height,o),`"></rect>
`)}},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(l),{reviver:l})},toClipPathSVG:function(l){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(l),{reviver:l})},_createBaseClipPathSVGMarkup:function(l,o){o=o||{};var n=o.reviver,r=o.additionalTransform||"",i=[this.getSvgTransform(!0,r),this.getSvgCommons()].join(""),a=l.indexOf("COMMON_PARTS");return l[a]=i,n?n(l.join("")):l.join("")},_createBaseSVGMarkup:function(l,o){o=o||{};var n=o.noStyle,r=o.reviver,i=n?"":'style="'+this.getSvgStyles()+'" ',a=o.withShadow?'style="'+this.getSvgFilter()+'" ':"",u=this.clipPath,s=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",f=u&&u.absolutePositioned,g=this.stroke,m=this.fill,v=this.shadow,C,w=[],S,A=l.indexOf("COMMON_PARTS"),P=o.additionalTransform;return u&&(u.clipPathId="CLIPPATH_"+t.Object.__uid++,S='<clipPath id="'+u.clipPathId+`" >
`+u.toClipPathSVG(r)+`</clipPath>
`),f&&w.push("<g ",a,this.getSvgCommons(),` >
`),w.push("<g ",this.getSvgTransform(!1),f?"":a+this.getSvgCommons(),` >
`),C=[i,s,n?"":this.addPaintOrder()," ",P?'transform="'+P+'" ':""].join(""),l[A]=C,m&&m.toLive&&w.push(m.toSVG(this)),g&&g.toLive&&w.push(g.toSVG(this)),v&&w.push(v.toSVG(this)),u&&w.push(S),w.push(l.join("")),w.push(`</g>
`),f&&w.push(`</g>
`),r?r(w.join("")):w.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var h=t.util.object.extend,e="stateProperties";function l(n,r,i){var a={},u=!0;i.forEach(function(s){a[s]=n[s]}),h(n[r],a,u)}function o(n,r,i){if(n===r)return!0;if(Array.isArray(n)){if(!Array.isArray(r)||n.length!==r.length)return!1;for(var a=0,u=n.length;a<u;a++)if(!o(n[a],r[a]))return!1;return!0}else if(n&&typeof n=="object"){var s=Object.keys(n),f;if(!r||typeof r!="object"||!i&&s.length!==Object.keys(r).length)return!1;for(var a=0,u=s.length;a<u;a++)if(f=s[a],!(f==="canvas"||f==="group")&&!o(n[f],r[f]))return!1;return!0}}t.util.object.extend(t.Object.prototype,{hasStateChanged:function(n){n=n||e;var r="_"+n;return Object.keys(this[r]).length<this[n].length?!0:!o(this[r],this,!0)},saveState:function(n){var r=n&&n.propertySet||e,i="_"+r;return this[i]?(l(this,i,this[r]),n&&n.stateProperties&&l(this,i,n.stateProperties),this):this.setupState(n)},setupState:function(n){n=n||{};var r=n.propertySet||e;return n.propertySet=r,this["_"+r]={},this.saveState(n),this}})}(),function(){var h=t.util.degreesToRadians;t.util.object.extend(t.Object.prototype,{_findTargetCorner:function(e,l){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var o=e.x,n=e.y,r,i,a=Object.keys(this.oCoords),u=a.length-1,s;for(this.__corner=0;u>=0;u--)if(s=a[u],!!this.isControlVisible(s)&&(i=this._getImageLines(l?this.oCoords[s].touchCorner:this.oCoords[s].corner),r=this._findCrossPoints({x:o,y:n},i),r!==0&&r%2===1))return this.__corner=s,s;return!1},forEachControl:function(e){for(var l in this.controls)e(this.controls[l],l,this)},_setCornerCoords:function(){var e=this.oCoords;for(var l in e){var o=this.controls[l];e[l].corner=o.calcCornerCoords(this.angle,this.cornerSize,e[l].x,e[l].y,!1),e[l].touchCorner=o.calcCornerCoords(this.angle,this.touchCornerSize,e[l].x,e[l].y,!0)}},drawSelectionBackground:function(e){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;e.save();var l=this.getCenterPoint(),o=this._calculateCurrentDimensions(),n=this.canvas.viewportTransform;return e.translate(l.x,l.y),e.scale(1/n[0],1/n[3]),e.rotate(h(this.angle)),e.fillStyle=this.selectionBackgroundColor,e.fillRect(-o.x/2,-o.y/2,o.x,o.y),e.restore(),this},drawBorders:function(e,l){l=l||{};var o=this._calculateCurrentDimensions(),n=this.borderScaleFactor,r=o.x+n,i=o.y+n,a=typeof l.hasControls<"u"?l.hasControls:this.hasControls,u=!1;return e.save(),e.strokeStyle=l.borderColor||this.borderColor,this._setLineDash(e,l.borderDashArray||this.borderDashArray),e.strokeRect(-r/2,-i/2,r,i),a&&(e.beginPath(),this.forEachControl(function(s,f,g){s.withConnection&&s.getVisibility(g,f)&&(u=!0,e.moveTo(s.x*r,s.y*i),e.lineTo(s.x*r+s.offsetX,s.y*i+s.offsetY))}),u&&e.stroke()),e.restore(),this},drawBordersInGroup:function(e,l,o){o=o||{};var n=t.util.sizeAfterTransform(this.width,this.height,l),r=this.strokeWidth,i=this.strokeUniform,a=this.borderScaleFactor,u=n.x+r*(i?this.canvas.getZoom():l.scaleX)+a,s=n.y+r*(i?this.canvas.getZoom():l.scaleY)+a;return e.save(),this._setLineDash(e,o.borderDashArray||this.borderDashArray),e.strokeStyle=o.borderColor||this.borderColor,e.strokeRect(-u/2,-s/2,u,s),e.restore(),this},drawControls:function(e,l){l=l||{},e.save();var o=this.canvas.getRetinaScaling(),n,r;return e.setTransform(o,0,0,o,0,0),e.strokeStyle=e.fillStyle=l.cornerColor||this.cornerColor,this.transparentCorners||(e.strokeStyle=l.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(e,l.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(n=this.group.calcTransformMatrix()),this.forEachControl(function(i,a,u){r=u.oCoords[a],i.getVisibility(u,a)&&(n&&(r=t.util.transformPoint(r,n)),i.render(e,r.x,r.y,l,u))}),e.restore(),this},isControlVisible:function(e){return this.controls[e]&&this.controls[e].getVisibility(this,e)},setControlVisible:function(e,l){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[e]=l,this},setControlsVisibility:function(e){e||(e={});for(var l in e)this.setControlVisible(l,e[l]);return this},onDeselect:function(){},onSelect:function(){}})}(),t.util.object.extend(t.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(h,e){e=e||{};var l=function(){},o=e.onComplete||l,n=e.onChange||l,r=this;return t.util.animate({target:this,startValue:h.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(i){h.set("left",i),r.requestRenderAll(),n()},onComplete:function(){h.setCoords(),o()}})},fxCenterObjectV:function(h,e){e=e||{};var l=function(){},o=e.onComplete||l,n=e.onChange||l,r=this;return t.util.animate({target:this,startValue:h.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(i){h.set("top",i),r.requestRenderAll(),n()},onComplete:function(){h.setCoords(),o()}})},fxRemove:function(h,e){e=e||{};var l=function(){},o=e.onComplete||l,n=e.onChange||l,r=this;return t.util.animate({target:this,startValue:h.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(i){h.set("opacity",i),r.requestRenderAll(),n()},onComplete:function(){r.remove(h),o()}})}}),t.util.object.extend(t.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var h=[],e,l,o=[];for(e in arguments[0])h.push(e);for(var n=0,r=h.length;n<r;n++)e=h[n],l=n!==r-1,o.push(this._animate(e,arguments[0][e],arguments[1],l));return o}else return this._animate.apply(this,arguments)},_animate:function(h,e,l,o){var n=this,r;e=e.toString(),l?l=t.util.object.clone(l):l={},~h.indexOf(".")&&(r=h.split("."));var i=n.colorProperties.indexOf(h)>-1||r&&n.colorProperties.indexOf(r[1])>-1,a=r?this.get(r[0])[r[1]]:this.get(h);"from"in l||(l.from=a),i||(~e.indexOf("=")?e=a+parseFloat(e.replace("=","")):e=parseFloat(e));var u={target:this,startValue:l.from,endValue:e,byValue:l.by,easing:l.easing,duration:l.duration,abort:l.abort&&function(s,f,g){return l.abort.call(n,s,f,g)},onChange:function(s,f,g){r?n[r[0]][r[1]]=s:n.set(h,s),!o&&l.onChange&&l.onChange(s,f,g)},onComplete:function(s,f,g){o||(n.setCoords(),l.onComplete&&l.onComplete(s,f,g))}};return i?t.util.animateColor(u.startValue,u.endValue,u.duration,u):t.util.animate(u)}}),function(h){var e=h.fabric||(h.fabric={}),l=e.util.object.extend,o=e.util.object.clone,n={x1:1,x2:1,y1:1,y2:1};if(e.Line){e.warn("fabric.Line is already defined");return}e.Line=e.util.createClass(e.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:e.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(i,a){i||(i=[0,0,0,0]),this.callSuper("initialize",a),this.set("x1",i[0]),this.set("y1",i[1]),this.set("x2",i[2]),this.set("y2",i[3]),this._setWidthHeight(a)},_setWidthHeight:function(i){i||(i={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in i?i.left:this._getLeftToOriginX(),this.top="top"in i?i.top:this._getTopToOriginY()},_set:function(i,a){return this.callSuper("_set",i,a),typeof n[i]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:r({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:r({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(i){i.beginPath();var a=this.calcLinePoints();i.moveTo(a.x1,a.y1),i.lineTo(a.x2,a.y2),i.lineWidth=this.strokeWidth;var u=i.strokeStyle;i.strokeStyle=this.stroke||i.fillStyle,this.stroke&&this._renderStroke(i),i.strokeStyle=u},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(i){return l(this.callSuper("toObject",i),this.calcLinePoints())},_getNonTransformedDimensions:function(){var i=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(i.y-=this.strokeWidth),this.height===0&&(i.x-=this.strokeWidth)),i},calcLinePoints:function(){var i=this.x1<=this.x2?-1:1,a=this.y1<=this.y2?-1:1,u=i*this.width*.5,s=a*this.height*.5,f=i*this.width*-.5,g=a*this.height*-.5;return{x1:u,x2:f,y1:s,y2:g}},_toSVG:function(){var i=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',i.x1,'" y1="',i.y1,'" x2="',i.x2,'" y2="',i.y2,`" />
`]}}),e.Line.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),e.Line.fromElement=function(i,a,u){u=u||{};var s=e.parseAttributes(i,e.Line.ATTRIBUTE_NAMES),f=[s.x1||0,s.y1||0,s.x2||0,s.y2||0];a(new e.Line(f,l(s,u)))},e.Line.fromObject=function(i,a){function u(f){delete f.points,a&&a(f)}var s=o(i,!0);s.points=[i.x1,i.y1,i.x2,i.y2],e.Object._fromObject("Line",s,u,"points")};function r(i,a){var u=i.origin,s=i.axis1,f=i.axis2,g=i.dimension,m=a.nearest,v=a.center,C=a.farthest;return function(){switch(this.get(u)){case m:return Math.min(this.get(s),this.get(f));case v:return Math.min(this.get(s),this.get(f))+.5*this.get(g);case C:return Math.max(this.get(s),this.get(f))}}}}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.util.degreesToRadians;if(e.Circle){e.warn("fabric.Circle is already defined.");return}e.Circle=e.util.createClass(e.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:e.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(n,r){return this.callSuper("_set",n,r),n==="radius"&&this.setRadius(r),this},toObject:function(n){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(n))},_toSVG:function(){var n,r=0,i=0,a=(this.endAngle-this.startAngle)%360;if(a===0)n=["<circle ","COMMON_PARTS",'cx="'+r+'" cy="'+i+'" ','r="',this.radius,`" />
`];else{var u=l(this.startAngle),s=l(this.endAngle),f=this.radius,g=e.util.cos(u)*f,m=e.util.sin(u)*f,v=e.util.cos(s)*f,C=e.util.sin(s)*f,w=a>180?"1":"0";n=['<path d="M '+g+" "+m," A "+f+" "+f," 0 ",+w+" 1"," "+v+" "+C,'" ',"COMMON_PARTS",` />
`]}return n},_render:function(n){n.beginPath(),n.arc(0,0,this.radius,l(this.startAngle),l(this.endAngle),!1),this._renderPaintInOrder(n)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(n){return this.radius=n,this.set("width",n*2).set("height",n*2)}}),e.Circle.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),e.Circle.fromElement=function(n,r){var i=e.parseAttributes(n,e.Circle.ATTRIBUTE_NAMES);if(!o(i))throw new Error("value of `r` attribute is required and can not be negative");i.left=(i.left||0)-i.radius,i.top=(i.top||0)-i.radius,r(new e.Circle(i))};function o(n){return"radius"in n&&n.radius>=0}e.Circle.fromObject=function(n,r){e.Object._fromObject("Circle",n,r)}}(c),function(h){var e=h.fabric||(h.fabric={});if(e.Triangle){e.warn("fabric.Triangle is already defined");return}e.Triangle=e.util.createClass(e.Object,{type:"triangle",width:100,height:100,_render:function(l){var o=this.width/2,n=this.height/2;l.beginPath(),l.moveTo(-o,n),l.lineTo(0,-n),l.lineTo(o,n),l.closePath(),this._renderPaintInOrder(l)},_toSVG:function(){var l=this.width/2,o=this.height/2,n=[-l+" "+o,"0 "+-o,l+" "+o].join(",");return["<polygon ","COMMON_PARTS",'points="',n,'" />']}}),e.Triangle.fromObject=function(l,o){return e.Object._fromObject("Triangle",l,o)}}(c),function(h){var e=h.fabric||(h.fabric={}),l=Math.PI*2;if(e.Ellipse){e.warn("fabric.Ellipse is already defined.");return}e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:e.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(o){this.callSuper("initialize",o),this.set("rx",o&&o.rx||0),this.set("ry",o&&o.ry||0)},_set:function(o,n){switch(this.callSuper("_set",o,n),o){case"rx":this.rx=n,this.set("width",n*2);break;case"ry":this.ry=n,this.set("height",n*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(o){return this.callSuper("toObject",["rx","ry"].concat(o))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(o){o.beginPath(),o.save(),o.transform(1,0,0,this.ry/this.rx,0,0),o.arc(0,0,this.rx,0,l,!1),o.restore(),this._renderPaintInOrder(o)}}),e.Ellipse.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),e.Ellipse.fromElement=function(o,n){var r=e.parseAttributes(o,e.Ellipse.ATTRIBUTE_NAMES);r.left=(r.left||0)-r.rx,r.top=(r.top||0)-r.ry,n(new e.Ellipse(r))},e.Ellipse.fromObject=function(o,n){e.Object._fromObject("Ellipse",o,n)}}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.util.object.extend;if(e.Rect){e.warn("fabric.Rect is already defined");return}e.Rect=e.util.createClass(e.Object,{stateProperties:e.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:e.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(o){this.callSuper("initialize",o),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(o){var n=this.rx?Math.min(this.rx,this.width/2):0,r=this.ry?Math.min(this.ry,this.height/2):0,i=this.width,a=this.height,u=-this.width/2,s=-this.height/2,f=n!==0||r!==0,g=1-.5522847498;o.beginPath(),o.moveTo(u+n,s),o.lineTo(u+i-n,s),f&&o.bezierCurveTo(u+i-g*n,s,u+i,s+g*r,u+i,s+r),o.lineTo(u+i,s+a-r),f&&o.bezierCurveTo(u+i,s+a-g*r,u+i-g*n,s+a,u+i-n,s+a),o.lineTo(u+n,s+a),f&&o.bezierCurveTo(u+g*n,s+a,u,s+a-g*r,u,s+a-r),o.lineTo(u,s+r),f&&o.bezierCurveTo(u,s+g*r,u+g*n,s,u+n,s),o.closePath(),this._renderPaintInOrder(o)},toObject:function(o){return this.callSuper("toObject",["rx","ry"].concat(o))},_toSVG:function(){var o=-this.width/2,n=-this.height/2;return["<rect ","COMMON_PARTS",'x="',o,'" y="',n,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),e.Rect.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),e.Rect.fromElement=function(o,n,r){if(!o)return n(null);r=r||{};var i=e.parseAttributes(o,e.Rect.ATTRIBUTE_NAMES);i.left=i.left||0,i.top=i.top||0,i.height=i.height||0,i.width=i.width||0;var a=new e.Rect(l(r?e.util.object.clone(r):{},i));a.visible=a.visible&&a.width>0&&a.height>0,n(a)},e.Rect.fromObject=function(o,n){return e.Object._fromObject("Rect",o,n)}}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.util.object.extend,o=e.util.array.min,n=e.util.array.max,r=e.util.toFixed,i=e.util.projectStrokeOnPoints;if(e.Polyline){e.warn("fabric.Polyline is already defined");return}e.Polyline=e.util.createClass(e.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:e.Object.prototype.cacheProperties.concat("points"),initialize:function(a,u){u=u||{},this.points=a||[],this.callSuper("initialize",u),this._setPositionDimensions(u)},_projectStrokeOnPoints:function(){return i(this.points,this,!0)},_setPositionDimensions:function(a){var u=this._calcDimensions(a),s,f=this.exactBoundingBox?this.strokeWidth:0;this.width=u.width-f,this.height=u.height-f,a.fromSVG||(s=this.translateToGivenOrigin({x:u.left-this.strokeWidth/2+f/2,y:u.top-this.strokeWidth/2+f/2},"left","top",this.originX,this.originY)),typeof a.left>"u"&&(this.left=a.fromSVG?u.left:s.x),typeof a.top>"u"&&(this.top=a.fromSVG?u.top:s.y),this.pathOffset={x:u.left+this.width/2+f/2,y:u.top+this.height/2+f/2}},_calcDimensions:function(){var a=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,u=o(a,"x")||0,s=o(a,"y")||0,f=n(a,"x")||0,g=n(a,"y")||0,m=f-u,v=g-s;return{left:u,top:s,width:m,height:v}},toObject:function(a){return l(this.callSuper("toObject",a),{points:this.points.concat()})},_toSVG:function(){for(var a=[],u=this.pathOffset.x,s=this.pathOffset.y,f=e.Object.NUM_FRACTION_DIGITS,g=0,m=this.points.length;g<m;g++)a.push(r(this.points[g].x-u,f),",",r(this.points[g].y-s,f)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',a.join(""),`" />
`]},commonRender:function(a){var u,s=this.points.length,f=this.pathOffset.x,g=this.pathOffset.y;if(!s||isNaN(this.points[s-1].y))return!1;a.beginPath(),a.moveTo(this.points[0].x-f,this.points[0].y-g);for(var m=0;m<s;m++)u=this.points[m],a.lineTo(u.x-f,u.y-g);return!0},_render:function(a){this.commonRender(a)&&this._renderPaintInOrder(a)},complexity:function(){return this.get("points").length}}),e.Polyline.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polyline.fromElementGenerator=function(a){return function(u,s,f){if(!u)return s(null);f||(f={});var g=e.parsePointsAttribute(u.getAttribute("points")),m=e.parseAttributes(u,e[a].ATTRIBUTE_NAMES);m.fromSVG=!0,s(new e[a](g,l(m,f)))}},e.Polyline.fromElement=e.Polyline.fromElementGenerator("Polyline"),e.Polyline.fromObject=function(a,u){return e.Object._fromObject("Polyline",a,u,"points")}}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.util.projectStrokeOnPoints;if(e.Polygon){e.warn("fabric.Polygon is already defined");return}e.Polygon=e.util.createClass(e.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return l(this.points,this)},_render:function(o){this.commonRender(o)&&(o.closePath(),this._renderPaintInOrder(o))}}),e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polygon.fromElement=e.Polyline.fromElementGenerator("Polygon"),e.Polygon.fromObject=function(o,n){e.Object._fromObject("Polygon",o,n,"points")}}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.util.array.min,o=e.util.array.max,n=e.util.object.extend,r=e.util.object.clone,i=e.util.toFixed;if(e.Path){e.warn("fabric.Path is already defined");return}e.Path=e.util.createClass(e.Object,{type:"path",path:null,cacheProperties:e.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:e.Object.prototype.stateProperties.concat("path"),initialize:function(a,u){u=r(u||{}),delete u.path,this.callSuper("initialize",u),this._setPath(a||[],u)},_setPath:function(a,u){this.path=e.util.makePathSimpler(Array.isArray(a)?a:e.util.parsePath(a)),e.Polyline.prototype._setPositionDimensions.call(this,u||{})},_renderPathCommands:function(a){var u,s=0,f=0,g=0,m=0,v=0,C=0,w=-this.pathOffset.x,S=-this.pathOffset.y;a.beginPath();for(var A=0,P=this.path.length;A<P;++A)switch(u=this.path[A],u[0]){case"L":g=u[1],m=u[2],a.lineTo(g+w,m+S);break;case"M":g=u[1],m=u[2],s=g,f=m,a.moveTo(g+w,m+S);break;case"C":g=u[5],m=u[6],v=u[3],C=u[4],a.bezierCurveTo(u[1]+w,u[2]+S,v+w,C+S,g+w,m+S);break;case"Q":a.quadraticCurveTo(u[1]+w,u[2]+S,u[3]+w,u[4]+S),g=u[3],m=u[4],v=u[1],C=u[2];break;case"z":case"Z":g=s,m=f,a.closePath();break}},_render:function(a){this._renderPathCommands(a),this._renderPaintInOrder(a)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){return n(this.callSuper("toObject",a),{path:this.path.map(function(u){return u.slice()})})},toDatalessObject:function(a){var u=this.toObject(["sourcePath"].concat(a));return u.sourcePath&&delete u.path,u},_toSVG:function(){var a=e.util.joinPath(this.path);return["<path ","COMMON_PARTS",'d="',a,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var a=e.Object.NUM_FRACTION_DIGITS;return" translate("+i(-this.pathOffset.x,a)+", "+i(-this.pathOffset.y,a)+")"},toClipPathSVG:function(a){var u=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:a,additionalTransform:u})},toSVG:function(a){var u=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:a,additionalTransform:u})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var a=[],u=[],s,f=0,g=0,m=0,v=0,C,w=0,S=this.path.length;w<S;++w){switch(s=this.path[w],s[0]){case"L":m=s[1],v=s[2],C=[];break;case"M":m=s[1],v=s[2],f=m,g=v,C=[];break;case"C":C=e.util.getBoundsOfCurve(m,v,s[1],s[2],s[3],s[4],s[5],s[6]),m=s[5],v=s[6];break;case"Q":C=e.util.getBoundsOfCurve(m,v,s[1],s[2],s[1],s[2],s[3],s[4]),m=s[3],v=s[4];break;case"z":case"Z":m=f,v=g;break}C.forEach(function(J){a.push(J.x),u.push(J.y)}),a.push(m),u.push(v)}var A=l(a)||0,P=l(u)||0,X=o(a)||0,K=o(u)||0,tt=X-A,H=K-P;return{left:A,top:P,width:tt,height:H}}}),e.Path.fromObject=function(a,u){if(typeof a.sourcePath=="string"){var s=a.sourcePath;e.loadSVGFromURL(s,function(f){var g=f[0];g.setOptions(a),a.clipPath?e.util.enlivenObjects([a.clipPath],function(m){g.clipPath=m[0],u&&u(g)}):u&&u(g)})}else e.Object._fromObject("Path",a,u,"path")},e.Path.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["d"]),e.Path.fromElement=function(a,u,s){var f=e.parseAttributes(a,e.Path.ATTRIBUTE_NAMES);f.fromSVG=!0,u(new e.Path(f.d,n(f,s)))}}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.util.array.min,o=e.util.array.max;e.Group||(e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(n,r,i){r=r||{},this._objects=[],i&&this.callSuper("initialize",r),this._objects=n||[];for(var a=this._objects.length;a--;)this._objects[a].group=this;if(i)this._updateObjectsACoords();else{var u=r&&r.centerPoint;r.originX!==void 0&&(this.originX=r.originX),r.originY!==void 0&&(this.originY=r.originY),u||this._calcBounds(),this._updateObjectsCoords(u),delete r.centerPoint,this.callSuper("initialize",r)}this.setCoords()},_updateObjectsACoords:function(){for(var n=!0,r=this._objects.length;r--;)this._objects[r].setCoords(n)},_updateObjectsCoords:function(r){for(var r=r||this.getCenterPoint(),i=this._objects.length;i--;)this._updateObjectCoords(this._objects[i],r)},_updateObjectCoords:function(n,r){var i=n.left,a=n.top,u=!0;n.set({left:i-r.x,top:a-r.y}),n.group=this,n.setCoords(u)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(n){var r=!!this.group;return this._restoreObjectsState(),e.util.resetObjectTransform(this),n&&(r&&e.util.removeTransformFromObject(n,this.group.calcTransformMatrix()),this._objects.push(n),n.group=this,n._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,r?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(n){return this._restoreObjectsState(),e.util.resetObjectTransform(this),this.remove(n),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(n){this.dirty=!0,n.group=this,n._set("canvas",this.canvas)},_onObjectRemoved:function(n){this.dirty=!0,delete n.group},_set:function(n,r){var i=this._objects.length;if(this.useSetOnGroup)for(;i--;)this._objects[i].setOnGroup(n,r);if(n==="canvas")for(;i--;)this._objects[i]._set(n,r);e.Object.prototype._set.call(this,n,r)},toObject:function(n){var r=this.includeDefaultValues,i=this._objects.filter(function(u){return!u.excludeFromExport}).map(function(u){var s=u.includeDefaultValues;u.includeDefaultValues=r;var f=u.toObject(n);return u.includeDefaultValues=s,f}),a=e.Object.prototype.toObject.call(this,n);return a.objects=i,a},toDatalessObject:function(n){var r,i=this.sourcePath;if(i)r=i;else{var a=this.includeDefaultValues;r=this._objects.map(function(s){var f=s.includeDefaultValues;s.includeDefaultValues=a;var g=s.toDatalessObject(n);return s.includeDefaultValues=f,g})}var u=e.Object.prototype.toDatalessObject.call(this,n);return u.objects=r,u},render:function(n){this._transformDone=!0,this.callSuper("render",n),this._transformDone=!1},shouldCache:function(){var n=e.Object.prototype.shouldCache.call(this);if(n){for(var r=0,i=this._objects.length;r<i;r++)if(this._objects[r].willDrawShadow())return this.ownCaching=!1,!1}return n},willDrawShadow:function(){if(e.Object.prototype.willDrawShadow.call(this))return!0;for(var n=0,r=this._objects.length;n<r;n++)if(this._objects[n].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(n){for(var r=0,i=this._objects.length;r<i;r++)this._objects[r].render(n);this._drawClipPath(n,this.clipPath)},isCacheDirty:function(n){if(this.callSuper("isCacheDirty",n))return!0;if(!this.statefullCache)return!1;for(var r=0,i=this._objects.length;r<i;r++)if(this._objects[r].isCacheDirty(!0)){if(this._cacheCanvas){var a=this.cacheWidth/this.zoomX,u=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-a/2,-u/2,a,u)}return!0}return!1},_restoreObjectsState:function(){var n=this.calcOwnMatrix();return this._objects.forEach(function(r){e.util.addTransformToObject(r,n),delete r.group,r.setCoords()}),this},destroy:function(){return this._objects.forEach(function(n){n.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(n){n.dispose&&n.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var n=this._objects,r=this.canvas;this._objects=[];var i=this.toObject();delete i.objects;var a=new e.ActiveSelection([]);return a.set(i),a.type="activeSelection",r.remove(this),n.forEach(function(u){u.group=a,u.dirty=!0,r.add(u)}),a.canvas=r,a._objects=n,r._activeObject=a,a.setCoords(),a}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var n=!0;return this.forEachObject(function(r){r.setCoords(n)}),this},_calcBounds:function(n){for(var r=[],i=[],a,u,s,f=["tr","br","bl","tl"],g=0,m=this._objects.length,v,C=f.length;g<m;++g){for(a=this._objects[g],s=a.calcACoords(),v=0;v<C;v++)u=f[v],r.push(s[u].x),i.push(s[u].y);a.aCoords=s}this._getBounds(r,i,n)},_getBounds:function(n,r,i){var a=new e.Point(l(n),l(r)),u=new e.Point(o(n),o(r)),s=a.y||0,f=a.x||0,g=u.x-a.x||0,m=u.y-a.y||0;this.width=g,this.height=m,i||this.setPositionByOrigin({x:f,y:s},"left","top")},_toSVG:function(n){for(var r=["<g ","COMMON_PARTS",` >
`],i=0,a=this._objects.length;i<a;i++)r.push("		",this._objects[i].toSVG(n));return r.push(`</g>
`),r},getSvgStyles:function(){var n=typeof this.opacity<"u"&&this.opacity!==1?"opacity: "+this.opacity+";":"",r=this.visible?"":" visibility: hidden;";return[n,this.getSvgFilter(),r].join("")},toClipPathSVG:function(n){for(var r=[],i=0,a=this._objects.length;i<a;i++)r.push("	",this._objects[i].toClipPathSVG(n));return this._createBaseClipPathSVGMarkup(r,{reviver:n})}}),e.Group.fromObject=function(n,r){var i=n.objects,a=e.util.object.clone(n,!0);if(delete a.objects,typeof i=="string"){e.loadSVGFromURL(i,function(u){var s=e.util.groupSVGElements(u,n,i),f=a.clipPath;delete a.clipPath,s.set(a),f?e.util.enlivenObjects([f],function(g){s.clipPath=g[0],r&&r(s)}):r&&r(s)});return}e.util.enlivenObjects(i,function(u){e.util.enlivenObjectEnlivables(n,a,function(){r&&r(new e.Group(u,a,!0))})})})}(c),function(h){var e=h.fabric||(h.fabric={});e.ActiveSelection||(e.ActiveSelection=e.util.createClass(e.Group,{type:"activeSelection",initialize:function(l,o){o=o||{},this._objects=l||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;o.originX&&(this.originX=o.originX),o.originY&&(this.originY=o.originY),this._calcBounds(),this._updateObjectsCoords(),e.Object.prototype.initialize.call(this,o),this.setCoords()},toGroup:function(){var l=this._objects.concat();this._objects=[];var o=e.Object.prototype.toObject.call(this),n=new e.Group([]);if(delete o.type,n.set(o),l.forEach(function(i){i.canvas.remove(i),i.group=n}),n._objects=l,!this.canvas)return n;var r=this.canvas;return r.add(n),r._activeObject=n,n.setCoords(),n},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(l,o,n){l.save(),l.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",l,o),n=n||{},typeof n.hasControls>"u"&&(n.hasControls=!1),n.forActiveSelection=!0;for(var r=0,i=this._objects.length;r<i;r++)this._objects[r]._renderControls(l,n);l.restore()}}),e.ActiveSelection.fromObject=function(l,o){e.util.enlivenObjects(l.objects,function(n){delete l.objects,o&&o(new e.ActiveSelection(n,l,!0))})})}(c),function(h){var e=t.util.object.extend;if(h.fabric||(h.fabric={}),h.fabric.Image){t.warn("fabric.Image is already defined.");return}t.Image=t.util.createClass(t.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:t.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:t.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(l,o){o||(o={}),this.filters=[],this.cacheKey="texture"+t.Object.__uid++,this.callSuper("initialize",o),this._initElement(l,o)},getElement:function(){return this._element||{}},setElement:function(l,o){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=l,this._originalElement=l,this._initConfig(o),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(l){var o=t.filterBackend;o&&o.evictCachesForKey&&o.evictCachesForKey(l)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(l){t.util.cleanUpJsdomNode(this[l]),this[l]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var l=this.getElement();return{width:l.naturalWidth||l.width,height:l.naturalHeight||l.height}},_stroke:function(l){if(!(!this.stroke||this.strokeWidth===0)){var o=this.width/2,n=this.height/2;l.beginPath(),l.moveTo(-o,-n),l.lineTo(o,-n),l.lineTo(o,n),l.lineTo(-o,n),l.lineTo(-o,-n),l.closePath()}},toObject:function(l){var o=[];this.filters.forEach(function(r){r&&o.push(r.toObject())});var n=e(this.callSuper("toObject",["cropX","cropY"].concat(l)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:o});return this.resizeFilter&&(n.resizeFilter=this.resizeFilter.toObject()),n},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var l=[],o=[],n,r=this._element,i=-this.width/2,a=-this.height/2,u="",s="";if(!r)return[];if(this.hasCrop()){var f=t.Object.__uid++;l.push('<clipPath id="imageCrop_'+f+`">
`,'	<rect x="'+i+'" y="'+a+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),u=' clip-path="url(#imageCrop_'+f+')" '}if(this.imageSmoothing||(s='" image-rendering="optimizeSpeed'),o.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',i-this.cropX,'" y="',a-this.cropY,'" width="',r.width||r.naturalWidth,'" height="',r.height||r.height,s,'"',u,`></image>
`),this.stroke||this.strokeDashArray){var g=this.fill;this.fill=null,n=["	<rect ",'x="',i,'" y="',a,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=g}return this.paintFirst!=="fill"?l=l.concat(n,o):l=l.concat(o,n),l},getSrc:function(l){var o=l?this._element:this._originalElement;return o?o.toDataURL?o.toDataURL():this.srcFromAttribute?o.getAttribute("src"):o.src:this.src||""},setSrc:function(l,o,n){return t.util.loadImage(l,function(r,i){this.setElement(r,n),this._setWidthHeight(),o&&o(this,i)},this,n&&n.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var l=this.resizeFilter,o=this.minimumScaleTrigger,n=this.getTotalObjectScaling(),r=n.scaleX,i=n.scaleY,a=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!l||r>o&&i>o){this._element=a,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=r,this._lastScaleY=i;return}t.filterBackend||(t.filterBackend=t.initFilterBackend());var u=t.util.createCanvasElement(),s=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,f=a.width,g=a.height;u.width=f,u.height=g,this._element=u,this._lastScaleX=l.scaleX=r,this._lastScaleY=l.scaleY=i,t.filterBackend.applyFilters([l],a,f,g,this._element,s),this._filterScalingX=u.width/this._originalElement.width,this._filterScalingY=u.height/this._originalElement.height},applyFilters:function(l){if(l=l||this.filters||[],l=l.filter(function(a){return a&&!a.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),l.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var o=this._originalElement,n=o.naturalWidth||o.width,r=o.naturalHeight||o.height;if(this._element===this._originalElement){var i=t.util.createCanvasElement();i.width=n,i.height=r,this._element=i,this._filteredEl=i}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,n,r),this._lastScaleX=1,this._lastScaleY=1;return t.filterBackend||(t.filterBackend=t.initFilterBackend()),t.filterBackend.applyFilters(l,this._originalElement,n,r,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(l){t.util.setImageSmoothing(l,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(l),this._renderPaintInOrder(l)},drawCacheOnCanvas:function(l){t.util.setImageSmoothing(l,this.imageSmoothing),t.Object.prototype.drawCacheOnCanvas.call(this,l)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(l){var o=this._element;if(o){var n=this._filterScalingX,r=this._filterScalingY,i=this.width,a=this.height,u=Math.min,s=Math.max,f=s(this.cropX,0),g=s(this.cropY,0),m=o.naturalWidth||o.width,v=o.naturalHeight||o.height,C=f*n,w=g*r,S=u(i*n,m-C),A=u(a*r,v-w),P=-i/2,X=-a/2,K=u(i,m/n-f),tt=u(a,v/r-g);o&&l.drawImage(o,C,w,S,A,P,X,K,tt)}},_needsResize:function(){var l=this.getTotalObjectScaling();return l.scaleX!==this._lastScaleX||l.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(l,o){this.setElement(t.util.getById(l),o),t.util.addClass(this.getElement(),t.Image.CSS_CANVAS)},_initConfig:function(l){l||(l={}),this.setOptions(l),this._setWidthHeight(l)},_initFilters:function(l,o){l&&l.length?t.util.enlivenObjects(l,function(n){o&&o(n)},"fabric.Image.filters"):o&&o()},_setWidthHeight:function(l){l||(l={});var o=this.getElement();this.width=l.width||o.naturalWidth||o.width||0,this.height=l.height||o.naturalHeight||o.height||0},parsePreserveAspectRatioAttribute:function(){var l=t.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),o=this._element.width,n=this._element.height,r=1,i=1,a=0,u=0,s=0,f=0,g,m=this.width,v=this.height,C={width:m,height:v};return l&&(l.alignX!=="none"||l.alignY!=="none")?(l.meetOrSlice==="meet"&&(r=i=t.util.findScaleToFit(this._element,C),g=(m-o*r)/2,l.alignX==="Min"&&(a=-g),l.alignX==="Max"&&(a=g),g=(v-n*i)/2,l.alignY==="Min"&&(u=-g),l.alignY==="Max"&&(u=g)),l.meetOrSlice==="slice"&&(r=i=t.util.findScaleToCover(this._element,C),g=o-m/r,l.alignX==="Mid"&&(s=g/2),l.alignX==="Max"&&(s=g),g=n-v/i,l.alignY==="Mid"&&(f=g/2),l.alignY==="Max"&&(f=g),o=m/r,n=v/i)):(r=m/o,i=v/n),{width:o,height:n,scaleX:r,scaleY:i,offsetLeft:a,offsetTop:u,cropX:s,cropY:f}}}),t.Image.CSS_CANVAS="canvas-img",t.Image.prototype.getSvgSrc=t.Image.prototype.getSrc,t.Image.fromObject=function(l,o){var n=t.util.object.clone(l);t.util.loadImage(n.src,function(r,i){if(i){o&&o(null,!0);return}t.Image.prototype._initFilters.call(n,n.filters,function(a){n.filters=a||[],t.Image.prototype._initFilters.call(n,[n.resizeFilter],function(u){n.resizeFilter=u[0],t.util.enlivenObjectEnlivables(n,n,function(){var s=new t.Image(r,n);o(s,!1)})})})},null,n.crossOrigin)},t.Image.fromURL=function(l,o,n){t.util.loadImage(l,function(r,i){o&&o(new t.Image(r,n),i)},null,n&&n.crossOrigin)},t.Image.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),t.Image.fromElement=function(l,o,n){var r=t.parseAttributes(l,t.Image.ATTRIBUTE_NAMES);t.Image.fromURL(r["xlink:href"],o,e(n?t.util.object.clone(n):{},r))}}(c),t.util.object.extend(t.Object.prototype,{_getAngleValueForStraighten:function(){var h=this.angle%360;return h>0?Math.round((h-1)/90)*90:Math.round(h/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(h){h=h||{};var e=function(){},l=h.onComplete||e,o=h.onChange||e,n=this;return t.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(r){n.rotate(r),o()},onComplete:function(){n.setCoords(),l()}})}}),t.util.object.extend(t.StaticCanvas.prototype,{straightenObject:function(h){return h.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(h){return h.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function h(l,o){var n="precision "+o+` float;
void main(){}`,r=l.createShader(l.FRAGMENT_SHADER);return l.shaderSource(r,n),l.compileShader(r),!!l.getShaderParameter(r,l.COMPILE_STATUS)}t.isWebglSupported=function(l){if(t.isLikelyNode)return!1;l=l||t.WebglFilterBackend.prototype.tileSize;var o=document.createElement("canvas"),n=o.getContext("webgl")||o.getContext("experimental-webgl"),r=!1;if(n){t.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),r=t.maxTextureSize>=l;for(var i=["highp","mediump","lowp"],a=0;a<3;a++)if(h(n,i[a])){t.webGlPrecision=i[a];break}}return this.isSupported=r,r},t.WebglFilterBackend=e;function e(l){l&&l.tileSize&&(this.tileSize=l.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}e.prototype={tileSize:2048,resources:{},setupGLContext:function(l,o){this.dispose(),this.createWebGLCanvas(l,o),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(l,o)},chooseFastestCopyGLTo2DMethod:function(l,o){var n=typeof window.performance<"u",r;try{new ImageData(1,1),r=!0}catch{r=!1}var i=typeof ArrayBuffer<"u",a=typeof Uint8ClampedArray<"u";if(n&&r&&i&&a){var u=t.util.createCanvasElement(),s=new ArrayBuffer(l*o*4);if(t.forceGLPutImageData){this.imageBuffer=s,this.copyGLTo2D=y;return}var f={imageBuffer:s,destinationWidth:l,destinationHeight:o,targetCanvas:u},g,m,v;u.width=l,u.height=o,g=window.performance.now(),b.call(f,this.gl,f),m=window.performance.now()-g,g=window.performance.now(),y.call(f,this.gl,f),v=window.performance.now()-g,m>v?(this.imageBuffer=s,this.copyGLTo2D=y):this.copyGLTo2D=b}},createWebGLCanvas:function(l,o){var n=t.util.createCanvasElement();n.width=l,n.height=o;var r={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},i=n.getContext("webgl",r);i||(i=n.getContext("experimental-webgl",r)),i&&(i.clearColor(0,0,0,0),this.canvas=n,this.gl=i)},applyFilters:function(l,o,n,r,i,a){var u=this.gl,s;a&&(s=this.getCachedTexture(a,o));var f={originalWidth:o.width||o.originalWidth,originalHeight:o.height||o.originalHeight,sourceWidth:n,sourceHeight:r,destinationWidth:n,destinationHeight:r,context:u,sourceTexture:this.createTexture(u,n,r,!s&&o),targetTexture:this.createTexture(u,n,r),originalTexture:s||this.createTexture(u,n,r,!s&&o),passes:l.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:i},g=u.createFramebuffer();return u.bindFramebuffer(u.FRAMEBUFFER,g),l.forEach(function(m){m&&m.applyTo(f)}),_(f),this.copyGLTo2D(u,f),u.bindTexture(u.TEXTURE_2D,null),u.deleteTexture(f.sourceTexture),u.deleteTexture(f.targetTexture),u.deleteFramebuffer(g),i.getContext("2d").setTransform(1,0,0,1,0,0),f},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(l,o,n,r,i){var a=l.createTexture();return l.bindTexture(l.TEXTURE_2D,a),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,i||l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,i||l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),r?l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,r):l.texImage2D(l.TEXTURE_2D,0,l.RGBA,o,n,0,l.RGBA,l.UNSIGNED_BYTE,null),a},getCachedTexture:function(l,o){if(this.textureCache[l])return this.textureCache[l];var n=this.createTexture(this.gl,o.width,o.height,o);return this.textureCache[l]=n,n},evictCachesForKey:function(l){this.textureCache[l]&&(this.gl.deleteTexture(this.textureCache[l]),delete this.textureCache[l])},copyGLTo2D:b,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var l=this.gl,o={renderer:"",vendor:""};if(!l)return o;var n=l.getExtension("WEBGL_debug_renderer_info");if(n){var r=l.getParameter(n.UNMASKED_RENDERER_WEBGL),i=l.getParameter(n.UNMASKED_VENDOR_WEBGL);r&&(o.renderer=r.toLowerCase()),i&&(o.vendor=i.toLowerCase())}return this.gpuInfo=o,o}}}();function _(h){var e=h.targetCanvas,l=e.width,o=e.height,n=h.destinationWidth,r=h.destinationHeight;(l!==n||o!==r)&&(e.width=n,e.height=r)}function b(h,e){var l=h.canvas,o=e.targetCanvas,n=o.getContext("2d");n.translate(0,o.height),n.scale(1,-1);var r=l.height-o.height;n.drawImage(l,0,r,o.width,o.height,0,0,o.width,o.height)}function y(h,e){var l=e.targetCanvas,o=l.getContext("2d"),n=e.destinationWidth,r=e.destinationHeight,i=n*r*4,a=new Uint8Array(this.imageBuffer,0,i),u=new Uint8ClampedArray(this.imageBuffer,0,i);h.readPixels(0,0,n,r,h.RGBA,h.UNSIGNED_BYTE,a);var s=new ImageData(u,n,r);o.putImageData(s,0,0)}(function(){var h=function(){};t.Canvas2dFilterBackend=e;function e(){}e.prototype={evictCachesForKey:h,dispose:h,clearWebGLCaches:h,resources:{},applyFilters:function(l,o,n,r,i){var a=i.getContext("2d");a.drawImage(o,0,0,n,r);var u=a.getImageData(0,0,n,r),s=a.getImageData(0,0,n,r),f={sourceWidth:n,sourceHeight:r,imageData:u,originalEl:o,originalImageData:s,canvasEl:i,ctx:a,filterBackend:this};return l.forEach(function(g){g.applyTo(f)}),(f.imageData.width!==n||f.imageData.height!==r)&&(i.width=f.imageData.width,i.height=f.imageData.height),a.putImageData(f.imageData,0,0),f}}})(),t.Image=t.Image||{},t.Image.filters=t.Image.filters||{},t.Image.filters.BaseFilter=t.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(h){h&&this.setOptions(h)},setOptions:function(h){for(var e in h)this[e]=h[e]},createProgram:function(h,e,l){e=e||this.fragmentSource,l=l||this.vertexSource,t.webGlPrecision!=="highp"&&(e=e.replace(/precision highp float/g,"precision "+t.webGlPrecision+" float"));var o=h.createShader(h.VERTEX_SHADER);if(h.shaderSource(o,l),h.compileShader(o),!h.getShaderParameter(o,h.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+h.getShaderInfoLog(o));var n=h.createShader(h.FRAGMENT_SHADER);if(h.shaderSource(n,e),h.compileShader(n),!h.getShaderParameter(n,h.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+h.getShaderInfoLog(n));var r=h.createProgram();if(h.attachShader(r,o),h.attachShader(r,n),h.linkProgram(r),!h.getProgramParameter(r,h.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+h.getProgramInfoLog(r));var i=this.getAttributeLocations(h,r),a=this.getUniformLocations(h,r)||{};return a.uStepW=h.getUniformLocation(r,"uStepW"),a.uStepH=h.getUniformLocation(r,"uStepH"),{program:r,attributeLocations:i,uniformLocations:a}},getAttributeLocations:function(h,e){return{aPosition:h.getAttribLocation(e,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(h,e,l){var o=e.aPosition,n=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,n),h.enableVertexAttribArray(o),h.vertexAttribPointer(o,2,h.FLOAT,!1,0,0),h.bufferData(h.ARRAY_BUFFER,l,h.STATIC_DRAW)},_setupFrameBuffer:function(h){var e=h.context,l,o;h.passes>1?(l=h.destinationWidth,o=h.destinationHeight,(h.sourceWidth!==l||h.sourceHeight!==o)&&(e.deleteTexture(h.targetTexture),h.targetTexture=h.filterBackend.createTexture(e,l,o)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,h.targetTexture,0)):(e.bindFramebuffer(e.FRAMEBUFFER,null),e.finish())},_swapTextures:function(h){h.passes--,h.pass++;var e=h.targetTexture;h.targetTexture=h.sourceTexture,h.sourceTexture=e},isNeutralState:function(){var h=this.mainParameter,e=t.Image.filters[this.type].prototype;if(h)if(Array.isArray(e[h])){for(var l=e[h].length;l--;)if(this[h][l]!==e[h][l])return!1;return!0}else return e[h]===this[h];else return!1},applyTo:function(h){h.webgl?(this._setupFrameBuffer(h),this.applyToWebGL(h),this._swapTextures(h)):this.applyTo2d(h)},retrieveShader:function(h){return h.programCache.hasOwnProperty(this.type)||(h.programCache[this.type]=this.createProgram(h.context)),h.programCache[this.type]},applyToWebGL:function(h){var e=h.context,l=this.retrieveShader(h);h.pass===0&&h.originalTexture?e.bindTexture(e.TEXTURE_2D,h.originalTexture):e.bindTexture(e.TEXTURE_2D,h.sourceTexture),e.useProgram(l.program),this.sendAttributeData(e,l.attributeLocations,h.aPosition),e.uniform1f(l.uniformLocations.uStepW,1/h.sourceWidth),e.uniform1f(l.uniformLocations.uStepH,1/h.sourceHeight),this.sendUniformData(e,l.uniformLocations),e.viewport(0,0,h.destinationWidth,h.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(h,e,l){h.activeTexture(l),h.bindTexture(h.TEXTURE_2D,e),h.activeTexture(h.TEXTURE0)},unbindAdditionalTexture:function(h,e){h.activeTexture(e),h.bindTexture(h.TEXTURE_2D,null),h.activeTexture(h.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(h){this[this.mainParameter]=h},sendUniformData:function(){},createHelpLayer:function(h){if(!h.helpLayer){var e=document.createElement("canvas");e.width=h.sourceWidth,e.height=h.sourceHeight,h.helpLayer=e}},toObject:function(){var h={type:this.type},e=this.mainParameter;return e&&(h[e]=this[e]),h},toJSON:function(){return this.toObject()}}),t.Image.filters.BaseFilter.fromObject=function(h,e){var l=new t.Image.filters[h.type](h);return e&&e(l),l},function(h){var e=h.fabric||(h.fabric={}),l=e.Image.filters,o=e.util.createClass;l.ColorMatrix=o(l.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(n){this.callSuper("initialize",n),this.matrix=this.matrix.slice(0)},applyTo2d:function(n){var r=n.imageData,i=r.data,a=i.length,u=this.matrix,s,f,g,m,v,C=this.colorsOnly;for(v=0;v<a;v+=4)s=i[v],f=i[v+1],g=i[v+2],C?(i[v]=s*u[0]+f*u[1]+g*u[2]+u[4]*255,i[v+1]=s*u[5]+f*u[6]+g*u[7]+u[9]*255,i[v+2]=s*u[10]+f*u[11]+g*u[12]+u[14]*255):(m=i[v+3],i[v]=s*u[0]+f*u[1]+g*u[2]+m*u[3]+u[4]*255,i[v+1]=s*u[5]+f*u[6]+g*u[7]+m*u[8]+u[9]*255,i[v+2]=s*u[10]+f*u[11]+g*u[12]+m*u[13]+u[14]*255,i[v+3]=s*u[15]+f*u[16]+g*u[17]+m*u[18]+u[19]*255)},getUniformLocations:function(n,r){return{uColorMatrix:n.getUniformLocation(r,"uColorMatrix"),uConstants:n.getUniformLocation(r,"uConstants")}},sendUniformData:function(n,r){var i=this.matrix,a=[i[0],i[1],i[2],i[3],i[5],i[6],i[7],i[8],i[10],i[11],i[12],i[13],i[15],i[16],i[17],i[18]],u=[i[4],i[9],i[14],i[19]];n.uniformMatrix4fv(r.uColorMatrix,!1,a),n.uniform4fv(r.uConstants,u)}}),e.Image.filters.ColorMatrix.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.Image.filters,o=e.util.createClass;l.Brightness=o(l.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(n){if(this.brightness!==0){var r=n.imageData,i=r.data,a,u=i.length,s=Math.round(this.brightness*255);for(a=0;a<u;a+=4)i[a]=i[a]+s,i[a+1]=i[a+1]+s,i[a+2]=i[a+2]+s}},getUniformLocations:function(n,r){return{uBrightness:n.getUniformLocation(r,"uBrightness")}},sendUniformData:function(n,r){n.uniform1f(r.uBrightness,this.brightness)}}),e.Image.filters.Brightness.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.util.object.extend,o=e.Image.filters,n=e.util.createClass;o.Convolute=n(o.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(r){var i=Math.sqrt(this.matrix.length),a=this.type+"_"+i+"_"+(this.opaque?1:0),u=this.fragmentSource[a];return r.programCache.hasOwnProperty(a)||(r.programCache[a]=this.createProgram(r.context,u)),r.programCache[a]},applyTo2d:function(r){var i=r.imageData,a=i.data,u=this.matrix,s=Math.round(Math.sqrt(u.length)),f=Math.floor(s/2),g=i.width,m=i.height,v=r.ctx.createImageData(g,m),C=v.data,w=this.opaque?1:0,S,A,P,X,K,tt,H,J,Z,nt,lt,rt,T;for(lt=0;lt<m;lt++)for(nt=0;nt<g;nt++){for(K=(lt*g+nt)*4,S=0,A=0,P=0,X=0,T=0;T<s;T++)for(rt=0;rt<s;rt++)H=lt+T-f,tt=nt+rt-f,!(H<0||H>=m||tt<0||tt>=g)&&(J=(H*g+tt)*4,Z=u[T*s+rt],S+=a[J]*Z,A+=a[J+1]*Z,P+=a[J+2]*Z,w||(X+=a[J+3]*Z));C[K]=S,C[K+1]=A,C[K+2]=P,w?C[K+3]=a[K+3]:C[K+3]=X}r.imageData=v},getUniformLocations:function(r,i){return{uMatrix:r.getUniformLocation(i,"uMatrix"),uOpaque:r.getUniformLocation(i,"uOpaque"),uHalfSize:r.getUniformLocation(i,"uHalfSize"),uSize:r.getUniformLocation(i,"uSize")}},sendUniformData:function(r,i){r.uniform1fv(i.uMatrix,this.matrix)},toObject:function(){return l(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),e.Image.filters.Convolute.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.Image.filters,o=e.util.createClass;l.Grayscale=o(l.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(n){var r=n.imageData,i=r.data,a,u=i.length,s,f=this.mode;for(a=0;a<u;a+=4)f==="average"?s=(i[a]+i[a+1]+i[a+2])/3:f==="lightness"?s=(Math.min(i[a],i[a+1],i[a+2])+Math.max(i[a],i[a+1],i[a+2]))/2:f==="luminosity"&&(s=.21*i[a]+.72*i[a+1]+.07*i[a+2]),i[a]=s,i[a+1]=s,i[a+2]=s},retrieveShader:function(n){var r=this.type+"_"+this.mode;if(!n.programCache.hasOwnProperty(r)){var i=this.fragmentSource[this.mode];n.programCache[r]=this.createProgram(n.context,i)}return n.programCache[r]},getUniformLocations:function(n,r){return{uMode:n.getUniformLocation(r,"uMode")}},sendUniformData:function(n,r){var i=1;n.uniform1i(r.uMode,i)},isNeutralState:function(){return!1}}),e.Image.filters.Grayscale.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.Image.filters,o=e.util.createClass;l.Invert=o(l.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(n){var r=n.imageData,i=r.data,a,u=i.length;for(a=0;a<u;a+=4)i[a]=255-i[a],i[a+1]=255-i[a+1],i[a+2]=255-i[a+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(n,r){return{uInvert:n.getUniformLocation(r,"uInvert")}},sendUniformData:function(n,r){n.uniform1i(r.uInvert,this.invert)}}),e.Image.filters.Invert.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.util.object.extend,o=e.Image.filters,n=e.util.createClass;o.Noise=n(o.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(r){if(this.noise!==0){var i=r.imageData,a=i.data,u,s=a.length,f=this.noise,g;for(u=0,s=a.length;u<s;u+=4)g=(.5-Math.random())*f,a[u]+=g,a[u+1]+=g,a[u+2]+=g}},getUniformLocations:function(r,i){return{uNoise:r.getUniformLocation(i,"uNoise"),uSeed:r.getUniformLocation(i,"uSeed")}},sendUniformData:function(r,i){r.uniform1f(i.uNoise,this.noise/255),r.uniform1f(i.uSeed,Math.random())},toObject:function(){return l(this.callSuper("toObject"),{noise:this.noise})}}),e.Image.filters.Noise.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.Image.filters,o=e.util.createClass;l.Pixelate=o(l.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(n){var r=n.imageData,i=r.data,a=r.height,u=r.width,s,f,g,m,v,C,w,S,A,P,X;for(f=0;f<a;f+=this.blocksize)for(g=0;g<u;g+=this.blocksize)for(s=f*4*u+g*4,m=i[s],v=i[s+1],C=i[s+2],w=i[s+3],P=Math.min(f+this.blocksize,a),X=Math.min(g+this.blocksize,u),S=f;S<P;S++)for(A=g;A<X;A++)s=S*4*u+A*4,i[s]=m,i[s+1]=v,i[s+2]=C,i[s+3]=w},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(n,r){return{uBlocksize:n.getUniformLocation(r,"uBlocksize"),uStepW:n.getUniformLocation(r,"uStepW"),uStepH:n.getUniformLocation(r,"uStepH")}},sendUniformData:function(n,r){n.uniform1f(r.uBlocksize,this.blocksize)}}),e.Image.filters.Pixelate.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.util.object.extend,o=e.Image.filters,n=e.util.createClass;o.RemoveColor=n(o.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(r){var i=r.imageData,a=i.data,u,s=this.distance*255,f,g,m,v=new e.Color(this.color).getSource(),C=[v[0]-s,v[1]-s,v[2]-s],w=[v[0]+s,v[1]+s,v[2]+s];for(u=0;u<a.length;u+=4)f=a[u],g=a[u+1],m=a[u+2],f>C[0]&&g>C[1]&&m>C[2]&&f<w[0]&&g<w[1]&&m<w[2]&&(a[u+3]=0)},getUniformLocations:function(r,i){return{uLow:r.getUniformLocation(i,"uLow"),uHigh:r.getUniformLocation(i,"uHigh")}},sendUniformData:function(r,i){var a=new e.Color(this.color).getSource(),u=parseFloat(this.distance),s=[0+a[0]/255-u,0+a[1]/255-u,0+a[2]/255-u,1],f=[a[0]/255+u,a[1]/255+u,a[2]/255+u,1];r.uniform4fv(i.uLow,s),r.uniform4fv(i.uHigh,f)},toObject:function(){return l(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),e.Image.filters.RemoveColor.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.Image.filters,o=e.util.createClass,n={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var r in n)l[r]=o(l.ColorMatrix,{type:r,matrix:n[r],mainParameter:!1,colorsOnly:!0}),e.Image.filters[r].fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric,l=e.Image.filters,o=e.util.createClass;l.BlendColor=o(l.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(n){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[n]+`}
}`},retrieveShader:function(n){var r=this.type+"_"+this.mode,i;return n.programCache.hasOwnProperty(r)||(i=this.buildSource(this.mode),n.programCache[r]=this.createProgram(n.context,i)),n.programCache[r]},applyTo2d:function(n){var r=n.imageData,i=r.data,a=i.length,u,s,f,g,m,v,C,w=1-this.alpha;C=new e.Color(this.color).getSource(),u=C[0]*this.alpha,s=C[1]*this.alpha,f=C[2]*this.alpha;for(var S=0;S<a;S+=4)switch(g=i[S],m=i[S+1],v=i[S+2],this.mode){case"multiply":i[S]=g*u/255,i[S+1]=m*s/255,i[S+2]=v*f/255;break;case"screen":i[S]=255-(255-g)*(255-u)/255,i[S+1]=255-(255-m)*(255-s)/255,i[S+2]=255-(255-v)*(255-f)/255;break;case"add":i[S]=g+u,i[S+1]=m+s,i[S+2]=v+f;break;case"diff":case"difference":i[S]=Math.abs(g-u),i[S+1]=Math.abs(m-s),i[S+2]=Math.abs(v-f);break;case"subtract":i[S]=g-u,i[S+1]=m-s,i[S+2]=v-f;break;case"darken":i[S]=Math.min(g,u),i[S+1]=Math.min(m,s),i[S+2]=Math.min(v,f);break;case"lighten":i[S]=Math.max(g,u),i[S+1]=Math.max(m,s),i[S+2]=Math.max(v,f);break;case"overlay":i[S]=u<128?2*g*u/255:255-2*(255-g)*(255-u)/255,i[S+1]=s<128?2*m*s/255:255-2*(255-m)*(255-s)/255,i[S+2]=f<128?2*v*f/255:255-2*(255-v)*(255-f)/255;break;case"exclusion":i[S]=u+g-2*u*g/255,i[S+1]=s+m-2*s*m/255,i[S+2]=f+v-2*f*v/255;break;case"tint":i[S]=u+g*w,i[S+1]=s+m*w,i[S+2]=f+v*w}},getUniformLocations:function(n,r){return{uColor:n.getUniformLocation(r,"uColor")}},sendUniformData:function(n,r){var i=new e.Color(this.color).getSource();i[0]=this.alpha*i[0]/255,i[1]=this.alpha*i[1]/255,i[2]=this.alpha*i[2]/255,i[3]=this.alpha,n.uniform4fv(r.uColor,i)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),e.Image.filters.BlendColor.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric,l=e.Image.filters,o=e.util.createClass;l.BlendImage=o(l.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(n){var r=this.type+"_"+this.mode,i=this.fragmentSource[this.mode];return n.programCache.hasOwnProperty(r)||(n.programCache[r]=this.createProgram(n.context,i)),n.programCache[r]},applyToWebGL:function(n){var r=n.context,i=this.createTexture(n.filterBackend,this.image);this.bindAdditionalTexture(r,i,r.TEXTURE1),this.callSuper("applyToWebGL",n),this.unbindAdditionalTexture(r,r.TEXTURE1)},createTexture:function(n,r){return n.getCachedTexture(r.cacheKey,r._element)},calculateMatrix:function(){var n=this.image,r=n._element.width,i=n._element.height;return[1/n.scaleX,0,0,0,1/n.scaleY,0,-n.left/r,-n.top/i,1]},applyTo2d:function(n){var r=n.imageData,i=n.filterBackend.resources,a=r.data,u=a.length,s=r.width,f=r.height,g,m,v,C,w,S,A,P,X,K,tt=this.image,H;i.blendImage||(i.blendImage=e.util.createCanvasElement()),X=i.blendImage,K=X.getContext("2d"),X.width!==s||X.height!==f?(X.width=s,X.height=f):K.clearRect(0,0,s,f),K.setTransform(tt.scaleX,0,0,tt.scaleY,tt.left,tt.top),K.drawImage(tt._element,0,0,s,f),H=K.getImageData(0,0,s,f).data;for(var J=0;J<u;J+=4)switch(w=a[J],S=a[J+1],A=a[J+2],P=a[J+3],g=H[J],m=H[J+1],v=H[J+2],C=H[J+3],this.mode){case"multiply":a[J]=w*g/255,a[J+1]=S*m/255,a[J+2]=A*v/255,a[J+3]=P*C/255;break;case"mask":a[J+3]=C;break}},getUniformLocations:function(n,r){return{uTransformMatrix:n.getUniformLocation(r,"uTransformMatrix"),uImage:n.getUniformLocation(r,"uImage")}},sendUniformData:function(n,r){var i=this.calculateMatrix();n.uniform1i(r.uImage,1),n.uniformMatrix3fv(r.uTransformMatrix,!1,i)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),e.Image.filters.BlendImage.fromObject=function(n,r){e.Image.fromObject(n.image,function(i){var a=e.util.object.clone(n);a.image=i,r(new e.Image.filters.BlendImage(a))})}}(c),function(h){var e=h.fabric||(h.fabric={}),l=Math.pow,o=Math.floor,n=Math.sqrt,r=Math.abs,i=Math.round,a=Math.sin,u=Math.ceil,s=e.Image.filters,f=e.util.createClass;s.Resize=f(s.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(g,m){return{uDelta:g.getUniformLocation(m,"uDelta"),uTaps:g.getUniformLocation(m,"uTaps")}},sendUniformData:function(g,m){g.uniform2fv(m.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),g.uniform1fv(m.uTaps,this.taps)},retrieveShader:function(g){var m=this.getFilterWindow(),v=this.type+"_"+m;if(!g.programCache.hasOwnProperty(v)){var C=this.generateShader(m);g.programCache[v]=this.createProgram(g.context,C)}return g.programCache[v]},getFilterWindow:function(){var g=this.tempScale;return Math.ceil(this.lanczosLobes/g)},getTaps:function(){for(var g=this.lanczosCreate(this.lanczosLobes),m=this.tempScale,v=this.getFilterWindow(),C=new Array(v),w=1;w<=v;w++)C[w-1]=g(w*m);return C},generateShader:function(C){for(var m=new Array(C),v=this.fragmentSourceTOP,C,w=1;w<=C;w++)m[w-1]=w+".0 * uDelta";return v+="uniform float uTaps["+C+`];
`,v+=`void main() {
`,v+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,v+=`  float sum = 1.0;
`,m.forEach(function(S,A){v+="  color += texture2D(uTexture, vTexCoord + "+S+") * uTaps["+A+`];
`,v+="  color += texture2D(uTexture, vTexCoord - "+S+") * uTaps["+A+`];
`,v+="  sum += 2.0 * uTaps["+A+`];
`}),v+=`  gl_FragColor = color / sum;
`,v+="}",v},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(g){g.webgl?(g.passes++,this.width=g.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=g.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),g.destinationWidth=this.dW,this._setupFrameBuffer(g),this.applyToWebGL(g),this._swapTextures(g),g.sourceWidth=g.destinationWidth,this.height=g.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),g.destinationHeight=this.dH,this._setupFrameBuffer(g),this.applyToWebGL(g),this._swapTextures(g),g.sourceHeight=g.destinationHeight):this.applyTo2d(g)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(g){return function(m){if(m>=g||m<=-g)return 0;if(m<11920929e-14&&m>-11920929e-14)return 1;m*=Math.PI;var v=m/g;return a(m)/m*a(v)/v}},applyTo2d:function(g){var m=g.imageData,v=this.scaleX,C=this.scaleY;this.rcpScaleX=1/v,this.rcpScaleY=1/C;var w=m.width,S=m.height,A=i(w*v),P=i(S*C),X;this.resizeType==="sliceHack"?X=this.sliceByTwo(g,w,S,A,P):this.resizeType==="hermite"?X=this.hermiteFastResize(g,w,S,A,P):this.resizeType==="bilinear"?X=this.bilinearFiltering(g,w,S,A,P):this.resizeType==="lanczos"&&(X=this.lanczosResize(g,w,S,A,P)),g.imageData=X},sliceByTwo:function(g,m,v,C,w){var S=g.imageData,A=.5,P=!1,X=!1,K=m*A,tt=v*A,H=e.filterBackend.resources,J,Z,nt=0,lt=0,rt=m,T=0;for(H.sliceByTwo||(H.sliceByTwo=document.createElement("canvas")),J=H.sliceByTwo,(J.width<m*1.5||J.height<v)&&(J.width=m*1.5,J.height=v),Z=J.getContext("2d"),Z.clearRect(0,0,m*1.5,v),Z.putImageData(S,0,0),C=o(C),w=o(w);!P||!X;)m=K,v=tt,C<o(K*A)?K=o(K*A):(K=C,P=!0),w<o(tt*A)?tt=o(tt*A):(tt=w,X=!0),Z.drawImage(J,nt,lt,m,v,rt,T,K,tt),nt=rt,lt=T,T+=tt;return Z.getImageData(nt,lt,C,w)},lanczosResize:function(g,m,v,C,w){function S(D){var k,B,O,x,I,L,Y,j,G,M,et;for(T.x=(D+.5)*tt,E.x=o(T.x),k=0;k<w;k++){for(T.y=(k+.5)*H,E.y=o(T.y),I=0,L=0,Y=0,j=0,G=0,B=E.x-nt;B<=E.x+nt;B++)if(!(B<0||B>=m)){M=o(1e3*r(B-T.x)),rt[M]||(rt[M]={});for(var W=E.y-lt;W<=E.y+lt;W++)W<0||W>=v||(et=o(1e3*r(W-T.y)),rt[M][et]||(rt[M][et]=K(n(l(M*J,2)+l(et*Z,2))/1e3)),O=rt[M][et],O>0&&(x=(W*m+B)*4,I+=O,L+=O*A[x],Y+=O*A[x+1],j+=O*A[x+2],G+=O*A[x+3]))}x=(k*C+D)*4,X[x]=L/I,X[x+1]=Y/I,X[x+2]=j/I,X[x+3]=G/I}return++D<C?S(D):P}var A=g.imageData.data,P=g.ctx.createImageData(C,w),X=P.data,K=this.lanczosCreate(this.lanczosLobes),tt=this.rcpScaleX,H=this.rcpScaleY,J=2/this.rcpScaleX,Z=2/this.rcpScaleY,nt=u(tt*this.lanczosLobes/2),lt=u(H*this.lanczosLobes/2),rt={},T={},E={};return S(0)},bilinearFiltering:function(g,m,v,C,w){var S,A,P,X,K,tt,H,J,Z,nt,lt,rt,T=0,E,D=this.rcpScaleX,k=this.rcpScaleY,B=4*(m-1),O=g.imageData,x=O.data,I=g.ctx.createImageData(C,w),L=I.data;for(H=0;H<w;H++)for(J=0;J<C;J++)for(K=o(D*J),tt=o(k*H),Z=D*J-K,nt=k*H-tt,E=4*(tt*m+K),lt=0;lt<4;lt++)S=x[E+lt],A=x[E+4+lt],P=x[E+B+lt],X=x[E+B+4+lt],rt=S*(1-Z)*(1-nt)+A*Z*(1-nt)+P*nt*(1-Z)+X*Z*nt,L[T++]=rt;return I},hermiteFastResize:function(g,m,v,C,w){for(var S=this.rcpScaleX,A=this.rcpScaleY,P=u(S/2),X=u(A/2),K=g.imageData,tt=K.data,H=g.ctx.createImageData(C,w),J=H.data,Z=0;Z<w;Z++)for(var nt=0;nt<C;nt++){for(var lt=(nt+Z*C)*4,rt=0,T=0,E=0,D=0,k=0,B=0,O=0,x=(Z+.5)*A,I=o(Z*A);I<(Z+1)*A;I++)for(var L=r(x-(I+.5))/X,Y=(nt+.5)*S,j=L*L,G=o(nt*S);G<(nt+1)*S;G++){var M=r(Y-(G+.5))/P,et=n(j+M*M);et>1&&et<-1||(rt=2*et*et*et-3*et*et+1,rt>0&&(M=4*(G+I*m),O+=rt*tt[M+3],E+=rt,tt[M+3]<255&&(rt=rt*tt[M+3]/250),D+=rt*tt[M],k+=rt*tt[M+1],B+=rt*tt[M+2],T+=rt))}J[lt]=D/T,J[lt+1]=k/T,J[lt+2]=B/T,J[lt+3]=O/E}return H},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),e.Image.filters.Resize.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.Image.filters,o=e.util.createClass;l.Contrast=o(l.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(n){if(this.contrast!==0){var r=n.imageData,i,u,a=r.data,u=a.length,s=Math.floor(this.contrast*255),f=259*(s+255)/(255*(259-s));for(i=0;i<u;i+=4)a[i]=f*(a[i]-128)+128,a[i+1]=f*(a[i+1]-128)+128,a[i+2]=f*(a[i+2]-128)+128}},getUniformLocations:function(n,r){return{uContrast:n.getUniformLocation(r,"uContrast")}},sendUniformData:function(n,r){n.uniform1f(r.uContrast,this.contrast)}}),e.Image.filters.Contrast.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.Image.filters,o=e.util.createClass;l.Saturation=o(l.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(n){if(this.saturation!==0){var r=n.imageData,i=r.data,a=i.length,u=-this.saturation,s,f;for(s=0;s<a;s+=4)f=Math.max(i[s],i[s+1],i[s+2]),i[s]+=f!==i[s]?(f-i[s])*u:0,i[s+1]+=f!==i[s+1]?(f-i[s+1])*u:0,i[s+2]+=f!==i[s+2]?(f-i[s+2])*u:0}},getUniformLocations:function(n,r){return{uSaturation:n.getUniformLocation(r,"uSaturation")}},sendUniformData:function(n,r){n.uniform1f(r.uSaturation,-this.saturation)}}),e.Image.filters.Saturation.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.Image.filters,o=e.util.createClass;l.Vibrance=o(l.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(n){if(this.vibrance!==0){var r=n.imageData,i=r.data,a=i.length,u=-this.vibrance,s,f,g,m;for(s=0;s<a;s+=4)f=Math.max(i[s],i[s+1],i[s+2]),g=(i[s]+i[s+1]+i[s+2])/3,m=Math.abs(f-g)*2/255*u,i[s]+=f!==i[s]?(f-i[s])*m:0,i[s+1]+=f!==i[s+1]?(f-i[s+1])*m:0,i[s+2]+=f!==i[s+2]?(f-i[s+2])*m:0}},getUniformLocations:function(n,r){return{uVibrance:n.getUniformLocation(r,"uVibrance")}},sendUniformData:function(n,r){n.uniform1f(r.uVibrance,-this.vibrance)}}),e.Image.filters.Vibrance.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.Image.filters,o=e.util.createClass;l.Blur=o(l.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(n){n.webgl?(this.aspectRatio=n.sourceWidth/n.sourceHeight,n.passes++,this._setupFrameBuffer(n),this.horizontal=!0,this.applyToWebGL(n),this._swapTextures(n),this._setupFrameBuffer(n),this.horizontal=!1,this.applyToWebGL(n),this._swapTextures(n)):this.applyTo2d(n)},applyTo2d:function(n){n.imageData=this.simpleBlur(n)},simpleBlur:function(n){var r=n.filterBackend.resources,i,a,u=n.imageData.width,s=n.imageData.height;r.blurLayer1||(r.blurLayer1=e.util.createCanvasElement(),r.blurLayer2=e.util.createCanvasElement()),i=r.blurLayer1,a=r.blurLayer2,(i.width!==u||i.height!==s)&&(a.width=i.width=u,a.height=i.height=s);var f=i.getContext("2d"),g=a.getContext("2d"),m=15,v,C,w,S,A=this.blur*.06*.5;for(f.putImageData(n.imageData,0,0),g.clearRect(0,0,u,s),S=-m;S<=m;S++)v=(Math.random()-.5)/4,C=S/m,w=A*C*u+v,g.globalAlpha=1-Math.abs(C),g.drawImage(i,w,v),f.drawImage(a,0,0),g.globalAlpha=1,g.clearRect(0,0,a.width,a.height);for(S=-m;S<=m;S++)v=(Math.random()-.5)/4,C=S/m,w=A*C*s+v,g.globalAlpha=1-Math.abs(C),g.drawImage(i,v,w),f.drawImage(a,0,0),g.globalAlpha=1,g.clearRect(0,0,a.width,a.height);n.ctx.drawImage(i,0,0);var P=n.ctx.getImageData(0,0,i.width,i.height);return f.globalAlpha=1,f.clearRect(0,0,i.width,i.height),P},getUniformLocations:function(n,r){return{delta:n.getUniformLocation(r,"uDelta")}},sendUniformData:function(n,r){var i=this.chooseRightDelta();n.uniform2fv(r.delta,i)},chooseRightDelta:function(){var n=1,r=[0,0],i;return this.horizontal?this.aspectRatio>1&&(n=1/this.aspectRatio):this.aspectRatio<1&&(n=this.aspectRatio),i=n*this.blur*.12,this.horizontal?r[0]=i:r[1]=i,r}}),l.Blur.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.Image.filters,o=e.util.createClass;l.Gamma=o(l.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(n){this.gamma=[1,1,1],l.BaseFilter.prototype.initialize.call(this,n)},applyTo2d:function(n){var r=n.imageData,i=r.data,a=this.gamma,u=i.length,s=1/a[0],f=1/a[1],g=1/a[2],m;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),m=0,u=256;m<u;m++)this.rVals[m]=Math.pow(m/255,s)*255,this.gVals[m]=Math.pow(m/255,f)*255,this.bVals[m]=Math.pow(m/255,g)*255;for(m=0,u=i.length;m<u;m+=4)i[m]=this.rVals[i[m]],i[m+1]=this.gVals[i[m+1]],i[m+2]=this.bVals[i[m+2]]},getUniformLocations:function(n,r){return{uGamma:n.getUniformLocation(r,"uGamma")}},sendUniformData:function(n,r){n.uniform3fv(r.uGamma,this.gamma)}}),e.Image.filters.Gamma.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.Image.filters,o=e.util.createClass;l.Composed=o(l.BaseFilter,{type:"Composed",subFilters:[],initialize:function(n){this.callSuper("initialize",n),this.subFilters=this.subFilters.slice(0)},applyTo:function(n){n.passes+=this.subFilters.length-1,this.subFilters.forEach(function(r){r.applyTo(n)})},toObject:function(){return e.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(n){return n.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(n){return!n.isNeutralState()})}}),e.Image.filters.Composed.fromObject=function(n,r){var i=n.subFilters||[],a=i.map(function(s){return new e.Image.filters[s.type](s)}),u=new e.Image.filters.Composed({subFilters:a});return r&&r(u),u}}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.Image.filters,o=e.util.createClass;l.HueRotation=o(l.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var n=this.rotation*Math.PI,r=e.util.cos(n),i=e.util.sin(n),a=1/3,u=Math.sqrt(a)*i,s=1-r;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=r+s/3,this.matrix[1]=a*s-u,this.matrix[2]=a*s+u,this.matrix[5]=a*s+u,this.matrix[6]=r+a*s,this.matrix[7]=a*s-u,this.matrix[10]=a*s-u,this.matrix[11]=a*s+u,this.matrix[12]=r+a*s},isNeutralState:function(n){return this.calculateMatrix(),l.BaseFilter.prototype.isNeutralState.call(this,n)},applyTo:function(n){this.calculateMatrix(),l.BaseFilter.prototype.applyTo.call(this,n)}}),e.Image.filters.HueRotation.fromObject=e.Image.filters.BaseFilter.fromObject}(c),function(h){var e=h.fabric||(h.fabric={}),l=e.util.object.clone;if(e.Text){e.warn("fabric.Text is already defined");return}var o="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");e.Text=e.util.createClass(e.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:e.Object.prototype.stateProperties.concat(o),cacheProperties:e.Object.prototype.cacheProperties.concat(o),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(n,r){this.styles=r?r.styles||{}:{},this.text=n,this.__skipDimension=!0,this.callSuper("initialize",r),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var n=this.path;n&&(n.segmentsInfo=e.util.getPathSegmentsInfo(n.path))},getMeasuringContext:function(){return e._measuringContext||(e._measuringContext=this.canvas&&this.canvas.contextCache||e.util.createCanvasElement().getContext("2d")),e._measuringContext},_splitText:function(){var n=this._splitTextIntoLines(this.text);return this.textLines=n.lines,this._textLines=n.graphemeLines,this._unwrappedTextLines=n._unwrappedLines,this._text=n.graphemeText,n},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var n,r,i,a,u,s,f,g=0,m=this._textLines.length;g<m;g++)if(!(this.textAlign!=="justify"&&(g===m-1||this.isEndOfWrapping(g)))&&(a=0,u=this._textLines[g],r=this.getLineWidth(g),r<this.width&&(f=this.textLines[g].match(this._reSpacesAndTabs)))){i=f.length,n=(this.width-r)/i;for(var v=0,C=u.length;v<=C;v++)s=this.__charBounds[g][v],this._reSpaceAndTab.test(u[v])?(s.width+=n,s.kernedWidth+=n,s.left+=a,a+=n):s.left+=a}},isEndOfWrapping:function(n){return n===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var n=this.callSuper("_getCacheCanvasDimensions"),r=this.fontSize;return n.width+=r*n.zoomX,n.height+=r*n.zoomY,n},_render:function(n){var r=this.path;r&&!r.isNotVisible()&&r._render(n),this._setTextStyles(n),this._renderTextLinesBackground(n),this._renderTextDecoration(n,"underline"),this._renderText(n),this._renderTextDecoration(n,"overline"),this._renderTextDecoration(n,"linethrough")},_renderText:function(n){this.paintFirst==="stroke"?(this._renderTextStroke(n),this._renderTextFill(n)):(this._renderTextFill(n),this._renderTextStroke(n))},_setTextStyles:function(n,r,i){if(n.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":n.textBaseline="middle";break;case"ascender":n.textBaseline="top";break;case"descender":n.textBaseline="bottom";break}n.font=this._getFontDeclaration(r,i)},calcTextWidth:function(){for(var n=this.getLineWidth(0),r=1,i=this._textLines.length;r<i;r++){var a=this.getLineWidth(r);a>n&&(n=a)}return n},_renderTextLine:function(n,r,i,a,u,s){this._renderChars(n,r,i,a,u,s)},_renderTextLinesBackground:function(n){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var r,i,a=n.fillStyle,u,s,f=this._getLeftOffset(),g=this._getTopOffset(),m=0,v=0,C,w,S=this.path,A,P=0,X=this._textLines.length;P<X;P++){if(r=this.getHeightOfLine(P),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",P)){g+=r;continue}u=this._textLines[P],i=this._getLineLeftOffset(P),v=0,m=0,s=this.getValueOfPropertyAt(P,0,"textBackgroundColor");for(var K=0,tt=u.length;K<tt;K++)C=this.__charBounds[P][K],w=this.getValueOfPropertyAt(P,K,"textBackgroundColor"),S?(n.save(),n.translate(C.renderLeft,C.renderTop),n.rotate(C.angle),n.fillStyle=w,w&&n.fillRect(-C.width/2,-r/this.lineHeight*(1-this._fontSizeFraction),C.width,r/this.lineHeight),n.restore()):w!==s?(A=f+i+m,this.direction==="rtl"&&(A=this.width-A-v),n.fillStyle=s,s&&n.fillRect(A,g,v,r/this.lineHeight),m=C.left,v=C.width,s=w):v+=C.kernedWidth;w&&!S&&(A=f+i+m,this.direction==="rtl"&&(A=this.width-A-v),n.fillStyle=w,n.fillRect(A,g,v,r/this.lineHeight)),g+=r}n.fillStyle=a,this._removeShadow(n)}},getFontCache:function(n){var r=n.fontFamily.toLowerCase();e.charWidthsCache[r]||(e.charWidthsCache[r]={});var i=e.charWidthsCache[r],a=n.fontStyle.toLowerCase()+"_"+(n.fontWeight+"").toLowerCase();return i[a]||(i[a]={}),i[a]},_measureChar:function(n,r,i,a){var u=this.getFontCache(r),s=this._getFontDeclaration(r),f=this._getFontDeclaration(a),g=i+n,m=s===f,v,C,w,S=r.fontSize/this.CACHE_FONT_SIZE,A;if(i&&u[i]!==void 0&&(w=u[i]),u[n]!==void 0&&(A=v=u[n]),m&&u[g]!==void 0&&(C=u[g],A=C-w),v===void 0||w===void 0||C===void 0){var P=this.getMeasuringContext();this._setTextStyles(P,r,!0)}return v===void 0&&(A=v=P.measureText(n).width,u[n]=v),w===void 0&&m&&i&&(w=P.measureText(i).width,u[i]=w),m&&C===void 0&&(C=P.measureText(g).width,u[g]=C,A=C-w),{width:v*S,kernedWidth:A*S}},getHeightOfChar:function(n,r){return this.getValueOfPropertyAt(n,r,"fontSize")},measureLine:function(n){var r=this._measureLine(n);return this.charSpacing!==0&&(r.width-=this._getWidthOfCharSpacing()),r.width<0&&(r.width=0),r},_measureLine:function(n){var r=0,i,a,u=this._textLines[n],s,f,g=0,m=new Array(u.length),v=0,C,w,S=this.path,A=this.pathSide==="right";for(this.__charBounds[n]=m,i=0;i<u.length;i++)a=u[i],f=this._getGraphemeBox(a,n,i,s),m[i]=f,r+=f.kernedWidth,s=a;if(m[i]={left:f?f.left+f.width:0,width:0,kernedWidth:0,height:this.fontSize},S){switch(w=S.segmentsInfo[S.segmentsInfo.length-1].length,C=e.util.getPointOnPath(S.path,0,S.segmentsInfo),C.x+=S.pathOffset.x,C.y+=S.pathOffset.y,this.textAlign){case"left":v=A?w-r:0;break;case"center":v=(w-r)/2;break;case"right":v=A?0:w-r;break}for(v+=this.pathStartOffset*(A?-1:1),i=A?u.length-1:0;A?i>=0:i<u.length;A?i--:i++)f=m[i],v>w?v%=w:v<0&&(v+=w),this._setGraphemeOnPath(v,f,C),v+=f.kernedWidth}return{width:r,numOfSpaces:g}},_setGraphemeOnPath:function(n,r,i){var a=n+r.kernedWidth/2,u=this.path,s=e.util.getPointOnPath(u.path,a,u.segmentsInfo);r.renderLeft=s.x-i.x,r.renderTop=s.y-i.y,r.angle=s.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(n,r,i,a,u){var s=this.getCompleteStyleDeclaration(r,i),f=a?this.getCompleteStyleDeclaration(r,i-1):{},g=this._measureChar(n,s,a,f),m=g.kernedWidth,v=g.width,C;this.charSpacing!==0&&(C=this._getWidthOfCharSpacing(),v+=C,m+=C);var w={width:v,left:0,height:s.fontSize,kernedWidth:m,deltaY:s.deltaY};if(i>0&&!u){var S=this.__charBounds[r][i-1];w.left=S.left+S.width+g.kernedWidth-g.width}return w},getHeightOfLine:function(n){if(this.__lineHeights[n])return this.__lineHeights[n];for(var r=this._textLines[n],i=this.getHeightOfChar(n,0),a=1,u=r.length;a<u;a++)i=Math.max(this.getHeightOfChar(n,a),i);return this.__lineHeights[n]=i*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var n,r=0,i=0,a=this._textLines.length;i<a;i++)n=this.getHeightOfLine(i),r+=i===a-1?n/this.lineHeight:n;return r},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(n,r){n.save();for(var i=0,a=this._getLeftOffset(),u=this._getTopOffset(),s=0,f=this._textLines.length;s<f;s++){var g=this.getHeightOfLine(s),m=g/this.lineHeight,v=this._getLineLeftOffset(s);this._renderTextLine(r,n,this._textLines[s],a+v,u+i+m,s),i+=g}n.restore()},_renderTextFill:function(n){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(n,"fillText")},_renderTextStroke:function(n){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(n),n.save(),this._setLineDash(n,this.strokeDashArray),n.beginPath(),this._renderTextCommon(n,"strokeText"),n.closePath(),n.restore())},_renderChars:function(n,r,i,a,u,s){var f=this.getHeightOfLine(s),g=this.textAlign.indexOf("justify")!==-1,m,v,C="",w,S=0,A,P=this.path,X=!g&&this.charSpacing===0&&this.isEmptyStyles(s)&&!P,K=this.direction==="ltr",tt=this.direction==="ltr"?1:-1,H,J=r.canvas.getAttribute("dir");if(r.save(),J!==this.direction&&(r.canvas.setAttribute("dir",K?"ltr":"rtl"),r.direction=K?"ltr":"rtl",r.textAlign=K?"left":"right"),u-=f*this._fontSizeFraction/this.lineHeight,X){this._renderChar(n,r,s,0,i.join(""),a,u,f),r.restore();return}for(var Z=0,nt=i.length-1;Z<=nt;Z++)A=Z===nt||this.charSpacing||P,C+=i[Z],w=this.__charBounds[s][Z],S===0?(a+=tt*(w.kernedWidth-w.width),S+=w.width):S+=w.kernedWidth,g&&!A&&this._reSpaceAndTab.test(i[Z])&&(A=!0),A||(m=m||this.getCompleteStyleDeclaration(s,Z),v=this.getCompleteStyleDeclaration(s,Z+1),A=e.util.hasStyleChanged(m,v,!1)),A&&(P?(r.save(),r.translate(w.renderLeft,w.renderTop),r.rotate(w.angle),this._renderChar(n,r,s,Z,C,-S/2,0,f),r.restore()):(H=a,this._renderChar(n,r,s,Z,C,H,u,f)),C="",m=v,a+=tt*S,S=0);r.restore()},_applyPatternGradientTransformText:function(n){var r=e.util.createCanvasElement(),i,a=this.width+this.strokeWidth,u=this.height+this.strokeWidth;return r.width=a,r.height=u,i=r.getContext("2d"),i.beginPath(),i.moveTo(0,0),i.lineTo(a,0),i.lineTo(a,u),i.lineTo(0,u),i.closePath(),i.translate(a/2,u/2),i.fillStyle=n.toLive(i),this._applyPatternGradientTransform(i,n),i.fill(),i.createPattern(r,"no-repeat")},handleFiller:function(n,r,i){var a,u;return i.toLive?i.gradientUnits==="percentage"||i.gradientTransform||i.patternTransform?(a=-this.width/2,u=-this.height/2,n.translate(a,u),n[r]=this._applyPatternGradientTransformText(i),{offsetX:a,offsetY:u}):(n[r]=i.toLive(n,this),this._applyPatternGradientTransform(n,i)):(n[r]=i,{offsetX:0,offsetY:0})},_setStrokeStyles:function(n,r){return n.lineWidth=r.strokeWidth,n.lineCap=this.strokeLineCap,n.lineDashOffset=this.strokeDashOffset,n.lineJoin=this.strokeLineJoin,n.miterLimit=this.strokeMiterLimit,this.handleFiller(n,"strokeStyle",r.stroke)},_setFillStyles:function(n,r){return this.handleFiller(n,"fillStyle",r.fill)},_renderChar:function(n,r,i,a,u,s,f){var g=this._getStyleDeclaration(i,a),m=this.getCompleteStyleDeclaration(i,a),v=n==="fillText"&&m.fill,C=n==="strokeText"&&m.stroke&&m.strokeWidth,w,S;!C&&!v||(r.save(),v&&(w=this._setFillStyles(r,m)),C&&(S=this._setStrokeStyles(r,m)),r.font=this._getFontDeclaration(m),g&&g.textBackgroundColor&&this._removeShadow(r),g&&g.deltaY&&(f+=g.deltaY),v&&r.fillText(u,s-w.offsetX,f-w.offsetY),C&&r.strokeText(u,s-S.offsetX,f-S.offsetY),r.restore())},setSuperscript:function(n,r){return this._setScript(n,r,this.superscript)},setSubscript:function(n,r){return this._setScript(n,r,this.subscript)},_setScript:function(n,r,i){var a=this.get2DCursorLocation(n,!0),u=this.getValueOfPropertyAt(a.lineIndex,a.charIndex,"fontSize"),s=this.getValueOfPropertyAt(a.lineIndex,a.charIndex,"deltaY"),f={fontSize:u*i.size,deltaY:s+u*i.baseline};return this.setSelectionStyles(f,n,r),this},_getLineLeftOffset:function(n){var r=this.getLineWidth(n),i=this.width-r,a=this.textAlign,u=this.direction,f,s=0,f=this.isEndOfWrapping(n);return a==="justify"||a==="justify-center"&&!f||a==="justify-right"&&!f||a==="justify-left"&&!f?0:(a==="center"&&(s=i/2),a==="right"&&(s=i),a==="justify-center"&&(s=i/2),a==="justify-right"&&(s=i),u==="rtl"&&(s-=i),s)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var n=this._forceClearCache;return n||(n=this.hasStateChanged("_dimensionAffectingProps")),n&&(this.dirty=!0,this._forceClearCache=!1),n},getLineWidth:function(n){if(this.__lineWidths[n]!==void 0)return this.__lineWidths[n];var r=this.measureLine(n),i=r.width;return this.__lineWidths[n]=i,i},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(n,r,i){var a=this._getStyleDeclaration(n,r);return a&&typeof a[i]<"u"?a[i]:this[i]},_renderTextDecoration:function(n,r){if(!(!this[r]&&!this.styleHas(r))){for(var i,a,u,s,f,g,m,v,C=this._getLeftOffset(),w=this._getTopOffset(),S,A,P,X,K,tt,H,J,Z=this.path,nt=this._getWidthOfCharSpacing(),lt=this.offsets[r],rt=0,T=this._textLines.length;rt<T;rt++){if(i=this.getHeightOfLine(rt),!this[r]&&!this.styleHas(r,rt)){w+=i;continue}m=this._textLines[rt],tt=i/this.lineHeight,s=this._getLineLeftOffset(rt),A=0,P=0,v=this.getValueOfPropertyAt(rt,0,r),J=this.getValueOfPropertyAt(rt,0,"fill"),S=w+tt*(1-this._fontSizeFraction),a=this.getHeightOfChar(rt,0),f=this.getValueOfPropertyAt(rt,0,"deltaY");for(var E=0,D=m.length;E<D;E++)if(X=this.__charBounds[rt][E],K=this.getValueOfPropertyAt(rt,E,r),H=this.getValueOfPropertyAt(rt,E,"fill"),u=this.getHeightOfChar(rt,E),g=this.getValueOfPropertyAt(rt,E,"deltaY"),Z&&K&&H)n.save(),n.fillStyle=J,n.translate(X.renderLeft,X.renderTop),n.rotate(X.angle),n.fillRect(-X.kernedWidth/2,lt*u+g,X.kernedWidth,this.fontSize/15),n.restore();else if((K!==v||H!==J||u!==a||g!==f)&&P>0){var k=C+s+A;this.direction==="rtl"&&(k=this.width-k-P),v&&J&&(n.fillStyle=J,n.fillRect(k,S+lt*a+f,P,this.fontSize/15)),A=X.left,P=X.width,v=K,J=H,a=u,f=g}else P+=X.kernedWidth;var k=C+s+A;this.direction==="rtl"&&(k=this.width-k-P),n.fillStyle=H,K&&H&&n.fillRect(k,S+lt*a+f,P-nt,this.fontSize/15),w+=i}this._removeShadow(n)}},_getFontDeclaration:function(n,r){var i=n||this,a=this.fontFamily,u=e.Text.genericFonts.indexOf(a.toLowerCase())>-1,s=a===void 0||a.indexOf("'")>-1||a.indexOf(",")>-1||a.indexOf('"')>-1||u?i.fontFamily:'"'+i.fontFamily+'"';return[e.isLikelyNode?i.fontWeight:i.fontStyle,e.isLikelyNode?i.fontStyle:i.fontWeight,r?this.CACHE_FONT_SIZE+"px":i.fontSize+"px",s].join(" ")},render:function(n){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",n)))},_splitTextIntoLines:function(n){for(var r=n.split(this._reNewline),i=new Array(r.length),a=[`
`],u=[],s=0;s<r.length;s++)i[s]=e.util.string.graphemeSplit(r[s]),u=u.concat(i[s],a);return u.pop(),{_unwrappedLines:i,lines:r,graphemeText:u,graphemeLines:i}},toObject:function(n){var r=o.concat(n),i=this.callSuper("toObject",r);return i.styles=e.util.stylesToArray(this.styles,this.text),i.path&&(i.path=this.path.toObject()),i},set:function(n,r){this.callSuper("set",n,r);var i=!1,a=!1;if(typeof n=="object")for(var u in n)u==="path"&&this.setPathInfo(),i=i||this._dimensionAffectingProps.indexOf(u)!==-1,a=a||u==="path";else i=this._dimensionAffectingProps.indexOf(n)!==-1,a=n==="path";return a&&this.setPathInfo(),i&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),e.Text.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),e.Text.DEFAULT_SVG_FONT_SIZE=16,e.Text.fromElement=function(n,r,i){if(!n)return r(null);var a=e.parseAttributes(n,e.Text.ATTRIBUTE_NAMES),u=a.textAnchor||"left";if(i=e.util.object.extend(i?l(i):{},a),i.top=i.top||0,i.left=i.left||0,a.textDecoration){var s=a.textDecoration;s.indexOf("underline")!==-1&&(i.underline=!0),s.indexOf("overline")!==-1&&(i.overline=!0),s.indexOf("line-through")!==-1&&(i.linethrough=!0),delete i.textDecoration}"dx"in a&&(i.left+=a.dx),"dy"in a&&(i.top+=a.dy),"fontSize"in i||(i.fontSize=e.Text.DEFAULT_SVG_FONT_SIZE);var f="";"textContent"in n?f=n.textContent:"firstChild"in n&&n.firstChild!==null&&"data"in n.firstChild&&n.firstChild.data!==null&&(f=n.firstChild.data),f=f.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var g=i.strokeWidth;i.strokeWidth=0;var m=new e.Text(f,i),v=m.getScaledHeight()/m.height,C=(m.height+m.strokeWidth)*m.lineHeight-m.height,w=C*v,S=m.getScaledHeight()+w,A=0;u==="center"&&(A=m.getScaledWidth()/2),u==="right"&&(A=m.getScaledWidth()),m.set({left:m.left-A,top:m.top-(S-m.fontSize*(.07+m._fontSizeFraction))/m.lineHeight,strokeWidth:typeof g<"u"?g:1}),r(m)},e.Text.fromObject=function(n,r){var i=l(n),a=n.path;return delete i.path,e.Object._fromObject("Text",i,function(u){u.styles=e.util.stylesFromArray(n.styles,n.text),a?e.Object._fromObject("Path",a,function(s){u.set("path",s),r(u)},"path"):r(u)},"text")},e.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],e.util.createAccessors&&e.util.createAccessors(e.Text)}(c),function(){t.util.object.extend(t.Text.prototype,{isEmptyStyles:function(h){if(!this.styles||typeof h<"u"&&!this.styles[h])return!0;var e=typeof h>"u"?this.styles:{line:this.styles[h]};for(var l in e)for(var o in e[l])for(var n in e[l][o])return!1;return!0},styleHas:function(h,e){if(!this.styles||!h||h===""||typeof e<"u"&&!this.styles[e])return!1;var l=typeof e>"u"?this.styles:{0:this.styles[e]};for(var o in l)for(var n in l[o])if(typeof l[o][n][h]<"u")return!0;return!1},cleanStyle:function(h){if(!this.styles||!h||h==="")return!1;var e=this.styles,l=0,o,n,r=!0,i=0,a;for(var u in e){o=0;for(var s in e[u]){var a=e[u][s],f=a.hasOwnProperty(h);l++,f?(n?a[h]!==n&&(r=!1):n=a[h],a[h]===this[h]&&delete a[h]):r=!1,Object.keys(a).length!==0?o++:delete e[u][s]}o===0&&delete e[u]}for(var g=0;g<this._textLines.length;g++)i+=this._textLines[g].length;r&&l===i&&(this[h]=n,this.removeStyle(h))},removeStyle:function(h){if(!(!this.styles||!h||h==="")){var e=this.styles,l,o,n;for(o in e){l=e[o];for(n in l)delete l[n][h],Object.keys(l[n]).length===0&&delete l[n];Object.keys(l).length===0&&delete e[o]}}},_extendStyles:function(h,e){var l=this.get2DCursorLocation(h);this._getLineStyle(l.lineIndex)||this._setLineStyle(l.lineIndex),this._getStyleDeclaration(l.lineIndex,l.charIndex)||this._setStyleDeclaration(l.lineIndex,l.charIndex,{}),t.util.object.extend(this._getStyleDeclaration(l.lineIndex,l.charIndex),e)},get2DCursorLocation:function(h,e){typeof h>"u"&&(h=this.selectionStart);for(var l=e?this._unwrappedTextLines:this._textLines,o=l.length,n=0;n<o;n++){if(h<=l[n].length)return{lineIndex:n,charIndex:h};h-=l[n].length+this.missingNewlineOffset(n)}return{lineIndex:n-1,charIndex:l[n-1].length<h?l[n-1].length:h}},getSelectionStyles:function(h,e,l){typeof h>"u"&&(h=this.selectionStart||0),typeof e>"u"&&(e=this.selectionEnd||h);for(var o=[],n=h;n<e;n++)o.push(this.getStyleAtPosition(n,l));return o},getStyleAtPosition:function(h,e){var l=this.get2DCursorLocation(h),o=e?this.getCompleteStyleDeclaration(l.lineIndex,l.charIndex):this._getStyleDeclaration(l.lineIndex,l.charIndex);return o||{}},setSelectionStyles:function(h,e,l){typeof e>"u"&&(e=this.selectionStart||0),typeof l>"u"&&(l=this.selectionEnd||e);for(var o=e;o<l;o++)this._extendStyles(o,h);return this._forceClearCache=!0,this},_getStyleDeclaration:function(h,e){var l=this.styles&&this.styles[h];return l?l[e]:null},getCompleteStyleDeclaration:function(h,e){for(var l=this._getStyleDeclaration(h,e)||{},o={},n,r=0;r<this._styleProperties.length;r++)n=this._styleProperties[r],o[n]=typeof l[n]>"u"?this[n]:l[n];return o},_setStyleDeclaration:function(h,e,l){this.styles[h][e]=l},_deleteStyleDeclaration:function(h,e){delete this.styles[h][e]},_getLineStyle:function(h){return!!this.styles[h]},_setLineStyle:function(h){this.styles[h]={}},_deleteLineStyle:function(h){delete this.styles[h]}})}(),function(){function h(e){e.textDecoration&&(e.textDecoration.indexOf("underline")>-1&&(e.underline=!0),e.textDecoration.indexOf("line-through")>-1&&(e.linethrough=!0),e.textDecoration.indexOf("overline")>-1&&(e.overline=!0),delete e.textDecoration)}t.IText=t.util.createClass(t.Text,t.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(e,l){this.callSuper("initialize",e,l),this.initBehavior()},setSelectionStart:function(e){e=Math.max(e,0),this._updateAndFire("selectionStart",e)},setSelectionEnd:function(e){e=Math.min(e,this.text.length),this._updateAndFire("selectionEnd",e)},_updateAndFire:function(e,l){this[e]!==l&&(this._fireSelectionChanged(),this[e]=l),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(e){this.clearContextTop(),this.callSuper("render",e),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(e){this.callSuper("_render",e)},clearContextTop:function(e){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var l=this.canvas.contextTop,o=this.canvas.viewportTransform;l.save(),l.transform(o[0],o[1],o[2],o[3],o[4],o[5]),this.transform(l),this._clearTextArea(l),e||l.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var e=this._getCursorBoundaries(),l=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(e,l):this.renderSelection(e,l),l.restore()}},_clearTextArea:function(e){var l=this.width+4,o=this.height+4;e.clearRect(-l/2,-o/2,l,o)},_getCursorBoundaries:function(e){typeof e>"u"&&(e=this.selectionStart);var l=this._getLeftOffset(),o=this._getTopOffset(),n=this._getCursorBoundariesOffsets(e);return{left:l,top:o,leftOffset:n.left,topOffset:n.top}},_getCursorBoundariesOffsets:function(e){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var l,o,n,r=0,i=0,a,u=this.get2DCursorLocation(e);n=u.charIndex,o=u.lineIndex;for(var s=0;s<o;s++)r+=this.getHeightOfLine(s);l=this._getLineLeftOffset(o);var f=this.__charBounds[o][n];return f&&(i=f.left),this.charSpacing!==0&&n===this._textLines[o].length&&(i-=this._getWidthOfCharSpacing()),a={top:r,left:l+(i>0?i:0)},this.direction==="rtl"&&(a.left*=-1),this.cursorOffsetCache=a,this.cursorOffsetCache},renderCursor:function(e,l){var o=this.get2DCursorLocation(),n=o.lineIndex,r=o.charIndex>0?o.charIndex-1:0,i=this.getValueOfPropertyAt(n,r,"fontSize"),a=this.scaleX*this.canvas.getZoom(),u=this.cursorWidth/a,s=e.topOffset,f=this.getValueOfPropertyAt(n,r,"deltaY");s+=(1-this._fontSizeFraction)*this.getHeightOfLine(n)/this.lineHeight-i*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(e,l),l.fillStyle=this.cursorColor||this.getValueOfPropertyAt(n,r,"fill"),l.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,l.fillRect(e.left+e.leftOffset-u/2,s+e.top+f,u,i)},renderSelection:function(e,l){for(var o=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,n=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,r=this.textAlign.indexOf("justify")!==-1,i=this.get2DCursorLocation(o),a=this.get2DCursorLocation(n),u=i.lineIndex,s=a.lineIndex,f=i.charIndex<0?0:i.charIndex,g=a.charIndex<0?0:a.charIndex,m=u;m<=s;m++){var v=this._getLineLeftOffset(m)||0,C=this.getHeightOfLine(m),w=0,S=0,A=0;if(m===u&&(S=this.__charBounds[u][f].left),m>=u&&m<s)A=r&&!this.isEndOfWrapping(m)?this.width:this.getLineWidth(m)||5;else if(m===s)if(g===0)A=this.__charBounds[s][g].left;else{var P=this._getWidthOfCharSpacing();A=this.__charBounds[s][g-1].left+this.__charBounds[s][g-1].width-P}w=C,(this.lineHeight<1||m===s&&this.lineHeight>1)&&(C/=this.lineHeight);var X=e.left+v+S,K=A-S,tt=C,H=0;this.inCompositionMode?(l.fillStyle=this.compositionColor||"black",tt=1,H=C):l.fillStyle=this.selectionColor,this.direction==="rtl"&&(X=this.width-X-K),l.fillRect(X,e.top+e.topOffset+H,K,tt),e.topOffset+=w}},getCurrentCharFontSize:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fontSize")},getCurrentCharColor:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fill")},_getCurrentCharIndex:function(){var e=this.get2DCursorLocation(this.selectionStart,!0),l=e.charIndex>0?e.charIndex-1:0;return{l:e.lineIndex,c:l}}}),t.IText.fromObject=function(e,l){var o=t.util.stylesFromArray(e.styles,e.text),n=Object.assign({},e,{styles:o});if(h(n),n.styles)for(var r in n.styles)for(var i in n.styles[r])h(n.styles[r][i]);t.Object._fromObject("IText",n,l,"text")}}(),function(){var h=t.util.object.clone;t.util.object.extend(t.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var e=this;this.on("added",function(){var l=e.canvas;l&&(l._hasITextHandlers||(l._hasITextHandlers=!0,e._initCanvasHandlers(l)),l._iTextInstances=l._iTextInstances||[],l._iTextInstances.push(e))})},initRemovedHandler:function(){var e=this;this.on("removed",function(){var l=e.canvas;l&&(l._iTextInstances=l._iTextInstances||[],t.util.removeFromArray(l._iTextInstances,e),l._iTextInstances.length===0&&(l._hasITextHandlers=!1,e._removeCanvasHandlers(l)))})},_initCanvasHandlers:function(e){e._mouseUpITextHandler=function(){e._iTextInstances&&e._iTextInstances.forEach(function(l){l.__isMousedown=!1})},e.on("mouse:up",e._mouseUpITextHandler)},_removeCanvasHandlers:function(e){e.off("mouse:up",e._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(e,l,o,n){var r;return r={isAborted:!1,abort:function(){this.isAborted=!0}},e.animate("_currentCursorOpacity",l,{duration:o,onComplete:function(){r.isAborted||e[n]()},onChange:function(){e.canvas&&e.selectionStart===e.selectionEnd&&e.renderCursorOrSelection()},abort:function(){return r.isAborted}}),r},_onTickComplete:function(){var e=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){e._currentTickCompleteState=e._animateCursor(e,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(e){var l=this,o=e?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){l._tick()},o)},abortCursorAnimation:function(){var e=this._currentTickState||this._currentTickCompleteState,l=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,e&&l&&l.clearContext(l.contextTop||l.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(e){var l=0,o=e-1;if(this._reSpace.test(this._text[o]))for(;this._reSpace.test(this._text[o]);)l++,o--;for(;/\S/.test(this._text[o])&&o>-1;)l++,o--;return e-l},findWordBoundaryRight:function(e){var l=0,o=e;if(this._reSpace.test(this._text[o]))for(;this._reSpace.test(this._text[o]);)l++,o++;for(;/\S/.test(this._text[o])&&o<this._text.length;)l++,o++;return e+l},findLineBoundaryLeft:function(e){for(var l=0,o=e-1;!/\n/.test(this._text[o])&&o>-1;)l++,o--;return e-l},findLineBoundaryRight:function(e){for(var l=0,o=e;!/\n/.test(this._text[o])&&o<this._text.length;)l++,o++;return e+l},searchWordBoundary:function(e,l){for(var o=this._text,n=this._reSpace.test(o[e])?e-1:e,r=o[n],i=t.reNonWord;!i.test(r)&&n>0&&n<o.length;)n+=l,r=o[n];return i.test(r)&&(n+=l===1?0:1),n},selectWord:function(e){e=e||this.selectionStart;var l=this.searchWordBoundary(e,-1),o=this.searchWordBoundary(e,1);this.selectionStart=l,this.selectionEnd=o,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(e){e=e||this.selectionStart;var l=this.findLineBoundaryLeft(e),o=this.findLineBoundaryRight(e);return this.selectionStart=l,this.selectionEnd=o,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(e){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(e),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(e){e._iTextInstances&&e._iTextInstances.forEach(function(l){l.selected=!1,l.isEditing&&l.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(e){if(!(!this.__isMousedown||!this.isEditing)){document.activeElement!==this.hiddenTextarea&&this.hiddenTextarea.focus();var l=this.getSelectionStartFromPointer(e.e),o=this.selectionStart,n=this.selectionEnd;(l!==this.__selectionStartOnMouseDown||o===n)&&(o===l||n===l)||(l>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=l):(this.selectionStart=l,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==o||this.selectionEnd!==n)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(e,l,o){var n=o.slice(0,e),r=t.util.string.graphemeSplit(n).length;if(e===l)return{selectionStart:r,selectionEnd:r};var i=o.slice(e,l),a=t.util.string.graphemeSplit(i).length;return{selectionStart:r,selectionEnd:r+a}},fromGraphemeToStringSelection:function(e,l,o){var n=o.slice(0,e),r=n.join("").length;if(e===l)return{selectionStart:r,selectionEnd:r};var i=o.slice(e,l),a=i.join("").length;return{selectionStart:r,selectionEnd:r+a}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var e=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=e.selectionStart,this.hiddenTextarea.selectionEnd=e.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var e=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var e=this._calcTextareaPosition();this.hiddenTextarea.style.left=e.left,this.hiddenTextarea.style.top=e.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var e=this.inCompositionMode?this.compositionStart:this.selectionStart,l=this._getCursorBoundaries(e),o=this.get2DCursorLocation(e),n=o.lineIndex,r=o.charIndex,i=this.getValueOfPropertyAt(n,r,"fontSize")*this.lineHeight,a=l.leftOffset,u=this.calcTransformMatrix(),s={x:l.left+a,y:l.top+l.topOffset+i},f=this.canvas.getRetinaScaling(),g=this.canvas.upperCanvasEl,m=g.width/f,v=g.height/f,C=m-i,w=v-i,S=g.clientWidth/m,A=g.clientHeight/v;return s=t.util.transformPoint(s,u),s=t.util.transformPoint(s,this.canvas.viewportTransform),s.x*=S,s.y*=A,s.x<0&&(s.x=0),s.x>C&&(s.x=C),s.y<0&&(s.y=0),s.y>w&&(s.y=w),s.x+=this.canvas._offset.left,s.y+=this.canvas._offset.top,{left:s.x+"px",top:s.y+"px",fontSize:i+"px",charHeight:i}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var e=this._textBeforeEdit!==this.text,l=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,l&&(l.blur&&l.blur(),l.parentNode&&l.parentNode.removeChild(l)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),e&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),e&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var e in this.styles)this._textLines[e]||delete this.styles[e]},removeStyleFromTo:function(e,l){var o=this.get2DCursorLocation(e,!0),n=this.get2DCursorLocation(l,!0),r=o.lineIndex,i=o.charIndex,a=n.lineIndex,u=n.charIndex,s,f;if(r!==a){if(this.styles[r])for(s=i;s<this._unwrappedTextLines[r].length;s++)delete this.styles[r][s];if(this.styles[a])for(s=u;s<this._unwrappedTextLines[a].length;s++)f=this.styles[a][s],f&&(this.styles[r]||(this.styles[r]={}),this.styles[r][i+s-u]=f);for(s=r+1;s<=a;s++)delete this.styles[s];this.shiftLineStyles(a,r-a)}else if(this.styles[r]){f=this.styles[r];var g=u-i,m,v;for(s=i;s<u;s++)delete f[s];for(v in this.styles[r])m=parseInt(v,10),m>=u&&(f[m-g]=f[v],delete f[v])}},shiftLineStyles:function(e,l){var o=h(this.styles);for(var n in this.styles){var r=parseInt(n,10);r>e&&(this.styles[r+l]=o[r],o[r-l]||delete this.styles[r])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(e,l,o,n){var r,i={},a=!1,u=this._unwrappedTextLines[e].length===l;o||(o=1),this.shiftLineStyles(e,o),this.styles[e]&&(r=this.styles[e][l===0?l:l-1]);for(var s in this.styles[e]){var f=parseInt(s,10);f>=l&&(a=!0,i[f-l]=this.styles[e][s],u&&l===0||delete this.styles[e][s])}var g=!1;for(a&&!u&&(this.styles[e+o]=i,g=!0),g&&o--;o>0;)n&&n[o-1]?this.styles[e+o]={0:h(n[o-1])}:r?this.styles[e+o]={0:h(r)}:delete this.styles[e+o],o--;this._forceClearCache=!0},insertCharStyleObject:function(e,l,o,n){this.styles||(this.styles={});var r=this.styles[e],i=r?h(r):{};o||(o=1);for(var a in i){var u=parseInt(a,10);u>=l&&(r[u+o]=i[u],i[u-o]||delete r[u])}if(this._forceClearCache=!0,n){for(;o--;)Object.keys(n[o]).length&&(this.styles[e]||(this.styles[e]={}),this.styles[e][l+o]=h(n[o]));return}if(r)for(var s=r[l?l-1:1];s&&o--;)this.styles[e][l+o]=h(s)},insertNewStyleBlock:function(e,l,o){for(var n=this.get2DCursorLocation(l,!0),r=[0],i=0,a=0;a<e.length;a++)e[a]===`
`?(i++,r[i]=0):r[i]++;r[0]>0&&(this.insertCharStyleObject(n.lineIndex,n.charIndex,r[0],o),o=o&&o.slice(r[0]+1)),i&&this.insertNewlineStyleObject(n.lineIndex,n.charIndex+r[0],i);for(var a=1;a<i;a++)r[a]>0?this.insertCharStyleObject(n.lineIndex+a,0,r[a],o):o&&this.styles[n.lineIndex+a]&&o[0]&&(this.styles[n.lineIndex+a][0]=o[0]),o=o&&o.slice(r[a]+1);r[a]>0&&this.insertCharStyleObject(n.lineIndex+a,0,r[a],o)},setSelectionStartEndWithShift:function(e,l,o){o<=e?(l===e?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=e),this.selectionStart=o):o>e&&o<l?this._selectionDirection==="right"?this.selectionEnd=o:this.selectionStart=o:(l===e?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=l),this.selectionEnd=o)},setSelectionInBoundaries:function(){var e=this.text.length;this.selectionStart>e?this.selectionStart=e:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>e?this.selectionEnd=e:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),t.util.object.extend(t.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(h){if(this.canvas){this.__newClickTime=+new Date;var e=h.pointer;this.isTripleClick(e)&&(this.fire("tripleclick",h),this._stopEvent(h.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(h){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===h.x&&this.__lastPointer.y===h.y},_stopEvent:function(h){h.preventDefault&&h.preventDefault(),h.stopPropagation&&h.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(h){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(h.e))},tripleClickHandler:function(h){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(h.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(h){!this.canvas||!this.editable||h.e.button&&h.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(h.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(h){!this.canvas||!this.editable||h.e.button&&h.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(h){if(this.__isMousedown=!1,!(!this.editable||this.group||h.transform&&h.transform.actionPerformed||h.e.button&&h.e.button!==1)){if(this.canvas){var e=this.canvas._activeObject;if(e&&e!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(h.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(h){var e=this.getSelectionStartFromPointer(h),l=this.selectionStart,o=this.selectionEnd;h.shiftKey?this.setSelectionStartEndWithShift(l,o,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(h){for(var e=this.getLocalPointer(h),l=0,o=0,n=0,r=0,i=0,a,u,s=0,f=this._textLines.length;s<f&&n<=e.y;s++)n+=this.getHeightOfLine(s)*this.scaleY,i=s,s>0&&(r+=this._textLines[s-1].length+this.missingNewlineOffset(s-1));a=this._getLineLeftOffset(i),o=a*this.scaleX,u=this._textLines[i],this.direction==="rtl"&&(e.x=this.width*this.scaleX-e.x+o);for(var g=0,m=u.length;g<m&&(l=o,o+=this.__charBounds[i][g].kernedWidth*this.scaleX,o<=e.x);g++)r++;return this._getNewSelectionStartFromOffset(e,l,o,r,m)},_getNewSelectionStartFromOffset:function(h,e,l,o,n){var r=h.x-e,i=l-h.x,a=i>r||i<0?0:1,u=o+a;return this.flipX&&(u=n-u),u>this._text.length&&(u=this._text.length),u}}),t.util.object.extend(t.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=t.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var h=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+h.top+"; left: "+h.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: "+h.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):t.document.body.appendChild(this.hiddenTextarea),t.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),t.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),t.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),t.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(t.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(h){if(this.isEditing){var e=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(h.keyCode in e)this[e[h.keyCode]](h);else if(h.keyCode in this.ctrlKeysMapDown&&(h.ctrlKey||h.metaKey))this[this.ctrlKeysMapDown[h.keyCode]](h);else return;h.stopImmediatePropagation(),h.preventDefault(),h.keyCode>=33&&h.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(h){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(h.keyCode in this.ctrlKeysMapUp&&(h.ctrlKey||h.metaKey))this[this.ctrlKeysMapUp[h.keyCode]](h);else return;h.stopImmediatePropagation(),h.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(h){var e=this.fromPaste;if(this.fromPaste=!1,h&&h.stopPropagation(),!!this.isEditing){var l=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,o=this._text.length,n=l.length,r,i,a=n-o,u=this.selectionStart,s=this.selectionEnd,f=u!==s,g,m,v;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var C=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),w=u>C.selectionStart;f?(r=this._text.slice(u,s),a+=s-u):n<o&&(w?r=this._text.slice(s+a,s):r=this._text.slice(u,u-a)),i=l.slice(C.selectionEnd-a,C.selectionEnd),r&&r.length&&(i.length&&(g=this.getSelectionStyles(u,u+1,!1),g=i.map(function(){return g[0]})),f?(m=u,v=s):w?(m=s-r.length,v=s):(m=s,v=s+r.length),this.removeStyleFromTo(m,v)),i.length&&(e&&i.join("")===t.copiedText&&!t.disableStyleCopyPaste&&(g=t.copiedTextStyle),this.insertNewStyleBlock(i,u,g)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(h){this.compositionStart=h.target.selectionStart,this.compositionEnd=h.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(t.copiedText=this.getSelectedText(),t.disableStyleCopyPaste?t.copiedTextStyle=null:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(h){return h&&h.clipboardData||t.window.clipboardData},_getWidthBeforeCursor:function(h,e){var l=this._getLineLeftOffset(h),o;return e>0&&(o=this.__charBounds[h][e-1],l+=o.left+o.width),l},getDownCursorOffset:function(h,e){var l=this._getSelectionForOffset(h,e),o=this.get2DCursorLocation(l),n=o.lineIndex;if(n===this._textLines.length-1||h.metaKey||h.keyCode===34)return this._text.length-l;var r=o.charIndex,i=this._getWidthBeforeCursor(n,r),a=this._getIndexOnLine(n+1,i),u=this._textLines[n].slice(r);return u.length+a+1+this.missingNewlineOffset(n)},_getSelectionForOffset:function(h,e){return h.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(h,e){var l=this._getSelectionForOffset(h,e),o=this.get2DCursorLocation(l),n=o.lineIndex;if(n===0||h.metaKey||h.keyCode===33)return-l;var r=o.charIndex,i=this._getWidthBeforeCursor(n,r),a=this._getIndexOnLine(n-1,i),u=this._textLines[n].slice(0,r),s=this.missingNewlineOffset(n-1);return-this._textLines[n-1].length+a-u.length+(1-s)},_getIndexOnLine:function(h,e){for(var l=this._textLines[h],o=this._getLineLeftOffset(h),n=o,r=0,i,a,u=0,s=l.length;u<s;u++)if(i=this.__charBounds[h][u].width,n+=i,n>e){a=!0;var f=n-i,g=n,m=Math.abs(f-e),v=Math.abs(g-e);r=v<m?u:u-1;break}return a||(r=l.length-1),r},moveCursorDown:function(h){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",h)},moveCursorUp:function(h){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",h)},_moveCursorUpOrDown:function(h,e){var l="get"+h+"CursorOffset",o=this[l](e,this._selectionDirection==="right");e.shiftKey?this.moveCursorWithShift(o):this.moveCursorWithoutShift(o),o!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(h){var e=this._selectionDirection==="left"?this.selectionStart+h:this.selectionEnd+h;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),h!==0},moveCursorWithoutShift:function(h){return h<0?(this.selectionStart+=h,this.selectionEnd=this.selectionStart):(this.selectionEnd+=h,this.selectionStart=this.selectionEnd),h!==0},moveCursorLeft:function(h){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",h)},_move:function(h,e,l){var o;if(h.altKey)o=this["findWordBoundary"+l](this[e]);else if(h.metaKey||h.keyCode===35||h.keyCode===36)o=this["findLineBoundary"+l](this[e]);else return this[e]+=l==="Left"?-1:1,!0;if(typeof o<"u"&&this[e]!==o)return this[e]=o,!0},_moveLeft:function(h,e){return this._move(h,e,"Left")},_moveRight:function(h,e){return this._move(h,e,"Right")},moveCursorLeftWithoutShift:function(h){var e=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(e=this._moveLeft(h,"selectionStart")),this.selectionEnd=this.selectionStart,e},moveCursorLeftWithShift:function(h){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(h,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(h,"selectionStart")},moveCursorRight:function(h){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",h)},_moveCursorLeftOrRight:function(h,e){var l="moveCursor"+h+"With";this._currentCursorOpacity=1,e.shiftKey?l+="Shift":l+="outShift",this[l](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(h){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(h,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(h,"selectionEnd")},moveCursorRightWithoutShift:function(h){var e=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(e=this._moveRight(h,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e},removeChars:function(h,e){typeof e>"u"&&(e=h+1),this.removeStyleFromTo(h,e),this._text.splice(h,e-h),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(h,e,l,o){typeof o>"u"&&(o=l),o>l&&this.removeStyleFromTo(l,o);var n=t.util.string.graphemeSplit(h);this.insertNewStyleBlock(n,l,e),this._text=[].concat(this._text.slice(0,l),n,this._text.slice(o)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var h=t.util.toFixed,e=/  +/g;t.util.object.extend(t.Text.prototype,{_toSVG:function(){var l=this._getSVGLeftTopOffsets(),o=this._getSVGTextAndBg(l.textTop,l.textLeft);return this._wrapSVGTextAndBg(o)},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(),{reviver:l,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(l){var o=!0,n=this.getSvgTextDecoration(this);return[l.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",n?'text-decoration="'+n+'" ':"",'style="',this.getSvgStyles(o),'"',this.addPaintOrder()," >",l.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(l,o){var n=[],r=[],i=l,a;this._setSVGBg(r);for(var u=0,s=this._textLines.length;u<s;u++)a=this._getLineLeftOffset(u),(this.textBackgroundColor||this.styleHas("textBackgroundColor",u))&&this._setSVGTextLineBg(r,u,o+a,i),this._setSVGTextLineText(n,u,o+a,i),i+=this.getHeightOfLine(u);return{textSpans:n,textBgRects:r}},_createTextCharSpan:function(l,o,n,r){var i=l!==l.trim()||l.match(e),a=this.getSvgSpanStyles(o,i),u=a?'style="'+a+'"':"",s=o.deltaY,f="",g=t.Object.NUM_FRACTION_DIGITS;return s&&(f=' dy="'+h(s,g)+'" '),['<tspan x="',h(n,g),'" y="',h(r,g),'" ',f,u,">",t.util.string.escapeXml(l),"</tspan>"].join("")},_setSVGTextLineText:function(l,o,n,r){var i=this.getHeightOfLine(o),a=this.textAlign.indexOf("justify")!==-1,u,s,f="",g,m,v=0,C=this._textLines[o],w;r+=i*(1-this._fontSizeFraction)/this.lineHeight;for(var S=0,A=C.length-1;S<=A;S++)w=S===A||this.charSpacing,f+=C[S],g=this.__charBounds[o][S],v===0?(n+=g.kernedWidth-g.width,v+=g.width):v+=g.kernedWidth,a&&!w&&this._reSpaceAndTab.test(C[S])&&(w=!0),w||(u=u||this.getCompleteStyleDeclaration(o,S),s=this.getCompleteStyleDeclaration(o,S+1),w=t.util.hasStyleChanged(u,s,!0)),w&&(m=this._getStyleDeclaration(o,S)||{},l.push(this._createTextCharSpan(f,m,n,r)),f="",u=s,n+=v,v=0)},_pushTextBgRect:function(l,o,n,r,i,a){var u=t.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(o),' x="',h(n,u),'" y="',h(r,u),'" width="',h(i,u),'" height="',h(a,u),`"></rect>
`)},_setSVGTextLineBg:function(l,o,n,r){for(var i=this._textLines[o],a=this.getHeightOfLine(o)/this.lineHeight,u=0,s=0,f,g,m=this.getValueOfPropertyAt(o,0,"textBackgroundColor"),v=0,C=i.length;v<C;v++)f=this.__charBounds[o][v],g=this.getValueOfPropertyAt(o,v,"textBackgroundColor"),g!==m?(m&&this._pushTextBgRect(l,m,n+s,r,u,a),s=f.left,u=f.width,m=g):u+=f.kernedWidth;g&&this._pushTextBgRect(l,g,n+s,r,u,a)},_getFillAttributes:function(l){var o=l&&typeof l=="string"?new t.Color(l):"";return!o||!o.getSource()||o.getAlpha()===1?'fill="'+l+'"':'opacity="'+o.getAlpha()+'" fill="'+o.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(l){for(var o=0,n=0,r=0;r<l;r++)o+=this.getHeightOfLine(r);return n=this.getHeightOfLine(r),{lineTop:o,offset:(this._fontSizeMult-this._fontSizeFraction)*n/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(l){var o=t.Object.prototype.getSvgStyles.call(this,l);return o+" white-space: pre;"}})}(),function(h){var e=h.fabric||(h.fabric={});e.Textbox=e.util.createClass(e.IText,e.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:e.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(l){for(var o=0,n=0,r=0,i={},a=0;a<l.graphemeLines.length;a++)l.graphemeText[r]===`
`&&a>0?(n=0,r++,o++):!this.splitByGrapheme&&this._reSpaceAndTab.test(l.graphemeText[r])&&a>0&&(n++,r++),i[a]={line:o,offset:n},r+=l.graphemeLines[a].length,n+=l.graphemeLines[a].length;return i},styleHas:function(l,o){if(this._styleMap&&!this.isWrapping){var n=this._styleMap[o];n&&(o=n.line)}return e.Text.prototype.styleHas.call(this,l,o)},isEmptyStyles:function(l){if(!this.styles)return!0;var o=0,n=l+1,r,i,a=!1,u=this._styleMap[l],s=this._styleMap[l+1];u&&(l=u.line,o=u.offset),s&&(n=s.line,a=n===l,r=s.offset),i=typeof l>"u"?this.styles:{line:this.styles[l]};for(var f in i)for(var g in i[f])if(g>=o&&(!a||g<r))for(var m in i[f][g])return!1;return!0},_getStyleDeclaration:function(l,o){if(this._styleMap&&!this.isWrapping){var n=this._styleMap[l];if(!n)return null;l=n.line,o=n.offset+o}return this.callSuper("_getStyleDeclaration",l,o)},_setStyleDeclaration:function(l,o,n){var r=this._styleMap[l];l=r.line,o=r.offset+o,this.styles[l][o]=n},_deleteStyleDeclaration:function(l,o){var n=this._styleMap[l];l=n.line,o=n.offset+o,delete this.styles[l][o]},_getLineStyle:function(l){var o=this._styleMap[l];return!!this.styles[o.line]},_setLineStyle:function(l){var o=this._styleMap[l];this.styles[o.line]={}},_wrapText:function(l,o){var n=[],r;for(this.isWrapping=!0,r=0;r<l.length;r++)n=n.concat(this._wrapLine(l[r],r,o));return this.isWrapping=!1,n},_measureWord:function(l,o,n){var r=0,i,a=!0;n=n||0;for(var u=0,s=l.length;u<s;u++){var f=this._getGraphemeBox(l[u],o,u+n,i,a);r+=f.kernedWidth,i=l[u]}return r},_wrapLine:function(l,o,n,X){var i=0,a=this.splitByGrapheme,u=[],s=[],f=a?e.util.string.graphemeSplit(l):l.split(this._wordJoiners),g="",m=0,v=a?"":" ",C=0,w=0,S=0,A=!0,P=this._getWidthOfCharSpacing(),X=X||0;f.length===0&&f.push([]),n-=X;for(var K=0;K<f.length;K++)g=a?f[K]:e.util.string.graphemeSplit(f[K]),C=this._measureWord(g,o,m),m+=g.length,i+=w+C-P,i>n&&!A?(u.push(s),s=[],i=C,A=!0):i+=P,!A&&!a&&s.push(v),s=s.concat(g),w=a?0:this._measureWord([v],o,m),m++,A=!1,C>S&&(S=C);return K&&u.push(s),S+X>this.dynamicMinWidth&&(this.dynamicMinWidth=S-P+X),u},isEndOfWrapping:function(l){return!this._styleMap[l+1]||this._styleMap[l+1].line!==this._styleMap[l].line},missingNewlineOffset:function(l){return this.splitByGrapheme?this.isEndOfWrapping(l)?1:0:1},_splitTextIntoLines:function(l){for(var o=e.Text.prototype._splitTextIntoLines.call(this,l),n=this._wrapText(o.lines,this.width),r=new Array(n.length),i=0;i<n.length;i++)r[i]=n[i].join("");return o.lines=r,o.graphemeLines=n,o},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var l={};for(var o in this._styleMap)this._textLines[o]&&(l[this._styleMap[o].line]=1);for(var o in this.styles)l[o]||delete this.styles[o]},toObject:function(l){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(l))}}),e.Textbox.fromObject=function(l,o){var n=e.util.stylesFromArray(l.styles,l.text),r=Object.assign({},l,{styles:n});return e.Object._fromObject("Textbox",r,o,"text")}}(c),function(){var h=t.controlsUtils,e=h.scaleSkewCursorStyleHandler,l=h.scaleCursorStyleHandler,o=h.scalingEqually,n=h.scalingYOrSkewingX,r=h.scalingXOrSkewingY,i=h.scaleOrSkewActionName,a=t.Object.prototype.controls;if(a.ml=new t.Control({x:-.5,y:0,cursorStyleHandler:e,actionHandler:r,getActionName:i}),a.mr=new t.Control({x:.5,y:0,cursorStyleHandler:e,actionHandler:r,getActionName:i}),a.mb=new t.Control({x:0,y:.5,cursorStyleHandler:e,actionHandler:n,getActionName:i}),a.mt=new t.Control({x:0,y:-.5,cursorStyleHandler:e,actionHandler:n,getActionName:i}),a.tl=new t.Control({x:-.5,y:-.5,cursorStyleHandler:l,actionHandler:o}),a.tr=new t.Control({x:.5,y:-.5,cursorStyleHandler:l,actionHandler:o}),a.bl=new t.Control({x:-.5,y:.5,cursorStyleHandler:l,actionHandler:o}),a.br=new t.Control({x:.5,y:.5,cursorStyleHandler:l,actionHandler:o}),a.mtr=new t.Control({x:0,y:-.5,actionHandler:h.rotationWithSnapping,cursorStyleHandler:h.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),t.Textbox){var u=t.Textbox.prototype.controls={};u.mtr=a.mtr,u.tr=a.tr,u.br=a.br,u.tl=a.tl,u.bl=a.bl,u.mt=a.mt,u.mb=a.mb,u.mr=new t.Control({x:.5,y:0,actionHandler:h.changeWidth,cursorStyleHandler:e,actionName:"resizing"}),u.ml=new t.Control({x:-.5,y:0,actionHandler:h.changeWidth,cursorStyleHandler:e,actionName:"resizing"})}}()})(se);const me={Decorate:1,Background:2,Photo:3,Save:4};var Nr={grad:.9,turn:360,rad:360/(2*Math.PI)},qt=function(c){return typeof c=="string"?c.length>0:typeof c=="number"},Rt=function(c,t,d){return t===void 0&&(t=0),d===void 0&&(d=Math.pow(10,t)),Math.round(d*c)/d+0},Ht=function(c,t,d){return t===void 0&&(t=0),d===void 0&&(d=1),c>d?d:c>t?c:t},Rn=function(c){return(c=isFinite(c)?c%360:0)>0?c:c+360},Li=function(c){return{r:Ht(c.r,0,255),g:Ht(c.g,0,255),b:Ht(c.b,0,255),a:Ht(c.a)}},ti=function(c){return{r:Rt(c.r),g:Rt(c.g),b:Rt(c.b),a:Rt(c.a,3)}},Xr=/^#([0-9a-f]{3,8})$/i,Re=function(c){var t=c.toString(16);return t.length<2?"0"+t:t},Ln=function(c){var t=c.r,d=c.g,p=c.b,_=c.a,b=Math.max(t,d,p),y=b-Math.min(t,d,p),h=y?b===t?(d-p)/y:b===d?2+(p-t)/y:4+(t-d)/y:0;return{h:60*(h<0?h+6:h),s:b?y/b*100:0,v:b/255*100,a:_}},Bn=function(c){var t=c.h,d=c.s,p=c.v,_=c.a;t=t/360*6,d/=100,p/=100;var b=Math.floor(t),y=p*(1-d),h=p*(1-(t-b)*d),e=p*(1-(1-t+b)*d),l=b%6;return{r:255*[p,h,y,y,e,p][l],g:255*[e,p,p,h,y,y][l],b:255*[y,y,e,p,p,h][l],a:_}},Bi=function(c){return{h:Rn(c.h),s:Ht(c.s,0,100),l:Ht(c.l,0,100),a:Ht(c.a)}},ji=function(c){return{h:Rt(c.h),s:Rt(c.s),l:Rt(c.l),a:Rt(c.a,3)}},Wi=function(c){return Bn((d=(t=c).s,{h:t.h,s:(d*=((p=t.l)<50?p:100-p)/100)>0?2*d/(p+d)*100:0,v:p+d,a:t.a}));var t,d,p},xe=function(c){return{h:(t=Ln(c)).h,s:(_=(200-(d=t.s))*(p=t.v)/100)>0&&_<200?d*p/100/(_<=100?_:200-_)*100:0,l:_/2,a:t.a};var t,d,p,_},Hr=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Yr=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,zr=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ur=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,pi={string:[[function(c){var t=Xr.exec(c);return t?(c=t[1]).length<=4?{r:parseInt(c[0]+c[0],16),g:parseInt(c[1]+c[1],16),b:parseInt(c[2]+c[2],16),a:c.length===4?Rt(parseInt(c[3]+c[3],16)/255,2):1}:c.length===6||c.length===8?{r:parseInt(c.substr(0,2),16),g:parseInt(c.substr(2,2),16),b:parseInt(c.substr(4,2),16),a:c.length===8?Rt(parseInt(c.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(c){var t=zr.exec(c)||Ur.exec(c);return t?t[2]!==t[4]||t[4]!==t[6]?null:Li({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(c){var t=Hr.exec(c)||Yr.exec(c);if(!t)return null;var d,p,_=Bi({h:(d=t[1],p=t[2],p===void 0&&(p="deg"),Number(d)*(Nr[p]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Wi(_)},"hsl"]],object:[[function(c){var t=c.r,d=c.g,p=c.b,_=c.a,b=_===void 0?1:_;return qt(t)&&qt(d)&&qt(p)?Li({r:Number(t),g:Number(d),b:Number(p),a:Number(b)}):null},"rgb"],[function(c){var t=c.h,d=c.s,p=c.l,_=c.a,b=_===void 0?1:_;if(!qt(t)||!qt(d)||!qt(p))return null;var y=Bi({h:Number(t),s:Number(d),l:Number(p),a:Number(b)});return Wi(y)},"hsl"],[function(c){var t=c.h,d=c.s,p=c.v,_=c.a,b=_===void 0?1:_;if(!qt(t)||!qt(d)||!qt(p))return null;var y=function(h){return{h:Rn(h.h),s:Ht(h.s,0,100),v:Ht(h.v,0,100),a:Ht(h.a)}}({h:Number(t),s:Number(d),v:Number(p),a:Number(b)});return Bn(y)},"hsv"]]},Ni=function(c,t){for(var d=0;d<t.length;d++){var p=t[d][0](c);if(p)return[p,t[d][1]]}return[null,void 0]},Vr=function(c){return typeof c=="string"?Ni(c.trim(),pi.string):typeof c=="object"&&c!==null?Ni(c,pi.object):[null,void 0]},ei=function(c,t){var d=xe(c);return{h:d.h,s:Ht(d.s+100*t,0,100),l:d.l,a:d.a}},ii=function(c){return(299*c.r+587*c.g+114*c.b)/1e3/255},Xi=function(c,t){var d=xe(c);return{h:d.h,s:d.s,l:Ht(d.l+100*t,0,100),a:d.a}},vi=function(){function c(t){this.parsed=Vr(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return c.prototype.isValid=function(){return this.parsed!==null},c.prototype.brightness=function(){return Rt(ii(this.rgba),2)},c.prototype.isDark=function(){return ii(this.rgba)<.5},c.prototype.isLight=function(){return ii(this.rgba)>=.5},c.prototype.toHex=function(){return t=ti(this.rgba),d=t.r,p=t.g,_=t.b,y=(b=t.a)<1?Re(Rt(255*b)):"","#"+Re(d)+Re(p)+Re(_)+y;var t,d,p,_,b,y},c.prototype.toRgb=function(){return ti(this.rgba)},c.prototype.toRgbString=function(){return t=ti(this.rgba),d=t.r,p=t.g,_=t.b,(b=t.a)<1?"rgba("+d+", "+p+", "+_+", "+b+")":"rgb("+d+", "+p+", "+_+")";var t,d,p,_,b},c.prototype.toHsl=function(){return ji(xe(this.rgba))},c.prototype.toHslString=function(){return t=ji(xe(this.rgba)),d=t.h,p=t.s,_=t.l,(b=t.a)<1?"hsla("+d+", "+p+"%, "+_+"%, "+b+")":"hsl("+d+", "+p+"%, "+_+"%)";var t,d,p,_,b},c.prototype.toHsv=function(){return t=Ln(this.rgba),{h:Rt(t.h),s:Rt(t.s),v:Rt(t.v),a:Rt(t.a,3)};var t},c.prototype.invert=function(){return jt({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},c.prototype.saturate=function(t){return t===void 0&&(t=.1),jt(ei(this.rgba,t))},c.prototype.desaturate=function(t){return t===void 0&&(t=.1),jt(ei(this.rgba,-t))},c.prototype.grayscale=function(){return jt(ei(this.rgba,-1))},c.prototype.lighten=function(t){return t===void 0&&(t=.1),jt(Xi(this.rgba,t))},c.prototype.darken=function(t){return t===void 0&&(t=.1),jt(Xi(this.rgba,-t))},c.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},c.prototype.alpha=function(t){return typeof t=="number"?jt({r:(d=this.rgba).r,g:d.g,b:d.b,a:t}):Rt(this.rgba.a,3);var d},c.prototype.hue=function(t){var d=xe(this.rgba);return typeof t=="number"?jt({h:t,s:d.s,l:d.l,a:d.a}):Rt(d.h)},c.prototype.isEqual=function(t){return this.toHex()===jt(t).toHex()},c}(),jt=function(c){return c instanceof vi?c:new vi(c)},Hi=[],Gr=function(c){c.forEach(function(t){Hi.indexOf(t)<0&&(t(vi,pi),Hi.push(t))})},ni=function(c){var t=c/255;return t<.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},ri=function(c){return .2126*ni(c.r)+.7152*ni(c.g)+.0722*ni(c.b)};function qr(c){c.prototype.luminance=function(){return t=ri(this.rgba),(d=2)===void 0&&(d=0),p===void 0&&(p=Math.pow(10,d)),Math.round(p*t)/p+0;var t,d,p},c.prototype.contrast=function(t){t===void 0&&(t="#FFF");var d,p,_,b,y,h,e,l=t instanceof c?t:new c(t);return b=this.rgba,y=l.toRgb(),h=ri(b),e=ri(y),d=h>e?(h+.05)/(e+.05):(e+.05)/(h+.05),(p=2)===void 0&&(p=0),_===void 0&&(_=Math.pow(10,p)),Math.floor(_*d)/_+0},c.prototype.isReadable=function(t,d){return t===void 0&&(t="#FFF"),d===void 0&&(d={}),this.contrast(t)>=(h=(y=(p=d).size)===void 0?"normal":y,(b=(_=p.level)===void 0?"AA":_)==="AAA"&&h==="normal"?7:b==="AA"&&h==="large"?3:4.5);var p,_,b,y,h}}const de=[];function Kr(c,t){return{subscribe:he(c,t).subscribe}}function he(c,t=bt){let d;const p=new Set;function _(h){if(Ot(c,h)&&(c=h,d)){const e=!de.length;for(const l of p)l[1](),de.push(l,c);if(e){for(let l=0;l<de.length;l+=2)de[l][0](de[l+1]);de.length=0}}}function b(h){_(h(c))}function y(h,e=bt){const l=[h,e];return p.add(l),p.size===1&&(d=t(_)||bt),h(c),()=>{p.delete(l),p.size===0&&d&&(d(),d=null)}}return{set:_,update:b,subscribe:y}}function Jr(c,t,d){const p=!Array.isArray(c),_=p?[c]:c,b=t.length<2;return Kr(d,y=>{let h=!1;const e=[];let l=0,o=bt;const n=()=>{if(l)return;o();const i=t(p?e[0]:e,y);b?y(i):o=Ge(i)?i:bt},r=_.map((i,a)=>Dn(i,u=>{e[a]=u,l&=~(1<<a),h&&n()},()=>{l|=1<<a}));return h=!0,n(),function(){Ft(r),o(),h=!1}})}const Kt=he({ArrowLeft:0,ArrowUp:0,ArrowRight:0,ArrowDown:0}),Oi=Jr(Kt,c=>({...c,ArrowV:c.ArrowUp+c.ArrowDown,ArrowH:c.ArrowLeft+c.ArrowRight,ArrowVH:c.ArrowUp+c.ArrowDown+c.ArrowLeft+c.ArrowRight}));function Ai(c,t=.001,d=.01){const b=Math.min(1,Math.max(1,c-50)/50);return t+(d-t)/2*(1-Math.cos(Math.PI*b))}const{window:we}=xi;function Qr(c){let t,d,p,_,b,y;var h=c[2].pickerIndicator;function e(l){return{props:{pos:l[9],isDark:l[5],hex:jt({h:l[3],s:l[0],v:l[1],a:1}).toHex()}}}return h&&(d=St(h,e(c))),{c(){var l,o;t=$("div"),d&&yt(d.$$.fragment),F(t,"class","picker svelte-uiwgvv"),F(t,"tabindex","0"),Wt(t,"--color-bg",c[8]),F(t,"aria-label","saturation and brightness picker (arrow keyboard navigation)"),F(t,"aria-valuemin",0),F(t,"aria-valuemax",100),F(t,"aria-valuetext",p="saturation "+((l=c[9].x)==null?void 0:l.toFixed())+"%, brightness "+((o=c[9].y)==null?void 0:o.toFixed())+"%")},m(l,o){ot(l,t,o),d&&pt(d,t,null),c[18](t),_=!0,b||(y=[ct(t,"mousedown",re(Ut(c[10]))),ct(t,"touchstart",c[16]),ct(t,"touchmove",re(Ut(c[16]))),ct(t,"touchend",c[16])],b=!0)},p(l,o){var r,i;const n={};if(o&512&&(n.pos=l[9]),o&32&&(n.isDark=l[5]),o&11&&(n.hex=jt({h:l[3],s:l[0],v:l[1],a:1}).toHex()),o&4&&h!==(h=l[2].pickerIndicator)){if(d){It();const a=d;ft(a.$$.fragment,1,0,()=>{vt(a,1)}),Mt()}h?(d=St(h,e(l)),yt(d.$$.fragment),at(d.$$.fragment,1),pt(d,t,null)):d=null}else h&&d.$set(n);(!_||o&256)&&Wt(t,"--color-bg",l[8]),(!_||o&512&&p!==(p="saturation "+((r=l[9].x)==null?void 0:r.toFixed())+"%, brightness "+((i=l[9].y)==null?void 0:i.toFixed())+"%"))&&F(t,"aria-valuetext",p)},i(l){_||(d&&at(d.$$.fragment,l),_=!0)},o(l){d&&ft(d.$$.fragment,l),_=!1},d(l){l&&st(t),d&&vt(d),c[18](null),b=!1,Ft(y)}}}function Zr(c){let t,d,p,_,b;var y=c[2].pickerWrapper;function h(e){return{props:{focused:e[7],toRight:e[4],$$slots:{default:[Qr]},$$scope:{ctx:e}}}}return y&&(t=St(y,h(c))),{c(){t&&yt(t.$$.fragment),d=Gt()},m(e,l){t&&pt(t,e,l),ot(e,d,l),p=!0,_||(b=[ct(we,"mouseup",c[11]),ct(we,"mousedown",c[13]),ct(we,"mousemove",c[12]),ct(we,"keyup",c[14]),ct(we,"keydown",c[15])],_=!0)},p(e,[l]){const o={};if(l&128&&(o.focused=e[7]),l&16&&(o.toRight=e[4]),l&67109743&&(o.$$scope={dirty:l,ctx:e}),l&4&&y!==(y=e[2].pickerWrapper)){if(t){It();const n=t;ft(n.$$.fragment,1,0,()=>{vt(n,1)}),Mt()}y?(t=St(y,h(e)),yt(t.$$.fragment),at(t.$$.fragment,1),pt(t,d.parentNode,d)):t=null}else y&&t.$set(o)},i(e){p||(t&&at(t.$$.fragment,e),p=!0)},o(e){t&&ft(t.$$.fragment,e),p=!1},d(e){e&&st(d),t&&vt(t,e),_=!1,Ft(b)}}}function Yi(c,t,d){return Math.min(Math.max(t,c),d)}function $r(c,t,d){let p,_;Et(c,Kt,H=>d(22,p=H)),Et(c,Oi,H=>d(23,_=H));let{components:b}=t,{h:y}=t,{s:h}=t,{v:e}=t,{isOpen:l}=t,{toRight:o}=t,{isDark:n}=t,r,i=!1,a=!1,u,s,f,g={x:100,y:0};function m(H){let J={x:H.offsetX,y:H.offsetY},Z=r.getBoundingClientRect().width,nt=r.getBoundingClientRect().height;d(0,h=Yi(J.x/Z,0,1)*100),d(1,e=Yi((nt-J.y)/nt,0,1)*100)}function v(H){H.button===0&&(i=!0,m(H))}function C(){i=!1}function w(H){i&&m({offsetX:Math.max(0,Math.min(r.getBoundingClientRect().width,H.clientX-r.getBoundingClientRect().left)),offsetY:Math.max(0,Math.min(r.getBoundingClientRect().height,H.clientY-r.getBoundingClientRect().top))})}function S(H){H.target.isSameNode(r)||d(7,a=!1)}function A(H){var J;H.key==="Tab"&&d(7,a=!!((J=document.activeElement)!=null&&J.isSameNode(r))),!H.repeat&&a&&X()}function P(H){a&&_.ArrowVH&&(H.preventDefault(),H.repeat||X())}function X(){_.ArrowVH?u||(s=0,u=window.setInterval(()=>{let H=Ai(++s);d(0,h=Math.min(100,Math.max(0,h+(p.ArrowRight-p.ArrowLeft)*H*100))),d(1,e=Math.min(100,Math.max(0,e+(p.ArrowUp-p.ArrowDown)*H*100)))},10)):u&&(clearInterval(u),u=void 0)}function K(H){H.preventDefault(),m({offsetX:H.changedTouches[0].clientX-r.getBoundingClientRect().left,offsetY:H.changedTouches[0].clientY-r.getBoundingClientRect().top})}function tt(H){Ct[H?"unshift":"push"](()=>{r=H,d(6,r)})}return c.$$set=H=>{"components"in H&&d(2,b=H.components),"h"in H&&d(3,y=H.h),"s"in H&&d(0,h=H.s),"v"in H&&d(1,e=H.v),"isOpen"in H&&d(17,l=H.isOpen),"toRight"in H&&d(4,o=H.toRight),"isDark"in H&&d(5,n=H.isDark)},c.$$.update=()=>{c.$$.dirty&8&&typeof y=="number"&&d(8,f=jt({h:y,s:100,v:100,a:1}).toHex()),c.$$.dirty&67&&typeof h=="number"&&typeof e=="number"&&r&&d(9,g={x:h,y:100-e})},[h,e,b,y,o,n,r,a,f,g,v,C,w,S,A,P,K,l,tt]}class ts extends kt{constructor(t){super(),At(this,t,$r,Zr,Ot,{components:2,h:3,s:0,v:1,isOpen:17,toRight:4,isDark:5})}}const{window:Le}=xi;function es(c){let t,d,p,_,b,y;var h=c[1].sliderIndicator;function e(l){return{props:{pos:l[4],toRight:l[2]}}}return h&&(d=St(h,e(c))),{c(){t=$("div"),d&&yt(d.$$.fragment),F(t,"class","slider svelte-14nweqy"),F(t,"tabindex","0"),F(t,"aria-label","hue picker (arrow keyboard navigation)"),F(t,"aria-valuemin",0),F(t,"aria-valuemax",360),F(t,"aria-valuenow",p=Math.round(c[0])),Lt(t,"to-right",c[2])},m(l,o){ot(l,t,o),d&&pt(d,t,null),c[12](t),_=!0,b||(y=[ct(t,"mousedown",re(Ut(c[6]))),ct(t,"touchstart",c[11]),ct(t,"touchmove",re(Ut(c[11]))),ct(t,"touchend",c[11])],b=!0)},p(l,o){const n={};if(o&16&&(n.pos=l[4]),o&4&&(n.toRight=l[2]),o&2&&h!==(h=l[1].sliderIndicator)){if(d){It();const r=d;ft(r.$$.fragment,1,0,()=>{vt(r,1)}),Mt()}h?(d=St(h,e(l)),yt(d.$$.fragment),at(d.$$.fragment,1),pt(d,t,null)):d=null}else h&&d.$set(n);(!_||o&1&&p!==(p=Math.round(l[0])))&&F(t,"aria-valuenow",p),(!_||o&4)&&Lt(t,"to-right",l[2])},i(l){_||(d&&at(d.$$.fragment,l),_=!0)},o(l){d&&ft(d.$$.fragment,l),_=!1},d(l){l&&st(t),d&&vt(d),c[12](null),b=!1,Ft(y)}}}function is(c){let t,d,p,_,b;var y=c[1].sliderWrapper;function h(e){return{props:{focused:e[5],toRight:e[2],$$slots:{default:[es]},$$scope:{ctx:e}}}}return y&&(t=St(y,h(c))),{c(){t&&yt(t.$$.fragment),d=Gt()},m(e,l){t&&pt(t,e,l),ot(e,d,l),p=!0,_||(b=[ct(Le,"mouseup",c[7]),ct(Le,"mousemove",c[8]),ct(Le,"keyup",c[9]),ct(Le,"keydown",c[10])],_=!0)},p(e,[l]){const o={};if(l&32&&(o.focused=e[5]),l&4&&(o.toRight=e[2]),l&1048607&&(o.$$scope={dirty:l,ctx:e}),l&2&&y!==(y=e[1].sliderWrapper)){if(t){It();const n=t;ft(n.$$.fragment,1,0,()=>{vt(n,1)}),Mt()}y?(t=St(y,h(e)),yt(t.$$.fragment),at(t.$$.fragment,1),pt(t,d.parentNode,d)):t=null}else y&&t.$set(o)},i(e){p||(t&&at(t.$$.fragment,e),p=!0)},o(e){t&&ft(t.$$.fragment,e),p=!1},d(e){e&&st(d),t&&vt(t,e),_=!1,Ft(b)}}}function ns(c,t,d){let p,_;Et(c,Kt,S=>d(16,p=S)),Et(c,Oi,S=>d(17,_=S));let{components:b}=t,{toRight:y}=t,h,e=!1,{h:l}=t,o=0,n=!1,r,i;function a(S){const A=y?h.getBoundingClientRect().width:h.getBoundingClientRect().height,P=Math.max(0,Math.min(A,S));d(0,l=P/A*360)}function u(S){S.button===0&&(e=!0,a(y?S.offsetX:S.offsetY))}function s(){e=!1}function f(S){e&&a(y?S.clientX-h.getBoundingClientRect().left:S.clientY-h.getBoundingClientRect().top)}function g(S){var A;S.key==="Tab"&&d(5,n=!!((A=document.activeElement)!=null&&A.isSameNode(h))),!S.repeat&&n&&v()}function m(S){n&&_.ArrowVH&&(S.preventDefault(),S.repeat||v())}function v(){_.ArrowVH?r||(i=0,r=window.setInterval(()=>{const S=Ai(++i),A=y?p.ArrowRight-p.ArrowLeft:p.ArrowDown-p.ArrowUp;d(0,l=Math.min(360,Math.max(0,l+A*360*S)))},10)):r&&(clearInterval(r),r=void 0)}function C(S){S.preventDefault(),a(y?S.changedTouches[0].clientX-h.getBoundingClientRect().left:S.changedTouches[0].clientY-h.getBoundingClientRect().top)}function w(S){Ct[S?"unshift":"push"](()=>{h=S,d(3,h)})}return c.$$set=S=>{"components"in S&&d(1,b=S.components),"toRight"in S&&d(2,y=S.toRight),"h"in S&&d(0,l=S.h)},c.$$.update=()=>{c.$$.dirty&9&&typeof l=="number"&&h&&d(4,o=100*l/360)},[l,b,y,h,o,n,u,s,f,g,m,C,w]}class rs extends kt{constructor(t){super(),At(this,t,ns,is,Ot,{components:1,toRight:2,h:0})}}const{window:Be}=xi;function ss(c){let t,d,p,_,b,y,h;var e=c[0].alphaIndicator;function l(o){return{props:{pos:o[5],toRight:o[2]}}}return e&&(d=St(e,l(c))),{c(){var o,n;t=$("div"),d&&yt(d.$$.fragment),F(t,"class","alpha svelte-f2vq53"),F(t,"tabindex","0"),Wt(t,"--alpha-color",(o=c[1])==null?void 0:o.substring(0,7)),F(t,"aria-label","transparency picker (arrow keyboard navigation)"),F(t,"aria-valuemin",0),F(t,"aria-valuemax",100),F(t,"aria-valuenow",p=Math.round(c[5])),F(t,"aria-valuetext",_=((n=c[5])==null?void 0:n.toFixed())+"%"),Lt(t,"to-right",c[2])},m(o,n){ot(o,t,n),d&&pt(d,t,null),c[14](t),b=!0,y||(h=[ct(t,"mousedown",re(Ut(c[6]))),ct(t,"touchstart",c[11]),ct(t,"touchmove",re(Ut(c[11]))),ct(t,"touchend",c[11])],y=!0)},p(o,n){var i,a;const r={};if(n&32&&(r.pos=o[5]),n&4&&(r.toRight=o[2]),n&1&&e!==(e=o[0].alphaIndicator)){if(d){It();const u=d;ft(u.$$.fragment,1,0,()=>{vt(u,1)}),Mt()}e?(d=St(e,l(o)),yt(d.$$.fragment),at(d.$$.fragment,1),pt(d,t,null)):d=null}else e&&d.$set(r);(!b||n&2)&&Wt(t,"--alpha-color",(i=o[1])==null?void 0:i.substring(0,7)),(!b||n&32&&p!==(p=Math.round(o[5])))&&F(t,"aria-valuenow",p),(!b||n&32&&_!==(_=((a=o[5])==null?void 0:a.toFixed())+"%"))&&F(t,"aria-valuetext",_),(!b||n&4)&&Lt(t,"to-right",o[2])},i(o){b||(d&&at(d.$$.fragment,o),b=!0)},o(o){d&&ft(d.$$.fragment,o),b=!1},d(o){o&&st(t),d&&vt(d),c[14](null),y=!1,Ft(h)}}}function as(c){let t,d,p,_,b;var y=c[0].alphaWrapper;function h(e){return{props:{focused:e[4],toRight:e[2],$$slots:{default:[ss]},$$scope:{ctx:e}}}}return y&&(t=St(y,h(c))),{c(){t&&yt(t.$$.fragment),d=Gt()},m(e,l){t&&pt(t,e,l),ot(e,d,l),p=!0,_||(b=[ct(Be,"mouseup",c[7]),ct(Be,"mousemove",c[8]),ct(Be,"keyup",c[9]),ct(Be,"keydown",c[10])],_=!0)},p(e,[l]){const o={};if(l&16&&(o.focused=e[4]),l&4&&(o.toRight=e[2]),l&4194351&&(o.$$scope={dirty:l,ctx:e}),l&1&&y!==(y=e[0].alphaWrapper)){if(t){It();const n=t;ft(n.$$.fragment,1,0,()=>{vt(n,1)}),Mt()}y?(t=St(y,h(e)),yt(t.$$.fragment),at(t.$$.fragment,1),pt(t,d.parentNode,d)):t=null}else y&&t.$set(o)},i(e){p||(t&&at(t.$$.fragment,e),p=!0)},o(e){t&&ft(t.$$.fragment,e),p=!1},d(e){e&&st(d),t&&vt(t,e),_=!1,Ft(b)}}}function os(c,t,d){let p,_;Et(c,Kt,P=>d(18,p=P)),Et(c,Oi,P=>d(19,_=P));let{components:b}=t,{isOpen:y}=t,{a:h=1}=t,{hex:e}=t,{toRight:l}=t,o,n=!1,r=!1,i,a,u;function s(P){const X=l?o.getBoundingClientRect().width:o.getBoundingClientRect().height,K=Math.max(0,Math.min(X,P));d(12,h=K/X)}function f(P){P.button===0&&(n=!0,s(l?P.offsetX:P.offsetY))}function g(){n=!1}function m(P){n&&s(l?P.clientX-o.getBoundingClientRect().left:P.clientY-o.getBoundingClientRect().top)}function v(P){var X;P.key==="Tab"&&d(4,r=!!((X=document.activeElement)!=null&&X.isSameNode(o))),!P.repeat&&r&&w()}function C(P){r&&_.ArrowVH&&(P.preventDefault(),P.repeat||w())}function w(){_.ArrowVH?i||(a=0,i=window.setInterval(()=>{const P=Ai(++a),X=l?p.ArrowRight-p.ArrowLeft:p.ArrowDown-p.ArrowUp;d(12,h=Math.min(1,Math.max(0,h+X*P)))},10)):i&&(clearInterval(i),i=void 0)}function S(P){P.preventDefault(),s(l?P.changedTouches[0].clientX-o.getBoundingClientRect().left:P.changedTouches[0].clientY-o.getBoundingClientRect().top)}function A(P){Ct[P?"unshift":"push"](()=>{o=P,d(3,o)})}return c.$$set=P=>{"components"in P&&d(0,b=P.components),"isOpen"in P&&d(13,y=P.isOpen),"a"in P&&d(12,h=P.a),"hex"in P&&d(1,e=P.hex),"toRight"in P&&d(2,l=P.toRight)},c.$$.update=()=>{c.$$.dirty&4104&&typeof h=="number"&&o&&d(5,u=100*h)},[b,e,l,o,r,u,f,g,m,v,C,S,h,y,A]}class ls extends kt{constructor(t){super(),At(this,t,os,as,Ot,{components:0,isOpen:13,a:12,hex:1,toRight:2})}}function cs(c){let t,d,p,_,b,y,h,e,l,o=c[2]&&zi(c);return{c(){t=$("div"),d=$("input"),p=dt(),_=$("input"),b=dt(),y=$("input"),h=dt(),o&&o.c(),F(d,"aria-label","hue chanel color"),d.value=c[8],F(d,"type","number"),F(d,"min","0"),F(d,"max","360"),F(d,"class","svelte-11z4jba"),F(_,"aria-label","saturation chanel color"),_.value=c[7],F(_,"type","number"),F(_,"min","0"),F(_,"max","100"),F(_,"class","svelte-11z4jba"),F(y,"aria-label","brightness chanel color"),y.value=c[6],F(y,"type","number"),F(y,"min","0"),F(y,"max","100"),F(y,"class","svelte-11z4jba"),F(t,"class","input-container svelte-11z4jba")},m(n,r){ot(n,t,r),Q(t,d),Q(t,p),Q(t,_),Q(t,b),Q(t,y),Q(t,h),o&&o.m(t,null),e||(l=[ct(d,"input",c[12]("h")),ct(_,"input",c[12]("s")),ct(y,"input",c[12]("v"))],e=!0)},p(n,r){r&256&&d.value!==n[8]&&(d.value=n[8]),r&128&&_.value!==n[7]&&(_.value=n[7]),r&64&&y.value!==n[6]&&(y.value=n[6]),n[2]?o?o.p(n,r):(o=zi(n),o.c(),o.m(t,null)):o&&(o.d(1),o=null)},d(n){n&&st(t),o&&o.d(),e=!1,Ft(l)}}}function hs(c){let t,d,p,_,b,y,h,e,l,o,n,r,i=c[2]&&Ui(c);return{c(){t=$("div"),d=$("input"),_=dt(),b=$("input"),h=dt(),e=$("input"),o=dt(),i&&i.c(),F(d,"aria-label","red chanel color"),d.value=p=c[0].r,F(d,"type","number"),F(d,"min","0"),F(d,"max","255"),F(d,"class","svelte-11z4jba"),F(b,"aria-label","green chanel color"),b.value=y=c[0].g,F(b,"type","number"),F(b,"min","0"),F(b,"max","255"),F(b,"class","svelte-11z4jba"),F(e,"aria-label","blue chanel color"),e.value=l=c[0].b,F(e,"type","number"),F(e,"min","0"),F(e,"max","255"),F(e,"class","svelte-11z4jba"),F(t,"class","input-container svelte-11z4jba")},m(a,u){ot(a,t,u),Q(t,d),Q(t,_),Q(t,b),Q(t,h),Q(t,e),Q(t,o),i&&i.m(t,null),n||(r=[ct(d,"input",c[11]("r")),ct(b,"input",c[11]("g")),ct(e,"input",c[11]("b"))],n=!0)},p(a,u){u&1&&p!==(p=a[0].r)&&d.value!==p&&(d.value=p),u&1&&y!==(y=a[0].g)&&b.value!==y&&(b.value=y),u&1&&l!==(l=a[0].b)&&e.value!==l&&(e.value=l),a[2]?i?i.p(a,u):(i=Ui(a),i.c(),i.m(t,null)):i&&(i.d(1),i=null)},d(a){a&&st(t),i&&i.d(),n=!1,Ft(r)}}}function us(c){let t,d,p,_,b,y=c[2]&&Vi(c);return{c(){t=$("div"),d=$("input"),p=dt(),y&&y.c(),d.value=c[1],Wt(d,"flex","3"),F(d,"class","svelte-11z4jba"),F(t,"class","input-container svelte-11z4jba")},m(h,e){ot(h,t,e),Q(t,d),Q(t,p),y&&y.m(t,null),_||(b=ct(d,"input",c[10]),_=!0)},p(h,e){e&2&&d.value!==h[1]&&(d.value=h[1]),h[2]?y?y.p(h,e):(y=Vi(h),y.c(),y.m(t,null)):y&&(y.d(1),y=null)},d(h){h&&st(t),y&&y.d(),_=!1,b()}}}function zi(c){let t,d,p;return{c(){t=$("input"),F(t,"aria-label","transparency chanel color"),t.value=c[5],F(t,"type","number"),F(t,"min","0"),F(t,"max","1"),F(t,"step","0.01"),F(t,"class","svelte-11z4jba")},m(_,b){ot(_,t,b),d||(p=ct(t,"input",c[12]("a")),d=!0)},p(_,b){b&32&&t.value!==_[5]&&(t.value=_[5])},d(_){_&&st(t),d=!1,p()}}}function Ui(c){let t,d,p;return{c(){t=$("input"),F(t,"aria-label","transparency chanel color"),t.value=c[5],F(t,"type","number"),F(t,"min","0"),F(t,"max","1"),F(t,"step","0.01"),F(t,"class","svelte-11z4jba")},m(_,b){ot(_,t,b),d||(p=ct(t,"input",c[11]("a")),d=!0)},p(_,b){b&32&&t.value!==_[5]&&(t.value=_[5])},d(_){_&&st(t),d=!1,p()}}}function Vi(c){let t,d,p;return{c(){t=$("input"),F(t,"aria-label","hexadecimal color"),t.value=c[5],F(t,"type","number"),F(t,"min","0"),F(t,"max","1"),F(t,"step","0.01"),F(t,"class","svelte-11z4jba")},m(_,b){ot(_,t,b),d||(p=ct(t,"input",c[11]("a")),d=!0)},p(_,b){b&32&&t.value!==_[5]&&(t.value=_[5])},d(_){_&&st(t),d=!1,p()}}}function Gi(c){let t,d=c[9][c[4]]+"",p,_,b,y;return{c(){t=$("button"),p=Vt(d),F(t,"aria-label",_="change inputs to "+c[9][(c[4]+1)%3]),F(t,"class","svelte-11z4jba")},m(h,e){ot(h,t,e),Q(t,p),b||(y=ct(t,"click",c[14]),b=!0)},p(h,e){e&16&&d!==(d=h[9][h[4]]+"")&&_e(p,d),e&16&&_!==(_="change inputs to "+h[9][(h[4]+1)%3])&&F(t,"aria-label",_)},d(h){h&&st(t),b=!1,y()}}}function fs(c){let t,d;function p(h,e){return h[4]===0?us:h[4]===1?hs:cs}let _=p(c),b=_(c),y=c[3]&&Gi(c);return{c(){t=$("div"),b.c(),d=dt(),y&&y.c(),F(t,"class","text-input svelte-11z4jba")},m(h,e){ot(h,t,e),b.m(t,null),Q(t,d),y&&y.m(t,null)},p(h,[e]){_===(_=p(h))&&b?b.p(h,e):(b.d(1),b=_(h),b&&(b.c(),b.m(t,d))),h[3]?y?y.p(h,e):(y=Gi(h),y.c(),y.m(t,null)):y&&(y.d(1),y=null)},i:bt,o:bt,d(h){h&&st(t),b.d(),y&&y.d()}}}const ds=/^#?([A-F0-9]{6}|[A-F0-9]{8})$/i;function gs(c,t,d){let p,_,b,y,{isAlpha:h}=t,{rgb:e}=t,{hsv:l}=t,{hex:o}=t,{canChangeMode:n}=t;const r=["HEX","RGB","HSV"];let i=0;function a(g){const m=g.target;ds.test(m.value)&&d(1,o=m.value)}function u(g){return function(m){d(0,e={...e,[g]:parseFloat(m.target.value)})}}function s(g){return function(m){d(13,l={...l,[g]:parseFloat(m.target.value)})}}const f=()=>d(4,i=(i+1)%3);return c.$$set=g=>{"isAlpha"in g&&d(2,h=g.isAlpha),"rgb"in g&&d(0,e=g.rgb),"hsv"in g&&d(13,l=g.hsv),"hex"in g&&d(1,o=g.hex),"canChangeMode"in g&&d(3,n=g.canChangeMode)},c.$$.update=()=>{c.$$.dirty&8192&&d(8,p=Math.round(l.h)),c.$$.dirty&8192&&d(7,_=Math.round(l.s)),c.$$.dirty&8192&&d(6,b=Math.round(l.v)),c.$$.dirty&8192&&d(5,y=l.a===void 0?1:Math.round(l.a*100)/100)},[e,o,h,n,i,y,b,_,p,r,a,u,s,l,f]}class ms extends kt{constructor(t){super(),At(this,t,gs,fs,Ot,{isAlpha:2,rgb:0,hsv:13,hex:1,canChangeMode:3})}}function ps(c){let t,d;return{c(){t=$("div"),F(t,"class","slider-indicator svelte-htgglv"),F(t,"style",d=`top: calc(${c[0]/200*186}% + 2px);`)},m(p,_){ot(p,t,_)},p(p,[_]){_&1&&d!==(d=`top: calc(${p[0]/200*186}% + 2px);`)&&F(t,"style",d)},i:bt,o:bt,d(p){p&&st(t)}}}function vs(c,t,d){let{pos:p}=t,{toRight:_}=t;return c.$$set=b=>{"pos"in b&&d(0,p=b.pos),"toRight"in b&&d(1,_=b.toRight)},[p,_]}class qi extends kt{constructor(t){super(),At(this,t,vs,ps,Ot,{pos:0,toRight:1})}}function _s(c){let t,d;return{c(){t=$("div"),F(t,"class","picker-indicator svelte-1nw247x"),F(t,"style",d=`left: calc(${c[0].x/200*186}% + 2px); top: calc(${c[0].y/200*186}% + 2px); box-shadow: 0 0 4px ${c[1]?"white":"black"};`)},m(p,_){ot(p,t,_)},p(p,[_]){_&3&&d!==(d=`left: calc(${p[0].x/200*186}% + 2px); top: calc(${p[0].y/200*186}% + 2px); box-shadow: 0 0 4px ${p[1]?"white":"black"};`)&&F(t,"style",d)},i:bt,o:bt,d(p){p&&st(t)}}}function ys(c,t,d){let{pos:p}=t,{hex:_}=t,{isDark:b}=t;return c.$$set=y=>{"pos"in y&&d(0,p=y.pos),"hex"in y&&d(2,_=y.hex),"isDark"in y&&d(1,b=y.isDark)},[p,b,_]}class bs extends kt{constructor(t){super(),At(this,t,ys,_s,Ot,{pos:0,hex:2,isDark:1})}}function Cs(c){let t,d;return{c:bt,m(p,_){t||(d=[ct(window,"keyup",c[0]),ct(window,"keydown",c[1])],t=!0)},p:bt,i:bt,o:bt,d(p){t=!1,Ft(d)}}}function ws(c,t,d){let p;Et(c,Kt,y=>d(2,p=y));function _(y){["ArrowLeft","ArrowUp","ArrowRight","ArrowDown"].includes(y.key)&&(Pe(Kt,p[y.key]=0,p),Kt.set(p))}function b(y){["ArrowLeft","ArrowUp","ArrowRight","ArrowDown"].includes(y.key)&&(y.repeat||(Pe(Kt,p[y.key]=1,p),Kt.set(p)))}return[_,b]}class Ss extends kt{constructor(t){super(),At(this,t,ws,Cs,Ot,{})}}function Ts(c){let t,d;const p=c[3].default,_=Ae(p,c,c[2],null);return{c(){t=$("div"),_&&_.c(),F(t,"class","picker-wrapper svelte-1isc651"),Lt(t,"focused",c[0])},m(b,y){ot(b,t,y),_&&_.m(t,null),d=!0},p(b,[y]){_&&_.p&&(!d||y&4)&&Ee(_,p,b,b[2],d?ke(p,b[2],y,null):De(b[2]),null),(!d||y&1)&&Lt(t,"focused",b[0])},i(b){d||(at(_,b),d=!0)},o(b){ft(_,b),d=!1},d(b){b&&st(t),_&&_.d(b)}}}function xs(c,t,d){let{$$slots:p={},$$scope:_}=t,{focused:b}=t,{toRight:y}=t;return c.$$set=h=>{"focused"in h&&d(0,b=h.focused),"toRight"in h&&d(1,y=h.toRight),"$$scope"in h&&d(2,_=h.$$scope)},[b,y,_,p]}class Os extends kt{constructor(t){super(),At(this,t,xs,Ts,Ot,{focused:0,toRight:1})}}function As(c){let t,d;const p=c[3].default,_=Ae(p,c,c[2],null);return{c(){t=$("div"),_&&_.c(),F(t,"class","slider-wrapper svelte-1udewng"),Lt(t,"focused",c[0])},m(b,y){ot(b,t,y),_&&_.m(t,null),d=!0},p(b,[y]){_&&_.p&&(!d||y&4)&&Ee(_,p,b,b[2],d?ke(p,b[2],y,null):De(b[2]),null),(!d||y&1)&&Lt(t,"focused",b[0])},i(b){d||(at(_,b),d=!0)},o(b){ft(_,b),d=!1},d(b){b&&st(t),_&&_.d(b)}}}function ks(c,t,d){let{$$slots:p={},$$scope:_}=t,{focused:b}=t,{toRight:y}=t;return c.$$set=h=>{"focused"in h&&d(0,b=h.focused),"toRight"in h&&d(1,y=h.toRight),"$$scope"in h&&d(2,_=h.$$scope)},[b,y,_,p]}class Ki extends kt{constructor(t){super(),At(this,t,ks,As,Ot,{focused:0,toRight:1})}}function Es(c){let t,d,p,_,b,y,h,e,l,o,n;return{c(){t=$("label"),d=$("div"),p=$("input"),_=dt(),b=$("div"),y=dt(),h=$("div"),e=dt(),l=Vt(c[2]),F(p,"type","color"),p.value=c[1],F(p,"aria-haspopup","dialog"),F(p,"class","svelte-2ybi8r"),F(b,"class","alpha svelte-2ybi8r"),F(h,"class","color svelte-2ybi8r"),Wt(h,"background",c[1]),F(d,"class","container svelte-2ybi8r"),F(t,"class","svelte-2ybi8r")},m(r,i){ot(r,t,i),Q(t,d),Q(d,p),Q(d,_),Q(d,b),Q(d,y),Q(d,h),Q(t,e),Q(t,l),c[4](t),o||(n=[ct(p,"click",Ut(Ds)),ct(p,"mousedown",Ut(Ps)),ct(t,"click",Ut(Is)),ct(t,"mousedown",Ut(Ms))],o=!0)},p(r,[i]){i&2&&(p.value=r[1]),i&2&&Wt(h,"background",r[1]),i&4&&_e(l,r[2])},i:bt,o:bt,d(r){r&&st(t),c[4](null),o=!1,Ft(n)}}}const Ds=()=>{},Ps=()=>{},Is=()=>{},Ms=()=>{};function Fs(c,t,d){let{labelWrapper:p}=t,{hex:_}=t,{label:b}=t,{isOpen:y}=t;function h(e){Ct[e?"unshift":"push"](()=>{p=e,d(0,p)})}return c.$$set=e=>{"labelWrapper"in e&&d(0,p=e.labelWrapper),"hex"in e&&d(1,_=e.hex),"label"in e&&d(2,b=e.label),"isOpen"in e&&d(3,y=e.isOpen)},[p,_,b,y,h]}class Rs extends kt{constructor(t){super(),At(this,t,Fs,Es,Ot,{labelWrapper:0,hex:1,label:2,isOpen:3})}}function Ls(c){let t,d,p;const _=c[5].default,b=Ae(_,c,c[4],null);return{c(){t=$("div"),b&&b.c(),F(t,"class","wrapper svelte-160vdtq"),F(t,"role",d=c[2]?"dialog":void 0),F(t,"aria-label","color picker"),Lt(t,"isOpen",c[1]),Lt(t,"isPopup",c[2])},m(y,h){ot(y,t,h),b&&b.m(t,null),c[6](t),p=!0},p(y,[h]){b&&b.p&&(!p||h&16)&&Ee(b,_,y,y[4],p?ke(_,y[4],h,null):De(y[4]),null),(!p||h&4&&d!==(d=y[2]?"dialog":void 0))&&F(t,"role",d),(!p||h&2)&&Lt(t,"isOpen",y[1]),(!p||h&4)&&Lt(t,"isPopup",y[2])},i(y){p||(at(b,y),p=!0)},o(y){ft(b,y),p=!1},d(y){y&&st(t),b&&b.d(y),c[6](null)}}}function Bs(c,t,d){let{$$slots:p={},$$scope:_}=t,{wrapper:b}=t,{isOpen:y}=t,{isPopup:h}=t,{toRight:e}=t;function l(o){Ct[o?"unshift":"push"](()=>{b=o,d(0,b)})}return c.$$set=o=>{"wrapper"in o&&d(0,b=o.wrapper),"isOpen"in o&&d(1,y=o.isOpen),"isPopup"in o&&d(2,h=o.isPopup),"toRight"in o&&d(3,e=o.toRight),"$$scope"in o&&d(4,_=o.$$scope)},[b,y,h,e,_,p,l]}class js extends kt{constructor(t){super(),At(this,t,Bs,Ls,Ot,{wrapper:0,isOpen:1,isPopup:2,toRight:3})}}function Ji(c,t,d){const p=c.slice();return p[9]=t[d].contrast,p[10]=t[d].hex,p[11]=t[d].placeholder,p[12]=t[d].reverse,p[13]=t[d].size,p}function Qi(c){let t,d,p;var _=c[0].a11ySingleNotice;function b(y){return{props:{contrast:y[9],textColor:y[12]?y[10]:y[1],bgColor:y[12]?y[1]:y[10],placeholder:y[11],size:y[13]}}}return _&&(t=St(_,b(c))),{c(){t&&yt(t.$$.fragment),d=Gt()},m(y,h){t&&pt(t,y,h),ot(y,d,h),p=!0},p(y,h){const e={};if(h&16&&(e.contrast=y[9]),h&18&&(e.textColor=y[12]?y[10]:y[1]),h&18&&(e.bgColor=y[12]?y[1]:y[10]),h&16&&(e.placeholder=y[11]),h&16&&(e.size=y[13]),h&1&&_!==(_=y[0].a11ySingleNotice)){if(t){It();const l=t;ft(l.$$.fragment,1,0,()=>{vt(l,1)}),Mt()}_?(t=St(_,b(y)),yt(t.$$.fragment),at(t.$$.fragment,1),pt(t,d.parentNode,d)):t=null}else _&&t.$set(e)},i(y){p||(t&&at(t.$$.fragment,y),p=!0)},o(y){t&&ft(t.$$.fragment,y),p=!1},d(y){y&&st(d),t&&vt(t,y)}}}function Zi(c){let t;return{c(){t=$("span"),F(t,"class","svelte-1s4dluu")},m(d,p){ot(d,t,p),t.innerHTML=c[2]},p(d,p){p&4&&(t.innerHTML=d[2])},d(d){d&&st(t)}}}function Ws(c){let t,d,p,_,b,y,h,e,l;var o=c[0].a11ySummary;function n(s){return{props:{a11yColors:s[4],hex:s[1]}}}o&&(p=St(o,n(c)));let r=c[4],i=[];for(let s=0;s<r.length;s+=1)i[s]=Qi(Ji(c,r,s));const a=s=>ft(i[s],1,1,()=>{i[s]=null});let u=c[2]&&Zi(c);return{c(){t=$("details"),d=$("summary"),p&&yt(p.$$.fragment),b=dt(),y=$("div");for(let s=0;s<i.length;s+=1)i[s].c();h=dt(),u&&u.c(),F(d,"tabindex",_=c[5]?-1:void 0),F(d,"class","svelte-1s4dluu"),F(y,"class","svelte-1s4dluu"),F(t,"class",e="a11y-notice "+(c[5]?"not-closable":"")+" svelte-1s4dluu"),t.open=c[3]},m(s,f){ot(s,t,f),Q(t,d),p&&pt(p,d,null),Q(t,b),Q(t,y);for(let g=0;g<i.length;g+=1)i[g]&&i[g].m(y,null);Q(y,h),u&&u.m(y,null),l=!0},p(s,[f]){const g={};if(f&16&&(g.a11yColors=s[4]),f&2&&(g.hex=s[1]),f&1&&o!==(o=s[0].a11ySummary)){if(p){It();const m=p;ft(m.$$.fragment,1,0,()=>{vt(m,1)}),Mt()}o?(p=St(o,n(s)),yt(p.$$.fragment),at(p.$$.fragment,1),pt(p,d,null)):p=null}else o&&p.$set(g);if((!l||f&32&&_!==(_=s[5]?-1:void 0))&&F(d,"tabindex",_),f&19){r=s[4];let m;for(m=0;m<r.length;m+=1){const v=Ji(s,r,m);i[m]?(i[m].p(v,f),at(i[m],1)):(i[m]=Qi(v),i[m].c(),at(i[m],1),i[m].m(y,h))}for(It(),m=r.length;m<i.length;m+=1)a(m);Mt()}s[2]?u?u.p(s,f):(u=Zi(s),u.c(),u.m(y,null)):u&&(u.d(1),u=null),(!l||f&32&&e!==(e="a11y-notice "+(s[5]?"not-closable":"")+" svelte-1s4dluu"))&&F(t,"class",e),(!l||f&8)&&(t.open=s[3])},i(s){if(!l){p&&at(p.$$.fragment,s);for(let f=0;f<r.length;f+=1)at(i[f]);l=!0}},o(s){p&&ft(p.$$.fragment,s),i=i.filter(Boolean);for(let f=0;f<i.length;f+=1)ft(i[f]);l=!1},d(s){s&&st(t),p&&vt(p),Xe(i,s),u&&u.d()}}}function Ns(c,t,d){let p,_,{components:b}=t,{a11yColors:y}=t,{hex:h}=t,{color:e}=t,{a11yGuidelines:l}=t,{isA11yOpen:o}=t,{isA11yClosable:n}=t;return c.$$set=r=>{"components"in r&&d(0,b=r.components),"a11yColors"in r&&d(6,y=r.a11yColors),"hex"in r&&d(1,h=r.hex),"color"in r&&d(7,e=r.color),"a11yGuidelines"in r&&d(2,l=r.a11yGuidelines),"isA11yOpen"in r&&d(3,o=r.isA11yOpen),"isA11yClosable"in r&&d(8,n=r.isA11yClosable)},c.$$.update=()=>{c.$$.dirty&264&&d(5,p=o&&!n),c.$$.dirty&192&&d(4,_=y.map(r=>({...r,contrast:e==null?void 0:e.contrast(r.hex)})))},[b,h,l,o,_,p,y,e,n]}class Xs extends kt{constructor(t){super(),At(this,t,Ns,Ws,Ot,{components:0,a11yColors:6,hex:1,color:7,a11yGuidelines:2,isA11yOpen:3,isA11yClosable:8})}}function Hs(c){let t,d,p=(c[2]||"Lorem Ipsum")+"",_,b,y,h,e,l,o=(c[3]>=10?c[3].toFixed(1):c[3])+"",n,r,i,a,u;return{c(){t=$("div"),d=$("p"),_=Vt(p),y=dt(),h=$("div"),e=$("p"),l=Vt("contrast: "),n=Vt(o),r=dt(),i=$("span"),i.textContent="AA",a=dt(),u=$("span"),u.textContent="AAA",F(d,"class",b="lorem "+(c[4]==="large"&&"large")+" svelte-obnxge"),Wt(d,"color",c[0]),Wt(d,"background-color",c[1]),F(e,"class","svelte-obnxge"),F(i,"class","grade svelte-obnxge"),Lt(i,"grade-ok",c[3]>(c[4]==="large"?3:4.5)),F(u,"class","grade svelte-obnxge"),Lt(u,"grade-ok",c[3]>(c[4]==="large"?4.5:7)),F(h,"class","score svelte-obnxge"),F(t,"class","a11y-single-notice svelte-obnxge")},m(s,f){ot(s,t,f),Q(t,d),Q(d,_),Q(t,y),Q(t,h),Q(h,e),Q(e,l),Q(e,n),Q(h,r),Q(h,i),Q(h,a),Q(h,u)},p(s,[f]){f&4&&p!==(p=(s[2]||"Lorem Ipsum")+"")&&_e(_,p),f&16&&b!==(b="lorem "+(s[4]==="large"&&"large")+" svelte-obnxge")&&F(d,"class",b),f&1&&Wt(d,"color",s[0]),f&2&&Wt(d,"background-color",s[1]),f&8&&o!==(o=(s[3]>=10?s[3].toFixed(1):s[3])+"")&&_e(n,o),f&24&&Lt(i,"grade-ok",s[3]>(s[4]==="large"?3:4.5)),f&24&&Lt(u,"grade-ok",s[3]>(s[4]==="large"?4.5:7))},i:bt,o:bt,d(s){s&&st(t)}}}function Ys(c,t,d){let{textColor:p}=t,{bgColor:_}=t,{placeholder:b=void 0}=t,{contrast:y=1}=t,{size:h=void 0}=t;return c.$$set=e=>{"textColor"in e&&d(0,p=e.textColor),"bgColor"in e&&d(1,_=e.bgColor),"placeholder"in e&&d(2,b=e.placeholder),"contrast"in e&&d(3,y=e.contrast),"size"in e&&d(4,h=e.size)},[p,_,b,y,h]}class zs extends kt{constructor(t){super(),At(this,t,Ys,Hs,Ot,{textColor:0,bgColor:1,placeholder:2,contrast:3,size:4})}}function Us(c){let t;return{c(){t=Vt(c[0])},m(d,p){ot(d,t,p)},p(d,[p]){p&1&&_e(t,d[0])},i:bt,o:bt,d(d){d&&st(t)}}}function Vs({contrast:c,size:t}){return c?t==="large"?c<3?2:c<4.5?1:0:c<4.5?2:c<7?1:0:1}function Gs(c,t,d){let p,_,{a11yColors:b}=t,{hex:y}=t;return c.$$set=h=>{"a11yColors"in h&&d(1,b=h.a11yColors),"hex"in h&&d(2,y=h.hex)},c.$$.update=()=>{c.$$.dirty&2&&d(3,p=b.map(Vs).reduce((h,e)=>h+e)),c.$$.dirty&8&&d(0,_=p?`⚠️ ${p} contrast grade${p&&"s"} fail`:"Contrast grade information")},[_,b,y,p]}class qs extends kt{constructor(t){super(),At(this,t,Gs,Us,Ot,{a11yColors:1,hex:2})}}function Ks(c){let t;return{c(){t=$("input"),F(t,"type","hidden"),t.value=c[2]},m(d,p){ot(d,t,p)},p(d,p){p[0]&4&&(t.value=d[2])},i:bt,o:bt,d(d){d&&st(t)}}}function Js(c){let t,d,p,_,b;function y(o){c[25](o)}function h(o){c[26](o)}var e=c[21]().input;function l(o){let n={hex:o[2],label:o[6]};return o[19]!==void 0&&(n.labelWrapper=o[19]),o[3]!==void 0&&(n.isOpen=o[3]),{props:n}}return e&&(t=St(e,l(c)),Ct.push(()=>Pt(t,"labelWrapper",y)),Ct.push(()=>Pt(t,"isOpen",h))),{c(){t&&yt(t.$$.fragment),_=Gt()},m(o,n){t&&pt(t,o,n),ot(o,_,n),b=!0},p(o,n){const r={};if(n[0]&4&&(r.hex=o[2]),n[0]&64&&(r.label=o[6]),!d&&n[0]&524288&&(d=!0,r.labelWrapper=o[19],Nt(()=>d=!1)),!p&&n[0]&8&&(p=!0,r.isOpen=o[3],Nt(()=>p=!1)),e!==(e=o[21]().input)){if(t){It();const i=t;ft(i.$$.fragment,1,0,()=>{vt(i,1)}),Mt()}e?(t=St(e,l(o)),Ct.push(()=>Pt(t,"labelWrapper",y)),Ct.push(()=>Pt(t,"isOpen",h)),yt(t.$$.fragment),at(t.$$.fragment,1),pt(t,_.parentNode,_)):t=null}else e&&t.$set(r)},i(o){b||(t&&at(t.$$.fragment,o),b=!0)},o(o){t&&ft(t.$$.fragment,o),b=!1},d(o){o&&st(_),t&&vt(t,o)}}}function $i(c){let t,d,p,_;function b(e){c[31](e)}function y(e){c[32](e)}let h={components:c[21](),hex:c[2],toRight:c[17]};return c[1].a!==void 0&&(h.a=c[1].a),c[3]!==void 0&&(h.isOpen=c[3]),t=new ls({props:h}),Ct.push(()=>Pt(t,"a",b)),Ct.push(()=>Pt(t,"isOpen",y)),{c(){yt(t.$$.fragment)},m(e,l){pt(t,e,l),_=!0},p(e,l){const o={};l[0]&4&&(o.hex=e[2]),l[0]&131072&&(o.toRight=e[17]),!d&&l[0]&2&&(d=!0,o.a=e[1].a,Nt(()=>d=!1)),!p&&l[0]&8&&(p=!0,o.isOpen=e[3],Nt(()=>p=!1)),t.$set(o)},i(e){_||(at(t.$$.fragment,e),_=!0)},o(e){ft(t.$$.fragment,e),_=!1},d(e){vt(t,e)}}}function tn(c){let t,d,p,_,b,y;function h(r){c[33](r)}function e(r){c[34](r)}function l(r){c[35](r)}var o=c[21]().textInput;function n(r){let i={isAlpha:r[7],canChangeMode:r[10]};return r[2]!==void 0&&(i.hex=r[2]),r[0]!==void 0&&(i.rgb=r[0]),r[1]!==void 0&&(i.hsv=r[1]),{props:i}}return o&&(t=St(o,n(c)),Ct.push(()=>Pt(t,"hex",h)),Ct.push(()=>Pt(t,"rgb",e)),Ct.push(()=>Pt(t,"hsv",l))),{c(){t&&yt(t.$$.fragment),b=Gt()},m(r,i){t&&pt(t,r,i),ot(r,b,i),y=!0},p(r,i){const a={};if(i[0]&128&&(a.isAlpha=r[7]),i[0]&1024&&(a.canChangeMode=r[10]),!d&&i[0]&4&&(d=!0,a.hex=r[2],Nt(()=>d=!1)),!p&&i[0]&1&&(p=!0,a.rgb=r[0],Nt(()=>p=!1)),!_&&i[0]&2&&(_=!0,a.hsv=r[1],Nt(()=>_=!1)),o!==(o=r[21]().textInput)){if(t){It();const u=t;ft(u.$$.fragment,1,0,()=>{vt(u,1)}),Mt()}o?(t=St(o,n(r)),Ct.push(()=>Pt(t,"hex",h)),Ct.push(()=>Pt(t,"rgb",e)),Ct.push(()=>Pt(t,"hsv",l)),yt(t.$$.fragment),at(t.$$.fragment,1),pt(t,b.parentNode,b)):t=null}else o&&t.$set(a)},i(r){y||(t&&at(t.$$.fragment,r),y=!0)},o(r){t&&ft(t.$$.fragment,r),y=!1},d(r){r&&st(b),t&&vt(t,r)}}}function en(c){let t,d,p;var _=c[21]().a11yNotice;function b(y){return{props:{components:y[21](),a11yColors:y[12],color:y[4],hex:y[2],a11yGuidelines:y[13],isA11yOpen:y[14],isA11yClosable:y[15]}}}return _&&(t=St(_,b(c))),{c(){t&&yt(t.$$.fragment),d=Gt()},m(y,h){t&&pt(t,y,h),ot(y,d,h),p=!0},p(y,h){const e={};if(h[0]&4096&&(e.a11yColors=y[12]),h[0]&16&&(e.color=y[4]),h[0]&4&&(e.hex=y[2]),h[0]&8192&&(e.a11yGuidelines=y[13]),h[0]&16384&&(e.isA11yOpen=y[14]),h[0]&32768&&(e.isA11yClosable=y[15]),_!==(_=y[21]().a11yNotice)){if(t){It();const l=t;ft(l.$$.fragment,1,0,()=>{vt(l,1)}),Mt()}_?(t=St(_,b(y)),yt(t.$$.fragment),at(t.$$.fragment,1),pt(t,d.parentNode,d)):t=null}else _&&t.$set(e)},i(y){p||(t&&at(t.$$.fragment,y),p=!0)},o(y){t&&ft(t.$$.fragment,y),p=!1},d(y){y&&st(d),t&&vt(t,y)}}}function Qs(c){let t,d,p,_,b,y,h,e,l,o,n,r;function i(w){c[27](w)}function a(w){c[28](w)}function u(w){c[29](w)}let s={components:c[21](),h:c[1].h,toRight:c[17],isDark:c[5]};c[1].s!==void 0&&(s.s=c[1].s),c[1].v!==void 0&&(s.v=c[1].v),c[3]!==void 0&&(s.isOpen=c[3]),t=new ts({props:s}),Ct.push(()=>Pt(t,"s",i)),Ct.push(()=>Pt(t,"v",a)),Ct.push(()=>Pt(t,"isOpen",u));function f(w){c[30](w)}let g={components:c[21](),toRight:c[17]};c[1].h!==void 0&&(g.h=c[1].h),y=new rs({props:g}),Ct.push(()=>Pt(y,"h",f));let m=c[7]&&$i(c),v=c[9]&&tn(c),C=c[11]&&en(c);return{c(){yt(t.$$.fragment),b=dt(),yt(y.$$.fragment),e=dt(),m&&m.c(),l=dt(),v&&v.c(),o=dt(),C&&C.c(),n=Gt()},m(w,S){pt(t,w,S),ot(w,b,S),pt(y,w,S),ot(w,e,S),m&&m.m(w,S),ot(w,l,S),v&&v.m(w,S),ot(w,o,S),C&&C.m(w,S),ot(w,n,S),r=!0},p(w,S){const A={};S[0]&2&&(A.h=w[1].h),S[0]&131072&&(A.toRight=w[17]),S[0]&32&&(A.isDark=w[5]),!d&&S[0]&2&&(d=!0,A.s=w[1].s,Nt(()=>d=!1)),!p&&S[0]&2&&(p=!0,A.v=w[1].v,Nt(()=>p=!1)),!_&&S[0]&8&&(_=!0,A.isOpen=w[3],Nt(()=>_=!1)),t.$set(A);const P={};S[0]&131072&&(P.toRight=w[17]),!h&&S[0]&2&&(h=!0,P.h=w[1].h,Nt(()=>h=!1)),y.$set(P),w[7]?m?(m.p(w,S),S[0]&128&&at(m,1)):(m=$i(w),m.c(),at(m,1),m.m(l.parentNode,l)):m&&(It(),ft(m,1,1,()=>{m=null}),Mt()),w[9]?v?(v.p(w,S),S[0]&512&&at(v,1)):(v=tn(w),v.c(),at(v,1),v.m(o.parentNode,o)):v&&(It(),ft(v,1,1,()=>{v=null}),Mt()),w[11]?C?(C.p(w,S),S[0]&2048&&at(C,1)):(C=en(w),C.c(),at(C,1),C.m(n.parentNode,n)):C&&(It(),ft(C,1,1,()=>{C=null}),Mt())},i(w){r||(at(t.$$.fragment,w),at(y.$$.fragment,w),at(m),at(v),at(C),r=!0)},o(w){ft(t.$$.fragment,w),ft(y.$$.fragment,w),ft(m),ft(v),ft(C),r=!1},d(w){vt(t,w),w&&st(b),vt(y,w),w&&st(e),m&&m.d(w),w&&st(l),v&&v.d(w),w&&st(o),C&&C.d(w),w&&st(n)}}}function Zs(c){let t,d,p,_,b,y,h,e,l,o,n;t=new Ss({});const r=[Js,Ks],i=[];function a(g,m){return g[8]?0:1}_=a(c),b=i[_]=r[_](c);function u(g){c[36](g)}var s=c[21]().wrapper;function f(g){let m={isOpen:g[3],isPopup:g[16],toRight:g[17],$$slots:{default:[Qs]},$$scope:{ctx:g}};return g[20]!==void 0&&(m.wrapper=g[20]),{props:m}}return s&&(h=St(s,f(c)),Ct.push(()=>Pt(h,"wrapper",u))),{c(){yt(t.$$.fragment),d=dt(),p=$("span"),b.c(),y=dt(),h&&yt(h.$$.fragment),F(p,"class","color-picker svelte-7ntk55")},m(g,m){pt(t,g,m),ot(g,d,m),ot(g,p,m),i[_].m(p,null),Q(p,y),h&&pt(h,p,null),c[37](p),l=!0,o||(n=[ct(window,"mousedown",c[22]),ct(window,"keyup",c[23])],o=!0)},p(g,m){let v=_;_=a(g),_===v?i[_].p(g,m):(It(),ft(i[v],1,1,()=>{i[v]=null}),Mt(),b=i[_],b?b.p(g,m):(b=i[_]=r[_](g),b.c()),at(b,1),b.m(p,y));const C={};if(m[0]&8&&(C.isOpen=g[3]),m[0]&65536&&(C.isPopup=g[16]),m[0]&131072&&(C.toRight=g[17]),m[0]&196287|m[1]&8192&&(C.$$scope={dirty:m,ctx:g}),!e&&m[0]&1048576&&(e=!0,C.wrapper=g[20],Nt(()=>e=!1)),s!==(s=g[21]().wrapper)){if(h){It();const w=h;ft(w.$$.fragment,1,0,()=>{vt(w,1)}),Mt()}s?(h=St(s,f(g)),Ct.push(()=>Pt(h,"wrapper",u)),yt(h.$$.fragment),at(h.$$.fragment,1),pt(h,p,null)):h=null}else s&&h.$set(C)},i(g){l||(at(t.$$.fragment,g),at(b),h&&at(h.$$.fragment,g),l=!0)},o(g){ft(t.$$.fragment,g),ft(b),h&&ft(h.$$.fragment,g),l=!1},d(g){vt(t,g),g&&st(d),g&&st(p),i[_].d(),h&&vt(h),c[37](null),o=!1,Ft(n)}}}function $s(c,t,d){Gr([qr]);let{components:p={}}=t;const _=Er();let{label:b="Choose a color"}=t,{isAlpha:y=!0}=t,{isInput:h=!0}=t,{isTextInput:e=!0}=t,{canChangeMode:l=!0}=t,{isA11y:o=!1}=t,{a11yColors:n=[{hex:"#ffffff"}]}=t,{a11yGuidelines:r='<p style="margin: 0; font-size: 12px;">Learn more at <a href="https://webaim.org/articles/contrast/" target="_blank">WebAIM contrast guide</a></p>'}=t,{isA11yOpen:i=!1}=t,{isA11yClosable:a=!0}=t,{isPopup:u=h}=t,{isOpen:s=!h}=t,{toRight:f=!1}=t,{rgb:g={r:255,g:0,b:0,a:1}}=t,{hsv:m={h:0,s:100,v:100,a:1}}=t,{hex:v="#ff0000"}=t,{color:C=void 0}=t,{isDark:w=!1}=t,S={r:255,g:0,b:0,a:1},A={h:0,s:100,v:100,a:1},P="#ff0000",X;const K={sliderIndicator:qi,pickerIndicator:bs,alphaIndicator:qi,pickerWrapper:Os,sliderWrapper:Ki,alphaWrapper:Ki,textInput:ms,a11yNotice:Xs,a11ySingleNotice:zs,a11ySummary:qs,input:Rs,wrapper:js};function tt(){return{...K,...p}}let H,J;function Z({target:M}){h&&(H.contains(M)||H.isSameNode(M)?d(3,s=!s):s&&!J.contains(M)&&d(3,s=!1))}function nt(M){M.key==="Tab"&&d(3,s=X==null?void 0:X.contains(document.activeElement))}function lt(){m.h===A.h&&m.s===A.s&&m.v===A.v&&m.a===A.a&&g.r===S.r&&g.g===S.g&&g.b===S.b&&g.a===S.a&&v===P||(m.a===void 0&&d(1,m.a=1,m),A.a===void 0&&(A.a=1),g.a===void 0&&d(0,g.a=1,g),S.a===void 0&&(S.a=1),(v==null?void 0:v.substring(7))==="ff"&&d(2,v=v.substring(0,7)),(v==null?void 0:v.substring(7))==="ff"&&d(2,v=v.substring(0,7)),m.h!==A.h||m.s!==A.s||m.v!==A.v||m.a!==A.a?(d(4,C=jt(m)),d(0,g=C.toRgb()),d(2,v=C.toHex())):g.r!==S.r||g.g!==S.g||g.b!==S.b||g.a!==S.a?(d(4,C=jt(g)),d(2,v=C.toHex()),d(1,m=C.toHsv())):v!==P&&(d(4,C=jt(v)),d(0,g=C.toRgb()),d(1,m=C.toHsv())),C&&d(5,w=C.isDark()),A=Object.assign({},m),S=Object.assign({},g),P=v,_("input",{color:C,hsv:m,rgb:g,hex:v}))}function rt(M){H=M,d(19,H)}function T(M){s=M,d(3,s)}function E(M){c.$$.not_equal(m.s,M)&&(m.s=M,d(1,m))}function D(M){c.$$.not_equal(m.v,M)&&(m.v=M,d(1,m))}function k(M){s=M,d(3,s)}function B(M){c.$$.not_equal(m.h,M)&&(m.h=M,d(1,m))}function O(M){c.$$.not_equal(m.a,M)&&(m.a=M,d(1,m))}function x(M){s=M,d(3,s)}function I(M){v=M,d(2,v)}function L(M){g=M,d(0,g)}function Y(M){m=M,d(1,m)}function j(M){J=M,d(20,J)}function G(M){Ct[M?"unshift":"push"](()=>{X=M,d(18,X)})}return c.$$set=M=>{"components"in M&&d(24,p=M.components),"label"in M&&d(6,b=M.label),"isAlpha"in M&&d(7,y=M.isAlpha),"isInput"in M&&d(8,h=M.isInput),"isTextInput"in M&&d(9,e=M.isTextInput),"canChangeMode"in M&&d(10,l=M.canChangeMode),"isA11y"in M&&d(11,o=M.isA11y),"a11yColors"in M&&d(12,n=M.a11yColors),"a11yGuidelines"in M&&d(13,r=M.a11yGuidelines),"isA11yOpen"in M&&d(14,i=M.isA11yOpen),"isA11yClosable"in M&&d(15,a=M.isA11yClosable),"isPopup"in M&&d(16,u=M.isPopup),"isOpen"in M&&d(3,s=M.isOpen),"toRight"in M&&d(17,f=M.toRight),"rgb"in M&&d(0,g=M.rgb),"hsv"in M&&d(1,m=M.hsv),"hex"in M&&d(2,v=M.hex),"color"in M&&d(4,C=M.color),"isDark"in M&&d(5,w=M.isDark)},c.$$.update=()=>{c.$$.dirty[0]&7&&(m||g||v)&&lt()},[g,m,v,s,C,w,b,y,h,e,l,o,n,r,i,a,u,f,X,H,J,tt,Z,nt,p,rt,T,E,D,k,B,O,x,I,L,Y,j,G]}class ta extends kt{constructor(t){super(),At(this,t,$s,Zs,Ot,{components:24,label:6,isAlpha:7,isInput:8,isTextInput:9,canChangeMode:10,isA11y:11,a11yColors:12,a11yGuidelines:13,isA11yOpen:14,isA11yClosable:15,isPopup:16,isOpen:3,toRight:17,rgb:0,hsv:1,hex:2,color:4,isDark:5},null,[-1,-1])}}const ea=(c,t)=>Math.floor(Math.random()*(t-c+1))+c,nn=["#ff595e","#ff924c","#ffca3a","#8ac926","#1982c4","#6a4c93","#ff99b6","#ffb7b2"],ia="/assets/glasses-ca8642be.png",na="/assets/laptop-afa03861.png",ra="/assets/hair-416c3326.png",sa="/assets/coffee-7794bf02.png",aa="/assets/goggles-96bb4daf.png",oa="/assets/hairband-299cc720.png",la="/assets/headphones-03d51a37.png",ca="/assets/basketball-c95eb96a.png",ha="/assets/basketballVest-e07faa60.png",ua="/assets/airpot-e41e8be4.png",fa="/assets/ballCap-ee5c5a8a.png",da="/assets/darkCircles-879e0de1.png",ga="/assets/toast-22dec998.png",ma="/assets/watch-c2396f29.png",pa="/assets/sneakers-1f8f079a.png",va="/assets/cookie-9d57dbff.png",_a="/assets/hardHat-6b531677.png",He=he(nn[ea(0,nn.length-1)]),ye=he(),be=he(600),jn={glasses:!1,hair:!1,laptop:!1,coffee:!1,goggles:!1,hairband:!1,headphones:!1,basketball:!1,basketballVest:!1,airpot:!1,ballCap:!1,darkCircles:!1,hardHat:!1,toast:!1,watch:!1,sneakers:!1,cookie:!1},ve={glasses:{title:"안경",src:ia},hair:{title:"앞머리",src:ra},laptop:{title:"노트북",src:na},coffee:{title:"커피",src:sa},goggles:{title:"고글",src:aa},headphones:{title:"헤드폰",src:la},hairband:{title:"농구 머리띠",src:oa},basketballVest:{title:"농구 조끼",src:ha},basketball:{title:"농구 공",src:ca},airpot:{title:"에어팟",src:ua},ballCap:{title:"볼캡",src:fa},darkCircles:{title:"다크써클",src:da},hardHat:{title:"안전모",src:_a},toast:{title:"토스트",src:ga},watch:{title:"애플워치",src:ma},sneakers:{title:"운동화",src:pa},cookie:{title:"쿠키",src:va}},ki=he(jn),ya=c=>{ki.update(t=>({...t,[c]:!t[c]}))},ba=()=>{ki.set(jn)};function Ca(c){let t,d,p,_,b,y,h,e,l,o,n,r,i,a,u,s,f,g,m,v,C,w;function S(P){c[5](P)}let A={isA11yClosable:!1,label:"선택하기"};return c[0]!==void 0&&(A.hex=c[0]),e=new ta({props:A}),Ct.push(()=>Pt(e,"hex",S)),{c(){t=$("div"),d=$("h2"),d.textContent="배경을 꾸며보세요!",p=dt(),_=$("ul"),b=$("li"),y=$("h3"),y.textContent="배경색",h=dt(),yt(e.$$.fragment),o=dt(),n=$("li"),r=$("h3"),r.textContent="배경이미지",i=dt(),a=$("div"),u=$("button"),u.textContent="이미지",s=dt(),f=$("button"),f.textContent="제거",g=dt(),m=$("input"),F(d,"class","svelte-1sm4ylp"),F(y,"class","svelte-1sm4ylp"),F(b,"class","svelte-1sm4ylp"),F(r,"class","svelte-1sm4ylp"),F(u,"class","svelte-1sm4ylp"),F(f,"class","svelte-1sm4ylp"),F(a,"class","buttonWrapper svelte-1sm4ylp"),F(n,"class","svelte-1sm4ylp"),F(_,"class","svelte-1sm4ylp"),F(t,"class","container svelte-1sm4ylp"),F(m,"type","file"),F(m,"accept","image/*"),Wt(m,"display","none")},m(P,X){ot(P,t,X),Q(t,d),Q(t,p),Q(t,_),Q(_,b),Q(b,y),Q(b,h),pt(e,b,null),Q(_,o),Q(_,n),Q(n,r),Q(n,i),Q(n,a),Q(a,u),Q(a,s),Q(a,f),ot(P,g,X),ot(P,m,X),c[7](m),v=!0,C||(w=[ct(u,"click",c[6]),ct(f,"click",c[3]),ct(m,"change",c[2])],C=!0)},p(P,[X]){const K={};!l&&X&1&&(l=!0,K.hex=P[0],Nt(()=>l=!1)),e.$set(K)},i(P){v||(at(e.$$.fragment,P),v=!0)},o(P){ft(e.$$.fragment,P),v=!1},d(P){P&&st(t),vt(e),P&&st(g),P&&st(m),c[7](null),C=!1,Ft(w)}}}function wa(c,t,d){let p,_;Et(c,ye,n=>d(4,p=n)),Et(c,He,n=>d(0,_=n));let b;const y=n=>{const r=n.currentTarget.files;if(!r)return;const i=r[0];if(!i)return;h();const a=URL.createObjectURL(i);se.fabric.Image.fromURL(a,function(u){p.setBackgroundImage(u,p.renderAll.bind(p),{scaleX:p.width/u.width,scaleY:p.height/u.height,selectable:!0})})},h=()=>{p.setBackgroundImage(null,p.renderAll.bind(p))};function e(n){_=n,He.set(_)}const l=()=>{b.click()};function o(n){Ct[n?"unshift":"push"](()=>{b=n,d(1,b)})}return c.$$.update=()=>{c.$$.dirty&17&&p&&p.setBackgroundColor(_,()=>{p.renderAll()})},[_,b,y,h,p,e,l,o]}class Sa extends kt{constructor(t){super(),At(this,t,wa,Ca,Ot,{})}}function Ta(c){let t,d,p,_,b,y,h,e,l,o,n,r,i;return{c(){t=$("div"),d=$("h2"),d.textContent="사진을 추가해보세요!",p=dt(),_=$("div"),_.innerHTML=`<p>사진을 이동하고 크기를 조절해보세요.</p> 
    <p>삭제하고 싶은 사진은 선택 후 제거 버튼을 클릭하세요.</p>`,b=dt(),y=$("div"),h=$("button"),h.textContent="추가",e=dt(),l=$("button"),l.textContent="제거",o=dt(),n=$("input"),F(d,"class","svelte-x4lqyk"),F(_,"class","detail svelte-x4lqyk"),F(h,"class","svelte-x4lqyk"),F(l,"class","svelte-x4lqyk"),Lt(l,"hasActiveObject",c[2]),F(y,"class","photo-buttons svelte-x4lqyk"),F(n,"type","file"),F(n,"accept","image/*"),Wt(n,"display","none"),F(t,"class","container svelte-x4lqyk")},m(a,u){ot(a,t,u),Q(t,d),Q(t,p),Q(t,_),Q(t,b),Q(t,y),Q(y,h),Q(y,e),Q(y,l),Q(t,o),Q(t,n),c[9](n),r||(i=[ct(h,"click",c[8]),ct(l,"click",c[4]),ct(n,"change",c[3])],r=!0)},p(a,[u]){u&4&&Lt(l,"hasActiveObject",a[2])},i:bt,o:bt,d(a){a&&st(t),c[9](null),r=!1,Ft(i)}}}function xa(c,t,d){let p,_,b;Et(c,ye,u=>d(6,p=u)),Et(c,be,u=>d(11,_=u)),Et(c,He,u=>d(7,b=u));let y,h="background",e=0,l=null,o=!1;const n=u=>{const s=u.currentTarget.files;if(!s)return;const f=s[0];if(!f)return;const g=URL.createObjectURL(f);e+=1,se.fabric.Image.fromURL(g,function(m){m.set({left:e*10,top:e*10}),m.set("imageType","item"),m.scaleToWidth(_/6),p.add(m),p.setActiveObject(m),d(2,o=!0)}),p.renderAll()},r=()=>{const u=p.getActiveObjects();u&&(u.forEach(s=>{p.remove(s),e-=1}),d(2,o=!1)),p.discardActiveObject()},i=()=>{y.click(),d(1,h="item")};function a(u){Ct[u?"unshift":"push"](()=>{y=u,d(0,y)})}return c.$$.update=()=>{c.$$.dirty&192&&p&&p.setBackgroundColor(b,()=>{p.renderAll()}),c.$$.dirty&96&&p&&p.on("mouse:move",u=>{d(5,l=p.getActiveObjects()),d(2,o=l.length>0)})},[y,h,o,n,r,l,p,b,i,a]}class Oa extends kt{constructor(t){super(),At(this,t,xa,Ta,Ot,{})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wn=function(c){const t=[];let d=0;for(let p=0;p<c.length;p++){let _=c.charCodeAt(p);_<128?t[d++]=_:_<2048?(t[d++]=_>>6|192,t[d++]=_&63|128):(_&64512)===55296&&p+1<c.length&&(c.charCodeAt(p+1)&64512)===56320?(_=65536+((_&1023)<<10)+(c.charCodeAt(++p)&1023),t[d++]=_>>18|240,t[d++]=_>>12&63|128,t[d++]=_>>6&63|128,t[d++]=_&63|128):(t[d++]=_>>12|224,t[d++]=_>>6&63|128,t[d++]=_&63|128)}return t},Aa=function(c){const t=[];let d=0,p=0;for(;d<c.length;){const _=c[d++];if(_<128)t[p++]=String.fromCharCode(_);else if(_>191&&_<224){const b=c[d++];t[p++]=String.fromCharCode((_&31)<<6|b&63)}else if(_>239&&_<365){const b=c[d++],y=c[d++],h=c[d++],e=((_&7)<<18|(b&63)<<12|(y&63)<<6|h&63)-65536;t[p++]=String.fromCharCode(55296+(e>>10)),t[p++]=String.fromCharCode(56320+(e&1023))}else{const b=c[d++],y=c[d++];t[p++]=String.fromCharCode((_&15)<<12|(b&63)<<6|y&63)}}return t.join("")},Nn={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(c,t){if(!Array.isArray(c))throw Error("encodeByteArray takes an array as a parameter");this.init_();const d=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,p=[];for(let _=0;_<c.length;_+=3){const b=c[_],y=_+1<c.length,h=y?c[_+1]:0,e=_+2<c.length,l=e?c[_+2]:0,o=b>>2,n=(b&3)<<4|h>>4;let r=(h&15)<<2|l>>6,i=l&63;e||(i=64,y||(r=64)),p.push(d[o],d[n],d[r],d[i])}return p.join("")},encodeString(c,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(c):this.encodeByteArray(Wn(c),t)},decodeString(c,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(c):Aa(this.decodeStringToByteArray(c,t))},decodeStringToByteArray(c,t){this.init_();const d=t?this.charToByteMapWebSafe_:this.charToByteMap_,p=[];for(let _=0;_<c.length;){const b=d[c.charAt(_++)],h=_<c.length?d[c.charAt(_)]:0;++_;const l=_<c.length?d[c.charAt(_)]:64;++_;const n=_<c.length?d[c.charAt(_)]:64;if(++_,b==null||h==null||l==null||n==null)throw new ka;const r=b<<2|h>>4;if(p.push(r),l!==64){const i=h<<4&240|l>>2;if(p.push(i),n!==64){const a=l<<6&192|n;p.push(a)}}}return p},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let c=0;c<this.ENCODED_VALS.length;c++)this.byteToCharMap_[c]=this.ENCODED_VALS.charAt(c),this.charToByteMap_[this.byteToCharMap_[c]]=c,this.byteToCharMapWebSafe_[c]=this.ENCODED_VALS_WEBSAFE.charAt(c),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[c]]=c,c>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(c)]=c,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(c)]=c)}}};class ka extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ea=function(c){const t=Wn(c);return Nn.encodeByteArray(t,!0)},Xn=function(c){return Ea(c).replace(/\./g,"")},Da=function(c){try{return Nn.decodeString(c,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pa(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ia=()=>Pa().__FIREBASE_DEFAULTS__,Ma=()=>{if(typeof process>"u"||typeof process.env>"u")return;const c={}.__FIREBASE_DEFAULTS__;if(c)return JSON.parse(c)},Fa=()=>{if(typeof document>"u")return;let c;try{c=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=c&&Da(c[1]);return t&&JSON.parse(t)},Ra=()=>{try{return Ia()||Ma()||Fa()}catch(c){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${c}`);return}},La=()=>{var c;return(c=Ra())===null||c===void 0?void 0:c.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ba{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,d)=>{this.resolve=t,this.reject=d})}wrapCallback(t){return(d,p)=>{d?this.reject(d):this.resolve(p),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(d):t(d,p))}}}function ja(){const c=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof c=="object"&&c.id!==void 0}function Hn(){try{return typeof indexedDB=="object"}catch{return!1}}function Yn(){return new Promise((c,t)=>{try{let d=!0;const p="validate-browser-context-for-indexeddb-analytics-module",_=self.indexedDB.open(p);_.onsuccess=()=>{_.result.close(),d||self.indexedDB.deleteDatabase(p),c(!0)},_.onupgradeneeded=()=>{d=!1},_.onerror=()=>{var b;t(((b=_.error)===null||b===void 0?void 0:b.message)||"")}}catch(d){t(d)}})}function Wa(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Na="FirebaseError";class ue extends Error{constructor(t,d,p){super(d),this.code=t,this.customData=p,this.name=Na,Object.setPrototypeOf(this,ue.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,qe.prototype.create)}}class qe{constructor(t,d,p){this.service=t,this.serviceName=d,this.errors=p}create(t,...d){const p=d[0]||{},_=`${this.service}/${t}`,b=this.errors[t],y=b?Xa(b,p):"Error",h=`${this.serviceName}: ${y} (${_}).`;return new ue(_,h,p)}}function Xa(c,t){return c.replace(Ha,(d,p)=>{const _=t[p];return _!=null?String(_):`<${p}?>`})}const Ha=/\{\$([^}]+)}/g;function Ye(c,t){if(c===t)return!0;const d=Object.keys(c),p=Object.keys(t);for(const _ of d){if(!p.includes(_))return!1;const b=c[_],y=t[_];if(rn(b)&&rn(y)){if(!Ye(b,y))return!1}else if(b!==y)return!1}for(const _ of p)if(!d.includes(_))return!1;return!0}function rn(c){return c!==null&&typeof c=="object"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ya=1e3,za=2,Ua=4*60*60*1e3,Va=.5;function sn(c,t=Ya,d=za){const p=t*Math.pow(d,c),_=Math.round(Va*p*(Math.random()-.5)*2);return Math.min(Ua,p+_)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zn(c){return c&&c._delegate?c._delegate:c}class $t{constructor(t,d,p){this.name=t,this.instanceFactory=d,this.type=p,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ee="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ga{constructor(t,d){this.name=t,this.container=d,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const d=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(d)){const p=new Ba;if(this.instancesDeferred.set(d,p),this.isInitialized(d)||this.shouldAutoInitialize())try{const _=this.getOrInitializeService({instanceIdentifier:d});_&&p.resolve(_)}catch{}}return this.instancesDeferred.get(d).promise}getImmediate(t){var d;const p=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),_=(d=t==null?void 0:t.optional)!==null&&d!==void 0?d:!1;if(this.isInitialized(p)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:p})}catch(b){if(_)return null;throw b}else{if(_)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Ka(t))try{this.getOrInitializeService({instanceIdentifier:ee})}catch{}for(const[d,p]of this.instancesDeferred.entries()){const _=this.normalizeInstanceIdentifier(d);try{const b=this.getOrInitializeService({instanceIdentifier:_});p.resolve(b)}catch{}}}}clearInstance(t=ee){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(d=>"INTERNAL"in d).map(d=>d.INTERNAL.delete()),...t.filter(d=>"_delete"in d).map(d=>d._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=ee){return this.instances.has(t)}getOptions(t=ee){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:d={}}=t,p=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(p))throw Error(`${this.name}(${p}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const _=this.getOrInitializeService({instanceIdentifier:p,options:d});for(const[b,y]of this.instancesDeferred.entries()){const h=this.normalizeInstanceIdentifier(b);p===h&&y.resolve(_)}return _}onInit(t,d){var p;const _=this.normalizeInstanceIdentifier(d),b=(p=this.onInitCallbacks.get(_))!==null&&p!==void 0?p:new Set;b.add(t),this.onInitCallbacks.set(_,b);const y=this.instances.get(_);return y&&t(y,_),()=>{b.delete(t)}}invokeOnInitCallbacks(t,d){const p=this.onInitCallbacks.get(d);if(p)for(const _ of p)try{_(t,d)}catch{}}getOrInitializeService({instanceIdentifier:t,options:d={}}){let p=this.instances.get(t);if(!p&&this.component&&(p=this.component.instanceFactory(this.container,{instanceIdentifier:qa(t),options:d}),this.instances.set(t,p),this.instancesOptions.set(t,d),this.invokeOnInitCallbacks(p,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,p)}catch{}return p||null}normalizeInstanceIdentifier(t=ee){return this.component?this.component.multipleInstances?t:ee:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function qa(c){return c===ee?void 0:c}function Ka(c){return c.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ja{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const d=this.getProvider(t.name);if(d.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);d.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const d=new Ga(t,this);return this.providers.set(t,d),d}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Tt;(function(c){c[c.DEBUG=0]="DEBUG",c[c.VERBOSE=1]="VERBOSE",c[c.INFO=2]="INFO",c[c.WARN=3]="WARN",c[c.ERROR=4]="ERROR",c[c.SILENT=5]="SILENT"})(Tt||(Tt={}));const Qa={debug:Tt.DEBUG,verbose:Tt.VERBOSE,info:Tt.INFO,warn:Tt.WARN,error:Tt.ERROR,silent:Tt.SILENT},Za=Tt.INFO,$a={[Tt.DEBUG]:"log",[Tt.VERBOSE]:"log",[Tt.INFO]:"info",[Tt.WARN]:"warn",[Tt.ERROR]:"error"},to=(c,t,...d)=>{if(t<c.logLevel)return;const p=new Date().toISOString(),_=$a[t];if(_)console[_](`[${p}]  ${c.name}:`,...d);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Un{constructor(t){this.name=t,this._logLevel=Za,this._logHandler=to,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Tt))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Qa[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Tt.DEBUG,...t),this._logHandler(this,Tt.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Tt.VERBOSE,...t),this._logHandler(this,Tt.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Tt.INFO,...t),this._logHandler(this,Tt.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Tt.WARN,...t),this._logHandler(this,Tt.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Tt.ERROR,...t),this._logHandler(this,Tt.ERROR,...t)}}const eo=(c,t)=>t.some(d=>c instanceof d);let an,on;function io(){return an||(an=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function no(){return on||(on=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Vn=new WeakMap,_i=new WeakMap,Gn=new WeakMap,si=new WeakMap,Ei=new WeakMap;function ro(c){const t=new Promise((d,p)=>{const _=()=>{c.removeEventListener("success",b),c.removeEventListener("error",y)},b=()=>{d(Jt(c.result)),_()},y=()=>{p(c.error),_()};c.addEventListener("success",b),c.addEventListener("error",y)});return t.then(d=>{d instanceof IDBCursor&&Vn.set(d,c)}).catch(()=>{}),Ei.set(t,c),t}function so(c){if(_i.has(c))return;const t=new Promise((d,p)=>{const _=()=>{c.removeEventListener("complete",b),c.removeEventListener("error",y),c.removeEventListener("abort",y)},b=()=>{d(),_()},y=()=>{p(c.error||new DOMException("AbortError","AbortError")),_()};c.addEventListener("complete",b),c.addEventListener("error",y),c.addEventListener("abort",y)});_i.set(c,t)}let yi={get(c,t,d){if(c instanceof IDBTransaction){if(t==="done")return _i.get(c);if(t==="objectStoreNames")return c.objectStoreNames||Gn.get(c);if(t==="store")return d.objectStoreNames[1]?void 0:d.objectStore(d.objectStoreNames[0])}return Jt(c[t])},set(c,t,d){return c[t]=d,!0},has(c,t){return c instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in c}};function ao(c){yi=c(yi)}function oo(c){return c===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...d){const p=c.call(ai(this),t,...d);return Gn.set(p,t.sort?t.sort():[t]),Jt(p)}:no().includes(c)?function(...t){return c.apply(ai(this),t),Jt(Vn.get(this))}:function(...t){return Jt(c.apply(ai(this),t))}}function lo(c){return typeof c=="function"?oo(c):(c instanceof IDBTransaction&&so(c),eo(c,io())?new Proxy(c,yi):c)}function Jt(c){if(c instanceof IDBRequest)return ro(c);if(si.has(c))return si.get(c);const t=lo(c);return t!==c&&(si.set(c,t),Ei.set(t,c)),t}const ai=c=>Ei.get(c);function qn(c,t,{blocked:d,upgrade:p,blocking:_,terminated:b}={}){const y=indexedDB.open(c,t),h=Jt(y);return p&&y.addEventListener("upgradeneeded",e=>{p(Jt(y.result),e.oldVersion,e.newVersion,Jt(y.transaction))}),d&&y.addEventListener("blocked",()=>d()),h.then(e=>{b&&e.addEventListener("close",()=>b()),_&&e.addEventListener("versionchange",()=>_())}).catch(()=>{}),h}const co=["get","getKey","getAll","getAllKeys","count"],ho=["put","add","delete","clear"],oi=new Map;function ln(c,t){if(!(c instanceof IDBDatabase&&!(t in c)&&typeof t=="string"))return;if(oi.get(t))return oi.get(t);const d=t.replace(/FromIndex$/,""),p=t!==d,_=ho.includes(d);if(!(d in(p?IDBIndex:IDBObjectStore).prototype)||!(_||co.includes(d)))return;const b=async function(y,...h){const e=this.transaction(y,_?"readwrite":"readonly");let l=e.store;return p&&(l=l.index(h.shift())),(await Promise.all([l[d](...h),_&&e.done]))[0]};return oi.set(t,b),b}ao(c=>({...c,get:(t,d,p)=>ln(t,d)||c.get(t,d,p),has:(t,d)=>!!ln(t,d)||c.has(t,d)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uo{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(d=>{if(fo(d)){const p=d.getImmediate();return`${p.library}/${p.version}`}else return null}).filter(d=>d).join(" ")}}function fo(c){const t=c.getComponent();return(t==null?void 0:t.type)==="VERSION"}const bi="@firebase/app",cn="0.9.5";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ae=new Un("@firebase/app"),go="@firebase/app-compat",mo="@firebase/analytics-compat",po="@firebase/analytics",vo="@firebase/app-check-compat",_o="@firebase/app-check",yo="@firebase/auth",bo="@firebase/auth-compat",Co="@firebase/database",wo="@firebase/database-compat",So="@firebase/functions",To="@firebase/functions-compat",xo="@firebase/installations",Oo="@firebase/installations-compat",Ao="@firebase/messaging",ko="@firebase/messaging-compat",Eo="@firebase/performance",Do="@firebase/performance-compat",Po="@firebase/remote-config",Io="@firebase/remote-config-compat",Mo="@firebase/storage",Fo="@firebase/storage-compat",Ro="@firebase/firestore",Lo="@firebase/firestore-compat",Bo="firebase";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ci="[DEFAULT]",jo={[bi]:"fire-core",[go]:"fire-core-compat",[po]:"fire-analytics",[mo]:"fire-analytics-compat",[_o]:"fire-app-check",[vo]:"fire-app-check-compat",[yo]:"fire-auth",[bo]:"fire-auth-compat",[Co]:"fire-rtdb",[wo]:"fire-rtdb-compat",[So]:"fire-fn",[To]:"fire-fn-compat",[xo]:"fire-iid",[Oo]:"fire-iid-compat",[Ao]:"fire-fcm",[ko]:"fire-fcm-compat",[Eo]:"fire-perf",[Do]:"fire-perf-compat",[Po]:"fire-rc",[Io]:"fire-rc-compat",[Mo]:"fire-gcs",[Fo]:"fire-gcs-compat",[Ro]:"fire-fst",[Lo]:"fire-fst-compat","fire-js":"fire-js",[Bo]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ze=new Map,wi=new Map;function Wo(c,t){try{c.container.addComponent(t)}catch(d){ae.debug(`Component ${t.name} failed to register with FirebaseApp ${c.name}`,d)}}function oe(c){const t=c.name;if(wi.has(t))return ae.debug(`There were multiple attempts to register component ${t}.`),!1;wi.set(t,c);for(const d of ze.values())Wo(d,c);return!0}function Ke(c,t){const d=c.container.getProvider("heartbeat").getImmediate({optional:!0});return d&&d.triggerHeartbeat(),c.container.getProvider(t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const No={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},Qt=new qe("app","Firebase",No);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xo{constructor(t,d,p){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},d),this._name=d.name,this._automaticDataCollectionEnabled=d.automaticDataCollectionEnabled,this._container=p,this.container.addComponent(new $t("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Qt.create("app-deleted",{appName:this._name})}}function Kn(c,t={}){let d=c;typeof t!="object"&&(t={name:t});const p=Object.assign({name:Ci,automaticDataCollectionEnabled:!1},t),_=p.name;if(typeof _!="string"||!_)throw Qt.create("bad-app-name",{appName:String(_)});if(d||(d=La()),!d)throw Qt.create("no-options");const b=ze.get(_);if(b){if(Ye(d,b.options)&&Ye(p,b.config))return b;throw Qt.create("duplicate-app",{appName:_})}const y=new Ja(_);for(const e of wi.values())y.addComponent(e);const h=new Xo(d,p,y);return ze.set(_,h),h}function Ho(c=Ci){const t=ze.get(c);if(!t&&c===Ci)return Kn();if(!t)throw Qt.create("no-app",{appName:c});return t}function Zt(c,t,d){var p;let _=(p=jo[c])!==null&&p!==void 0?p:c;d&&(_+=`-${d}`);const b=_.match(/\s|\//),y=t.match(/\s|\//);if(b||y){const h=[`Unable to register library "${_}" with version "${t}":`];b&&h.push(`library name "${_}" contains illegal characters (whitespace or "/")`),b&&y&&h.push("and"),y&&h.push(`version name "${t}" contains illegal characters (whitespace or "/")`),ae.warn(h.join(" "));return}oe(new $t(`${_}-version`,()=>({library:_,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yo="firebase-heartbeat-database",zo=1,Me="firebase-heartbeat-store";let li=null;function Jn(){return li||(li=qn(Yo,zo,{upgrade:(c,t)=>{switch(t){case 0:c.createObjectStore(Me)}}}).catch(c=>{throw Qt.create("idb-open",{originalErrorMessage:c.message})})),li}async function Uo(c){try{return(await Jn()).transaction(Me).objectStore(Me).get(Qn(c))}catch(t){if(t instanceof ue)ae.warn(t.message);else{const d=Qt.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});ae.warn(d.message)}}}async function hn(c,t){try{const p=(await Jn()).transaction(Me,"readwrite");return await p.objectStore(Me).put(t,Qn(c)),p.done}catch(d){if(d instanceof ue)ae.warn(d.message);else{const p=Qt.create("idb-set",{originalErrorMessage:d==null?void 0:d.message});ae.warn(p.message)}}}function Qn(c){return`${c.name}!${c.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vo=1024,Go=30*24*60*60*1e3;class qo{constructor(t){this.container=t,this._heartbeatsCache=null;const d=this.container.getProvider("app").getImmediate();this._storage=new Jo(d),this._heartbeatsCachePromise=this._storage.read().then(p=>(this._heartbeatsCache=p,p))}async triggerHeartbeat(){const d=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),p=un();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===p||this._heartbeatsCache.heartbeats.some(_=>_.date===p)))return this._heartbeatsCache.heartbeats.push({date:p,agent:d}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(_=>{const b=new Date(_.date).valueOf();return Date.now()-b<=Go}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const t=un(),{heartbeatsToSend:d,unsentEntries:p}=Ko(this._heartbeatsCache.heartbeats),_=Xn(JSON.stringify({version:2,heartbeats:d}));return this._heartbeatsCache.lastSentHeartbeatDate=t,p.length>0?(this._heartbeatsCache.heartbeats=p,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),_}}function un(){return new Date().toISOString().substring(0,10)}function Ko(c,t=Vo){const d=[];let p=c.slice();for(const _ of c){const b=d.find(y=>y.agent===_.agent);if(b){if(b.dates.push(_.date),fn(d)>t){b.dates.pop();break}}else if(d.push({agent:_.agent,dates:[_.date]}),fn(d)>t){d.pop();break}p=p.slice(1)}return{heartbeatsToSend:d,unsentEntries:p}}class Jo{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Hn()?Yn().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await Uo(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(t){var d;if(await this._canUseIndexedDBPromise){const _=await this.read();return hn(this.app,{lastSentHeartbeatDate:(d=t.lastSentHeartbeatDate)!==null&&d!==void 0?d:_.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var d;if(await this._canUseIndexedDBPromise){const _=await this.read();return hn(this.app,{lastSentHeartbeatDate:(d=t.lastSentHeartbeatDate)!==null&&d!==void 0?d:_.lastSentHeartbeatDate,heartbeats:[..._.heartbeats,...t.heartbeats]})}else return}}function fn(c){return Xn(JSON.stringify({version:2,heartbeats:c})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qo(c){oe(new $t("platform-logger",t=>new uo(t),"PRIVATE")),oe(new $t("heartbeat",t=>new qo(t),"PRIVATE")),Zt(bi,cn,c),Zt(bi,cn,"esm2017"),Zt("fire-js","")}Qo("");const Zn="@firebase/installations",Di="0.6.4";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $n=1e4,tr=`w:${Di}`,er="FIS_v2",Zo="https://firebaseinstallations.googleapis.com/v1",$o=60*60*1e3,tl="installations",el="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const il={["missing-app-config-values"]:'Missing App configuration value: "{$valueName}"',["not-registered"]:"Firebase Installation is not registered.",["installation-not-found"]:"Firebase Installation not found.",["request-failed"]:'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',["app-offline"]:"Could not process request. Application offline.",["delete-pending-registration"]:"Can't delete installation while there is a pending registration request."},le=new qe(tl,el,il);function ir(c){return c instanceof ue&&c.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nr({projectId:c}){return`${Zo}/projects/${c}/installations`}function rr(c){return{token:c.token,requestStatus:2,expiresIn:rl(c.expiresIn),creationTime:Date.now()}}async function sr(c,t){const p=(await t.json()).error;return le.create("request-failed",{requestName:c,serverCode:p.code,serverMessage:p.message,serverStatus:p.status})}function ar({apiKey:c}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":c})}function nl(c,{refreshToken:t}){const d=ar(c);return d.append("Authorization",sl(t)),d}async function or(c){const t=await c();return t.status>=500&&t.status<600?c():t}function rl(c){return Number(c.replace("s","000"))}function sl(c){return`${er} ${c}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function al({appConfig:c,heartbeatServiceProvider:t},{fid:d}){const p=nr(c),_=ar(c),b=t.getImmediate({optional:!0});if(b){const l=await b.getHeartbeatsHeader();l&&_.append("x-firebase-client",l)}const y={fid:d,authVersion:er,appId:c.appId,sdkVersion:tr},h={method:"POST",headers:_,body:JSON.stringify(y)},e=await or(()=>fetch(p,h));if(e.ok){const l=await e.json();return{fid:l.fid||d,registrationStatus:2,refreshToken:l.refreshToken,authToken:rr(l.authToken)}}else throw await sr("Create Installation",e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lr(c){return new Promise(t=>{setTimeout(t,c)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ol(c){return btoa(String.fromCharCode(...c)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ll=/^[cdef][\w-]{21}$/,Si="";function cl(){try{const c=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(c),c[0]=112+c[0]%16;const d=hl(c);return ll.test(d)?d:Si}catch{return Si}}function hl(c){return ol(c).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Je(c){return`${c.appName}!${c.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cr=new Map;function hr(c,t){const d=Je(c);ur(d,t),ul(d,t)}function ur(c,t){const d=cr.get(c);if(d)for(const p of d)p(t)}function ul(c,t){const d=fl();d&&d.postMessage({key:c,fid:t}),dl()}let ne=null;function fl(){return!ne&&"BroadcastChannel"in self&&(ne=new BroadcastChannel("[Firebase] FID Change"),ne.onmessage=c=>{ur(c.data.key,c.data.fid)}),ne}function dl(){cr.size===0&&ne&&(ne.close(),ne=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gl="firebase-installations-database",ml=1,ce="firebase-installations-store";let ci=null;function Pi(){return ci||(ci=qn(gl,ml,{upgrade:(c,t)=>{switch(t){case 0:c.createObjectStore(ce)}}})),ci}async function Ue(c,t){const d=Je(c),_=(await Pi()).transaction(ce,"readwrite"),b=_.objectStore(ce),y=await b.get(d);return await b.put(t,d),await _.done,(!y||y.fid!==t.fid)&&hr(c,t.fid),t}async function fr(c){const t=Je(c),p=(await Pi()).transaction(ce,"readwrite");await p.objectStore(ce).delete(t),await p.done}async function Qe(c,t){const d=Je(c),_=(await Pi()).transaction(ce,"readwrite"),b=_.objectStore(ce),y=await b.get(d),h=t(y);return h===void 0?await b.delete(d):await b.put(h,d),await _.done,h&&(!y||y.fid!==h.fid)&&hr(c,h.fid),h}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ii(c){let t;const d=await Qe(c.appConfig,p=>{const _=pl(p),b=vl(c,_);return t=b.registrationPromise,b.installationEntry});return d.fid===Si?{installationEntry:await t}:{installationEntry:d,registrationPromise:t}}function pl(c){const t=c||{fid:cl(),registrationStatus:0};return dr(t)}function vl(c,t){if(t.registrationStatus===0){if(!navigator.onLine){const _=Promise.reject(le.create("app-offline"));return{installationEntry:t,registrationPromise:_}}const d={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},p=_l(c,d);return{installationEntry:d,registrationPromise:p}}else return t.registrationStatus===1?{installationEntry:t,registrationPromise:yl(c)}:{installationEntry:t}}async function _l(c,t){try{const d=await al(c,t);return Ue(c.appConfig,d)}catch(d){throw ir(d)&&d.customData.serverCode===409?await fr(c.appConfig):await Ue(c.appConfig,{fid:t.fid,registrationStatus:0}),d}}async function yl(c){let t=await dn(c.appConfig);for(;t.registrationStatus===1;)await lr(100),t=await dn(c.appConfig);if(t.registrationStatus===0){const{installationEntry:d,registrationPromise:p}=await Ii(c);return p||d}return t}function dn(c){return Qe(c,t=>{if(!t)throw le.create("installation-not-found");return dr(t)})}function dr(c){return bl(c)?{fid:c.fid,registrationStatus:0}:c}function bl(c){return c.registrationStatus===1&&c.registrationTime+$n<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cl({appConfig:c,heartbeatServiceProvider:t},d){const p=wl(c,d),_=nl(c,d),b=t.getImmediate({optional:!0});if(b){const l=await b.getHeartbeatsHeader();l&&_.append("x-firebase-client",l)}const y={installation:{sdkVersion:tr,appId:c.appId}},h={method:"POST",headers:_,body:JSON.stringify(y)},e=await or(()=>fetch(p,h));if(e.ok){const l=await e.json();return rr(l)}else throw await sr("Generate Auth Token",e)}function wl(c,{fid:t}){return`${nr(c)}/${t}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mi(c,t=!1){let d;const p=await Qe(c.appConfig,b=>{if(!gr(b))throw le.create("not-registered");const y=b.authToken;if(!t&&xl(y))return b;if(y.requestStatus===1)return d=Sl(c,t),b;{if(!navigator.onLine)throw le.create("app-offline");const h=Al(b);return d=Tl(c,h),h}});return d?await d:p.authToken}async function Sl(c,t){let d=await gn(c.appConfig);for(;d.authToken.requestStatus===1;)await lr(100),d=await gn(c.appConfig);const p=d.authToken;return p.requestStatus===0?Mi(c,t):p}function gn(c){return Qe(c,t=>{if(!gr(t))throw le.create("not-registered");const d=t.authToken;return kl(d)?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t})}async function Tl(c,t){try{const d=await Cl(c,t),p=Object.assign(Object.assign({},t),{authToken:d});return await Ue(c.appConfig,p),d}catch(d){if(ir(d)&&(d.customData.serverCode===401||d.customData.serverCode===404))await fr(c.appConfig);else{const p=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await Ue(c.appConfig,p)}throw d}}function gr(c){return c!==void 0&&c.registrationStatus===2}function xl(c){return c.requestStatus===2&&!Ol(c)}function Ol(c){const t=Date.now();return t<c.creationTime||c.creationTime+c.expiresIn<t+$o}function Al(c){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},c),{authToken:t})}function kl(c){return c.requestStatus===1&&c.requestTime+$n<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function El(c){const t=c,{installationEntry:d,registrationPromise:p}=await Ii(t);return p?p.catch(console.error):Mi(t).catch(console.error),d.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dl(c,t=!1){const d=c;return await Pl(d),(await Mi(d,t)).token}async function Pl(c){const{registrationPromise:t}=await Ii(c);t&&await t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Il(c){if(!c||!c.options)throw hi("App Configuration");if(!c.name)throw hi("App Name");const t=["projectId","apiKey","appId"];for(const d of t)if(!c.options[d])throw hi(d);return{appName:c.name,projectId:c.options.projectId,apiKey:c.options.apiKey,appId:c.options.appId}}function hi(c){return le.create("missing-app-config-values",{valueName:c})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mr="installations",Ml="installations-internal",Fl=c=>{const t=c.getProvider("app").getImmediate(),d=Il(t),p=Ke(t,"heartbeat");return{app:t,appConfig:d,heartbeatServiceProvider:p,_delete:()=>Promise.resolve()}},Rl=c=>{const t=c.getProvider("app").getImmediate(),d=Ke(t,mr).getImmediate();return{getId:()=>El(d),getToken:_=>Dl(d,_)}};function Ll(){oe(new $t(mr,Fl,"PUBLIC")),oe(new $t(Ml,Rl,"PRIVATE"))}Ll();Zt(Zn,Di);Zt(Zn,Di,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ve="analytics",Bl="firebase_id",jl="origin",Wl=60*1e3,Nl="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",pr="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xt=new Un("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vr(c){return Promise.all(c.map(t=>t.catch(d=>d)))}function Xl(c,t){const d=document.createElement("script");d.src=`${pr}?l=${c}&id=${t}`,d.async=!0,document.head.appendChild(d)}function Hl(c){let t=[];return Array.isArray(window[c])?t=window[c]:window[c]=t,t}async function Yl(c,t,d,p,_,b){const y=p[_];try{if(y)await t[y];else{const e=(await vr(d)).find(l=>l.measurementId===_);e&&await t[e.appId]}}catch(h){Xt.error(h)}c("config",_,b)}async function zl(c,t,d,p,_){try{let b=[];if(_&&_.send_to){let y=_.send_to;Array.isArray(y)||(y=[y]);const h=await vr(d);for(const e of y){const l=h.find(n=>n.measurementId===e),o=l&&t[l.appId];if(o)b.push(o);else{b=[];break}}}b.length===0&&(b=Object.values(t)),await Promise.all(b),c("event",p,_||{})}catch(b){Xt.error(b)}}function Ul(c,t,d,p){async function _(b,y,h){try{b==="event"?await zl(c,t,d,y,h):b==="config"?await Yl(c,t,d,p,y,h):b==="consent"?c("consent","update",h):c("set",y)}catch(e){Xt.error(e)}}return _}function Vl(c,t,d,p,_){let b=function(...y){window[p].push(arguments)};return window[_]&&typeof window[_]=="function"&&(b=window[_]),window[_]=Ul(b,c,t,d),{gtagCore:b,wrappedGtag:window[_]}}function Gl(c){const t=window.document.getElementsByTagName("script");for(const d of Object.values(t))if(d.src&&d.src.includes(pr)&&d.src.includes(c))return d;return null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ql={["already-exists"]:"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.",["already-initialized"]:"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.",["already-initialized-settings"]:"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",["interop-component-reg-failed"]:"Firebase Analytics Interop Component failed to instantiate: {$reason}",["invalid-analytics-context"]:"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",["indexeddb-unavailable"]:"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",["fetch-throttle"]:"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.",["config-fetch-failed"]:"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}",["no-api-key"]:'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',["no-app-id"]:'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'},Yt=new qe("analytics","Analytics",ql);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kl=30,Jl=1e3;class Ql{constructor(t={},d=Jl){this.throttleMetadata=t,this.intervalMillis=d}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,d){this.throttleMetadata[t]=d}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}}const _r=new Ql;function Zl(c){return new Headers({Accept:"application/json","x-goog-api-key":c})}async function $l(c){var t;const{appId:d,apiKey:p}=c,_={method:"GET",headers:Zl(p)},b=Nl.replace("{app-id}",d),y=await fetch(b,_);if(y.status!==200&&y.status!==304){let h="";try{const e=await y.json();!((t=e.error)===null||t===void 0)&&t.message&&(h=e.error.message)}catch{}throw Yt.create("config-fetch-failed",{httpStatus:y.status,responseMessage:h})}return y.json()}async function tc(c,t=_r,d){const{appId:p,apiKey:_,measurementId:b}=c.options;if(!p)throw Yt.create("no-app-id");if(!_){if(b)return{measurementId:b,appId:p};throw Yt.create("no-api-key")}const y=t.getThrottleMetadata(p)||{backoffCount:0,throttleEndTimeMillis:Date.now()},h=new nc;return setTimeout(async()=>{h.abort()},d!==void 0?d:Wl),yr({appId:p,apiKey:_,measurementId:b},y,h,t)}async function yr(c,{throttleEndTimeMillis:t,backoffCount:d},p,_=_r){var b;const{appId:y,measurementId:h}=c;try{await ec(p,t)}catch(e){if(h)return Xt.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${h} provided in the "measurementId" field in the local Firebase config. [${e==null?void 0:e.message}]`),{appId:y,measurementId:h};throw e}try{const e=await $l(c);return _.deleteThrottleMetadata(y),e}catch(e){const l=e;if(!ic(l)){if(_.deleteThrottleMetadata(y),h)return Xt.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${h} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:y,measurementId:h};throw e}const o=Number((b=l==null?void 0:l.customData)===null||b===void 0?void 0:b.httpStatus)===503?sn(d,_.intervalMillis,Kl):sn(d,_.intervalMillis),n={throttleEndTimeMillis:Date.now()+o,backoffCount:d+1};return _.setThrottleMetadata(y,n),Xt.debug(`Calling attemptFetch again in ${o} millis`),yr(c,n,p,_)}}function ec(c,t){return new Promise((d,p)=>{const _=Math.max(t-Date.now(),0),b=setTimeout(d,_);c.addEventListener(()=>{clearTimeout(b),p(Yt.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}function ic(c){if(!(c instanceof ue)||!c.customData)return!1;const t=Number(c.customData.httpStatus);return t===429||t===500||t===503||t===504}class nc{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach(t=>t())}}async function rc(c,t,d,p,_){if(_&&_.global){c("event",d,p);return}else{const b=await t,y=Object.assign(Object.assign({},p),{send_to:b});c("event",d,y)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sc(){if(Hn())try{await Yn()}catch(c){return Xt.warn(Yt.create("indexeddb-unavailable",{errorInfo:c==null?void 0:c.toString()}).message),!1}else return Xt.warn(Yt.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function ac(c,t,d,p,_,b,y){var h;const e=tc(c);e.then(i=>{d[i.measurementId]=i.appId,c.options.measurementId&&i.measurementId!==c.options.measurementId&&Xt.warn(`The measurement ID in the local Firebase config (${c.options.measurementId}) does not match the measurement ID fetched from the server (${i.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(i=>Xt.error(i)),t.push(e);const l=sc().then(i=>{if(i)return p.getId()}),[o,n]=await Promise.all([e,l]);Gl(b)||Xl(b,o.measurementId),_("js",new Date);const r=(h=y==null?void 0:y.config)!==null&&h!==void 0?h:{};return r[jl]="firebase",r.update=!0,n!=null&&(r[Bl]=n),_("config",o.measurementId,r),o.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oc{constructor(t){this.app=t}_delete(){return delete Oe[this.app.options.appId],Promise.resolve()}}let Oe={},mn=[];const pn={};let ui="dataLayer",lc="gtag",vn,br,_n=!1;function cc(){const c=[];if(ja()&&c.push("This is a browser extension environment."),Wa()||c.push("Cookies are not available."),c.length>0){const t=c.map((p,_)=>`(${_+1}) ${p}`).join(" "),d=Yt.create("invalid-analytics-context",{errorInfo:t});Xt.warn(d.message)}}function hc(c,t,d){cc();const p=c.options.appId;if(!p)throw Yt.create("no-app-id");if(!c.options.apiKey)if(c.options.measurementId)Xt.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${c.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Yt.create("no-api-key");if(Oe[p]!=null)throw Yt.create("already-exists",{id:p});if(!_n){Hl(ui);const{wrappedGtag:b,gtagCore:y}=Vl(Oe,mn,pn,ui,lc);br=b,vn=y,_n=!0}return Oe[p]=ac(c,mn,pn,t,vn,ui,d),new oc(c)}function uc(c=Ho()){c=zn(c);const t=Ke(c,Ve);return t.isInitialized()?t.getImmediate():fc(c)}function fc(c,t={}){const d=Ke(c,Ve);if(d.isInitialized()){const _=d.getImmediate();if(Ye(t,d.getOptions()))return _;throw Yt.create("already-initialized")}return d.initialize({options:t})}function Se(c,t,d,p){c=zn(c),rc(br,Oe[c.app.options.appId],t,d,p).catch(_=>Xt.error(_))}const yn="@firebase/analytics",bn="0.9.4";function dc(){oe(new $t(Ve,(t,{options:d})=>{const p=t.getProvider("app").getImmediate(),_=t.getProvider("installations-internal").getImmediate();return hc(p,_,d)},"PUBLIC")),oe(new $t("analytics-internal",c,"PRIVATE")),Zt(yn,bn),Zt(yn,bn,"esm2017");function c(t){try{const d=t.getProvider(Ve).getImmediate();return{logEvent:(p,_,b)=>Se(d,p,_,b)}}catch(d){throw Yt.create("interop-component-reg-failed",{reason:d})}}}dc();var gc="firebase",mc="9.18.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Zt(gc,mc,"app");const pc={apiKey:"AIzaSyD57hutaqXEkYVTDX5foWenR2LmG7_1jyM",authDomain:"dev-jeans-9f478.firebaseapp.com",projectId:"dev-jeans-9f478",storageBucket:"dev-jeans-9f478.appspot.com",messagingSenderId:"31771451735",appId:"1:31771451735:web:92841c507a7ee00301de12",measurementId:"G-LLL5G2XTTH"},vc=Kn(pc),je=uc(vc);function Cn(c,t,d){const p=c.slice();return p[7]=t[d],p}function wn(c){let t,d,p=ve[c[7]].title+"",_,b,y,h,e;return{c(){t=$("li"),d=$("button"),_=Vt(p),y=dt(),F(d,"class",b=Ne(c[0][c[7]]?"active":"")+" svelte-122p4th"),F(t,"class","svelte-122p4th")},m(l,o){ot(l,t,o),Q(t,d),Q(d,_),Q(t,y),h||(e=ct(d,"click",c[1](c[7])),h=!0)},p(l,o){c=l,o&1&&b!==(b=Ne(c[0][c[7]]?"active":"")+" svelte-122p4th")&&F(d,"class",b)},d(l){l&&st(t),h=!1,e()}}}function _c(c){let t,d,p,_,b,y,h,e,l,o=Object.keys(ve),n=[];for(let r=0;r<o.length;r+=1)n[r]=wn(Cn(c,o,r));return{c(){t=$("div"),d=$("h2"),d.textContent="아이템을 추가해 꾸며주세요!",p=dt(),_=$("ul"),b=$("li"),y=$("button"),y.textContent="초기화 하기",h=dt();for(let r=0;r<n.length;r+=1)n[r].c();F(d,"class","svelte-122p4th"),F(y,"class","reset svelte-122p4th"),F(b,"class","svelte-122p4th"),F(_,"class","toolbar svelte-122p4th"),F(t,"class","container svelte-122p4th")},m(r,i){ot(r,t,i),Q(t,d),Q(t,p),Q(t,_),Q(_,b),Q(b,y),Q(_,h);for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(_,null);e||(l=ct(y,"click",c[2]),e=!0)},p(r,[i]){if(i&3){o=Object.keys(ve);let a;for(a=0;a<o.length;a+=1){const u=Cn(r,o,a);n[a]?n[a].p(u,i):(n[a]=wn(u),n[a].c(),n[a].m(_,null))}for(;a<n.length;a+=1)n[a].d(1);n.length=o.length}},i:bt,o:bt,d(r){r&&st(t),Xe(n,r),e=!1,l()}}}function yc(c,t,d){let p,_,b;Et(c,ki,o=>d(0,p=o)),Et(c,ye,o=>d(3,_=o)),Et(c,be,o=>d(4,b=o)),Mn(()=>{Se(je,"꾸미기 탭 진입")});const y=o=>{let n=ve[o].src;Se(je,`${ve[o].title} 추가`),se.fabric.Image.fromURL(n,function(r){r.scaleToWidth(b),r.scaleToWidth(b),r.selectable=!1,r.set("costume",o),_.add(r),_.getObjects().forEach(i=>{(i.costume==="basketball"||i.costume==="laptop")&&_.moveTo(i,100)}),_.renderAll()})},h=o=>{const n=_.getObjects();Se(je,`${ve[o].title} 제거`),n.filter(i=>i.costume===o).forEach(i=>_.remove(i))},e=o=>()=>{ya(o)},l=()=>{Se(je,"초기화 버튼 클릭"),ba()};return c.$$.update=()=>{if(c.$$.dirty&9&&_){const o=_.getObjects();for(const n in p){const r=o.find(i=>i.costume===n);r&&!p[n]&&h(n),!r&&p[n]&&y(n)}}},[p,e,l,_]}class bc extends kt{constructor(t){super(),At(this,t,yc,_c,Ot,{})}}const Cc="/assets/watermark-c2d43a34.png",wc="/assets/close-7faef788.svg";const Sc=c=>({}),Sn=c=>({});function Tc(c){let t,d,p,_,b,y,h,e,l,o;const n=c[3].header,r=Ae(n,c,c[2],Sn),i=c[3].default,a=Ae(i,c,c[2],null);return{c(){t=$("dialog"),d=$("div"),r&&r.c(),p=dt(),a&&a.c(),_=dt(),b=$("button"),y=$("img"),fi(y.src,h=wc)||F(y,"src",h),F(y,"aria-hidden",""),F(y,"alt","닫기"),F(b,"class","close svelte-ckxgtn"),b.autofocus=!0,F(b,"aria-label","닫기"),F(d,"class","svelte-ckxgtn"),F(t,"class","svelte-ckxgtn")},m(u,s){ot(u,t,s),Q(t,d),r&&r.m(d,null),Q(d,p),a&&a.m(d,null),Q(d,_),Q(d,b),Q(b,y),c[6](t),e=!0,b.focus(),l||(o=[ct(b,"click",c[5]),ct(d,"click",re(c[4])),ct(t,"close",c[7]),ct(t,"click",Or(c[8]))],l=!0)},p(u,[s]){r&&r.p&&(!e||s&4)&&Ee(r,n,u,u[2],e?ke(n,u[2],s,Sc):De(u[2]),Sn),a&&a.p&&(!e||s&4)&&Ee(a,i,u,u[2],e?ke(i,u[2],s,null):De(u[2]),null)},i(u){e||(at(r,u),at(a,u),e=!0)},o(u){ft(r,u),ft(a,u),e=!1},d(u){u&&st(t),r&&r.d(u),a&&a.d(u),c[6](null),l=!1,Ft(o)}}}function xc(c,t,d){let{$$slots:p={},$$scope:_}=t,{showModal:b}=t,y;function h(r){Dr.call(this,c,r)}const e=()=>y.close();function l(r){Ct[r?"unshift":"push"](()=>{y=r,d(1,y)})}const o=()=>d(0,b=!1),n=()=>y.close();return c.$$set=r=>{"showModal"in r&&d(0,b=r.showModal),"$$scope"in r&&d(2,_=r.$$scope)},c.$$.update=()=>{c.$$.dirty&3&&y&&b&&y.showModal()},[b,y,_,p,h,e,l,o,n]}class Oc extends kt{constructor(t){super(),At(this,t,xc,Tc,Ot,{showModal:0})}}function Ac(c){let t,d,p,_,b,y;return{c(){t=$("img"),p=dt(),_=$("button"),_.textContent="저장하기",fi(t.src,d=c[1])||F(t,"src",d),F(t,"alt","데브진스"),F(_,"class","save svelte-1cdxw3x")},m(h,e){ot(h,t,e),ot(h,p,e),ot(h,_,e),b||(y=ct(_,"click",c[3]),b=!0)},p(h,e){e&2&&!fi(t.src,d=h[1])&&F(t,"src",d)},d(h){h&&st(t),h&&st(p),h&&st(_),b=!1,y()}}}function kc(c){let t;return{c(){t=$("h2"),t.textContent="짜잔~ 완성된 이미지에요.",F(t,"slot","header"),F(t,"class","svelte-1cdxw3x")},m(d,p){ot(d,t,p)},p:bt,d(d){d&&st(t)}}}function Ec(c){let t,d,p,_,b,y,h,e,l,o;function n(i){c[4](i)}let r={$$slots:{header:[kc],default:[Ac]},$$scope:{ctx:c}};return c[0]!==void 0&&(r.showModal=c[0]),t=new Oc({props:r}),Ct.push(()=>Pt(t,"showModal",n)),{c(){yt(t.$$.fragment),p=dt(),_=$("div"),b=$("h2"),b.textContent="최종 결과물이 맘에 드시나요?",y=dt(),h=$("button"),h.textContent="만족해요!",F(b,"class","svelte-1cdxw3x"),F(h,"class","svelte-1cdxw3x"),F(_,"class","container svelte-1cdxw3x")},m(i,a){pt(t,i,a),ot(i,p,a),ot(i,_,a),Q(_,b),Q(_,y),Q(_,h),e=!0,l||(o=ct(h,"click",c[2]),l=!0)},p(i,[a]){const u={};a&130&&(u.$$scope={dirty:a,ctx:i}),!d&&a&1&&(d=!0,u.showModal=i[0],Nt(()=>d=!1)),t.$set(u)},i(i){e||(at(t.$$.fragment,i),e=!0)},o(i){ft(t.$$.fragment,i),e=!1},d(i){vt(t,i),i&&st(p),i&&st(_),l=!1,o()}}}function Dc(c,t,d){let p,_;Et(c,ye,o=>d(5,p=o)),Et(c,be,o=>d(6,_=o));let b=!1,y="";const h=()=>{se.fabric.Image.fromURL(Cc,function(o){o.scaleToWidth(_),o.scaleToWidth(_),o.selectable=!1,p.add(o),p.renderAll(),d(1,y=p.toDataURL({format:"png",quality:1,multiplier:4})),p.remove(o),d(0,b=!0)})},e=()=>{const o=document.createElement("a");o.download="dev-jeans.png",o.href=y,o.click()};function l(o){b=o,d(0,b)}return[b,y,h,e,l]}class Pc extends kt{constructor(t){super(),At(this,t,Dc,Ec,Ot,{})}}const Ti=he(me.Decorate);function Tn(c,t,d){const p=c.slice();return p[3]=t[d],p}function xn(c,t,d){const p=c.slice();return p[3]=t[d],p}function On(c){let t,d,p=c[3].label+"",_,b,y,h,e;return{c(){t=$("li"),d=$("button"),_=Vt(p),b=dt(),F(d,"type","button"),F(d,"class","svelte-bzko04"),F(t,"class",y=Ne(c[1]===c[3].value?"active":"")+" svelte-bzko04")},m(l,o){ot(l,t,o),Q(t,d),Q(d,_),Q(t,b),h||(e=ct(d,"click",function(){Ge(c[2](c[3].value))&&c[2](c[3].value).apply(this,arguments)}),h=!0)},p(l,o){c=l,o&1&&p!==(p=c[3].label+"")&&_e(_,p),o&3&&y!==(y=Ne(c[1]===c[3].value?"active":"")+" svelte-bzko04")&&F(t,"class",y)},d(l){l&&st(t),h=!1,e()}}}function An(c){let t,d,p,_;var b=c[3].component;function y(h){return{}}return b&&(d=St(b,y())),{c(){t=$("div"),d&&yt(d.$$.fragment),p=dt(),F(t,"class","box svelte-bzko04")},m(h,e){ot(h,t,e),d&&pt(d,t,null),Q(t,p),_=!0},p(h,e){if(e&1&&b!==(b=h[3].component)){if(d){It();const l=d;ft(l.$$.fragment,1,0,()=>{vt(l,1)}),Mt()}b?(d=St(b,y()),yt(d.$$.fragment),at(d.$$.fragment,1),pt(d,t,p)):d=null}},i(h){_||(d&&at(d.$$.fragment,h),_=!0)},o(h){d&&ft(d.$$.fragment,h),_=!1},d(h){h&&st(t),d&&vt(d)}}}function kn(c){let t,d,p=c[1]==c[3].value&&An(c);return{c(){p&&p.c(),t=Gt()},m(_,b){p&&p.m(_,b),ot(_,t,b),d=!0},p(_,b){_[1]==_[3].value?p?(p.p(_,b),b&3&&at(p,1)):(p=An(_),p.c(),at(p,1),p.m(t.parentNode,t)):p&&(It(),ft(p,1,1,()=>{p=null}),Mt())},i(_){d||(at(p),d=!0)},o(_){ft(p),d=!1},d(_){p&&p.d(_),_&&st(t)}}}function Ic(c){let t,d,p,_,b=c[0],y=[];for(let o=0;o<b.length;o+=1)y[o]=On(xn(c,b,o));let h=c[0],e=[];for(let o=0;o<h.length;o+=1)e[o]=kn(Tn(c,h,o));const l=o=>ft(e[o],1,1,()=>{e[o]=null});return{c(){t=$("ul");for(let o=0;o<y.length;o+=1)y[o].c();d=dt();for(let o=0;o<e.length;o+=1)e[o].c();p=Gt(),F(t,"class","taps svelte-bzko04")},m(o,n){ot(o,t,n);for(let r=0;r<y.length;r+=1)y[r]&&y[r].m(t,null);ot(o,d,n);for(let r=0;r<e.length;r+=1)e[r]&&e[r].m(o,n);ot(o,p,n),_=!0},p(o,[n]){if(n&7){b=o[0];let r;for(r=0;r<b.length;r+=1){const i=xn(o,b,r);y[r]?y[r].p(i,n):(y[r]=On(i),y[r].c(),y[r].m(t,null))}for(;r<y.length;r+=1)y[r].d(1);y.length=b.length}if(n&3){h=o[0];let r;for(r=0;r<h.length;r+=1){const i=Tn(o,h,r);e[r]?(e[r].p(i,n),at(e[r],1)):(e[r]=kn(i),e[r].c(),at(e[r],1),e[r].m(p.parentNode,p))}for(It(),r=h.length;r<e.length;r+=1)l(r);Mt()}},i(o){if(!_){for(let n=0;n<h.length;n+=1)at(e[n]);_=!0}},o(o){e=e.filter(Boolean);for(let n=0;n<e.length;n+=1)ft(e[n]);_=!1},d(o){o&&st(t),Xe(y,o),o&&st(d),Xe(e,o),o&&st(p)}}}function Mc(c,t,d){let p;Et(c,Ti,y=>d(1,p=y));let{items:_=[]}=t;const b=y=>()=>Pe(Ti,p=y,p);return c.$$set=y=>{"items"in y&&d(0,_=y.items)},[_,p,b]}class Fc extends kt{constructor(t){super(),At(this,t,Mc,Ic,Ot,{items:0})}}function Rc(c){let t,d,p;return d=new Fc({props:{items:c[0]}}),{c(){t=$("div"),yt(d.$$.fragment),F(t,"class","container svelte-1nz23oh")},m(_,b){ot(_,t,b),pt(d,t,null),p=!0},p:bt,i(_){p||(at(d.$$.fragment,_),p=!0)},o(_){ft(d.$$.fragment,_),p=!1},d(_){_&&st(t),vt(d)}}}function Lc(c){return[[{label:"꾸미기",value:me.Decorate,component:bc},{label:"배경",value:me.Background,component:Sa},{label:"사진 추가",value:me.Photo,component:Oa},{label:"저장하기",value:me.Save,component:Pc}]]}class Bc extends kt{constructor(t){super(),At(this,t,Lc,Rc,Ot,{})}}function jc(c){let t,d,p,_,b,y,h,e,l,o,n,r,i;return y=new Bc({}),{c(){t=$("main"),d=$("h1"),d.textContent="~개발진스 짤 만들어 쓰기~",p=dt(),_=$("canvas"),b=dt(),yt(y.$$.fragment),h=dt(),e=$("footer"),l=$("span"),l.innerHTML='Instagram: <a href="https://www.instagram.com/dev_hee/" class="svelte-15k31bi">@dev_hee</a>',o=dt(),n=$("span"),n.innerHTML='Blog: <a href="https://velog.io/@heelieben" class="svelte-15k31bi">@pigme</a>',F(d,"class","svelte-15k31bi"),F(_,"id","canvas"),F(_,"width","2400"),F(_,"height","2400"),Wt(_,"border","1px solid #ccc"),F(t,"style",`width: ${be}`),F(t,"class","svelte-15k31bi"),F(e,"style",r=`width: ${c[0]}`),F(e,"class","svelte-15k31bi")},m(a,u){ot(a,t,u),Q(t,d),Q(t,p),Q(t,_),ot(a,b,u),pt(y,a,u),ot(a,h,u),ot(a,e,u),Q(e,l),Q(e,o),Q(e,n),i=!0},p(a,[u]){(!i||u&1&&r!==(r=`width: ${a[0]}`))&&F(e,"style",r)},i(a){i||(at(y.$$.fragment,a),i=!0)},o(a){ft(y.$$.fragment,a),i=!1},d(a){a&&st(t),a&&st(b),vt(y,a),a&&st(h),a&&st(e)}}}function Wc(c,t,d){let p,_,b,y;Et(c,ye,l=>d(1,p=l)),Et(c,Ti,l=>d(2,_=l)),Et(c,He,l=>d(3,b=l)),Et(c,be,l=>d(0,y=l));const h=()=>window.innerWidth<600?window.innerWidth:600;return Mn(()=>{Pe(ye,p=new se.fabric.Canvas("canvas"),p),Pe(be,y=h(),y),p.setWidth(y*p.getZoom()),p.setHeight(y*p.getZoom()),se.fabric.Image.fromURL(Lr,function(l){l.scaleToWidth(y),l.scaleToWidth(y),l.selectable=!1,l.set("imageType","bunny"),p.add(l),p.renderAll()},{crossOrigin:"anonymous"})}),c.$$.update=()=>{if(c.$$.dirty&10&&p&&(p.setBackgroundImage(null,p.renderAll.bind(p)),p.setBackgroundColor(b,()=>{p.renderAll()})),c.$$.dirty&6&&p&&_){const l=p.getObjects();p.discardActiveObject(),_===me.Background?l.filter(n=>n.imageType==="bunny").forEach(n=>{n.opacity=.5}):l.filter(n=>n.imageType==="bunny").forEach(n=>{n.opacity=1}),p.renderAll()}},[y,p,_,b]}class Nc extends kt{constructor(t){super(),At(this,t,Wc,jc,Ot,{})}}new Nc({target:document.getElementById("app")});
